// Осуществляет проверку значений "НачалоПериода" и "КонецПериода"
// введенных пользователем.
Функция ПроверкаПериода()
	
	ПроверкаПройдена=Истина;
	
	Если НачалоПериода > КонецПериода Тогда
		
		Предупреждение("Неправильно задан период формирования отчета!"+Символы.ПС+
		               "Дата начала больше даты окончания периода.");
					   
		ПроверкаПройдена=Ложь;
		
	ИначеЕсли НачалоПериода='00010101' Тогда
		
		Предупреждение("Не указана дата начала отчета");
					   
		ПроверкаПройдена=Ложь;
		
	ИначеЕсли КонецПериода='00010101' Тогда
		
		Предупреждение("Не указана дата конца отчета");
					   
		ПроверкаПройдена=Ложь;
	
	КонецЕсли;
		
	Возврат ПроверкаПройдена;
	
КонецФункции // ПроверкаПериода()

Процедура ВыбПериодНажатие(Элемент)

	РаботаСДиалогами.ОбработчикНастройкаПериодаНажатие(НачалоПериода, КонецПериода);
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	НачалоПериода = НачалоМесяца(РабочаяДата);
	КонецПериода = КонецМесяца(РабочаяДата);

	СформироватьОтчетПоСтандартнойФорме = Истина;
	СкрытьКолонкиПоСтавке20 = Истина;
	
	// Установка настроек печати по умолчанию. Если настройки были изменены, они будут загружены при формировании отчета
	ЭлементыФормы.ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
	ЭлементыФормы.ТабличныйДокумент.АвтоМасштаб = Истина;
	
	УстановитьВидимость();

КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Организация = глЗначениеПеременной("ОсновнаяОрганизация");
	
КонецПроцедуры

Процедура КоманднаяПанельСформировать(Кнопка) Экспорт
	
	СформироватьОтчет();
	
КонецПроцедуры

Процедура СформироватьОтчет()
	
	Если Не ЗначениеЗаполнено(Организация) Тогда
		Предупреждение("Не указана организация.");
		Возврат;
	КонецЕсли;
	
	Если Не ПроверкаПериода() Тогда
		Возврат;
	КонецЕсли;
	
	ЭлементыФормы.ПанельРазделовКниги.Страницы.ОсновнойРаздел.Видимость = Не (ФормироватьДополнительныеЛисты И ВыводитьТолькоДопЛисты);
	
	СформироватьКнигуПокупок(ЭлементыФормы);
	
	ЭлементыФормы.ПанельРазделовКниги.ТекущаяСтраница = ЭлементыФормы.ПанельРазделовКниги.Страницы.ОсновнойРаздел;
	ТекущийЭлемент = ЭлементыФормы.ТабличныйДокумент;
	
КонецПроцедуры

Процедура УстановитьВидимость()
	
	ЭлементыФормы.ДополнительныеЛистыЗаТекущийПериод.Доступность = ФормироватьДополнительныеЛисты;
	ЭлементыФормы.ВыводитьТолькоДопЛисты.Доступность = ФормироватьДополнительныеЛисты;
	
	ЭлементыФормы.ВключаяОбособленныеПодразделения.Видимость = СтандартныеОтчеты.ДоступностьУчетаПоПодразделениям();
	
КонецПроцедуры

Процедура ФормироватьДополнительныеЛистыПриИзменении(Элемент)
	
	Если Не ФормироватьДополнительныеЛисты И ВыводитьТолькоДопЛисты Тогда
		ВыводитьТолькоДопЛисты = Ложь;
	КонецЕсли;
	
	УстановитьВидимость();
	
КонецПроцедуры

Процедура КоманднаяПанельДействиеНастройка(Кнопка)
	
	ФормаНастройки = ПолучитьФорму("ФормаНастройки");
	ФормаНастройки.ГруппироватьПоКонтрагентам = ГруппироватьПоКонтрагентам;
	ФормаНастройки.КонтрагентДляОтбора = КонтрагентДляОтбора;
	ФормаНастройки.ОтбиратьПоКонтрагенту = ОтбиратьПоКонтрагенту;
	ФормаНастройки.СкрытьКолонкиПоСтавке20 = СкрытьКолонкиПоСтавке20;
	ФормаНастройки.СформироватьОтчетПоСтандартнойФорме = СформироватьОтчетПоСтандартнойФорме;
	ФормаНастройки.ВыводитьПокупателейПоАвансам = ВыводитьПокупателейПоАвансам;
	
	Если ФормаНастройки.ОткрытьМодально() = Истина Тогда
		ГруппироватьПоКонтрагентам = ФормаНастройки.ГруппироватьПоКонтрагентам;
		КонтрагентДляОтбора = ФормаНастройки.КонтрагентДляОтбора;
		ОтбиратьПоКонтрагенту = ФормаНастройки.ОтбиратьПоКонтрагенту;
		СкрытьКолонкиПоСтавке20 = ФормаНастройки.СкрытьКолонкиПоСтавке20;
		СформироватьОтчетПоСтандартнойФорме = ФормаНастройки.СформироватьОтчетПоСтандартнойФорме;
		ВыводитьПокупателейПоАвансам = ФормаНастройки.ВыводитьПокупателейПоАвансам;
		
		СформироватьОтчет();
			
	КонецЕсли;		
	
КонецПроцедуры

Процедура ТабличныйДокументОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	Если ТипЗнч(Расшифровка) = Тип("СписокЗначений") Тогда
		СтандартнаяОбработка = Ложь;
		ЭлементВыбора = Расшифровка.ВыбратьЭлемент("Выберите счет-фактуру");
		
		Если ЭлементВыбора <> Неопределено Тогда
			ФормаДокумента = ЭлементВыбора.Значение.ПолучитьФорму("ФормаДокумента");
			ФормаДокумента.Открыть();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
