////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ

// Поля табличных документов
Перем мТитульный;
Перем мТитульный002;
Перем мРаздел1;
Перем мРаздел2;
Перем мРаздел3;
Перем мРаздел4;
Перем мРаздел5;
Перем мРаздел6;
Перем мЛистА;				//раздел 7
Перем мЛистБ;				//раздел 8
Перем мЛистВ;				//раздел 9
Перем мЛистГ1;				//раздел 10
Перем мЛистГ1Продолжение;	//раздел 25
Перем мЛистГ2;				//раздел 11
Перем мЛистГ3;				//раздел 26
Перем мЛистД;				//раздел 12
Перем мЛистЕ;				//раздел 13
Перем мЛистЖ1;				//раздел 14
Перем мЛистЖ2;				//раздел 15
Перем мЛистЗ;				//раздел 16
Перем мЛистЗПродолжение;	//раздел 17
Перем мЛистИ;				//раздел 18
Перем мЛистИПродолжение;	//раздел 19
Перем мЛистК1;				//раздел 20
Перем мЛистК2;				//раздел 21
Перем мЛистК3;				//раздел 22
Перем мЛистК4;				//раздел 23
Перем мЛистЛ;				//раздел 24

// Хранит имена многострочных разделов
Перем мИдГруппыА, мИдГруппыБ, мИдГруппыВ, мИдГруппыГ1Продолжение, мИдГруппыГ2, мИдГруппыГ3;
Перем мИдГруппыД, мИдГруппыЕ;
Перем мИдГруппыЖ2_1, мИдГруппыЖ2_2, мИдГруппыЗ, мИдГруппыИ, мИдГруппыК3_1, мИдГруппыК3_2;
Перем мИдГруппыК4_1, мИдГруппыК4_2;

Перем мСтатусНалогоплательщика;

Перем мСтруктураМногостраничныхРазделов Экспорт;
Перем мСтруктураМногострочныхРазделов Экспорт;

//Список ячеек многострачниой формы которые не разбиваются при выводе на печать
Перем мСписокМоноЯчеек;

Перем мСтруктураИсхКолвоСтрокРазделов Экспорт;

// Хранит дерево значений - список выводимых на печать страниц
Перем мДеревоВыбранныхСтраниц Экспорт;

// Хранит форматную строку представления денежных показателей отчета
Перем мСтрокаФормата Экспорт;

// Хранит код отчета по КНД
Перем мКодОтчета;

// Хранит коллекцию цветов раскраски автоматически заполняемых ячеек табличного документа
Перем мСтруктураЦветовРаскраски Экспорт;

Перем ВариантыФорматовВыгрузки;
Перем ТаблицаСообщений Экспорт;

Перем мПечатныеФормы Экспорт;
Перем мПечатаемыеРазделы Экспорт;

Перем мСвойстваРазделовДекларации Экспорт;

// Для явной установки типа значения 17, 2 - менять нельзя!
Перем мОписаниеТиповЧислоЕ Экспорт;
// Для явной установки типа значения 17, 4 - менять нельзя!
Перем мОписаниеТиповЧислоЕ4 Экспорт;
// Для явной установки типа значения 17, 0 - менять нельзя!
Перем мОписаниеТиповЧислоЕ0 Экспорт;

// Для явной установки типа значения 9, 2 - менять нельзя!
Перем мОписаниеТиповЧислоЕ9 Экспорт;
// Для явной установки типа значения 8, 2 - менять нельзя!
Перем мОписаниеТиповЧислоЕ8 Экспорт;
// Для явной установки типа значения 7, 2 - менять нельзя!
Перем мОписаниеТиповЧислоЕ7 Экспорт;

Перем мСоставПоказателей Экспорт;

Перем мБезОткрытияФормы Экспорт;
Перем мРежимПечати Экспорт;

Перем СвойстваПоказателей Экспорт;

Перем СоответствиеЕдиницыИзмеренияДелителю;

Перем мДанныеОтчета Экспорт;

Перем ПС;

Перем ЦветЗаполняетсяАвтоАрифметика;

//Вспомогательные переменные для заполнения формы
Перем мРезидент;

// Удаляет строку многострочного раздела формы.
Процедура УдалитьДополнительнуюСтроку(СпециальноеДобавление = Ложь, ИмяКолонкиНомера = Неопределено, ИмяГруппы = Неопределено, Спросить = Истина) Экспорт
	Перем ИсходноеКоличествоСтрокГруппы;
	Перем СтруктураГруппы;

	ТекущаяСтраница = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница.Имя;
	ТекТабличноеПоле = ЭлементыФормы["ПолеТабличногоДокумента" + ТекущаяСтраница];

	ТекущаяОбласть = ТекТабличноеПоле.ТекущаяОбласть;
	Если ИмяГруппы = Неопределено Тогда
		ИмяГруппы = РегламентированнаяОтчетность.роРазделТекущейОбласти(ЭтаФорма, ТекущаяОбласть);
	КонецЕсли;
	
	Если ИмяГруппы = Неопределено Тогда
		Сообщить("Не выбрана удаляемая строка многострочного раздела.", СтатусСообщения.Внимание);
		Возврат;
	КонецЕсли;

	Если Спросить Тогда
	Ответ = Вопрос("Удалить выбранную строку?" + Символы.ПС
		  + "(Внимание! данная операция необратима)", РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Да);
	  Иначе
		Ответ = КодВозвратаДиалога.Да;
	КонецЕсли;
	
	Если Ответ <> КодВозвратаДиалога.Да Тогда
		Возврат;
	КонецЕсли;

	// исходное количество строк группы
	мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, ИсходноеКоличествоСтрокГруппы);

	ТекТабличноеПоле = ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИмяГруппы);
	мСтруктураМногострочныхРазделов.Свойство(ИмяГруппы, СтруктураГруппы);

	// Выполним также проверку вхождения текущей (выделенной) ячейки в многострочный раздел
	ТекущаяОбласть = ТекТабличноеПоле.ТекущаяОбласть;
	ИмяЯчейки = ТекущаяОбласть.Имя;

	// номер строки многострочного раздела определим
	// по имени выделенной ячейки
	НомУдаляемойСтроки = Число(Сред(ИмяЯчейки, Найти(ИмяЯчейки, "_") + 1));
	НомерСтрокиТаблицы = НомУдаляемойСтроки - 1; // нумерация строк в таблице значений начинается с нуля

	Если СтруктураГруппы.Количество() > ИсходноеКоличествоСтрокГруппы Тогда
		// удаляется добавленная строка
		ИмяПервойЯчейкиУдаляемойСтроки = СтруктураГруппы.Колонки[0].Имя + "_" + Формат(НомУдаляемойСтроки, "ЧГ=0");

		// область первой ячейки удаляемой строки многострочного раздела
		ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяПервойЯчейкиУдаляемойСтроки];

		НастройкиМнгЧ = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ТекТабличноеПоле.Имя, "МногострочностьВРазделе").Найти(ИмяГруппы, "ИдГруппы");
		ВысотаСтроки = НастройкиМнгЧ.ВысотаСтроки;
		
		НомерВерхЯчейкиОбласти = ОбластьЯчейки.Верх;
		НомерНижнЯчейкиОбласти = ОбластьЯчейки.Низ + ВысотаСтроки - 1;
		
		МногострочностьВРазделе = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ТекущаяСтраница, "МногострочностьВРазделе");
		МногострочностьВРазделеТип = ТипЗнч(МногострочностьВРазделе);
		Если МногострочностьВРазделеТип = Тип("Число") Тогда
			ИмяОбластиМнгЧ = "МногострочнаяЧасть";
		ИначеЕсли МногострочностьВРазделеТип = Тип("ТаблицаЗначений") Тогда
			ИмяОбластиМнгЧ = МногострочностьВРазделе.Найти(ИмяГруппы, "ИдГруппы").Область;
		КонецЕсли;
		// Найдем координаты области, для последующего восстановления.

		Если ТекТабличноеПоле.Области.Найти(ИмяОбластиМнгЧ) <> Неопределено Тогда
			ОбластьВерх = ТекТабличноеПоле.Области[ИмяОбластиМнгЧ].Верх;
			ОбластьНиз = ТекТабличноеПоле.Области[ИмяОбластиМнгЧ].Низ;
		КонецЕсли;

		Если СпециальноеДобавление Тогда
			// Запустим единую процедуру удаляющая строку по специальному алгоритму
			// Используется в: ОчиститьТабличноеПоле(), ЗаполнитьРаздел2()
			//СпециальногоУдаленияСтроки(ТекТабличноеПоле, ИмяГруппы, НомерВерхЯчейкиОбласти, НомерНижнЯчейкиОбласти);
		Иначе
			// Определим область удаляемой строки
			УдаляемаяОбласть = ТекТабличноеПоле.Область(НомерВерхЯчейкиОбласти, , НомерНижнЯчейкиОбласти,);
			// непосредственно удаляем область строки табличного документа
			ТекТабличноеПоле.УдалитьОбласть(УдаляемаяОбласть, ТипСмещенияТабличногоДокумента.ПоВертикали);
		КонецЕсли;
		// Восстановим область.
		Если ТекТабличноеПоле.Области.Найти(ИмяОбластиМнгЧ) <> Неопределено Тогда
			ТекТабличноеПоле.Области[ИмяОбластиМнгЧ].Имя = "";
			ТекТабличноеПоле.Область(ОбластьВерх, 0, ОбластьНиз, 0).Имя = ИмяОбластиМнгЧ;
		КонецЕсли;

		КолвоСдвигаемыхСтрок = СтруктураГруппы.Количество() - НомУдаляемойСтроки;

		// обновим имена ячеек сдвинутых строк
		Если КолвоСдвигаемыхСтрок > 0 Тогда

			Для НСтр = НомУдаляемойСтроки + 1 По СтруктураГруппы.Количество() Цикл

				ТекСтрока = СтруктураГруппы[НСтр - 1];

				НСтрСтр = Формат(НСтр, "ЧГ=0");
				НСтрСтр1 = Формат(НСтр - 1, "ЧГ=0");
				Для Каждого Колонка Из СтруктураГруппы.Колонки Цикл
					КолонкаИмя = Колонка.Имя;
					ИмяСдвинутойЯчейки = КолонкаИмя + "_" + НСтрСтр;
					НовоеИмяСдвинутойЯчейки = КолонкаИмя + "_" + НСтрСтр1;

					ОбластьСдвинутойЯчейки = ТекТабличноеПоле.Области[ИмяСдвинутойЯчейки];
					ОбластьСдвинутойЯчейки.Имя = НовоеИмяСдвинутойЯчейки;

					Если ИмяКолонкиНомера <> Неопределено Тогда
						Если ИмяКолонкиНомера = КолонкаИмя Тогда
							// обновляем порядковый номер строки

							СтарыйНомер = Число(ТекСтрока[КолонкаИмя]);
							НовыйПорядковыйНомер = Строка(Макс(СтарыйНомер - 1, 0));
							ОбластьСдвинутойЯчейки.Текст = НовыйПорядковыйНомер;

							// обновляем значение элемента таблицы значений
							ТекСтрока[КолонкаИмя] = НовыйПорядковыйНомер;
						КонецЕсли;
					КонецЕсли;
				КонецЦикла;

			КонецЦикла;
		КонецЕсли;

		// обновляем структуру многострочного раздела
		СтруктураГруппы.Удалить(НомерСтрокиТаблицы);

	Иначе
		// строка не удаляется в форме табличного документа,
		// а должна осуществляться сдвиг строк

		// обновляем структуру многострочного раздела
		// методом удаления выбранной строки и добавления пустой строки
		СтруктураГруппы.Удалить(НомерСтрокиТаблицы);

		ДобавляемаяСтрока = СтруктураГруппы.Добавить();

		// обновляем порядковые номера строк, выводимых в табличный документ
		Для Каждого СтрокаТаблицы Из СтруктураГруппы Цикл
			НомерСтрокиВТаблице = СтруктураГруппы.Индекс(СтрокаТаблицы);
			НомерСтрокиВФормеТаблицы = Формат(НомерСтрокиВТаблице + 1, "ЧГ=0");
			Для Каждого КолонкаТаблицы Из СтруктураГруппы.Колонки Цикл
				КолонкаТаблицыИмя = КолонкаТаблицы.Имя;

				Если ИмяКолонкиНомера <> Неопределено Тогда
					Если ИмяКолонкиНомера = КолонкаТаблицыИмя Тогда
						// обновляем порядковый номер строки
						СтрокаТаблицы[КолонкаТаблицыИмя] = НомерСтрокиВФормеТаблицы;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
		КонецЦикла;

		// Данные в многострочном блоке обновляются в декларациях!
		// Форма.ОбновитьСтруктуруМногострочногоРаздела(ИмяГруппы);
		// Обновляем экранную форму табличного документа
		ВывестиРазделВТабличныйДокумент(ИмяГруппы, СтруктураГруппы);

	КонецЕсли;

	// назначим текущей областью таблицы первую редактируемую ячейку
	// удаленной строки, если ее порядковый номер меньше кол-ва строк
	// многострочного раздела, или последней строки раздела в противном случае

	// определяем текущую область таблицы
	НомТекущейСтроки = Мин(НомУдаляемойСтроки, СтруктураГруппы.Количество());
	ИмяТекущейОбласти = СтруктураГруппы.Колонки[0].Имя + "_" + Формат(НомТекущейСтроки, "ЧГ=0");

	ТекТабличноеПоле.ТекущаяОбласть = ТекТабличноеПоле.Области[ИмяТекущейОбласти];

	// установим фокус на поле табличн. документа
	ТекущийЭлемент = ТекТабличноеПоле;

	Модифицированность = Истина;

КонецПроцедуры // УдалитьДополнительнуюСтроку()

// Проверяет указанную строку КодПок на соответствие требованиям, предъявляемым
// к именам предписанных показателей в форматах представления отчетности версий 2.00, 2.01 и 3.00
Функция ЭтоКодПоказателяП(КодПок) 
	
	Если СтрДлина(КодПок) < 13 Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Пок = СокрЛП(КодПок);
	
	Если Сред(Пок, 1, 1) = "П" Тогда
		
		Для Сч = 2 По 13 Цикл
			
			КодСимв = КодСимвола(Пок, Сч);
			
			Если НЕ ((КодСимв >= КодСимвола("0")) И (КодСимв <= КодСимвола("9"))) Тогда
				Возврат Ложь;
			КонецЕсли;
			
		КонецЦикла;
		
		Возврат Истина;
		
	Иначе
		Возврат Ложь;
	КонецЕсли;
	
КонецФункции

// ПолучитьТаблицуМногостраничногоРаздела
// флМногострочность - Булево, для многостраничных разделов, являющихся многострочными = Истина
// Возвращаемое значение:
//  ТаблицаЗначений, эталонная таблица многостраничного раздела, с одним экземпляром и активной страницей.
//
Функция ПолучитьТаблицуМногостраничногоРаздела(флМногострочность = Ложь)
	ОписаниеТиповСтрока254 = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(254);

	МассивБулево = Новый Массив;
	МассивБулево.Добавить(Тип("Булево"));
	мОписаниеТиповБулево = Новый ОписаниеТипов(МассивБулево);

	ТаблицаСтраницыРаздела = Новый ТаблицаЗначений;
	ТаблицаСтраницыРаздела.Колонки.Добавить("Представление", ОписаниеТиповСтрока254, "Наименование");
	ТаблицаСтраницыРаздела.Колонки.Добавить("АктивнаяСтраница", мОписаниеТиповБулево);
	ТаблицаСтраницыРаздела.Колонки.Добавить("Данные");
	Если флМногострочность Тогда
		ТаблицаСтраницыРаздела.Колонки.Добавить("ДанныеДопСтрок");	
	КонецЕсли;
	ТаблицаСтраницыРаздела.Колонки.Добавить("АвтоматическоеПредставление", мОписаниеТиповБулево);

	СтрПерваяСтраница = ТаблицаСтраницыРаздела.Добавить();
	СтрПерваяСтраница.Представление = "Новая страница";
	СтрПерваяСтраница.АктивнаяСтраница = Истина;
	СтрПерваяСтраница.АвтоматическоеПредставление = Истина;
	Возврат ТаблицаСтраницыРаздела;

КонецФункции // ПолучитьТаблицуМногостраничногоРаздела

// СпециальныеОперацииПослеОчисткиЛиста
// Процедура вызывается из модуля РО. При удалении листа любого раздела отчета.
// Вызов происходит в том случае, если в св-вах раздела установлен реквизит ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Истина
// если в св-вах такого реквизита нет, то после удаления листа запускается расчет этого листа.
//
// В подобных процедурах должны выполняться действия, которые следуют за удалением доп. страниц. пересчет номеров, закрашивание ячеек и т.д.
// Если в разделе в св-вах нет ключа СпециальныеОперацииПослеОчисткиЛиста = Ложь или нет для многостраничного раздела
// тогда не вызывается эта процедура.
//
// Параметры:
//  ИмяСтраницы    - имся страницы раздела декларации
//  УдалениДопЭкз  - Булево. Имеет смысл только для многостраничных разделов. Если Истина, то выбрана очистка всего раздела "насквозь" включая
//                 удаление всех доп страниц. Если Ложь - то очистка только текущего табличного поля.
//
Процедура СпециальныеОперацииПослеОчисткиЛиста(ИмяСтраницы, УдалениДопЭкз) Экспорт

	Расчет("");

КонецПроцедуры // СпециальныеОперацииПослеОчисткиЛиста

Процедура ПоказатьСтраницуМногостраничногоРазделаПриВосстановлении(Шаг, ИмяТекущейСтраницыПанели, УчестьАктивнуюСтраницу = Ложь)

	РегламентированнаяОтчетность.роПоказатьСтраницуМногостраничногоРазделаПриВосстановлении(ЭтаФорма, Шаг, ИмяТекущейСтраницыПанели, УчестьАктивнуюСтраницу);

КонецПроцедуры

// Формирует дерево значений - структуру страниц отчета,
// содержащей настройки показа страниц, вывода на печать и выгрузки в ИФНС.
//
Процедура ФормироватьСтруктуруСвойствСтраниц() Экспорт

	ОписаниеТиповБулево			= Новый ОписаниеТипов("Булево");
	ОписаниеТиповСтрока100		= ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(100);
	ОписаниеТиповСтрока50		= ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(50);
	ОписаниеТиповЧисло1			= ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(1);


	мСвойстваРазделовДекларации           = Новый ДеревоЗначений;
	мСвойстваРазделовДекларации.Колонки.Добавить("ИмяСтраницы", ОписаниеТиповСтрока100);
	
	мСвойстваРазделовДекларации.Колонки.Добавить("МногострочностьВРазделе");
	// 0 - нет
	// 1 - есть одна многострочная часть
	// 2 - и более, точное кол-во число многострочных частей на листе

	// Позволяет записывать многострочность в многостраничных документ либо как ТаблицуЗначений, либо как Структуру
	// В случае, если как Структура, то необходима еще одна процедура СформироватьСтруктуруДанныхДопСтрокСтраницы
	// Только для Многостраничных документов !
	мСвойстваРазделовДекларации.Колонки.Добавить("СохранятьМногострКакТЗ", ОписаниеТиповБулево);

	мСвойстваРазделовДекларации.Колонки.Добавить("МногостраничностьВРазделе", ОписаниеТиповБулево);
	// Ложь   - нет
	// Истина - да

	мСвойстваРазделовДекларации.Колонки.Добавить("МаксКолвоЭкз", ОписаниеТиповЧисло1);
	//максимальное количество экземпляров (страниц) многостраничного раздела (листа)
	//0-9 (0 - неограниченное количество экземпляров. Значения 1-9 имеют смысл при значении в колонке МногостраничностьВРазделе = Истина)
	
	
	// 3. Будет ли очищаться раздел по кнопки "Очистить"
	// Название параметра
	мСвойстваРазделовДекларации.Колонки.Добавить("ОчищатьРаздел", ОписаниеТиповБулево);
	// Ложь   - нет
	// Истина - да

	// 4. Если раздел многостраничный, параметр МногостраничностьВРазделе = Истина, тогда имя поля, по которому
	// будет осуществляться Представление доп. страницы
	// Название параметра
	мСвойстваРазделовДекларации.Колонки.Добавить("ИмяПредставления", ОписаниеТиповСтрока50);

	// 5. Есть ли в разделе значения, отображаемые в квадратном представлении
	// Название параметра
	мСвойстваРазделовДекларации.Колонки.Добавить("ПредставлениеДанных", ОписаниеТиповБулево);

	// 6. Обязательный раздел для выгрузки или нет
	// Название параметра
	мСвойстваРазделовДекларации.Колонки.Добавить("РазделОбязателенДляВыгрузки", ОписаниеТиповБулево);
	// Ложь   - нет
	// Истина - да

	// 7. Обязательный раздел для выгрузки или нет
	// Название параметра
	мСвойстваРазделовДекларации.Колонки.Добавить("НазваниеПанелиТабличногоПоляРаздела", ОписаниеТиповСтрока50);

	мСвойстваРазделовДекларации.Колонки.Добавить("РазделЯвляетсяАвтозаполняемым", ОписаниеТиповБулево);

	// Для разделов, где этот ключ = Истина после очистки листа будет запускаться экспортная процедура из РО модуля СпециальныеОперацииПослеОчисткиЛиста.
	мСвойстваРазделовДекларации.Колонки.Добавить("ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста", ОписаниеТиповБулево);

	//настройка многострочных частей
	МногострочностьНастройка = Новый ТаблицаЗначений;
	МногострочностьНастройка.Колонки.Добавить("ИдГруппы");
	МногострочностьНастройка.Колонки.Добавить("Область");
	МногострочностьНастройка.Колонки.Добавить("ВысотаСтроки");
	МногострочностьНастройка.Колонки.Добавить("НезаполняемыеПоказателиЕсть", ОписаниеТиповБулево);

	МнгЛистА = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистА.Добавить();
	НовСтр.ИдГруппы = мИдГруппыА;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 18;
	
	МнгЛистБ = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистБ.Добавить();
	НовСтр.ИдГруппы = мИдГруппыБ;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 32;
	
	МнгЛистВ = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистВ.Добавить();
	НовСтр.ИдГруппы = мИдГруппыВ;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 30;
	
	МнгЛистГ1Продолжение = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистГ1Продолжение.Добавить();
	НовСтр.ИдГруппы = мИдГруппыГ1Продолжение;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 6;
	
	МнгЛистГ2 = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистГ2.Добавить();
	НовСтр.ИдГруппы = мИдГруппыГ2;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 14;
	
	МнгЛистГ3 = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистГ3.Добавить();
	НовСтр.ИдГруппы = мИдГруппыГ3;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 14;
	
	МнгЛистД = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистД.Добавить();
	НовСтр.ИдГруппы = мИдГруппыД;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 24;
	
	МнгЛистЕ = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистЕ.Добавить();
	НовСтр.ИдГруппы = мИдГруппыЕ;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 14;
	
	МнгЛистЖ2 = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистЖ2.Добавить();
	НовСтр.ИдГруппы = мИдГруппыЖ2_1;
	НовСтр.Область = "МногострочнаяЧасть1";
	НовСтр.ВысотаСтроки = 14;
	НовСтр = МнгЛистЖ2.Добавить();
	НовСтр.ИдГруппы = мИдГруппыЖ2_2;
	НовСтр.Область = "МногострочнаяЧасть2";
	НовСтр.ВысотаСтроки = 14;
	
	МнгЛистЗ = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистЗ.Добавить();
	НовСтр.ИдГруппы = мИдГруппыЗ;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 20;
	
	МнгЛистИ = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистИ.Добавить();
	НовСтр.ИдГруппы = мИдГруппыИ;
	НовСтр.Область = "МногострочнаяЧасть";
	НовСтр.ВысотаСтроки = 20;
	
	МнгЛистК3 = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистК3.Добавить();
	НовСтр.ИдГруппы = мИдГруппыК3_1;
	НовСтр.Область = "МногострочнаяЧасть1";
	НовСтр.ВысотаСтроки = 18;
	НовСтр = МнгЛистК3.Добавить();
	НовСтр.ИдГруппы = мИдГруппыК3_2;
	НовСтр.Область = "МногострочнаяЧасть2";
	НовСтр.ВысотаСтроки = 18;
	
	МнгЛистК4 = МногострочностьНастройка.Скопировать();
	НовСтр = МнгЛистК4.Добавить();
	НовСтр.ИдГруппы = мИдГруппыК4_1;
	НовСтр.Область = "МногострочнаяЧасть1";
	НовСтр.ВысотаСтроки = 18;
	НовСтр = МнгЛистК4.Добавить();
	НовСтр.ИдГруппы = мИдГруппыК4_2;
	НовСтр.Область = "МногострочнаяЧасть2";
	НовСтр.ВысотаСтроки = 18;
	
	мСвойстваРазделовДекларации.Строки.Очистить();

	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Титульный";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Ложь;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Титульный002";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Ложь;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Раздел1";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;

	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Раздел2";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Раздел3";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Раздел4";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Раздел5";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "Раздел6";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистА";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистА;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 5;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистБ";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистБ;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 5;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистВ";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистВ;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистГ1";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистГ1Продолжение";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистГ1Продолжение;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 10;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистГ2";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистГ2;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистГ3";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистГ3;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистД";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистД;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 2;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистЕ";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистЕ;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 2;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистЖ1";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистЖ2";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистЖ2;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Ложь;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 2;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистЗ";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистЗ;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 2;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистЗПродолжение";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;//
	СтрокаУровня1.МаксКолвоЭкз						   = 2;//
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистИ";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистИ;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Истина;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;
	СтрокаУровня1.МаксКолвоЭкз						   = 2;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Ложь;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистИПродолжение";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Истина;//
	СтрокаУровня1.МаксКолвоЭкз						   = 2;//
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистК1";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистК2";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистК3";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистК3;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Ложь;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистК4";
	СтрокаУровня1.МногострочностьВРазделе              = МнгЛистК4;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Ложь;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	СтрокаУровня1 = мСвойстваРазделовДекларации.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы                          = "ЛистЛ";
	СтрокаУровня1.МногострочностьВРазделе              = 0;
	СтрокаУровня1.СохранятьМногострКакТЗ               = Неопределено;
	СтрокаУровня1.МногостраничностьВРазделе            = Ложь;
	СтрокаУровня1.МаксКолвоЭкз						   = 0;
	СтрокаУровня1.ОчищатьРаздел                        = Истина;
	СтрокаУровня1.ИмяПредставления                     = "";
	СтрокаУровня1.ПредставлениеДанных                  = Истина;
	СтрокаУровня1.РазделОбязателенДляВыгрузки          = Неопределено;
	СтрокаУровня1.НазваниеПанелиТабличногоПоляРаздела  = "ОсновнаяПанель";
	СтрокаУровня1.РазделЯвляетсяАвтозаполняемым        = Ложь;
	СтрокаУровня1.ЗапускатьОтдельнуюОбработкуПослеОчисткиЛиста = Ложь;
	
	
	ОписаниеТиповСтрока254 = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(254);

КонецПроцедуры // ФормироватьСтруктуруСвойствСтраниц()

Функция СформироватьСтруктуруДанныхДопСтрокСтраницы(ИмяСтраницы) Экспорт
	
	Перем СтруктураДанныхДопСтрокРаздела;

	Если ИмяСтраницы = "ЛистЖ2" Тогда

		// Так как раздел содержит несколько многострочных блоков,
		// то поочередно сохраняем данные дополнительных строк каждого блока.
		ОбновитьСтруктуруМногострочногоРаздела(мИдГруппыЖ2_1);
		ОбновитьСтруктуруМногострочногоРаздела(мИдГруппыЖ2_2);
		
		СтруктураДанныхДопСтрокРаздела = Новый Структура;

		// Обновим структуру, хранящую данные строк многострочных блоков.
		ПромТаблицаДопСтрокРаздела = Новый ТаблицаЗначений;
		мСтруктураМногострочныхРазделов.Свойство(мИдГруппыЖ2_1, ПромТаблицаДопСтрокРаздела);
		ТаблицаДопСтрокГруппы1 = ПромТаблицаДопСтрокРаздела.Скопировать();
		СтруктураДанныхДопСтрокРаздела.Вставить(мИдГруппыЖ2_1, ТаблицаДопСтрокГруппы1);

		ПромТаблицаДопСтрокРаздела = Новый ТаблицаЗначений;
		мСтруктураМногострочныхРазделов.Свойство(мИдГруппыЖ2_2, ПромТаблицаДопСтрокРаздела);
		ТаблицаДопСтрокГруппы2 = ПромТаблицаДопСтрокРаздела.Скопировать();
		СтруктураДанныхДопСтрокРаздела.Вставить(мИдГруппыЖ2_2, ТаблицаДопСтрокГруппы2);
	КонецЕсли;
	
	Если ИмяСтраницы = "ЛистК3" Тогда

		// Так как раздел содержит несколько многострочных блоков,
		// то поочередно сохраняем данные дополнительных строк каждого блока.
		ОбновитьСтруктуруМногострочногоРаздела(мИдГруппыК3_1);
		ОбновитьСтруктуруМногострочногоРаздела(мИдГруппыК3_2);
		
		СтруктураДанныхДопСтрокРаздела = Новый Структура;

		// Обновим структуру, хранящую данные строк многострочных блоков.
		ПромТаблицаДопСтрокРаздела = Новый ТаблицаЗначений;
		мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК3_1, ПромТаблицаДопСтрокРаздела);
		ТаблицаДопСтрокГруппы1 = ПромТаблицаДопСтрокРаздела.Скопировать();
		СтруктураДанныхДопСтрокРаздела.Вставить(мИдГруппыК3_1, ТаблицаДопСтрокГруппы1);

		ПромТаблицаДопСтрокРаздела = Новый ТаблицаЗначений;
		мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК3_2, ПромТаблицаДопСтрокРаздела);
		ТаблицаДопСтрокГруппы2 = ПромТаблицаДопСтрокРаздела.Скопировать();
		СтруктураДанныхДопСтрокРаздела.Вставить(мИдГруппыК3_2, ТаблицаДопСтрокГруппы2);
	КонецЕсли;
	
	Если ИмяСтраницы = "ЛистК4" Тогда

		// Так как раздел содержит несколько многострочных блоков,
		// то поочередно сохраняем данные дополнительных строк каждого блока.
		ОбновитьСтруктуруМногострочногоРаздела(мИдГруппыК4_1);
		ОбновитьСтруктуруМногострочногоРаздела(мИдГруппыК4_2);
		
		СтруктураДанныхДопСтрокРаздела = Новый Структура;

		// Обновим структуру, хранящую данные строк многострочных блоков.
		ПромТаблицаДопСтрокРаздела = Новый ТаблицаЗначений;
		мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК4_1, ПромТаблицаДопСтрокРаздела);
		ТаблицаДопСтрокГруппы1 = ПромТаблицаДопСтрокРаздела.Скопировать();
		СтруктураДанныхДопСтрокРаздела.Вставить(мИдГруппыК4_1, ТаблицаДопСтрокГруппы1);

		ПромТаблицаДопСтрокРаздела = Новый ТаблицаЗначений;
		мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК4_2, ПромТаблицаДопСтрокРаздела);
		ТаблицаДопСтрокГруппы2 = ПромТаблицаДопСтрокРаздела.Скопировать();
		СтруктураДанныхДопСтрокРаздела.Вставить(мИдГруппыК4_2, ТаблицаДопСтрокГруппы2);
	КонецЕсли;
	
	Возврат СтруктураДанныхДопСтрокРаздела;
	
КонецФункции

Процедура ОбнулитьПеременныеМодуляХранящиеЗначенияКвадратногоПредставленияПоРазделу(Знач ИмяРаздела) Экспорт
КонецПроцедуры

Процедура УправлениеЛистами(ТипНП = Неопределено) Экспорт
КонецПроцедуры

Процедура ЗаполнениеЗначенийВКвадратиках(Знач ИмяСтраницы) Экспорт
КонецПроцедуры

Функция СобратьДанныеТекущегоТаблПоля(ТабличноеПоле) Экспорт

	СтруктураДанныхПоля = Новый Структура;
	Для Каждого ТекущаяОбласть Из ТабличноеПоле.Области Цикл
		Если ТекущаяОбласть.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник И ТекущаяОбласть.СодержитЗначение = Истина Тогда
			СтруктураДанныхПоля.Вставить(ТекущаяОбласть.Имя, ТекущаяОбласть.Значение);
		КонецЕсли;
	КонецЦикла;
	
	Возврат СтруктураДанныхПоля;

КонецФункции

// Процедура управляет цветом фона автозаполняемых ячеек при:
//  а) автозаполнении;
//  б) ручном выборе другого варианта заполнения;
//  в) добавлении/удалении и листании дополнительных страниц.
//
// Цвет фона устанавливается в зависимости от варианта заполнения ячейки.
//
// Параметры:
//  ИмяЯчейки                - строка, имя ячейки, для которой устанавливаем цвет фона;
//  ВариантЗаполнения        - число,  вариант заполнения ячейки;
//  ИмяТекущейСтраницыПанели - строка, имя страницы основной панели, на которой для всех автозаполняемых
//                             ячеек табличного документа следует установить цвет фона.
Процедура УстановитьЦветФонаЯчейки(ИмяЯчейки = Неопределено, ВариантЗаполнения = Неопределено, ИмяТекущейСтраницыПанели = "") Экспорт
	
	Перем ЦветФона;
	Перем Комментарий;

	// Не нужно разукрашивать табличные поля, если открывается без открытия формы (например печать или просмотр)
	Если мБезОткрытияФормы ИЛИ мРежимПечати Тогда
		Возврат;
	КонецЕсли;

	Если Не ИмяЯчейки = Неопределено Тогда
		// устанавливаем цвет фона конкретной ячейки
		ИмяСтраницыПанели = РегламентированнаяОтчетность.роОпределитьСтраницуПанелиПоКодуПоказателя(ЭтаФорма, ИмяЯчейки);
		Если ИмяСтраницыПанели = Неопределено Тогда
			Возврат;
		КонецЕсли;

		ИмяПоляТаблДокумента = "ПолеТабличногоДокумента" + ИмяСтраницыПанели;

		Ключ = "_" + ВариантЗаполнения;
		мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);

		// КодПоказателяПоСтруктуре
		ЗначениеВКвадратах = РегламентированнаяОтчетность.роОбластьЯвляетсяЯчейкойСоставногоПоля(ЭтаФорма, ИмяЯчейки);

		Если ВариантЗаполнения = 4 ИЛИ ВариантЗаполнения = 5 Тогда

			Если ЗначениеВКвадратах Тогда
				// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
				РегламентированнаяОтчетность.роСвойстваГрупповыхЗначений(ЭтаФорма, ИмяЯчейки, "УстановитьЗащиту");
			Иначе
				ЭлементыФормы[ИмяПоляТаблДокумента].Области[ИмяЯчейки].Защита = Истина;
			КонецЕсли;

		Иначе

			Если ЗначениеВКвадратах Тогда
				// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
				РегламентированнаяОтчетность.роСвойстваГрупповыхЗначений(ЭтаФорма, ИмяЯчейки, "СнятьЗащиту");
			Иначе
				ЭлементыФормы[ИмяПоляТаблДокумента].Области[ИмяЯчейки].Защита = Ложь;
			КонецЕсли;
			
		КонецЕсли;

		// установим цвет ячейки
		Если ЗначениеВКвадратах Тогда
			РегламентированнаяОтчетность.роСвойстваГрупповыхЗначений(ЭтаФорма, ИмяЯчейки, "ПроставитьЦветРаскраски", ЦветФона);
		Иначе
			ЭлементыФормы[ИмяПоляТаблДокумента].Области[ИмяЯчейки].ЦветФона = ЦветФона;
		КонецЕсли;

	Иначе
		// устанавливаем цвет фона всех автозаполняемых ячеек активной страницы

		ТаблицаВариантыЗаполнения = РегламентированнаяОтчетность.роПолучитьТаблицуВариантовЗаполнения(ЭтаФорма, ИмяТекущейСтраницыПанели);
		Если ТаблицаВариантыЗаполнения = Неопределено Тогда
			Возврат;
		КонецЕсли;

		Для Каждого Строка Из ТаблицаВариантыЗаполнения Цикл
			ИмяПоказателя            =  Строка.КодПоказателя;
			ВариантЗаполнения        =  Строка.ВариантЗаполнения;
			Комментарий              =  Строка.Комментарий;
			КодПоказателяПоСтруктуре =  Строка.КодПоказателяПоСтруктуре;

			КолвоСтрокВМногострочнойЧасти = РегламентированнаяОтчетность.роПоказательВходитВМногострочнуюЧасть(ЭтаФорма, ИмяПоказателя);

			Если КолвоСтрокВМногострочнойЧасти > 0 Тогда
				Многострочность = Истина;
				БазоваяЧасть = ИмяПоказателя;
				ОписанияБлоков = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели, "МногострочностьВРазделе");

				Если ТипЗнч(ОписанияБлоков) = Тип("Число") Тогда
					ВБлокеВсеПоказателиЗаполняются = Истина;
				ИначеЕсли ТипЗнч(ОписанияБлоков) = Тип("ТаблицаЗначений") Тогда
					ИмяГруппы = Сред(ИмяПоказателя, 1, 11);
					ВБлокеВсеПоказателиЗаполняются = НЕ ОписанияБлоков.Найти(ИмяГруппы, "ИдГруппы").НезаполняемыеПоказателиЕсть;
				КонецЕсли;

			Иначе
				Многострочность = Ложь;
				ВБлокеВсеПоказателиЗаполняются = Истина;
				КолвоСтрокВМногострочнойЧасти = 1;
			КонецЕсли;

			Для Инд = 1 по КолвоСтрокВМногострочнойЧасти Цикл

				Если Многострочность Тогда
					ИмяПоказателя = БазоваяЧасть + "_" + Формат(Инд, "ЧГ=0");
					// В многострочном блоке встречаются строки, которые не должны быть закрашены в стандартный зеленый цвет.
					
				КонецЕсли;

				ТекОбластьЯчеек = ЭлементыФормы["ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели].Области[ИмяПоказателя];
				Если (Не ПустаяСтрока(Комментарий)) ИЛИ (Не ПустаяСтрока(ТекОбластьЯчеек.Примечание.Текст)) Тогда
					ТекОбластьЯчеек.Примечание.Текст = Комментарий;
				КонецЕсли;

				Ключ = "_" + ВариантЗаполнения;
				мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);

				//ЗначениеВКвадратах = роОбластьЯвляетсяЯчейкойСоставногоПоля(Форма, ИмяПоказателя);
				ЗначениеВКвадратах = ?(ПустаяСтрока(КодПоказателяПоСтруктуре), Ложь, Истина);

				Если ВариантЗаполнения = 4 ИЛИ ВариантЗаполнения = 5 Тогда
					//ЭлементыФормы["ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели].Области[ИмяПоказателя].Защита = Истина;

					Если ЗначениеВКвадратах Тогда
						// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
						РегламентированнаяОтчетность.роСвойстваГрупповыхЗначений(ЭтаФорма, ИмяПоказателя, "УстановитьЗащиту");
					Иначе
						ЭлементыФормы["ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели].Области[ИмяПоказателя].Защита = Истина;
					КонецЕсли;

				Иначе

					Если ЗначениеВКвадратах Тогда
						// если ЗНАЧЕНИЕ КВАДРАТИЧНОЕ
						РегламентированнаяОтчетность.роСвойстваГрупповыхЗначений(ЭтаФорма, ИмяПоказателя, "СнятьЗащиту");
					Иначе
						ЭлементыФормы["ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели].Области[ИмяПоказателя].Защита = Ложь;
					КонецЕсли;
				КонецЕсли;

				Если ЗначениеВКвадратах Тогда
					РегламентированнаяОтчетность.роСвойстваГрупповыхЗначений(ЭтаФорма, ИмяПоказателя, "ПроставитьЦветРаскраски", ЦветФона);
				Иначе
					ЭлементыФормы["ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели].Области[ИмяПоказателя].ЦветФона = ЦветФона;
				КонецЕсли;
			КонецЦикла;

		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

Функция ОбновитьПеременныеМодуля(ИмяПоказателя, ЗначениеПоказателя) Экспорт

	ИзмененияПроизошли = Ложь;

	Если Лев(ИмяПоказателя, 1) = "_" Тогда
		Возврат Истина;
	КонецЕсли;

	Если ИмяПоказателя = "ПредставительФизЛицо" Тогда
		мПредставительФизЛицо = ЗначениеПоказателя;
		ИзмененияПроизошли = Истина;
	ИначеЕсли ИмяПоказателя = "НазваниеПредставителя" Тогда
		мНазваниеПредставителя = ЗначениеПоказателя;
		ИзмененияПроизошли = Истина;
	ИначеЕсли ИмяПоказателя = "ДокументПредставителя" Тогда
		мДокументПредставителя = ЗначениеПоказателя;
		ИзмененияПроизошли = Истина;
	ИначеЕсли ИмяПоказателя = "ФамилияПредставителя" Тогда
		мФамилияПредставителя = ЗначениеПоказателя;
		ИзмененияПроизошли = Истина;
	ИначеЕсли ИмяПоказателя = "ИмяПредставителя" Тогда
		мИмяПредставителя = ЗначениеПоказателя;
		ИзмененияПроизошли = Истина;
	ИначеЕсли ИмяПоказателя = "ОтчествоПредставителя" Тогда
		мОтчествоПредставителя = ЗначениеПоказателя;
		ИзмененияПроизошли = Истина;
	ИначеЕсли ИмяПоказателя = "СтатусНалогоплательщика" Тогда
		Если ЗначениеПоказателя = "1" Тогда
			мСтатусНалогоплательщика = 1;
		ИначеЕсли ЗначениеПоказателя = "2" Тогда
			мСтатусНалогоплательщика = 2;
		Иначе
			мСтатусНалогоплательщика = 0;
		КонецЕсли;
	КонецЕсли;

	Возврат ИзмененияПроизошли;

КонецФункции // ОбновитьПеременныеМодуля

// Процедура управляет показом в форме периода построения отчета.
//
Процедура ПоказатьПериод()
	
	Если СокрЛП(мТитульный.Области.Период1.Значение + мТитульный.Области.Период2.Значение) = "" ИЛИ мСкопированаФорма <> Неопределено Тогда
		мТитульный.Области.Период1.Значение = "3";
		мТитульный.Области.Период2.Значение = "4";
	КонецЕсли; 
	
	
	
	// выводим год на титульный лист
	ОтчетныйГод = Формат(Год(мДатаКонцаПериодаОтчета), "ЧГ=");
	мТитульный.Области.ОтчетГод1.Значение = Сред(ОтчетныйГод, 1, 1);
	мТитульный.Области.ОтчетГод2.Значение = Сред(ОтчетныйГод, 2, 1);
	мТитульный.Области.ОтчетГод3.Значение = Сред(ОтчетныйГод, 3, 1);
	мТитульный.Области.ОтчетГод4.Значение = Сред(ОтчетныйГод, 4, 1);
	
	// задаем заголовок формы
	СтрПериодОтчета = ПредставлениеПериода(НачалоДня(мДатаНачалаПериодаОтчета), КонецДня(мДатаКонцаПериодаОтчета), "ФП = Истина");
	Заголовок = ЭтотОбъект.Метаданные().Формы.ОсновнаяФорма.Представление() + " (за " + СтрПериодОтчета + ")";

КонецПроцедуры // ПоказатьПериод()

// Заполняет дату подписания отчета должностными лицами, в зависимости от наличия данных по этим лицам.
//
Процедура ЗаполнитьДатуПодписи()

	ПроставитьНаВсехЛистах("ДатаПодписи", ?(ЗначениеЗаполнено(ДатаПодписи), Формат(ДатаПодписи, "ДФ = 'ддММгггг'"), "        "), Истина);

КонецПроцедуры // ЗаполнитьДатуПодписи()

Процедура ЗаполнитьСведенияОПредставителе(РегистрацияВИФНС = Неопределено)
	
	УполномоченноеЛицоПредставителя = "";
	НаименованиеОрганизацииПредставителя = "";
	ДокументПредставителя = "";
	ТипПодписанта = "1";
	Если ЗначениеЗаполнено(РегистрацияВИФНС) Тогда
		Если ТипЗнч(РегистрацияВИФНС) = Тип("Строка") Тогда
			Запрос = Новый Запрос("ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
			                      |	РегистрацияВИФНС.Код,
			                      |	РегистрацияВИФНС.Представитель,
			                      |	РегистрацияВИФНС.ДокументПредставителя,
			                      |	РегистрацияВИФНС.УполномоченноеЛицоПредставителя
			                      |ИЗ
			                      |	Справочник.РегистрацияВИФНС КАК РегистрацияВИФНС
			                      |ГДЕ
			                      |	РегистрацияВИФНС.Код = &Код
			                      |	И РегистрацияВИФНС.Владелец = &Владелец");
			Запрос.УстановитьПараметр("Код", РегистрацияВИФНС);
			Запрос.УстановитьПараметр("Владелец", Организация);
		Иначе
			Запрос = Новый Запрос("ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
			                      |	РегистрацияВИФНС.Код,
			                      |	РегистрацияВИФНС.Представитель,
			                      |	РегистрацияВИФНС.ДокументПредставителя,
			                      |	РегистрацияВИФНС.УполномоченноеЛицоПредставителя
			                      |ИЗ
			                      |	Справочник.РегистрацияВИФНС КАК РегистрацияВИФНС
			                      |ГДЕ
			                      |	РегистрацияВИФНС.Ссылка = &Ссылка");
			Запрос.УстановитьПараметр("Ссылка", РегистрацияВИФНС);
		КонецЕсли;
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.Представитель) Тогда
			ТипПредставителя = ТипЗнч(Выборка.Представитель);
			Если ТипПредставителя = Тип("СправочникСсылка.Контрагенты") Тогда
				УполномоченноеЛицоПредставителя = СокрЛП(Выборка.УполномоченноеЛицоПредставителя);
				НаименованиеОрганизацииПредставителя = СокрЛП(Выборка.Представитель);
			ИначеЕсли ТипПредставителя = Тип("СправочникСсылка.ФизическиеЛица") Тогда
				УполномоченноеЛицоПредставителя = СокрЛП(Выборка.Представитель);
			КонецЕсли;
			ДокументПредставителя = СокрЛП(Выборка.ДокументПредставителя);
			ТипПодписанта = "2";
		КонецЕсли;
	КонецЕсли;
	
	СведенияОбОрганизации = РегламентированнаяОтчетность.ПолучитьСведенияОбОрганизации(Организация, ДатаПодписи, "ФИОРук, ФИО");
	Если ТипПодписанта = "1" тогда		
		УполномоченноеЛицоПредставителя = "";
	КонецЕсли;
	
	мТитульный.Области.ПрПодп.Значение = ТипПодписанта;
	мТитульный.Области.ОргПодписант.Значение = УполномоченноеЛицоПредставителя;
	мТитульный.Области.ОргУп.Значение = НаименованиеОрганизацииПредставителя;
	мТитульный.Области.ДокУпПред.Значение = ДокументПредставителя;
	
	Модифицированность = Истина;
	
КонецПроцедуры

Процедура ЗаполнитьСведенияОбОрганизации(ИзмененаДатаПодписи = Ложь)

	Если НЕ ИзмененаДатаПодписи Тогда
	
		СтрокаСведений = "ИННФЛ, НаимЮЛПол, КодНО, НаимНО, ТипНП, ТелОрганизации, ФИО, ОКАТО,
						|ДатаРожд, МестоРожд, КодУдЛичн, ОрганВыданУдЛичн, СерияУдЛичн,
						|НомерУдЛичн, ДатаУдЛичн, ИндексМЖ, КодСубъектМЖ, РайонМЖ,
						|ГородМЖ, НПунктМЖ, УлицаМЖ, ДомМЖ, КорпусМЖ, КвартираМЖ";
		СведенияОбОрганизации = РегламентированнаяОтчетность.ПолучитьСведенияОбОрганизации(Организация, ДатаПодписи, СтрокаСведений);
		
		
		// заполняем ИНН
		ИНН = СокрЛП(СведенияОбОрганизации.ИННФЛ);
		Для Инд = СтрДлина(ИНН) + 1 По 12 Цикл
			ИНН = ИНН + "-";
		КонецЦикла;
		
		
		Для Сч=1 По 9 Цикл
			ПроставитьНаВсехЛистах("ИНН" + Сч + "_", ИНН);
		КонецЦикла;
		
		// заполняем код ИФНС
		КодНО = СведенияОбОрганизации.КодНО;
		Для Инд = СтрДлина(СведенияОбОрганизации.КодНО) + 1 По 4 Цикл
			КодНО = " " + КодНО;
		КонецЦикла;
		Для Инд = 1 По 4 Цикл
			мТитульный.Области["КодИМНС" + Инд].Значение = Сред(КодНО, Инд, 1);
		КонецЦикла;
		
		// заполняем ФИО
		ДанныеФЛ = РазложитьФИО(СведенияОбОрганизации.ФИО);
		Если ДанныеФЛ.Количество() > 0 Тогда
			мТитульный.Области.Фамилия.Значение = СокрЛП(ДанныеФЛ.Фамилия);
			мТитульный.Области.Имя.Значение = СокрЛП(ДанныеФЛ.Имя);
			мТитульный.Области.Отчество.Значение = СокрЛП(ДанныеФЛ.Отчество);
			
			ПроставитьНаВсехЛистах("Фамилия", СокрЛП(ДанныеФЛ.Фамилия), Ложь);
			ПроставитьНаВсехЛистах("Имя1", Лев(СокрЛП(ДанныеФЛ.Имя),1), Ложь);
			ПроставитьНаВсехЛистах("Отчество1", Лев(СокрЛП(ДанныеФЛ.Отчество),1), Ложь);
		КонецЕсли;
		
		ЗнОКАТО = СокрЛП(СведенияОбОрганизации.ОКАТО);
		ДлинаЗначения = СтрДлина(ЗнОКАТО);
		Для Инд = ДлинаЗначения+1 По 11 Цикл
			ЗнОКАТО = СокрЛП(ЗнОКАТО) + "0";
		КонецЦикла;
		мТитульный.Области.ОКАТО.Значение = ЗнОКАТО;
		
		// заполняем телефон организации
		мТитульный.Области.ТелОрганизации.Значение = СокрЛП(СведенияОбОрганизации.ТелОрганизации);
		
		//Код категории
		мТитульный.Области.ПоМесту1.Значение = "7";
		мТитульный.Области.ПоМесту2.Значение = "2";
		мТитульный.Области.ПоМесту3.Значение = "0";
		
		// заполняем сведения о представителе
		ЗаполнитьСведенияОПредставителе(КодНО);
		
		//Титульный лист раздел 002
		ДатаРождения = СтрЗаменить(СокрЛП(Формат(СведенияОбОрганизации.ДатаРожд, "ДФ=dd.MM.yyyy")),".","");
		Для Инд = 1 По СтрДлина(ДатаРождения) Цикл
			мТитульный002.Области["ДатаРождения" + Инд].Значение = Сред(ДатаРождения, Инд, 1);
		КонецЦикла;

		мТитульный002.Области.МестоРождения.Значение = РегламентированнаяОтчетность.ПредставлениеМестаРождения(СведенияОбОрганизации.МестоРожд);
		мТитульный002.Области.Гражданство.Значение = "1";
		мТитульный002.Области.КодСтраны.Значение = "643";
		
		//Удостоверение личности
		мТитульный002.Области.КодВидаДокумента.Значение = СокрЛП(СведенияОбОрганизации.КодУдЛичн);
		мТитульный002.Области.СерияИНомерДокумента.Значение = СокрЛП(СведенияОбОрганизации.СерияУдЛичн) + " " + СокрЛП(СведенияОбОрганизации.НомерУдЛичн);
		мТитульный002.Области.КемВыданДокумент.Значение = СокрЛП(СведенияОбОрганизации.ОрганВыданУдЛичн);
		
		мРезидент = Истина;
		
		Если мРезидент Тогда
			мТитульный002.Области.СтатусНалогоплательщика.Значение = "1";
			мСтатусНалогоплательщика = 1;
		Иначе
			мТитульный002.Области.СтатусНалогоплательщика.Значение = "2";
			мСтатусНалогоплательщика = 2;
		КонецЕсли;
		
		ДатаВыдачиДокумента = СтрЗаменить(СокрЛП(Формат(СведенияОбОрганизации.ДатаУдЛичн, "ДФ=dd.MM.yyyy")),".","");
		Для Инд = 1 По СтрДлина(ДатаВыдачиДокумента) Цикл
			мТитульный002.Области["ДатаВыдачиДокумента" + Инд].Значение = Сред(ДатаВыдачиДокумента, Инд, 1);
		КонецЦикла;
		
		//Адрес
		мТитульный002.Области.МестоЖительства.Значение = 1;
		мТитульный002.Области.Индекс.Значение = СокрЛП(СведенияОбОрганизации.ИндексМЖ);
		мТитульный002.Области.Регион.Значение = СокрЛП(СведенияОбОрганизации.КодСубъектМЖ);
		мТитульный002.Области.Район.Значение = СокрЛП(СведенияОбОрганизации.РайонМЖ);
		мТитульный002.Области.Город.Значение = СокрЛП(СведенияОбОрганизации.ГородМЖ);
		мТитульный002.Области.НаселенныйПункт.Значение = СокрЛП(СведенияОбОрганизации.НПунктМЖ);
		мТитульный002.Области.Улица.Значение = СокрЛП(СведенияОбОрганизации.УлицаМЖ);
		мТитульный002.Области.Дом.Значение = СокрЛП(СведенияОбОрганизации.ДомМЖ);
		мТитульный002.Области.Корпус.Значение = СокрЛП(СведенияОбОрганизации.КорпусМЖ);
		мТитульный002.Области.Квартира.Значение = СокрЛП(СведенияОбОрганизации.КвартираМЖ);
		
		Данные = Новый Структура("Объект, Тип, Вид",  Организация.ИндивидуальныйПредприниматель, Перечисления.ТипыКонтактнойИнформации.Адрес, Справочники.ВидыКонтактнойИнформации.ИнострАдресФизЛица);
		Результат = РегистрыСведений.КонтактнаяИнформация.Получить(Данные).Представление;
		мТитульный002.Области.АдресЗаПределамиРФ.Значение = СокрЛП(Результат);
		
		//Разделы
		мРаздел6.Области.П000060001001.Значение = "3";
		
	Иначе
		
		// обновляем сведения о руководстве организации
		СведенияОбОрганизации = РегламентированнаяОтчетность.ПолучитьСведенияОбОрганизации(Организация, ДатаПодписи, "ФИОРук, ФИО");
		Если СокрЛП(мТитульный.Области.ПрПодп.Значение) = "1" тогда			
			мТитульный.Области.ОргПодписант.Значение = "";
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

// Открывает форму документа ФормаНастройкиОтчета с целью выбора 
// выводимых на печать листов отчета.
//
// Параметры:
//   ВариантВыбора - строка, назначение выбора страниц.
//
Процедура ОткрытьФормуВыбораСтраниц(ВариантВыбора)

	ФормаНастройкиОтчета = РегламентированнаяОтчетность.роПолучитьОбщуюФорму("НастройкиОтчета", ЭтаФорма, "дляВыбораСтраницОтчета");
	мДеревоВыбранныхСтраниц = "";
	ДеревоСтраницОтчета = мДеревоСтраницОтчета.Скопировать();
	ФормаНастройкиОтчета.НачальноеЗначениеВыбора = ДеревоСтраницОтчета;
	ФормаНастройкиОтчета.мПараметры.РазрешитьВстроеннуюПечать = Истина;
	РезультатВыбора = ФормаНастройкиОтчета.ОткрытьМодально();
	Если РезультатВыбора <> Неопределено Тогда
		мДеревоВыбранныхСтраниц = РезультатВыбора;
		РегламентированнаяОтчетность.ПрорисоватьПодменюПечать(ЭтаФорма, Новый Действие("КоманднаяПанельДействийПоказатьБланк"), Новый Действие("КоманднаяПанельДействийПечатьМашиночитаемогоБланка"));
		Модифицированность = Истина;
	Иначе
		мДеревоВыбранныхСтраниц = ДеревоСтраницОтчета;
	КонецЕсли;

КонецПроцедуры // ОткрытьФормуВыбораСтраниц()

Процедура ВывестиНаПечатьЛистЧерновика(Парам1)
	
	Если Парам1.ЧтоИскать <> Неопределено Тогда
		РегламентированнаяОтчетность.роНайтиЗначение(ЭтаФорма, Парам1);
	Иначе
		РегламентированнаяОтчетность.ВывестиНаПечатьЛистОбщая(ЭтаФорма, Парам1);
	КонецЕсли;
	
КонецПроцедуры

Процедура ВывестиНаПечатьДополнительныеСтраницыЧерновика(СтруктураПараметровСтраницы)
	Перем ИмяСтраницы; // имя страницы основной панели формы;
	Перем ТаблицаСтраницРаздела;
	
	СтруктураПараметровСтраницы.Свойство("ИмяСтраницыПанели", ИмяСтраницы);

	Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницы, ТаблицаСтраницРаздела) Тогда
		Возврат;
	КонецЕсли;

	АктивнаяСтраницаРаздела = ТаблицаСтраницРаздела.Найти(Истина, "АктивнаяСтраница");
	Если АктивнаяСтраницаРаздела = Неопределено Тогда
		ВывестиНаПечатьЛистЧерновика(СтруктураПараметровСтраницы);
		Возврат;
	КонецЕсли;

	ИсходныйИндекс = ТаблицаСтраницРаздела.Индекс(АктивнаяСтраницаРаздела);

	Для Каждого Страница Из ТаблицаСтраницРаздела Цикл
		// выводим на печать каждую страницу многостраничного раздела
		ТекущийИндекс = ТаблицаСтраницРаздела.Индекс(Страница);
		ПоказатьСтраницуМногостраничногоРаздела(ТекущийИндекс, ИмяСтраницы, Истина);
		ВывестиНаПечатьЛистЧерновика(СтруктураПараметровСтраницы);
	КонецЦикла;

	// вывод в форму данных исходной (активной) страницы
	ПоказатьСтраницуМногостраничногоРаздела(ИсходныйИндекс, ИмяСтраницы, Истина);
	
КонецПроцедуры

// Процедура очищает содержимое редактируемых и вычисляемых ячеек
// поля табличного документа, переданного параметром ВыбТабличноеПоле.
//
// Параметры:
//  ВыбТабличноеПоле - поле табличного документа.
//
Процедура ОчиститьТабличноеПоле(ВыбТабличноеПоле) Экспорт
	
	//для очистки защищенных областей итоговых ячеек
	//получим список итоговых ячеек, снимая с них защиту), а после очищения вернем защиту
	СписокИтоговыхЯчеек = Новый СписокЗначений;
	
	Для каждого Область Из ВыбТабличноеПоле.Области Цикл
		Если Область.ЦветФона = ЦветЗаполняетсяАвтоАрифметика И Область.Защита Тогда
			Область.Защита = Ложь;
			СписокИтоговыхЯчеек.Добавить(Область.Имя);
		КонецЕсли;
	КонецЦикла;
	
	РегламентированнаяОтчетность.роОчиститьТабличноеПоле(ЭтаФорма, ВыбТабличноеПоле);
	
	Для каждого КодИтоговогоПоказателя Из СписокИтоговыхЯчеек Цикл
		ОбластьПоказателя=ВыбТабличноеПоле.Области.Найти(КодИтоговогоПоказателя.Значение);
		Если ОбластьПоказателя <> Неопределено Тогда
			ОбластьПоказателя.Защита = Истина;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры // ОчиститьТабличноеПоле()

// Обрабатывает полученный из формы ФормаНастройкиОтчета дерево значений,
// определяет состав помеченных для вывода на печать листов.
//
// Параметры:
//  ВидПечати - строка, задающая способ печати:
//              "ПоказатьБланк" - непосредственный вывод на печать;
//              "ПечататьСразу" - с предварительным просмотром.
//
Процедура ПечатьЧерновика(ВидПечати, ЧтоИскать = Неопределено) Экспорт

	Если ТипЗнч(мДеревоВыбранныхСтраниц) <> Тип("ДеревоЗначений") Тогда
		Возврат;
	КонецЕсли;

	мПечатныеФормы.Очистить();

	СтруктураПараметров = Новый Структура;
	мРежимПечати = Истина;

	Для Каждого СтрокаУровня1 Из мДеревоВыбранныхСтраниц.Строки Цикл
		Пометка = РегламентированнаяОтчетность.ПечататьРаздел(ЭтаФорма, СтрокаУровня1, ЧтоИскать);

		ИмяСтраницыПанели  = СтрокаУровня1.ИмяСтраницы;
		НаименованиеЛиста  = СтрокаУровня1.Представление;
		ОриентацияЛиста    = СтрокаУровня1.ОриентацияСтраницы;
		ИмяТабличногоПоля  = СтрокаУровня1.ИмяПоляТабличногоДокум;
		ИмяОбластиТаблПоля = СтрокаУровня1.ИмяОбластиТабличногоПоля;

		Если СтрокаУровня1.Строки.Количество() > 0 Тогда

			Для Каждого СтрокаУровня2 Из СтрокаУровня1.Строки Цикл
				Пометка = РегламентированнаяОтчетность.ПечататьРаздел(ЭтаФорма, СтрокаУровня2, ЧтоИскать);

				ИмяСтраницыПанели  = СтрокаУровня2.ИмяСтраницы;
				НаименованиеЛиста  = СтрокаУровня2.Представление;
				ОриентацияЛиста    = СтрокаУровня2.ОриентацияСтраницы;
				ИмяТабличногоПоля  = СтрокаУровня2.ИмяПоляТабличногоДокум;
				ИмяОбластиТаблПоля = СтрокаУровня2.ИмяОбластиТабличногоПоля;

				Если СтрокаУровня2.Строки.Количество() > 0 Тогда
					Для Каждого СтрокаУровня3 Из СтрокаУровня2.Строки Цикл

						Пометка = РегламентированнаяОтчетность.ПечататьРаздел(ЭтаФорма, СтрокаУровня3, ЧтоИскать);
						Если Пометка = 0 И ЧтоИскать = Неопределено Тогда
							Продолжить;
						КонецЕсли;

						ИмяСтраницыПанели  = СтрокаУровня3.ИмяСтраницы;
						НаименованиеЛиста  = СтрокаУровня3.Представление;
						ОриентацияЛиста    = СтрокаУровня3.ОриентацияСтраницы;
						ИмяТабличногоПоля  = СтрокаУровня3.ИмяПоляТабличногоДокум;
						ИмяОбластиТаблПоля = СтрокаУровня3.ИмяОбластиТабличногоПоля;

						СтруктураПараметров.Очистить();
						СтруктураПараметров.Вставить("НаименованиеЛиста",  НаименованиеЛиста);
						СтруктураПараметров.Вставить("ОриентацияЛиста",    ОриентацияЛиста);
						СтруктураПараметров.Вставить("ИмяТабличногоПоля",  ИмяТабличногоПоля);
						Структурапараметров.Вставить("ИмяОбластиТаблПоля", ИмяОбластиТаблПоля);
						СтруктураПараметров.Вставить("ВидПечати",          ВидПечати);
						СтруктураПараметров.Вставить("ЧтоИскать",	       ЧтоИскать);

						Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницыПанели) Тогда
							ВывестиНаПечатьЛистЧерновика(СтруктураПараметров);
						Иначе
							// выводим на печать все созданные страницы многостраничного раздела
							СтруктураПараметров.Вставить("ИмяСтраницыПанели", ИмяСтраницыПанели);
							ВывестиНаПечатьДополнительныеСтраницыЧерновика(СтруктураПараметров);
						КонецЕсли;
					КонецЦикла;

					Продолжить;

				КонецЕсли;

				Если Пометка = 0 И ЧтоИскать = Неопределено Тогда
					Продолжить;
				КонецЕсли;

				СтруктураПараметров.Очистить();
				СтруктураПараметров.Вставить("НаименованиеЛиста",  НаименованиеЛиста);
				СтруктураПараметров.Вставить("ОриентацияЛиста",    ОриентацияЛиста);
				СтруктураПараметров.Вставить("ИмяТабличногоПоля",  ИмяТабличногоПоля);
				Структурапараметров.Вставить("ИмяОбластиТаблПоля", ИмяОбластиТаблПоля);
				СтруктураПараметров.Вставить("ВидПечати",          ВидПечати);
				СтруктураПараметров.Вставить("ЧтоИскать",	       ЧтоИскать);

				Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницыПанели) Тогда
					ВывестиНаПечатьЛистЧерновика(СтруктураПараметров);
				Иначе
					// выводим на печать все созданные страницы многостраничного раздела
					СтруктураПараметров.Вставить("ИмяСтраницыПанели", ИмяСтраницыПанели);
					ВывестиНаПечатьДополнительныеСтраницыЧерновика(СтруктураПараметров);
				КонецЕсли;
			КонецЦикла;

			Продолжить;

		КонецЕсли;

		Если Пометка = 0 И ЧтоИскать = Неопределено Тогда
			Продолжить;
		КонецЕсли;

		СтруктураПараметров.Очистить();
		СтруктураПараметров.Вставить("НаименованиеЛиста",  НаименованиеЛиста);
		СтруктураПараметров.Вставить("ОриентацияЛиста",    ОриентацияЛиста);
		СтруктураПараметров.Вставить("ИмяТабличногоПоля",  ИмяТабличногоПоля);
		Структурапараметров.Вставить("ИмяОбластиТаблПоля", ИмяОбластиТаблПоля);
		СтруктураПараметров.Вставить("ВидПечати",          ВидПечати);
		СтруктураПараметров.Вставить("ЧтоИскать",	       ЧтоИскать);

		Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницыПанели) Тогда
			ВывестиНаПечатьЛистЧерновика(СтруктураПараметров);
		Иначе
			// выводим на печать все созданные страницы многостраничного раздела
			СтруктураПараметров.Вставить("ИмяСтраницыПанели", ИмяСтраницыПанели);
			ВывестиНаПечатьДополнительныеСтраницыЧерновика(СтруктураПараметров);
		КонецЕсли;
	КонецЦикла;

	// обновляем исходное дерево значений 
	мДеревоСтраницОтчета = мДеревоВыбранныхСтраниц.Скопировать();

	Если ЧтоИскать = Неопределено Тогда
		РегламентированнаяОтчетность.ПроставитьНомераЛистов(ЭтаФорма, ВидПечати);
	КонецЕсли;
	мРежимПечати = Ложь;

КонецПроцедуры

// Формирует структуру данных отчета и помещает в реквизит типа ХранилищеЗначения
// документа РегламентированныйОтчет.
// 
// При первом сохранении данных отчета создает новый документ этого вида.
// Структура данных отчета состоит из элементов:
//   - значения редактируемых реквизитов отчета;
//   - данные по многострочным разделам отчета;
//   - данные по  многостраничным разделам отчета;
//   - данные по вариантам заполнения реквизитов,
//     участвующих в автозаполнении.
//
Функция Сохранить(Автосохранение = Ложь) Экспорт

	Перем ТаблицаСтраниц;

	Вариант = ВидДокумента * НомерКорректировки;

	КодИФНС = РегламентированнаяОтчетность.роВернутьЗначениеПараметраСЛиста(ЭтаФорма, "Титульный", "КодИМНС");

	Если НЕ РегламентированнаяОтчетность.ПриЗаписиРегламентированногоОтчета(ЭтаФорма, КодИФНС, Автосохранение, Вариант) Тогда
		Возврат Ложь;
	КонецЕсли;

	// установим текущие значения реквизитов документа
	мСохраненныйДок.ИсточникОтчета             = ЭтотОбъект.Метаданные().Имя;
	мСохраненныйДок.НаименованиеОтчета         = ЭтотОбъект.Метаданные().Формы.ОсновнаяФорма.Представление();
	мСохраненныйДок.ДатаНачала                 = мДатаНачалаПериодаОтчета;
	мСохраненныйДок.ДатаОкончания              = мДатаКонцаПериодаОтчета;
	мСохраненныйДок.Периодичность              = мПериодичность;
	мСохраненныйДок.ВыбраннаяФорма             = мВыбраннаяФорма;
	мСохраненныйДок.Организация                = Организация;
	мСохраненныйДок.ДатаПодписи                = ДатаПодписи;
	мСохраненныйДок.ЕдиницаИзмерения           = ЕдиницаИзмерения;
	мСохраненныйДок.ТочностьЕдиницыИзмерения   = ТочностьЕдиницыИзмерения;
	мСохраненныйДок.ВидОтчетности              = Перечисления.ВидыОтчетности.РегламентированнаяОтчетность;
	мСохраненныйДок.Комментарий                = Комментарий;
	мСохраненныйДок.КодИМНС                    = КодИФНС;
	мСохраненныйДок.Вид                        = Вариант;
	мВариант = Вариант;

	мСохраненныйДок.ФорматВыгрузки = "Автоматически";

	РегламентированнаяОтчетность.роОбновитьСтруктуруМногостраничныхРазделов(ЭтаФорма);
	РегламентированнаяОтчетность.роОбновитьСтруктуруМногострочныхРазделов(ЭтаФорма);

	// формируем данные редактируемых ячеек таблицы
	ПоказателиОтчета = Новый Структура();

	Для Каждого СтраницаПанели из ЭлементыФормы.ОсновнаяПанель.Страницы Цикл

		// Многостраничность - не записываем в Показатели отчета !!!
		//
		Если Не мСтруктураМногостраничныхРазделов.Свойство(СтраницаПанели.Имя, ТаблицаСтраниц) Тогда
			ИмяТекТабличногоПоля    = "ПолеТабличногоДокумента" + СтраницаПанели.Имя;
			ТекТабличноеПоле        = ЭлементыФормы[ИмяТекТабличногоПоля];

			ПоказателиТекущегоЛиста = СобратьДанныеТекущегоТаблПоля(ТекТабличноеПоле);
			ПоказателиОтчета.Вставить(ИмяТекТабличногоПоля, ПоказателиТекущегоЛиста);
		КонецЕсли;

	КонецЦикла;

	// формируем список сохранения
	СписокСохранения = Новый Структура();

	// вставляем данные редактируемых ячеек таблицы	
	СписокСохранения.Вставить("ПоказателиОтчета", ПоказателиОтчета);

	// вставляем данные многострочных разделов
	СписокСохранения.Вставить("ДанныеМногострочныхРазделов", мСтруктураМногострочныхРазделов);

	// вставляем данные многостраничных разделов
	СписокСохранения.Вставить("ДанныеМногостраничныхРазделов", мСтруктураМногостраничныхРазделов);

	// вставляем данные вариантов автозаполнения ячеек
	СписокСохранения.Вставить("ДанныеВариантовАвтоЗаполнения", мСтруктураВариантыЗаполнения);

	// вствляем версию формы
	СписокСохранения.Вставить("ВерсияФормы", мВерсияФормы);
	
	// вствляем флажок пересчета страниц
	СписокСохранения.Вставить("ФлПодсчетСтраниц", мСчетчикСтраниц);
	
	// вствляем флажок отключения
	СписокСохранения.Вставить("ФлОтклВыборЗначений", мАвтоВыборКодов);

	// вствляем флажок ручной ввод ВРЕМЕННАЯ ОТМЕНА
	СписокСохранения.Вставить("Автозаполнение", ФлажокОтклАвтоРасчет);

	// вствляем флажок разрешения печати без штрихкода
	СписокСохранения.Вставить("ПечатьБезШтрихкодаРазрешена", мПечатьБезШтрихкодаРазрешена);
	
	ХранилищеДанных = Новый ХранилищеЗначения(СписокСохранения);
	мСохраненныйДок.ДанныеОтчета = ХранилищеДанных;

	// записываем документ, хранящий данные отчета	
	Попытка
		мСохраненныйДок.Записать();
	Исключение
		Если НЕ Автосохранение Тогда
			Предупреждение(ОбщегоНазначения.СформироватьТекстСообщения(ОписаниеОшибки()));
		КонецЕсли;
		РегламентированнаяОтчетность.СкрытьКартинкуСохранение(ЭтаФорма);
		Возврат Ложь;
	КонецПопытки;
	
	РегламентированнаяОтчетность.ПослеЗаписиРегламентированногоОтчета(ЭтаФорма);
	
	Модифицированность = Ложь;
	
	СохранитьДеревоНастройкиСтраниц();
	
	КлючУникальности = мСохраненныйДок.Ссылка;
	
	Возврат Истина;

КонецФункции // Сохранить()

// Восстанавливает сохраненные данные отчета.
//
Процедура ВосстановитьСохраненныеДанные()
	Перем ДанныеМногострочныхРазделов;
	Перем ДанныеМногостраничныхРазделов;
	Перем ДанныеВариановАвтоЗаполнения;
	Перем ПоказателиОтчета;
	Перем Автозаполнение;
	Перем ТаблицаМногостраничногоДокумента;

	Если НЕ ЗначениеЗаполнено(Организация) Тогда
		Организация =				мСохраненныйДок.Организация;
	КонецЕсли;
	
	ДатаПодписи =				мСохраненныйДок.ДатаПодписи;
	ЕдиницаИзмерения =			мСохраненныйДок.ЕдиницаИзмерения;
	ТочностьЕдиницыИзмерения =	мСохраненныйДок.ТочностьЕдиницыИзмерения;
	Комментарий =				мСохраненныйДок.Комментарий;

	// восстанавливаем сохраненные данные отчета
	СписокСохранения = мСохраненныйДок.ДанныеОтчета.Получить();
	
	// список листов, выводимых на печать
	ДеревоНастройкиСтраниц = мСохраненныйДок.ДеревоНастройкиСтраниц.Получить();
	мДеревоСтраницОтчета   = ДеревоНастройкиСтраниц.Скопировать();

	// восстанавливаем сохраненные данные многострочных разделов
	Если СписокСохранения.Свойство("ДанныеМногострочныхРазделов", ДанныеМногострочныхРазделов) Тогда
		мСтруктураМногострочныхРазделов = ДанныеМногострочныхРазделов;

		Для Каждого ЭлементСтруктуры Из мСтруктураМногострочныхРазделов Цикл

			ИмяГруппы       = ЭлементСтруктуры.Ключ;
			СтруктураГруппы = ЭлементСтруктуры.Значение;

			ВывестиРазделВТабличныйДокумент(ИмяГруппы, СтруктураГруппы);

		КонецЦикла;

	КонецЕсли;

	// восстанавливаем сохраненные данные вариантов автозаполнения ячеек
	Если СписокСохранения.Свойство("ДанныеВариантовАвтоЗаполнения", ДанныеВариановАвтоЗаполнения) Тогда
		мСтруктураВариантыЗаполнения = ДанныеВариановАвтоЗаполнения;
	КонецЕсли;

	// восстановим сохраненные данные редактируемых ячеек
	СписокСохранения.Свойство("ПоказателиОтчета", ПоказателиОтчета);

	// восстанавливаем сохраненные данные многостраничных разделов
	Если СписокСохранения.Свойство("ДанныеМногостраничныхРазделов", ДанныеМногостраничныхРазделов) Тогда
		мСтруктураМногостраничныхРазделов = ДанныеМногостраничныхРазделов;

		// Отображаем данные, хранящиеся в структуре многостраничных разделов
		Для Каждого ЭлементСтруктуры Из мСтруктураМногостраничныхРазделов Цикл
			мСтруктураМногостраничныхРазделов.Свойство(ЭлементСтруктуры.Ключ, ТаблицаМногостраничногоДокумента);
			АктивнаяСтраница = ТаблицаМногостраничногоДокумента.Найти(Истина, "АктивнаяСтраница");
			ИндАктивнаяСтраница = ТаблицаМногостраничногоДокумента.Индекс(АктивнаяСтраница);
			ПоказатьСтраницуМногостраничногоРазделаПриВосстановлении(ИндАктивнаяСтраница, ЭлементСтруктуры.Ключ);
		КонецЦикла;

	КонецЕсли;

	СписокСохранения.Свойство("ФлПодсчетСтраниц", мСчетчикСтраниц);
	СписокСохранения.Свойство("ФлОтклВыборЗначений", мАвтоВыборКодов);
	мАвтоВыборКодов = ?(мАвтоВыборКодов = Неопределено, Ложь, мАвтоВыборКодов);

	СписокСохранения.Свойство("Автозаполнение", Автозаполнение);
	ФлажокОтклАвтоРасчет = Автозаполнение;

	Для Каждого ПоказателиСтраницы Из ПоказателиОтчета Цикл
		ИмяТекТабличноеПоле = ПоказателиСтраницы.Ключ;
		ТекТабличноеПоле    = ЭлементыФормы[ИмяТекТабличноеПоле];
		ПоказателиТаблПоле  = ПоказателиСтраницы.Значение;

		ПредставлениеДанных = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекТабличноеПоле, "ПредставлениеДанных");

		Для Каждого Показатель Из ПоказателиТаблПоле Цикл
			ИмяПоказателя       = Показатель.Ключ;
			ЗначениеПоказателя  = Показатель.Значение;
			ИмяСтраницыПанели   = СтрЗаменить(ИмяТекТабличноеПоле, "ПолеТабличногоДокумента", "");

			Если мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницыПанели, ТаблицаМногостраничногоДокумента) Тогда
				Продолжить;
			КонецЕсли;

			Если ПредставлениеДанных Тогда
				Если ОбновитьПеременныеМодуля(ИмяПоказателя, ЗначениеПоказателя) Тогда
					Продолжить;
				КонецЕсли;
			КонецЕсли;

			Попытка
				ТекТабличноеПоле.Области[ИмяПоказателя].Значение = ЗначениеПоказателя;
			Исключение
			КонецПопытки;

		КонецЦикла;

	КонецЦикла;

	Если НЕ СписокСохранения.Свойство("ПечатьБезШтрихкодаРазрешена", мПечатьБезШтрихкодаРазрешена) Тогда
		мПечатьБезШтрихкодаРазрешена = Ложь;
	КонецЕсли;
	
	РегламентированнаяОтчетность.ОперацииПриВосстановленииРегламентированногоОтчета(ЭтаФорма);

	мДеревоВыбранныхСтраниц = мДеревоСтраницОтчета.Скопировать();

	УстановитьФорматВыводаВПоляхВвода();
	
	ОтобразитьНомерКорректировки();

	// Управляем видимостью страниц основной панели формы
	РегламентированнаяОтчетность.роПоказатьСтраницыОтчета(ЭтаФорма);

	Модифицированность = Ложь;

КонецПроцедуры // ВосстановитьСохраненныеДанные()

Функция ОкруглитьЧислоПоФормату(ИсходноеЧисло,ТочностьОкругления = Неопределено)
	
	Если ТочностьОкругления = Неопределено Тогда
		ТочностьОкругления = ТочностьЕдиницыИзмерения;
	КонецЕсли;
	
	Делитель = СоответствиеЕдиницыИзмеренияДелителю[ЕдиницаИзмерения];
	Возврат Окр(ИсходноеЧисло / Делитель, ТочностьОкругления) * Делитель;

КонецФункции // ОкруглитьЧислоПоФормату()

////////////////////////////////////////////////////////////////////////////////
//АВТОРАСЧЕТ И ВСПОМОГАТЕЛЬНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ+++

// РасчетВСтруктуре
// Параметры:
//  ИмяЛиста              - Имя листа.

Процедура РасчетВСтруктуре(ИмяЛиста)
	
	Перем ТаблицаБлока;
	// Расчет осуществляется по структуре многостраничных разделов декларации.
	ТаблицаРаздела = мСтруктураМногостраничныхРазделов[ИмяЛиста];
	
	Для Каждого Страница Из ТаблицаРаздела Цикл
		Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
			Продолжить;
		КонецЕсли;
		
		Данные = Страница.Данные;
			
		Если ИмяЛиста = "ЛистА" Тогда
			
			ТаблицаБлока = Страница.ДанныеДопСтрок;
			
			Колонка080 = 0;
			Колонка090 = 0;
			Колонка100 = 0;
			Колонка110 = 0;
			
			Если ТаблицаБлока <> Неопределено Тогда
				Для каждого Зап Из ТаблицаБлока Цикл
					Колонка080 = Колонка080 + ОкруглитьЧислоПоФормату(Зап.П000070001005);
					Колонка090 = Колонка090 + ОкруглитьЧислоПоФормату(Зап.П000070001006);
					Колонка100 = Колонка100 + ОкруглитьЧислоПоФормату(Зап.П000070001007);
					Колонка110 = Колонка110 + ОкруглитьЧислоПоФормату(Зап.П000070001008);
					Колонка021 = Зап.П000070001003;
					Если ЗначениеЗаполнено(Колонка021) Тогда
						ДлинаЗначения = СтрДлина(СокрЛП(Колонка021));
						Для Инд = ДлинаЗначения+1 По 11 Цикл
							Колонка021 = СокрЛП(Колонка021) + "0";
						КонецЦикла;
					КонецЕсли;
					Данные["П000070001003_" + (ТаблицаБлока.Индекс(Зап)+1)] = Колонка021;
					Зап.П000070001003 = Колонка021;
				КонецЦикла;
			КонецЕсли;
			
			Данные.П000070008001 = Колонка080;
			Данные.П000070009001 = Колонка090;
			Данные.П000070010001 = Колонка100;
			Данные.П000070011001 = Колонка110;
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистБ" Тогда

			ТаблицаБлока = Страница.ДанныеДопСтрок;
			
			Колонка150 = 0;
			Колонка160 = 0;
			Колонка170 = 0;
			Колонка180 = 0;
			
			Если ТаблицаБлока <> Неопределено Тогда
				Для каждого Зап Из ТаблицаБлока Цикл
					Колонка150 = Колонка150 + ОкруглитьЧислоПоФормату(Зап.П000080001008);
					Колонка160 = Колонка160 + ОкруглитьЧислоПоФормату(Зап.П000080001012);
					Колонка170 = Колонка170 + ОкруглитьЧислоПоФормату(Зап.П000080001013);
					Колонка180 = Колонка180 + ОкруглитьЧислоПоФормату(Зап.П000080001014);
				КонецЦикла;
			КонецЕсли;
			
			Данные.П000080001501 = Колонка150;
			Данные.П000080001601 = Колонка160;
			Данные.П000080001701 = Колонка170;
			Данные.П000080001801 = Колонка180;
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистГ1Продолжение" Тогда
			
			ТаблицаБлока = Страница.ДанныеДопСтрок;
			
			Колонка240 = 0;
			
			Если ТаблицаБлока <> Неопределено Тогда
				Для каждого Зап Из ТаблицаБлока Цикл
					НомерСтроки = (ТаблицаБлока.Индекс(Зап)+1);
					
					Если НомерСтроки <> 1 Тогда
						Данные["П000025119004_" + НомерСтроки] = Данные["П000025119006_" + (НомерСтроки-1)];
						Зап.П000025119004 = Данные["П000025119006_" + (НомерСтроки-1)];
					КонецЕсли;
					
					Колонка220 = Мин(Зап.П000025119004 + 4300, Зап.П000025119003);
					
					ДоляОплатыВНатруальнойФорме = ?(Зап.П000025119002 <> 0, Зап.П000025119003/Зап.П000025119002, 0)*100; 
					Колонка230ПредМесяца = ?(НомерСтроки = 1,0,Данные["П000025119006_" + (НомерСтроки-1)]) + 4300;
					
					Если ДоляОплатыВНатруальнойФорме > 20
						ИЛИ Колонка220 > Колонка230ПредМесяца Тогда
						Колонка220 = 0					
					КонецЕсли;
				
					Данные["П000025119005_" + НомерСтроки] = Колонка220;
					Зап.П000025119005 = Колонка220;
					
					Колонка230 = Зап.П000025119004 + ?(Зап.П000025119005 = 0, 0, 4300) - Зап.П000025119005;
					Данные["П000025119006_" + НомерСтроки] = Колонка230;
					Зап.П000025119006 = Колонка230;
					
					Колонка240 = Колонка240 + Колонка220;
					Если НомерСтроки = 12 Тогда
						Данные["П000025119006_" + НомерСтроки] = 0;
						Зап.П000025119006 = 0;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
			
			Данные.П000025124002 = Колонка240;
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистД" Тогда
			
			ТаблицаБлока = Страница.ДанныеДопСтрок;
			
			Колонка100 = 0;
			
			Если ТаблицаБлока <> Неопределено Тогда
				Для каждого Зап Из ТаблицаБлока Цикл
					Если Зап.П000012001007 = "405" Тогда
						Колонка090 = Окр((Зап.П000012001006 * Зап.П000012001008)/100, 2);
						
					Иначе
						Колонка090 = Мин(Зап.П000012001006, Зап.П000012001009);
					КонецЕсли;
					Данные["П000012001009_" + (ТаблицаБлока.Индекс(Зап)+1)] = Колонка090;
					Зап.П000012001009 = Колонка090;
					Колонка100 = Колонка100 + ОкруглитьЧислоПоФормату(Зап.П000012001009);
				КонецЦикла;
			КонецЕсли;
			
			Данные.П000012010004 = Колонка100;
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистЕ" Тогда
			
			ТаблицаБлока = Страница.ДанныеДопСтрок;
			
			Колонка060 = 0;
			
			Если ТаблицаБлока <> Неопределено Тогда
				Для каждого Зап Из ТаблицаБлока Цикл
					Колонка050 = Мин(ОкруглитьЧислоПоФормату(Зап.П000013001004),ОкруглитьЧислоПоФормату(Зап.П000013001005));
					Колонка060 = Колонка060 + ОкруглитьЧислоПоФормату(Зап.П000013001005);
					Данные["П000013001005_" + (ТаблицаБлока.Индекс(Зап)+1)] = Колонка050;
					Зап.П000013001005 = Колонка050;
				КонецЦикла;
			КонецЕсли;
			
			Данные.П000013006004 = Колонка060;
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистЖ2" Тогда
			
			ТаблицыБлока = Страница.ДанныеДопСтрок;
			
			Колонка060 = 0;
			Колонка120 = 0;
			Если ТаблицыБлока <> Неопределено Тогда
				ТаблицыБлока.Свойство(мИдГруппыЖ2_1, ТаблицаБлока);
				Для каждого Зап Из ТаблицаБлока Цикл
					Колонка050 = Мин(Зап.П000015001005, Зап.П000015001004);
					Данные["П000015001005_" + (ТаблицаБлока.Индекс(Зап)+1)] = Колонка050;
					Зап.П000015001005 = Колонка050;
					Колонка060 = Колонка060 + ОкруглитьЧислоПоФормату(Зап.П000015001005);
				КонецЦикла;
				ТаблицыБлока.Свойство(мИдГруппыЖ2_2, ТаблицаБлока);
				Для каждого Зап Из ТаблицаБлока Цикл
					Колонка050 =  Мин(Зап.П000015002005, Зап.П000015002004);
					Данные["П000015002005_" + (ТаблицаБлока.Индекс(Зап)+1)] = Колонка050;
					Зап.П000015002005 = Колонка050;
					Колонка120 = Колонка120 + ОкруглитьЧислоПоФормату(Зап.П000015002005);
				КонецЦикла;
			КонецЕсли;
			Данные.П000015006004 = Колонка060;
			Данные.П000015012004 = Колонка120;
			
			Данные.П000015013004 = Колонка060
			+ Колонка120;
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистЗПродолжение" Тогда
			
			Колонка110 = 0;
			Колонка130 = 0;
			Колонка160 = 0;
			Колонка180 = 0;
			Колонка200 = 0;
			Колонка220 = 0;
			Колонка240 = 0;
			Колонка260 = 0;
			Колонка280 = 0;
			Колонка300 = 0;
			Колонка320 = 0;
			Колонка340 = 0;
			Колонка360 = 0;
			Колонка380 = 0;
			
			ДляКолонки170 = 0;
			ДляКолонки210 = 0;
			ДляКолонки250 = 0;
			ДляКолонки290 = 0;			
			ДляКолонки330 = 0;			
			ДляКолонки370 = 0;
			
			ТипЛиста = Данные.П000017000101;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистЗ"];
			ДопТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистИПродолжение"];
			
			Для Каждого Стр Из ПромТаблицаРаздела Цикл
				Если (Стр.Данные = Неопределено) ИЛИ (Тип(Стр.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				
				СтрТипЛиста = ?(ТипЛиста = 0,"",Строка(ТипЛиста));
				
				Если СтрТипЛиста <> Стр.Данные.П000016000101 Тогда
					Продолжить;
				КонецЕсли;
				
				ТаблицаБлока = Стр.ДанныеДопСтрок;
				
				Если ТаблицаБлока <> Неопределено Тогда
					Для каждого Зап Из ТаблицаБлока Цикл
						Если Зап.П000016001001 = "1" Тогда
							Колонка110 = Колонка110 + Зап.П000016001006;
							Колонка130 = Колонка130 + Зап.П000016001007;
						КонецЕсли;
						Если Зап.П000016001001 = "2" Тогда
							Колонка160 = Колонка160 + Зап.П000016001006;
							Колонка180 = Колонка180 + Зап.П000016001007;
						КонецЕсли;
						Если Зап.П000016001001 = "3" Тогда
							Колонка200 = Колонка200 + Зап.П000016001006;
							Колонка220 = Колонка220 + Зап.П000016001007;
						КонецЕсли;
						Если Зап.П000016001001 = "4" Тогда
							Колонка240 = Колонка240 + Зап.П000016001006;
							Колонка260 = Колонка260 + Зап.П000016001007;
						КонецЕсли;
						Если Зап.П000016001001 = "5" Тогда
							Колонка280 = Колонка280 + Зап.П000016001006;
							Колонка300 = Колонка300 + Зап.П000016001007;
						КонецЕсли;
						Если Зап.П000016001001 = "6" Тогда
							Колонка320 = Колонка320 + Зап.П000016001006;
							Колонка340 = Колонка340 + Зап.П000016001007;
						КонецЕсли;
						Если Зап.П000016001001 = "7" Тогда
							Колонка360 = Колонка360 + Зап.П000016001006;
							Колонка380 = Колонка380 + Зап.П000016001007;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
			
			Данные.П000017008002 = Колонка110;
			Данные.П000017010002 = Колонка130;
			Данные.П000017013002 = Колонка160;
			Данные.П000017015002 = Колонка180;
			Данные.П000017017002 = Колонка200;
			Данные.П000017019002 = Колонка220;
			Данные.П000017021002 = Колонка240;
			Данные.П000017023002 = Колонка260;
			Данные.П000017025002 = Колонка280;
			Данные.П000017027002 = Колонка300;
			Данные.П000017029002 = Колонка320;
			Данные.П000017031002 = Колонка340;
			Данные.П000017036002 = Колонка360;
			Данные.П000017038002 = Колонка380;
			
			Для Каждого ДопСтр Из ДопТаблицаРаздела Цикл
				Если (ДопСтр.Данные = Неопределено) ИЛИ (Тип(ДопСтр.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				
				ДопСтрДанные = ДопСтр.Данные;
				
				Если ТипЛиста <> ДопСтрДанные.П000019000101 Тогда
					Продолжить;
				КонецЕсли;
								
				ДляКолонки170 = ДляКолонки170 + ДопСтрДанные.П000019012004;				
				ДляКолонки210 = ДляКолонки210 + ДопСтрДанные.П000019020004;				
				ДляКолонки250 = ДляКолонки250 + ДопСтрДанные.П000019024004;				
				ДляКолонки290 = ДляКолонки290 + ДопСтрДанные.П000019028004;				
				ДляКолонки330 = ДляКолонки330 + ДопСтрДанные.П000019032004;				
				ДляКолонки370 = ДляКолонки370 + ДопСтрДанные.П000019039004;
				
			КонецЦикла;
			
			//Итоговые показатели на странице
			//стр. 370
			Данные.П000017037004 = ОкруглитьЧислоПоФормату(ДляКолонки370);
			//стр. 390
			Данные.П000017039004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000017038002)
			- ОкруглитьЧислоПоФормату(Данные.П000017036002)
			- ОкруглитьЧислоПоФормату(Данные.П000017037004));
			//стр. 400
			Данные.П000017040004 = Макс(0,(ОкруглитьЧислоПоФормату(Данные.П000017036002)
			+ ОкруглитьЧислоПоФормату(Данные.П000017037004))
			- ОкруглитьЧислоПоФормату(Данные.П000017038002));

			//стр. 330
			Данные.П000017030004 = ОкруглитьЧислоПоФормату(ДляКолонки330);
			//стр. 350
			Данные.П000017032004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000017031002)
			- ОкруглитьЧислоПоФормату(Данные.П000017029002)
			- ОкруглитьЧислоПоФормату(Данные.П000017030004));

			//стр. 290
			Данные.П000017026004 = ОкруглитьЧислоПоФормату(ДляКолонки290);
			//стр. 310
			Данные.П000017028004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000017027002)
			- ОкруглитьЧислоПоФормату(Данные.П000017025002)
			- ОкруглитьЧислоПоФормату(Данные.П000017026004));
			
			//стр. 250
			Данные.П000017022004 = ОкруглитьЧислоПоФормату(ДляКолонки250);
			//стр. 270
			Данные.П000017024004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000017023002)
			- ОкруглитьЧислоПоФормату(Данные.П000017021002)
			- ОкруглитьЧислоПоФормату(Данные.П000017022004));
			
			//стр. 210
			Данные.П000017018004 = ОкруглитьЧислоПоФормату(ДляКолонки210);
			//стр. 230
			Данные.П000017020004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000017019002)
			- ОкруглитьЧислоПоФормату(Данные.П000017017002)
			- ОкруглитьЧислоПоФормату(Данные.П000017018004));
			
			//стр. 170
			Данные.П000017014004 = ОкруглитьЧислоПоФормату(ДляКолонки170);
			//стр. 190
			Данные.П000017016004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000017015002)
			- ОкруглитьЧислоПоФормату(Данные.П000017014004)
			- ОкруглитьЧислоПоФормату(Данные.П000017013002));

			//стр. 120
			Данные.П000017009004 = ОкруглитьЧислоПоФормату(ДляКолонки170 + Данные.П000017040004);
			//стр. 140
			Данные.П000017011004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000017010002)
			- ОкруглитьЧислоПоФормату(Данные.П000017008002)
			- ОкруглитьЧислоПоФормату(Данные.П000017009004));
			//стр. 150
			Данные.П000017012004 = Макс(0,(ОкруглитьЧислоПоФормату(Данные.П000017008002)
			+ ОкруглитьЧислоПоФормату(Данные.П000017009004))
			- ОкруглитьЧислоПоФормату(Данные.П000017010002));
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистЗ" Тогда
			
			ДляКолонки080 = 0;
			ДляКолонки090 = 0;
			ДляКолонки1000 = 0;
			
			ТипЛиста = Данные.П000016000101;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистЗ"];
			ДопТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистЗПродолжение"];
			
			Для Каждого Стр Из ПромТаблицаРаздела Цикл
				Если (Стр.Данные = Неопределено) ИЛИ (Тип(Стр.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				
				СтрТипЛиста = ?(ТипЛиста = 0,"",Строка(ТипЛиста));
				
				Если СтрТипЛиста <> Стр.Данные.П000016000101 Тогда
					Продолжить;
				КонецЕсли;
				
				ТаблицаБлока = Стр.ДанныеДопСтрок;
				
				Если ТаблицаБлока <> Неопределено Тогда
					Для каждого Зап Из ТаблицаБлока Цикл
						ДляКолонки080 = ДляКолонки080 + Зап.П000016001005;	
					КонецЦикла;
				КонецЕсли;
								
				Для Каждого ДопСтр Из ДопТаблицаРаздела Цикл
					Если (ДопСтр.Данные = Неопределено) ИЛИ (Тип(ДопСтр.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					
					ДопСтрДанные = ДопСтр.Данные;
					
					Если ТипЛиста <> Строка(ДопСтрДанные.П000017000101) Тогда
						Продолжить;
					КонецЕсли;
					
					ДляКолонки090 = ОкруглитьЧислоПоФормату(ДопСтрДанные.П000017011004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000017016004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000017020004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000017022004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000017028004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000017032004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000017039004);
					
					ДляКолонки100 = ДляКолонки080 - ДляКолонки090;
					
					Данные.П000016002008 = ДляКолонки080;
					Данные.П000016002009 = ДляКолонки090;
					Данные.П000016002010 = ДляКолонки100;				
					
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистИПродолжение" Тогда
			
			Колонка110 = 0;
			Колонка130 = 0;
			Колонка160 = 0;
			Колонка180 = 0;
			Колонка200 = 0;
			Колонка210 = 0;
			Колонка240 = 0;
			Колонка250 = 0;
			Колонка280 = 0;
			Колонка290 = 0;
			Колонка320 = 0;
			Колонка330 = 0;			
			Колонка360 = 0;
			Колонка370 = 0;	
			
			ТипЛиста = Данные.П000019000101;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистИ"];
			Для Каждого Стр Из ПромТаблицаРаздела Цикл
				Если (Стр.Данные = Неопределено) ИЛИ (Тип(Стр.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				
				СтрТипЛиста = ?(ТипЛиста = 0,"",Строка(ТипЛиста));
				
				Если СтрТипЛиста <> Стр.Данные.П000018000101 Тогда
					Продолжить;
				КонецЕсли;
				
				ТаблицаБлока = Стр.ДанныеДопСтрок;
				
				Если ТаблицаБлока <> Неопределено Тогда
					Для каждого Зап Из ТаблицаБлока Цикл
						Если Зап.П000018001001 = "1" Тогда
							Колонка110 = Колонка110 + Зап.П000018001006;
							Колонка130 = Колонка130 + Зап.П000018001007;
						КонецЕсли;
						Если Зап.П000018001001 = "2" Тогда
							Колонка160 = Колонка160 + Зап.П000018001006;
							Колонка180 = Колонка180 + Зап.П000018001007;
						КонецЕсли;
						Если Зап.П000018001001 = "3" Тогда
							Колонка200 = Колонка200 + Зап.П000018001006;
							Колонка210 = Колонка210 + Зап.П000018001007;
						КонецЕсли;
						Если Зап.П000018001001 = "4" Тогда
							Колонка240 = Колонка240 + Зап.П000018001006;
							Колонка250 = Колонка250 + Зап.П000018001007;
						КонецЕсли;
						Если Зап.П000018001001 = "5" Тогда
							Колонка280 = Колонка280 + Зап.П000018001006;
							Колонка290 = Колонка290 + Зап.П000018001007;
						КонецЕсли;
						Если Зап.П000018001001 = "6" Тогда
							Колонка320 = Колонка320 + Зап.П000018001006;
							Колонка330 = Колонка330 + Зап.П000018001007;
						КонецЕсли;
						Если Зап.П000018001001 = "7" Тогда
							Колонка360 = Колонка360 + Зап.П000018001006;
							Колонка370 = Колонка370 + Зап.П000018001007;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
			
			Данные.П000019008002= Колонка110;
			Данные.П000019010002 = Колонка130;
			Данные.П000019013002 = Колонка160;
			Данные.П000019015002 = Колонка180;
			Данные.П000019017002 = Колонка200;
			Данные.П000019018004 = Колонка210;
			Данные.П000019021002 = Колонка240;
			Данные.П000019022004 = Колонка250;
			Данные.П000019025002 = Колонка280;
			Данные.П000019026004 = Колонка290;
			Данные.П000019029002 = Колонка320;
			Данные.П000019030004 = Колонка330;
			Данные.П000019036002 = Колонка360;
			Данные.П000019037004 = Колонка370;
			
			//Итоговые показатели на странице
			
			//стр. 380
			Данные.П000019038002= Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019037004)
			- ОкруглитьЧислоПоФормату(Данные.П000019036002));
			//стр. 390
			Данные.П000019039004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019036002)
			- ОкруглитьЧислоПоФормату(Данные.П000019037004));

			//стр. 340
			Данные.П000019031002= Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019030004)
			- ОкруглитьЧислоПоФормату(Данные.П000019029002));
			//стр. 350
			Данные.П000019032004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019029002)
			- ОкруглитьЧислоПоФормату(Данные.П000019030004));
			
			//стр. 300
			Данные.П000019027002 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019026004)
			- ОкруглитьЧислоПоФормату(Данные.П000019025002));
			//стр. 310
			Данные.П000019028004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019025002)
			- ОкруглитьЧислоПоФормату(Данные.П000019026004));
			
			//стр. 260
			Данные.П000019023002 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019022004)
			- ОкруглитьЧислоПоФормату(Данные.П000019021002));
			//стр. 270
			Данные.П000019024004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019021002)
			- ОкруглитьЧислоПоФормату(Данные.П000019022004));
			
			//стр. 220
			Данные.П000019019002 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019018004)
			- ОкруглитьЧислоПоФормату(Данные.П000019017002));
			//стр. 230
			Данные.П000019020004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019017002)
			- ОкруглитьЧислоПоФормату(Данные.П000019018004));
			
			//стр. 170
			Данные.П000019014004 = ОкруглитьЧислоПоФормату(Данные.П000019012004);
			//стр. 190
			Данные.П000019016004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019015002)
			- ОкруглитьЧислоПоФормату(Данные.П000019013002)
			- ОкруглитьЧислоПоФормату(Данные.П000019014004));
			
			//стр. 120
			Данные.П000019009004 = ОкруглитьЧислоПоФормату(Данные.П000019032004);
			//стр. 140
			Данные.П000019011004 = Макс(0,ОкруглитьЧислоПоФормату(Данные.П000019010002)
			- ОкруглитьЧислоПоФормату(Данные.П000019008002)
			- ОкруглитьЧислоПоФормату(Данные.П000019009004));
			//стр. 150
			Данные.П000019012004 = Макс(0,(ОкруглитьЧислоПоФормату(Данные.П000019008002)
			+ ОкруглитьЧислоПоФормату(Данные.П000019009004))
			- ОкруглитьЧислоПоФормату(Данные.П000019010002));
			
		КонецЕсли;
		
		Если ИмяЛиста = "ЛистИ" Тогда
			
			ДляКолонки080 = 0;
			ДляКолонки090 = 0;
			ДляКолонки1000 = 0;
			
			ТипЛиста = Данные.П000018000101;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистИ"];
			ДопТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистИПродолжение"];
			
			Для Каждого Стр Из ПромТаблицаРаздела Цикл
				Если (Стр.Данные = Неопределено) ИЛИ (Тип(Стр.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				
				СтрТипЛиста = ?(ТипЛиста = 0,"",Строка(ТипЛиста));
				
				Если СтрТипЛиста <> Стр.Данные.П000018000101 Тогда
					Продолжить;
				КонецЕсли;
				
				ТаблицаБлока = Стр.ДанныеДопСтрок;
				
				Если ТаблицаБлока <> Неопределено Тогда
					Для каждого Зап Из ТаблицаБлока Цикл
						ДляКолонки080 = ДляКолонки080 + Зап.П000018001005;	
					КонецЦикла;
				КонецЕсли;
								
				Для Каждого ДопСтр Из ДопТаблицаРаздела Цикл
					Если (ДопСтр.Данные = Неопределено) ИЛИ (Тип(ДопСтр.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					
					ДопСтрДанные = ДопСтр.Данные;
					
					Если ТипЛиста <> Строка(ДопСтрДанные.П000019000101) Тогда
						Продолжить;
					КонецЕсли;
					
					ДляКолонки090 = ОкруглитьЧислоПоФормату(ДопСтрДанные.П000019011004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000019016004)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000019019002)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000019023002)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000019027002)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000019031002)
					+ ОкруглитьЧислоПоФормату(ДопСтрДанные.П000019038002);
					
					ДляКолонки100 = ДляКолонки080 - ДляКолонки090;
					
					Данные.П000018002008 = ДляКолонки080;
					Данные.П000018002009 = ДляКолонки090;
					Данные.П000018002010 = ДляКолонки100;				
					
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЕсли;
				
		// Если рассчитывается активный лист, то необходимо значения из структуры данных отобразить в табличном поле.
		Если Страница.АктивнаяСтраница Тогда
			Для каждого ЭлементДанных Из Данные Цикл
				Если Лев(ЭлементДанных.Ключ, 13) = "П000070001003" Тогда //исклчение
					ЭлементыФормы["ПолеТабличногоДокумента" + ИмяЛиста].Области[ЭлементДанных.Ключ].Значение = ЭлементДанных.Значение;	
				КонецЕсли;
				Если ТипЗнч(ЭлементДанных.Значение) <> Тип("Число") 
					ИЛИ СтрДлина(ЭлементДанных.Ключ) < 13
					ИЛИ НЕ ЭтоКодПоказателяП(Лев(ЭлементДанных.Ключ, 13)) Тогда
					Продолжить;
				КонецЕсли;
				ЭлементыФормы["ПолеТабличногоДокумента" + ИмяЛиста].Области[ЭлементДанных.Ключ].Значение = ЭлементДанных.Значение;	
			КонецЦикла; 
		КонецЕсли;
		
	КонецЦикла; // Конец перебора страниц многостраничного раздела

	
КонецПроцедуры // РасчетВСтруктуре()

// Функция РАСЧЕТ ()
// Выполняет расчет вычисляемых показателей на заданной странице отчета
// (ячеек, выделенных зеленым цветом). 
// В случае неуказания листа, ничего происходить не будет
// Параметры:
//  ИмяТекущейСтраницыПанели - строка, имя страницы основной панели формы.
//
Процедура Расчет(ИмяСтраницыПанели = "") Экспорт
	
	Перем ТаблицаБлока;
	
	Если (мРежимПечати) Тогда
		Возврат; // служебный вызов в процессе печати
	КонецЕсли;
	
	Если ИмяСтраницыПанели = "" Тогда
		//для многостраничных или многостраничных разделов необходимо сохранить данные в структуру
		ИмяТекущейСтраницыПанели = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница.Имя;
		МногостраничностьЕсть = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели, "МногостраничностьВРазделе");
		
		ИмяГруппы = ОпределитьИдМногострочногоРазделаПоАктивнойСтранице();
		МногострочностьЕсть = (ИмяГруппы <> Неопределено);
		Если МногостраничностьЕсть Тогда
			РегламентированнаяОтчетность.роСохранитьДанныеМногостраничногоРазделаВактивнойСтранице(ЭтаФорма, ИмяТекущейСтраницыПанели, Ложь);
		КонецЕсли;
		Если МногострочностьЕсть Тогда
			ОбновитьСтруктуруМногострочногоРаздела(ИмяГруппы);
		КонецЕсли;
	КонецЕсли;
	
	Если (ФлажокОтклАвтоРасчет) Тогда
		Возврат; // отключен режим авторасчета
	КонецЕсли;

	Если ИмяСтраницыПанели <> "" Тогда
		
		Если ИмяСтраницыПанели = "Раздел1" Тогда
			
			Если мСтатусНалогоплательщика <> 1 Тогда
				ОчиститьТабличноеПоле(ЭлементыФормы.ПолеТабличногоДокументаРаздел1);
			Иначе
				
				Колонка010 = 0;
				Колонка070 = 0;
				Колонка090 = 0;
				Колонка040 = 0;
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистА"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Если Данные.СтавкаНалога = "13" Тогда
						Колонка010 = Колонка010 + Данные.П000070008001;
						Колонка070 = Колонка070 + Данные.П000070011001;
					КонецЕсли;
				КонецЦикла;
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистБ"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Если Данные.СтавкаНалога = "13" Тогда
						Колонка010 = Колонка010 + Данные.П000080001501;
						Колонка090 = Колонка090 + Данные.П000080001801;
						
					КонецЕсли;
				КонецЦикла;
				
				Колонка010 = Колонка010 + ОкруглитьЧислоПоФормату(мЛистВ.Области.П000090001101.Значение);
				
				мРаздел1.Области.П000010001003.Значение = Колонка010;
				
				мРаздел1.Области.П000010002003.Значение = ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010116004.Значение);
				
				мРаздел1.Области.П000010003003.Значение = ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010001003.Значение)
				- ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010002003.Значение);
				
				//Получим данные связанных разделов для строки 040
				Колонка040 = Колонка040 + ОкруглитьЧислоПоФормату(мЛистВ.Области.П000090001201.Значение);
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистД"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Колонка040 = Колонка040 + Данные.П000012010004;
				КонецЦикла;
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистЕ"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Колонка040 = Колонка040 + Данные.П000013006004;
				КонецЦикла;
				
				Колонка040 = Колонка040 + ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014021004.Значение);
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистЖ2"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Колонка040 = Колонка040 + Данные.П000015013004;
				КонецЦикла;
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистЗ"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Колонка040 = Колонка040 + Данные.П000016002010;
				КонецЦикла;
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистИ"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Колонка040 = Колонка040 + Данные.П000018002010;
				КонецЦикла;
				
				Колонка040 = Колонка040 + ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020022004.Значение);
				
				Колонка040 = Колонка040 + ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021013004.Значение);
				
				Колонка040 = Колонка040 + ОкруглитьЧислоПоФормату(мЛистЛ.Области.П000024018004.Значение)
				+ ОкруглитьЧислоПоФормату(мЛистЛ.Области.П000024019004.Значение)
				+ ОкруглитьЧислоПоФормату(мЛистЛ.Области.П000024021004.Значение)
				+ ОкруглитьЧислоПоФормату(мЛистЛ.Области.П000024022004.Значение);
				
				мРаздел1.Области.П000010004003.Значение = Колонка040;
				// строка 040
				
				мРаздел1.Области.П000010005003.Значение = Макс(0,ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010003003.Значение)
				- ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010004003.Значение));
				
				
				мРаздел1.Области.П000010006003.Значение = ОкруглитьЧислоПоФормату(ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010005003.Значение)
				* 0.13,0);
				
				мРаздел1.Области.П000010007003.Значение = ОкруглитьЧислоПоФормату(Колонка070,0);
				
				мРаздел1.Области.П000010007503.Значение = ОкруглитьЧислоПоФормату(мЛистВ.Области.П000090001401.Значение, 0);
				
				мРаздел1.Области.П000010009003.Значение = ОкруглитьЧислоПоФормату(Колонка090, 0);
				
				мРаздел1.Области.П000010010003.Значение = Макс(0,(ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010007003.Значение, 0)
				+ ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010007503.Значение, 0)
				+ ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010008003.Значение, 0))
				- ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010006003.Значение, 0));
				
				мРаздел1.Области.П000010011003.Значение = Макс(0,ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010006003.Значение, 0)
				-(ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010007003.Значение, 0)
				+ ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010007503.Значение, 0)
				+ ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010008003.Значение, 0)
				+ ОкруглитьЧислоПоФормату(мРаздел1.Области.П000010009003.Значение, 0)));
				
			КонецЕсли;
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "Раздел2" Тогда
			
			Если мСтатусНалогоплательщика <> 2 Тогда
				ОчиститьТабличноеПоле(ЭлементыФормы.ПолеТабличногоДокументаРаздел2);
			Иначе
				
				Колонка010 = 0;
				Колонка040 = 0;
				Колонка060 = 0;
				Колонка070 = 0;
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистА"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Если Данные.СтавкаНалога = "30" Тогда
						Колонка010 = Колонка010 + Данные.П000070008001;
						Колонка060 = Колонка060 + Данные.П000070010001;
						Колонка070 = Колонка070 + Данные.П000070011001;
					КонецЕсли;
				КонецЦикла;
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистЗ"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Колонка040 = Колонка040 + Данные.П000016002010;
				КонецЦикла;
				
				ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистИ"];
				Для Каждого Страница Из ПромТаблицаРаздела Цикл
					Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
						Продолжить;
					КонецЕсли;
					Данные = Страница.Данные;
					
					Колонка040 = Колонка040 + Данные.П000018002010;
				КонецЦикла;
				
				мРаздел2.Области.П000020001003.Значение = Колонка010;
				
				мРаздел2.Области.П000020002003.Значение = ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010116004.Значение)
				+ ОкруглитьЧислоПоФормату(мЛистГ2.Области.П000010207001.Значение);
				
				мРаздел2.Области.П000020004003.Значение = Колонка040;
				
				мРаздел2.Области.П000020006003.Значение = Колонка060;
				
				мРаздел2.Области.П000020007003.Значение = Колонка070;
				
				мРаздел2.Области.П000020003003.Значение = ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020001003.Значение)
				- ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020002003.Значение);
				
				мРаздел2.Области.П000020005003.Значение = Макс(0,ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020003003.Значение)
				- ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020004003.Значение));
				
				
				мРаздел2.Области.П000020009003.Значение = Макс(0,(ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020007003.Значение, 0)
				+ ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020008003.Значение, 0))
				- ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020006003.Значение, 0));
				
				мРаздел2.Области.П000020010003.Значение = Макс(0,ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020006003.Значение, 0)
				-(ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020007003.Значение, 0)
				+ ОкруглитьЧислоПоФормату(мРаздел2.Области.П000020008003.Значение, 0)));
				
			КонецЕсли;
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "Раздел3" Тогда
			
			Колонка010 = 0;
			Колонка040 = 0;
			Колонка050 = 0;
			Колонка070 = 0;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистА"];
			Для Каждого Страница Из ПромТаблицаРаздела Цикл
				Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				Данные = Страница.Данные;
				
				Если Данные.СтавкаНалога = "35" Тогда
					Колонка010 = Колонка010 + Данные.П000070008001;
					Колонка040 = Колонка040 + Данные.П000070010001;
					Колонка050 = Колонка050 + Данные.П000070011001;
				КонецЕсли;
			КонецЦикла;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистБ"];
			Для Каждого Страница Из ПромТаблицаРаздела Цикл
				Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				Данные = Страница.Данные;
				
				Если Данные.СтавкаНалога = "35" Тогда
					Колонка010 = Колонка010 + Данные.П000080001501;
					Колонка040 = Колонка040 + Данные.П000080001701;
					Колонка070 = Колонка070 + Данные.П000080001801;
				КонецЕсли;
			КонецЦикла;
			
			мРаздел3.Области.П000030001003.Значение = Колонка010;
			
			мРаздел3.Области.П000030002003.Значение = ОкруглитьЧислоПоФормату(мЛистГ2.Области.П000010207001.Значение);
			
			мРаздел3.Области.П000030003003.Значение = ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030001003.Значение)
			- ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030002003.Значение);
			
			мРаздел3.Области.П000030004003.Значение = Колонка040;
			
			мРаздел3.Области.П000030005003.Значение = Колонка050;
			
			мРаздел3.Области.П000030005103.Значение = ОкруглитьЧислоПоФормату(мЛистГ3.Области.П000027207001.Значение);
			
			мРаздел3.Области.П000030007003.Значение = Колонка070;
			
			мРаздел3.Области.П000030008003.Значение = Макс(0,(ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030005003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030005103.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030006003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030007003.Значение, 0))
			- ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030004003.Значение, 0));
			
			мРаздел3.Области.П000030009003.Значение = Макс(0,ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030004003.Значение, 0)
			-(ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030005003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030005103.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030006003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел3.Области.П000030007003.Значение, 0)));
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "Раздел4" Тогда
			
			Колонка010 = 0;
			Колонка020 = 0;
			Колонка030 = 0;
			Колонка040 = 0;
			Колонка060 = 0;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистА"];
			Для Каждого Страница Из ПромТаблицаРаздела Цикл
				Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				Данные = Страница.Данные;
				
				Если Данные.СтавкаНалога = "9" Тогда
					Колонка010 = Колонка010 + Данные.П000070008001;
					Колонка020 = Колонка020 + Данные.П000070009001;
					Колонка030 = Колонка030 + Данные.П000070010001;
					Колонка040 = Колонка040 + Данные.П000070011001;
				КонецЕсли;
			КонецЦикла;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистБ"];
			Для Каждого Страница Из ПромТаблицаРаздела Цикл
				Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				Данные = Страница.Данные;
				
				Если Данные.СтавкаНалога = "9" Тогда
					Колонка010 = Колонка010 + Данные.П000080001501;
					Колонка020 = Колонка020 + Данные.П000080001501;
					Колонка030 = Колонка030 + Данные.П000080001701;
					Колонка060 = Колонка060 + Данные.П000080001801;
				КонецЕсли;
			КонецЦикла;
			
			мРаздел4.Области.П000040001003.Значение = Колонка010;
			
			мРаздел4.Области.П000040002003.Значение = Колонка020;
			
			мРаздел4.Области.П000040003003.Значение = Колонка030;
			
			мРаздел4.Области.П000040004003.Значение = Колонка040;
			
			мРаздел4.Области.П000040006003.Значение = Колонка060;
			
			мРаздел4.Области.П000040007003.Значение = Макс(0,(ОкруглитьЧислоПоФормату(мРаздел4.Области.П000040004003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел4.Области.П000040005003.Значение, 0))
			- ОкруглитьЧислоПоФормату(мРаздел4.Области.П000040003003.Значение, 0));
			
			мРаздел4.Области.П000040008003.Значение = Макс(0,ОкруглитьЧислоПоФормату(мРаздел4.Области.П000040003003.Значение, 0)
			-(ОкруглитьЧислоПоФормату(мРаздел4.Области.П000040004003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел4.Области.П000040005003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел4.Области.П000040006003.Значение, 0)));
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "Раздел5" Тогда
			
			Колонка010 = 0;
			Колонка020 = 0;
			Колонка030 = 0;
			Колонка040 = 0;
			
			ПромТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистА"];
			Для Каждого Страница Из ПромТаблицаРаздела Цикл
				Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				Данные = Страница.Данные;
				
				Если Данные.СтавкаНалога = "15" Тогда
					Колонка010 = Колонка010 + Данные.П000070008001;
					Колонка020 = Колонка020 + Данные.П000070009001;
					Колонка030 = Колонка030 + Данные.П000070010001;
					Колонка040 = Колонка040 + Данные.П000070011001;
				КонецЕсли;
			КонецЦикла;
			
			мРаздел5.Области.П000050001003.Значение = Колонка010;
			
			мРаздел5.Области.П000050002003.Значение = Колонка020;
			
			мРаздел5.Области.П000050003003.Значение = Колонка030;
			
			мРаздел5.Области.П000050004003.Значение = Колонка040;
			
			мРаздел5.Области.П000050006003.Значение = Макс(0,(ОкруглитьЧислоПоФормату(мРаздел5.Области.П000050004003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел5.Области.П000050005003.Значение, 0))
			- ОкруглитьЧислоПоФормату(мРаздел5.Области.П000050003003.Значение, 0));
			
			мРаздел5.Области.П000050007003.Значение = Макс(0,ОкруглитьЧислоПоФормату(мРаздел5.Области.П000050003003.Значение, 0)
			-(ОкруглитьЧислоПоФормату(мРаздел5.Области.П000050004003.Значение, 0)
			+ ОкруглитьЧислоПоФормату(мРаздел5.Области.П000050005003.Значение, 0)));
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистА" Тогда
			
			РасчетВСтруктуре("ЛистА");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистБ" Тогда
			
			РасчетВСтруктуре("ЛистБ");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистВ" Тогда
			
			мСтруктураМногострочныхРазделов.Свойство(мИдГруппыВ, ТаблицаБлока);
			Колонка100 = 0;			
			Колонка110 = 0;
			Колонка120 = 0;
			Для каждого Зап Из ТаблицаБлока Цикл
				Колонка110 = Колонка110 + ОкруглитьЧислоПоФормату(Зап.П000090001003);				
				Колонка100 = ОкруглитьЧислоПоФормату(?(Зап.П000090001004 = 0 ,Окр(Зап.П000090001003 * 0.2, 2), 0));
				Зап.П000090001010 = Колонка100;
				мЛистВ.Области["П000090001010_" + (ТаблицаБлока.Индекс(Зап) + 1)].Значение = Колонка100;
				Колонка120 = Колонка120 + ?(Колонка100 = 0, ОкруглитьЧислоПоФормату(Зап.П000090001004), Колонка100);
			КонецЦикла;
			
			мЛистВ.Области.П000090001101.Значение = Колонка110;
			мЛистВ.Области.П000090001201.Значение = Колонка120;
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистГ1" Тогда
			
			Колонка150 = 0;
			
			ТаблицаРаздела = мСтруктураМногостраничныхРазделов["ЛистГ1Продолжение"];
			
			Для Каждого Страница Из ТаблицаРаздела Цикл
				Если (Страница.Данные = Неопределено) ИЛИ (Тип(Страница.Данные) <> Тип("Структура")) Тогда
					Продолжить;
				КонецЕсли;
				
				Данные = Страница.Данные;
				Колонка150 = Колонка150 + Данные.П000025124002;				
				
			КонецЦикла;
			
			мЛистГ1.Области.П000010102004.Значение = Мин(мЛистГ1.Области.П000010101002.Значение,мЛистГ1.Области.П000010102004.Значение);
			мЛистГ1.Области.П000010104004.Значение = Мин(мЛистГ1.Области.П000010103002.Значение,4000);
			мЛистГ1.Области.П000010106004.Значение = Мин(мЛистГ1.Области.П000010105002.Значение,4000);
			мЛистГ1.Области.П000010108004.Значение = Мин(мЛистГ1.Области.П000010107002.Значение,4000);
			мЛистГ1.Области.П000010110004.Значение = Мин(мЛистГ1.Области.П000010109002.Значение,4000);
			мЛистГ1.Области.П000010112004.Значение = Мин(мЛистГ1.Области.П000010111002.Значение,4000);
			мЛистГ1.Области.П000010114004.Значение = Мин(мЛистГ1.Области.П000010113002.Значение,10000);
			
			мЛистГ1.Области.П000010115004.Значение = Колонка150;
			
			мЛистГ1.Области.П000010116004.Значение = ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010102004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010104004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010106004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010108004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010110004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010112004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010114004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистГ1.Области.П000010115004.Значение);
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистГ1Продолжение" Тогда
			
			РасчетВСтруктуре("ЛистГ1Продолжение");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистГ2" Тогда
			
			мСтруктураМногострочныхРазделов.Свойство(мИдГруппыГ2, ТаблицаБлока);
			Колонка060 = 0;
			Для каждого Зап Из ТаблицаБлока Цикл
				Колонка050 = ОкруглитьЧислоПоФормату(Зап.П000010201006);
				Колонка050 = Мин(Колонка050,Зап.П000010201005,4000);
				мЛистГ2.Области["П000010201006_" + (ТаблицаБлока.Индекс(Зап)+1)].Значение = Колонка050;
				Колонка060 = Колонка060 + Колонка050;				
			КонецЦикла;
			
			мЛистГ2.Области.П000010207001.Значение = Колонка060;
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистГ3" Тогда
			
			мСтруктураМногострочныхРазделов.Свойство(мИдГруппыГ3, ТаблицаБлока);
			Колонка070 = 0;
			Для каждого Зап Из ТаблицаБлока Цикл
				Колонка070 = Колонка070 + ОкруглитьЧислоПоФормату(Зап.П000027201006);
				Колонка030 = Зап.П000027201003;
				Если ЗначениеЗаполнено(Колонка030) Тогда
					ДлинаЗначения = СтрДлина(СокрЛП(Колонка030));
					Для Инд = ДлинаЗначения+1 По 11 Цикл
						Колонка030 = СокрЛП(Колонка030) + "0";
					КонецЦикла;
				КонецЕсли;
				мЛистГ3.Области["П000027201003_" + (ТаблицаБлока.Индекс(Зап)+1)].Значение = Колонка030;
			КонецЦикла;
			
			мЛистГ3.Области.П000027207001.Значение = Колонка070;
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистД" Тогда
			
			РасчетВСтруктуре("ЛистД");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистЕ" Тогда
			
			РасчетВСтруктуре("ЛистЕ");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистЖ1" Тогда
			
			//пп. 1.1 и пп. 1.2
			мЛистЖ1.Области.П000014002004.Значение = Мин(1000000, ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014002004.Значение), ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014001002.Значение));
			мЛистЖ1.Области.П000014004004.Значение = Мин(ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014004004.Значение), ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014003002.Значение));
			
			//Общая сумма по пп. 1.1 и пп. 1.2
			мЛистЖ1.Области.П000014005002.Значение = ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014001002.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014003002.Значение);
			
			мЛистЖ1.Области.П000014006004.Значение = Мин(1000000, ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014002004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014004004.Значение));

			//пп. 1.4 и пп. 1.5
			мЛистЖ1.Области.П000014008004.Значение = Мин(ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014008004.Значение), ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014007002.Значение));
			мЛистЖ1.Области.П000014010004.Значение = Мин(ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014010004.Значение), ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014009002.Значение));
			
			//Итоговые суммы по п. 1
			мЛистЖ1.Области.П000014011002.Значение = ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014005002.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014007002.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014009002.Значение);
			
			мЛистЖ1.Области.П000014012004.Значение = ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014006004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014008004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014010004.Значение);
			
			//пп. 2.2 и пп. 2.3
			мЛистЖ1.Области.П000014016004.Значение = Мин(ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014016004.Значение), ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014015002.Значение));
			мЛистЖ1.Области.П000014018004.Значение = Мин(ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014018004.Значение), ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014017002.Значение));
			
			//Итоговые суммы по п. 2
			мЛистЖ1.Области.П000014019002.Значение = ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014013002.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014015002.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014017002.Значение);
			
			мЛистЖ1.Области.П000014020004.Значение = ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014014004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014016004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014018004.Значение);
			
			//Общая сумма вычетов
			мЛистЖ1.Области.П000014021004.Значение = ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014012004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистЖ1.Области.П000014020004.Значение);
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистЖ2" Тогда
			
			РасчетВСтруктуре("ЛистЖ2");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистЗ" Тогда
			
			РасчетВСтруктуре("ЛистЗ");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистЗПродолжение" Тогда
			
			РасчетВСтруктуре("ЛистЗПродолжение");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистИ" Тогда
			
			РасчетВСтруктуре("ЛистИ");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистИПродолжение" Тогда
			
			РасчетВСтруктуре("ЛистИПродолжение");
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистК1" Тогда
			
			мЛистК1.Области.П000020022004.Значение = ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020015004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020016004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020017004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020018004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020019004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020020004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК1.Области.П000020021004.Значение);
			
			Колонка130 = 0;
			Колонка140 = 0;
			СумДоход = 0;
			Для НомерМесяца = 1 По 12 Цикл
				Постфикс = "002";
				Префикс = ?(НомерМесяца<10, "0", "");
				СумДоходТек = ОкруглитьЧислоПоФормату(мЛистК1.Области["П0000200" + Префикс + НомерМесяца + Постфикс].Значение);
				//перепишем значения доходов нарастающим итогом
				Если НомерМесяца > 1 Тогда
					ПрефиксПред = ?(НомерМесяца<11, "0", "");
					СумДоходПред = ОкруглитьЧислоПоФормату(мЛистК1.Области["П0000200" + ПрефиксПред + (НомерМесяца-1) + Постфикс].Значение);
					СумДоходНов = Макс(СумДоходТек, СумДоходПред);
					мЛистК1.Области["П0000200" + Префикс + НомерМесяца + Постфикс].Значение = СумДоходНов;
				КонецЕсли;
				СумДоход = ОкруглитьЧислоПоФормату(мЛистК1.Области["П0000200" + Префикс + НомерМесяца + Постфикс].Значение);
				Если СумДоход > 0 Тогда
					Если СумДоход <= 40000 Тогда
						Колонка130 = Колонка130 + 1;
					КонецЕсли;
					Если СумДоход <= 280000 Тогда
						Колонка140 = Колонка140 + 1;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
			мЛистК1.Области.П000020013002.Значение = Колонка130;
			мЛистК1.Области.П000020014004.Значение = Колонка140;
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистК2" Тогда
			
			мЛистК2.Области.П000021004004.Значение = ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021001004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021002004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021003004.Значение);
			
			мЛистК2.Области.П000021008004.Значение = ОкруглитьЧислоПоФормату(мЛистК3.Области.П000022008004.Значение);
			мЛистК2.Области.П000021009004.Значение = ОкруглитьЧислоПоФормату(мЛистК3.Области.П000022016004.Значение);
			мЛистК2.Области.П000021010004.Значение = ОкруглитьЧислоПоФормату(мЛистК4.Области.П000023008004.Значение);
			мЛистК2.Области.П000021011004.Значение = ОкруглитьЧислоПоФормату(мЛистК4.Области.П000023016004.Значение);
			
			мЛистК2.Области.П000021013004.Значение = Мин(120000, ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021005004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021006004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021007004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021008004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021009004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021010004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021011004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021012004.Значение));
			
			мЛистК2.Области.П000021014004.Значение = ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021004004.Значение)
			+ ОкруглитьЧислоПоФормату(мЛистК2.Области.П000021013004.Значение);
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистК3" Тогда
			
			мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК3_1, ТаблицаБлока);
			Колонка080 = 0;
			Для каждого Зап Из ТаблицаБлока Цикл
				Колонка080 = Колонка080 + ОкруглитьЧислоПоФормату(Зап.П000022001007);
			КонецЦикла;
			мЛистК3.Области.П000022008004.Значение = Колонка080;
			
			мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК3_2, ТаблицаБлока);
			Колонка160 = 0;
			Для каждого Зап Из ТаблицаБлока Цикл
				Колонка160 = Колонка160 + ОкруглитьЧислоПоФормату(Зап.П000022002007);
			КонецЦикла;
			мЛистК3.Области.П000022016004.Значение = Колонка160;
			
		КонецЕсли;
		
		Если ИмяСтраницыПанели = "ЛистК4" Тогда
			
			мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК4_1, ТаблицаБлока);
			Колонка080 = 0;
			Для каждого Зап Из ТаблицаБлока Цикл
				Колонка080 = Колонка080 + ОкруглитьЧислоПоФормату(Зап.П000023001007);
			КонецЦикла;
			мЛистК4.Области.П000023008004.Значение = Колонка080;
			
			мСтруктураМногострочныхРазделов.Свойство(мИдГруппыК4_2, ТаблицаБлока);
			Колонка160 = 0;
			Для каждого Зап Из ТаблицаБлока Цикл
				Колонка160 = Колонка160 + ОкруглитьЧислоПоФормату(Зап.П000023002007);
			КонецЦикла;
			мЛистК4.Области.П000023016004.Значение = Колонка160;
			
		КонецЕсли;
		
	ИначеЕсли ИмяСтраницыПанели = "" Тогда
		
		// В этом режиме перерассчитаем все показатели на листах в обратном порядке.

		Расчет("ЛистК4");
		Расчет("ЛистК3");
		Расчет("ЛистК2");
		Расчет("ЛистК1");
		Расчет("ЛистИПродолжение");
		Расчет("ЛистИ");
		Расчет("ЛистЗПродолжение");
		Расчет("ЛистЗ");
		Расчет("ЛистЖ2");
		Расчет("ЛистЖ1");		
		Расчет("ЛистЕ");
		Расчет("ЛистД");
		Расчет("ЛистГ3");
		Расчет("ЛистГ2");
		Расчет("ЛистГ1Продолжение");
		Расчет("ЛистГ1");		
		Расчет("ЛистВ");
		Расчет("ЛистБ");
		Расчет("ЛистА");
		
		Расчет("Раздел5");
		Расчет("Раздел4");
		Расчет("Раздел3");
		Расчет("Раздел2");
		Расчет("Раздел1");
		
	КонецЕсли;

КонецПроцедуры // Расчет()

//АВТОРАСЧЕТ И ВСПОМОГАТЕЛЬНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ---
////////////////////////////////////////////////////////////////////////////////

Процедура УстановитьМаскиВПоляхВвода()
	
	// титульный 001
	Для Инд = 1 По 3 Цикл
		мТитульный.Области["СоставленаНа" + Инд].ЭлементУправления.Маска = "9";
		мТитульный.Области["Прил" + Инд].ЭлементУправления.Маска = "9";
	КонецЦикла;
	Для Инд = 1 По 4 Цикл
		мТитульный.Области["КодИМНС" + Инд].ЭлементУправления.Маска = "9";
	КонецЦикла;
	мТитульный.Области["ОКАТО"].ЭлементУправления.Маска = "99999999999";
	
	// Раздел6
	мРаздел6.Области.П000060001001.ЭлементУправления.Маска = "9";
	мРаздел6.Области.П000060003003.ЭлементУправления.Маска = "99999999999";
	мРаздел6.Области.П000060002003.ЭлементУправления.Маска = "99999999999999999999";
	
	//Лист В
	мЛистВ.Области.П000090001501.ЭлементУправления.Маска = "9999";
	
	//Лист Л
	мЛистЛ.Области.ИмГодВычета.ЭлементУправления.Маска = "9999";
	
	// области номера страницы
	Для Каждого СтрокаУровня1 Из мСвойстваРазделовДекларации.Строки Цикл
		ТаблДок = ЭлементыФормы["ПолеТабличногоДокумента" + СтрокаУровня1.ИмяСтраницы];
		НомерБлока = 1;
		Пока ТаблДок.Области.Найти("НомСтр" + НомерБлока + "_1") <> Неопределено Цикл
			Для НомерОбластиВБлоке = 1 По 3 Цикл
				ТаблДок.Области.Найти("НомСтр" + НомерБлока + "_" + НомерОбластиВБлоке).ЭлементУправления.Маска = "9";
			КонецЦикла;
			НомерБлока = НомерБлока + 1;
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры

Процедура ОтобразитьНомерКорректировки()
	
	НомерКорр = ВидДокумента * НомерКорректировки;
	НомерКорректировкиСтрока = Формат(НомерКорр, "ЧН=0; ЧГ=");
	СтрДлинаНомерКорректировкиСтрока = СтрДлина(НомерКорректировкиСтрока);
	Для Инд = 1 По 3 Цикл
		мТитульный.Области["НомерКорректировки" + Инд].Значение = ?(Инд > СтрДлинаНомерКорректировкиСтрока, "-", Сред(НомерКорректировкиСтрока, Инд, 1));
	КонецЦикла;
	
Конецпроцедуры

Процедура УправлениеЭУВидДокументаНомерКорректировки()
	
	ЭлементыФормы.НомерКорректировки.Доступность = (ВидДокумента = 1);
	
КонецПроцедуры

Процедура Инициализация(БезОткрытияФормы = Ложь) Экспорт

	Перем ИсходноеКоличествоСтрокГруппы;
	
	мБезОткрытияФормы = БезОткрытияФормы;

	//В теущей версии не поддерживается автозаполнение и вывод расшифровки
	ИДКонфигурации = РегламентированнаяОтчетность.ИДКонфигурации();
	Если ИДКонфигурации <> "БПКОРП" Тогда
		РегламентированнаяОтчетность.УдалитьКнопкуЗаполненияПоДаннымИБ(ЭтаФорма);
		РегламентированнаяОтчетность.УдалитьКнопкуРасшифровки(ЭтаФорма, "Расшифровка");
	КонецЕсли;
 
	ЗаполнитьНачальныеНастройки();

	ФормироватьСтруктуруСтраницОтчета();

	ФормироватьСтруктуруСвойствСтраниц();

	мТитульный          = ЭлементыФормы.ПолеТабличногоДокументаТитульный;
	мТитульный002       = ЭлементыФормы.ПолеТабличногоДокументаТитульный002;
	мРаздел1            = ЭлементыФормы.ПолеТабличногоДокументаРаздел1;
	мРаздел2            = ЭлементыФормы.ПолеТабличногоДокументаРаздел2;
	мРаздел3            = ЭлементыФормы.ПолеТабличногоДокументаРаздел3;
	мРаздел4            = ЭлементыФормы.ПолеТабличногоДокументаРаздел4;
	мРаздел5            = ЭлементыФормы.ПолеТабличногоДокументаРаздел5;
	мРаздел6            = ЭлементыФормы.ПолеТабличногоДокументаРаздел6;
	мЛистА              = ЭлементыФормы.ПолеТабличногоДокументаЛистА;
	мЛистБ              = ЭлементыФормы.ПолеТабличногоДокументаЛистБ;
	мЛистВ              = ЭлементыФормы.ПолеТабличногоДокументаЛистВ;
	мЛистГ1             = ЭлементыФормы.ПолеТабличногоДокументаЛистГ1;
	мЛистГ1Продолжение  = ЭлементыФормы.ПолеТабличногоДокументаЛистГ1Продолжение;
	мЛистГ2             = ЭлементыФормы.ПолеТабличногоДокументаЛистГ2;
	мЛистГ3             = ЭлементыФормы.ПолеТабличногоДокументаЛистГ3;
	мЛистД              = ЭлементыФормы.ПолеТабличногоДокументаЛистД;
	мЛистЕ              = ЭлементыФормы.ПолеТабличногоДокументаЛистЕ;
	мЛистЖ1             = ЭлементыФормы.ПолеТабличногоДокументаЛистЖ1;
	мЛистЖ2             = ЭлементыФормы.ПолеТабличногоДокументаЛистЖ2;
	мЛистЗ              = ЭлементыФормы.ПолеТабличногоДокументаЛистЗ;
	мЛистЗПродолжение   = ЭлементыФормы.ПолеТабличногоДокументаЛистЗПродолжение;
	мЛистИ              = ЭлементыФормы.ПолеТабличногоДокументаЛистИ;
	мЛистИПродолжение   = ЭлементыФормы.ПолеТабличногоДокументаЛистИПродолжение;
	мЛистК1              = ЭлементыФормы.ПолеТабличногоДокументаЛистК1;
	мЛистК2              = ЭлементыФормы.ПолеТабличногоДокументаЛистК2;
	мЛистК3             = ЭлементыФормы.ПолеТабличногоДокументаЛистК3;
	мЛистК4             = ЭлементыФормы.ПолеТабличногоДокументаЛистК4;
	мЛистЛ              = ЭлементыФормы.ПолеТабличногоДокументаЛистЛ;
	
	УстановитьМаскиВПоляхВвода();
	
	ВидДокумента = 0;
	НомерКорректировки = 1;
	УправлениеЭУВидДокументаНомерКорректировки();

	мАвтоВыборКодов = Ложь;
	мРежимПечати = Ложь;

	Если НЕ БезОткрытияФормы Тогда
		СформироватьСпискиВыбора();
		РегламентированнаяОтчетность.СформироватьСоставКнопкиОчиститьДляРегОтчетов(ЭтаФорма);
	КонецЕсли;

	Если мСохраненныйДок = Неопределено Тогда
		// создаем исходную структуру многострочных разделов
		Для Каждого ЭлементСтруктуры Из мСтруктураМногострочныхРазделов Цикл
			ИмяГруппы = ЭлементСтруктуры.Ключ;
			СтруктураГруппы = ЭлементСтруктуры.Значение;

			ТекТабличноеПоле = ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИмяГруппы);

			мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, ИсходноеКоличествоСтрокГруппы);

			Для НСтр = 1 По  ИсходноеКоличествоСтрокГруппы Цикл

				СтрокаГруппы = СтруктураГруппы.Добавить();

				Для Каждого Колонка Из СтруктураГруппы.Колонки Цикл

					ИмяКолонки    = Колонка.Имя;
					КодПоказателя = ИмяКолонки + "_" + Формат(НСтр, "ЧГ=0");
					ОбластьЯчейки = ТекТабличноеПоле.Области[КодПоказателя];

					Если ОбластьЯчейки.СодержитЗначение Тогда
						ЗначениеЯчейки = ОбластьЯчейки.Значение;
					Иначе
						ЗначениеЯчейки = ОбластьЯчейки.Текст;
					КонецЕсли;

					СтрокаГруппы[ИмяКолонки] = ЗначениеЯчейки;

				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
		
		Если мСкопированаФорма <> Неопределено Тогда // документ скопирован
			ВосстановитьСохраненныеДанные();
		Иначе // новый документ
			ЕдиницаИзмерения         = Перечисления.ПорядкиОкругленияОтчетности.Окр1;
			ТочностьЕдиницыИзмерения = 2;
			ОтобразитьНомерКорректировки();
			мДеревоВыбранныхСтраниц = мДеревоСтраницОтчета.Скопировать();
			УстановитьФорматВыводаВПоляхВвода();
			
		КонецЕсли;
		ЗаполнитьДатуПодписи();
	Иначе
		ВосстановитьСохраненныеДанные();
	КонецЕсли;

	ПоказатьПериод();

	Если мСохраненныйДок = Неопределено ИЛИ ЗначениеЗаполнено(мСкопированаФорма) Тогда
		ЗаполнитьСведенияОбОрганизации();
	//Иначе
	//	УправлениеЛистами();
	КонецЕсли;

	//начальное заполнение структуры данных
	РегламентированнаяОтчетность.роОбновитьСтруктуруМногостраничныхРазделов(ЭтаФорма);
	РегламентированнаяОтчетность.роОбновитьСтруктуруМногострочныхРазделов(ЭтаФорма);
	
	// устанавливаем раскраску ячеек, участвующих в автозаполнении
	Для Каждого Страница Из ЭлементыФормы.ОсновнаяПанель.Страницы Цикл
		Если Страница.Имя = "ЛистД" Тогда
			//Накладываем условие на доступность ячейки
			ИзменитьТаблицуВариантовЗаполненияЛистаД(НЕ ФлажокОтклАвтоРасчет);
		Иначе
			УстановитьЦветФонаЯчейки(,, Страница.Имя);
		КонецЕсли;
		Если Страница.Имя = "ЛистГ1Продолжение" Тогда
			ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение();
		КонецЕсли;
	КонецЦикла;

	// формируем список элементов подменю, связанное с кнопкой <Печать>
	Если НЕ БезОткрытияФормы Тогда
		РегламентированнаяОтчетность.ПрорисоватьПодменюПечать(ЭтаФорма, Новый Действие("КоманднаяПанельДействийПоказатьБланк"), Новый Действие("КоманднаяПанельДействийПечатьМашиночитаемогоБланка"));
	КонецЕсли;
	
	РегламентированнаяОтчетность.ПриИнициализацииФормыРегламентированногоОтчета(ЭтаФорма);
	
КонецПроцедуры

Процедура УстановитьФорматВыводаВПоляхВвода() Экспорт
	Перем СтруктураГруппы;

	ИмяПоляТаблДокументаСтароеЗначение = "";
	Для Каждого СтрПоказатели Из мТаблицаСоставПоказателей Цикл

		ИмяПоляТаблДокумента		= СокрП(СтрПоказатели.ИмяПоляТаблДокумента);
		КодПоказателя				= СокрП(СтрПоказатели.КодПоказателяПоСоставу);
		ПризнМногострочность		= СокрП(СтрПоказатели.ПризнМногострочности);
		КодПоказателяПоСтруктуре	= СокрП(СтрПоказатели.КодПоказателяПоСтруктуре);
		КодПоказателяПоФорме		= СокрП(СтрПоказатели.КодПоказателяПоФорме);
		ТипДанныхПоказателя			= СокрП(СтрПоказатели.ТипДанныхПоказателя);
		ИмяПоказателя				= ?(ПустаяСтрока(СтрПоказатели.КодПоказателяПоФорме), КодПоказателя, КодПоказателяПоФорме);
		ТочностьПоказателя			= ?(ПустаяСтрока(СтрПоказатели.ТочностьПоказателя),ТочностьЕдиницыИзмерения,СокрП(СтрПоказатели.ТочностьПоказателя));
		
		мСтрокаФормата = "ЧЦ = 17; ЧДЦ = " + ТочностьПоказателя + "; ЧРД=,; ЧН=-; ЧС = 0";

		Если ПустаяСтрока(КодПоказателя) ИЛИ КодПоказателя = "===" ИЛИ КодПоказателя = "###" ИЛИ Лев(КодПоказателя, 2) = "//" Тогда
			Продолжить;
		КонецЕсли;

		Если (ТипДанныхПоказателя = "Е" ИЛИ ТипДанныхПоказателя = "Е4" ИЛИ ТипДанныхПоказателя = "Е0")И ПустаяСтрока(КодПоказателяПоСтруктуре) Тогда
			ТекТабличноеПоле = ЭлементыФормы["ПолеТабличногоДокумента" + ИмяПоляТаблДокумента];
			Если ПризнМногострочность <> "/" Тогда
				ФорматируемаяОбласть = ТекТабличноеПоле.Области[ИмяПоказателя];
				ДопустимыйЗнакПоказателя = ФорматируемаяОбласть.ТипЗначения.КвалификаторыЧисла.ДопустимыйЗнак;
				Если ТипДанныхПоказателя = "Е" Тогда
					ЧислоЕЗнак = мОписаниеТиповЧислоЕ;
				ИначеЕсли ТипДанныхПоказателя = "Е4" Тогда
					ЧислоЕЗнак = мОписаниеТиповЧислоЕ4;
				Иначе
					ЧислоЕЗнак = мОписаниеТиповЧислоЕ0;
				КонецЕсли;
				
				Если ДопустимыйЗнакПоказателя = ДопустимыйЗнак.Неотрицательный Тогда
					ЧислоЕЗнак = Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(ЧислоЕЗнак.КвалификаторыЧисла.Разрядность,ЧислоЕЗнак.КвалификаторыЧисла.РазрядностьДробнойЧасти, ДопустимыйЗнакПоказателя));
				КонецЕсли;
				ФорматируемаяОбласть.ТипЗначения = ЧислоЕЗнак;
				ФорматируемаяОбласть.Формат = мСтрокаФормата;
				ФорматируемаяОбласть.ЭлементУправления.КнопкаВыбора = Истина;
			Иначе
				// определяем кол-во строк многострочного раздела и применяем процедуру форматирования к данной графе по всем строкам
				НСтр = 1;
				Пока ТекТабличноеПоле.Области.Найти(ИмяПоказателя + "_" + Формат(НСтр, "ЧГ=0")) <> Неопределено Цикл
					ФорматируемаяОбласть = ТекТабличноеПоле.Области[ИмяПоказателя + "_" + Формат(НСтр, "ЧГ=0")];
					ДопустимыйЗнакПоказателя = ФорматируемаяОбласть.ТипЗначения.КвалификаторыЧисла.ДопустимыйЗнак;
					
					Если ТипДанныхПоказателя = "Е" Тогда
						ЧислоЕЗнак = мОписаниеТиповЧислоЕ;
					ИначеЕсли ТипДанныхПоказателя = "Е4" Тогда
						ЧислоЕЗнак = мОписаниеТиповЧислоЕ4;
					Иначе
						ЧислоЕЗнак = мОписаниеТиповЧислоЕ0;
					КонецЕсли;
					
					Если ДопустимыйЗнакПоказателя = ДопустимыйЗнак.Неотрицательный Тогда
						ЧислоЕЗнак = Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(ЧислоЕЗнак.КвалификаторыЧисла.Разрядность,ЧислоЕЗнак.КвалификаторыЧисла.РазрядностьДробнойЧасти, ДопустимыйЗнакПоказателя));
					КонецЕсли;
					ФорматируемаяОбласть.ТипЗначения = ЧислоЕЗнак;
					ФорматируемаяОбласть.Формат = мСтрокаФормата;
					ФорматируемаяОбласть.ЭлементУправления.КнопкаВыбора = Истина;
					НСтр = НСтр + 1;
				КонецЦикла;
			КонецЕсли;
		КонецЕсли;
		
		ИмяПоляТаблДокументаСтароеЗначение = ИмяПоляТаблДокумента;
	КонецЦикла;

КонецПроцедуры

Процедура Очистить() Экспорт

	Если ОчиститьОтчет() Тогда
		РегламентированнаяОтчетность.роОчиститьВариантыЗаполнения(ЭтаФорма);
		РегламентированнаяОтчетность.ОтключитьОбработчикАвтосохранения(ЭтаФорма);
		РегламентированнаяОтчетность.ВключитьОбработчикАвтосохранения(ЭтаФорма);
	КонецЕсли;

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ФУНКЦИИ АВТОЗАПОЛНЕНИЯ

Процедура ДобавитьСтрокуРасшифровки(Форма, ИмяЯчейки, ИмяПоказателя, ЗнакОперации, ИмяСлагаемого, Знач Сумма, Счет = Неопределено, КорСчет = Неопределено, Сдвиг = Неопределено, ПраваяГраница = Неопределено, ИмяРаздела = Неопределено, НомерЛиста = Неопределено, МнЧ = Неопределено, НомерСтроки = Неопределено, Субконто1 = Неопределено, Субконто2 = Неопределено, Субконто3 = Неопределено) Экспорт
	
	//РегламентированнаяОтчетность._ДобавитьСтрокуРасшифровки(Форма, ИмяЯчейки, ИмяПоказателя, ЗнакОперации, ИмяСлагаемого, Сумма, Счет, КорСчет, Сдвиг, ПраваяГраница, ИмяРаздела, НомерЛиста, МнЧ, НомерСтроки, Субконто1, Субконто2, Субконто3);
	
КонецПроцедуры

Процедура КоманднаяПанельФормыРасшифровка(Кнопка)
	
	Предупреждение("В текущей версии расшифровка не поддерживается!");
	//Обраб = Обработки.РасшифровкаРегламентированнойОтчетности.Создать();
	//Обраб.Форма = ЭтаФорма;
	//ТекущийЛист = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница.Имя;
	//ТекущееТабличноеПоле = ЭлементыФормы["ПолеТабличногоДокумента" + ТекущийЛист];
	//Обраб.ИмяЯчейки = ЭлементыФормы[ТекущееТабличноеПоле.Имя].ТекущаяОбласть.Имя;
	//Обраб.ПолучитьФорму(, ЭтаФорма).Показать();

КонецПроцедуры

Процедура ЗаполнитьАвто() Экспорт

	Если НЕ ЗначениеЗаполнено(Организация) Тогда
		Предупреждение("Необходимо указать индивидуального предпринимателя!");
		Возврат;
	КонецЕсли;

	Модифицированность = Истина;

	// Начало модуля автозаполнения.
	
	РегламентированнаяОтчетность.роОбновитьСтруктуруМногостраничныхРазделов(ЭтаФорма);
	
	ИДКонфигурации = РегламентированнаяОтчетность.ИДКонфигурации();
	РедакцияКонфигурации = РегламентированнаяОтчетность.РедакцияКонфигурации();
	Если ИДКонфигурации = "БПКОРП" ИЛИ ИДКонфигурации = "БП" И РедакцияКонфигурации = "2.0" Тогда
		ЗаполнитьДаннымиИБ();
	КонецЕсли;
	
	
	// Конец автозаполнения.
	// Операции, необходимые после процедуры автозаполнения.
	Расчет("");
	
	РегламентированнаяОтчетность.ОтключитьОбработчикАвтосохранения(ЭтаФорма);
	РегламентированнаяОтчетность.ВключитьОбработчикАвтосохранения(ЭтаФорма);

КонецПроцедуры // ЗаполнитьАвто()

Процедура ЗаполнитьДаннымиИБ()
	
	УчетнаяПолитика = ОбщегоНазначения.ПолучитьПараметрыУчетнойПолитики(КонецМесяца(мДатаКонцаПериодаОтчета), Ложь, Организация);
	Если УчетнаяПолитика.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	ПрименениеУСН = НалоговыйУчетУСН.ПрименениеУСН(Организация, КонецМесяца(мДатаКонцаПериодаОтчета));
	Если ПрименениеУСН Тогда
		Возврат;
	КонецЕсли;
	
	ВестиУчетПоВидамДеятельности = УчетнаяПолитика.ВестиУчетПоВидамДеятельности;
	
	НомерСтроки = 1;
	
	Если ВестиУчетПоВидамДеятельности Тогда
		
		ВидыДеятельности = Справочники.ВидыДеятельностиПредпринимателей.Выбрать();
		Пока ВидыДеятельности.Следующий() Цикл
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ВидДеятельности", ВидыДеятельности.Ссылка);
			Запрос.УстановитьПараметр("Организация", Организация);
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ВидыДеятельностиОрганизаций.НоменклатурнаяГруппа,
			|	ВидыДеятельностиОрганизаций.ХарактерДеятельности,
			|	ВидыДеятельностиОрганизаций.ВидДеятельности
			|ИЗ
			|	РегистрСведений.ВидыДеятельностиПредпринимателей КАК ВидыДеятельностиОрганизаций
			|ГДЕ
			|	ВидыДеятельностиОрганизаций.ВидДеятельности = &ВидДеятельности";
			
			РезультатЗапроса = Запрос.Выполнить().Выгрузить();
			СписокХарактеровДеятельности = РезультатЗапроса.ВыгрузитьКолонку("ХарактерДеятельности");
			СписокНоменклатурныхГрупп = РезультатЗапроса.ВыгрузитьКолонку("НоменклатурнаяГруппа");
			
			ПолучитьДанныеОДеятельностиИП(СписокХарактеровДеятельности, СписокНоменклатурныхГрупп, ВидыДеятельности.КодОКВЭД, НомерСтроки);
		КонецЦикла;
	Иначе
		
		СписокХарактеровДеятельности = Новый Массив;
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ОптоваяТорговля);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ПроизводствоРаботыУслуги);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.УслугиЕНВД);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.РозничнаяТорговляНеЕНВД);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.РозничнаяТорговляЕНВД);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ВсеВидыТорговли);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ВсеВидыТорговлиНеЕНВД);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ВсеВидыПроизводстваРаботУслуг);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ВсяДеятельностьНеЕНВД);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ВсяДеятельностьЕНВД);
		СписокХарактеровДеятельности.Добавить(Перечисления.ХарактерДеятельности.ПустаяСсылка());
		
		СписокНоменклатурныхГрупп = Новый Массив;
		СписокНоменклатурныхГрупп.Добавить(Справочники.НоменклатурныеГруппы.ПустаяСсылка());
		
		Выборка = Справочники.НоменклатурныеГруппы.Выбрать();
		Пока Выборка.Следующий() Цикл
			СписокНоменклатурныхГрупп.Добавить(Выборка.Ссылка);
		КонецЦикла;
		
		ПолучитьДанныеОДеятельностиИП(СписокХарактеровДеятельности, СписокНоменклатурныхГрупп, ,НомерСтроки);
	КонецЕсли;
	
КонецПроцедуры

Процедура ПолучитьДанныеОДеятельностиИП(СписокХарактеровДеятельности, СписокНоменклатурныхГрупп,КодОКВЭД = "",НомерСтроки);
	
	ОблагаетсяНДС = Истина;

	Доходы = 0;
	ПрочиеДоходы = 0;
	МатериальныеРасходы = 0;
	Амортизация = 0;
	РасходыНаОплатуТруда = 0;
	ПрочиеРасходы = 0;
	СуммаИМР = 0;
	ИтогоДоходов = 0;
	ИтогоРасходов = 0;

	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("СписокХарактеровДеятельности", СписокХарактеровДеятельности);
	Запрос.УстановитьПараметр("СписокНоменклатурныхГрупп", СписокНоменклатурныхГрупп);
	Запрос.УстановитьПараметр("ДатаНачГода", НачалоГода(мДатаНачалаПериодаОтчета));
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(мДатаКонцаПериодаОтчета));
	Запрос.УстановитьПараметр("ВидНеПринимаемыхРасходов", Перечисления.ВидыРасходовНУ.НеУчитываемыеВЦеляхНалогообложения);

	// ИМР
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИМРОбороты.СуммаРасход + ИМРОбороты.НДСРасход, 0) КАК СуммаРасходСНДС,
	|	ЕСТЬNULL(ИМРОбороты.СуммаРасход, 0) КАК СуммаРасход,
	|	ЕСТЬNULL(ИМРОбороты.НДСРасход, 0) КАК НДСРасход
	|ИЗ
	|	РегистрНакопления.ИПИныеМатериальныеРасходы.Обороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			,
	|			Организация = &Организация
	|				И ДокументОплаты <> НЕОПРЕДЕЛЕНО
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)) КАК ИМРОбороты
	|ИТОГИ
	|	СУММА(СуммаРасходСНДС),
	|	СУММА(СуммаРасход),
	|	СУММА(НДСРасход)
	|ПО
	|	ОБЩИЕ";

	Общ = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");

	Если Общ.Следующий() Тогда
		СуммаИМР = ?(ОблагаетсяНДС, Общ.СуммаРасход, Общ.СуммаРасходСНДС);
	КонецЕсли;

	ДатаНачалаГода = НачалоГода(мДатаНачалаПериодаОтчета);
	ДляПризнанияРасходовНеТребуетсяПолучениеДохода = 
		ДоходыИРасходыПредпринимателя.ДляПризнанияРасходовНеТребуетсяПолучениеДохода(Организация, ДатаНачалаГода);

	// Доходы и материальные расходы
	Если ДляПризнанияРасходовНеТребуетсяПолучениеДохода Тогда
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЕСТЬNULL(ИПМПЗОбороты.СуммаПриход + ИПМПЗОбороты.НДСПриход, 0) КАК СуммаСНДС,
		|	ЕСТЬNULL(ИПМПЗОбороты.СуммаПриход, 0) КАК Сумма,
		|	ЕСТЬNULL(ИПМПЗОбороты.НДСПриход, 0) КАК НДС
		|ИЗ
		|	РегистрНакопления.ИПМПЗ.Обороты(
		|			&ДатаНачГода,
		|			&ДатаКон,
		|			Регистратор,
		|			Организация = &Организация
		|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
		|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)
		|				И ВидМПЗ = ЗНАЧЕНИЕ(Перечисление.ВидыМПЗ.Продукция)
		|				И ДокументОплаты <> НЕОПРЕДЕЛЕНО) КАК ИПМПЗОбороты
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЕСТЬNULL(ИПМПЗОбороты.СуммаПриход + ИПМПЗОбороты.НДСПриход, 0),
		|	ЕСТЬNULL(ИПМПЗОбороты.СуммаПриход, 0),
		|	ЕСТЬNULL(ИПМПЗОбороты.НДСПриход, 0)
		|ИЗ
		|	РегистрНакопления.ИПМПЗ.Обороты(
		|			&ДатаНачГода,
		|			&ДатаКон,
		|			Регистратор,
		|			Организация = &Организация
		|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
		|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)
		|				И ВидМПЗ <> ЗНАЧЕНИЕ(Перечисление.ВидыМПЗ.Продукция)
		|				И ВидМПЗ <> ЗНАЧЕНИЕ(Перечисление.ВидыМПЗ.ВспомогательныеМатериалы)
		|				И ВидМПЗ <> ЗНАЧЕНИЕ(Перечисление.ВидыМПЗ.Материалы)
		|				И ДокументОплаты <> НЕОПРЕДЕЛЕНО) КАК ИПМПЗОбороты
		|ИТОГИ
		|	СУММА(СуммаСНДС),
		|	СУММА(Сумма),
		|	СУММА(НДС)
		|ПО
		|	ОБЩИЕ";
	Иначе
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЕСТЬNULL(ОтгружОбороты.СуммаОборот + ОтгружОбороты.НДСОборот, 0) КАК СуммаСНДС,
		|	ЕСТЬNULL(ОтгружОбороты.СуммаОборот, 0) КАК Сумма,
		|	ЕСТЬNULL(ОтгружОбороты.НДСОборот, 0) КАК НДС
		|ИЗ
		|	РегистрНакопления.ИПДоходы.Обороты(
		|			&ДатаНачГода,
		|			&ДатаКон,
		|			,
		|			Организация = &Организация
		|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
		|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)) КАК ОтгружОбороты
		|ИТОГИ
		|	СУММА(СуммаСНДС),
		|	СУММА(Сумма),
		|	СУММА(НДС)
		|ПО
		|	ОБЩИЕ";
	КонецЕсли;

	Общ = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");

	Если Общ.Следующий() Тогда
		МатериальныеРасходы = ?(ОблагаетсяНДС, Общ.Сумма, Общ.СуммаСНДС);
	КонецЕсли;

	МатериальныеРасходы = МатериальныеРасходы + СуммаИМР;

	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИПДоходыОбороты.ВыручкаОборот - ИПДоходыОбороты.НДСНачисленныйОборот, 0) КАК Доход
	|ИЗ
	|	РегистрНакопления.ИПДоходы.Обороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			,
	|			Организация = &Организация
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)
	|				И ДокументОплаты <> НЕОПРЕДЕЛЕНО) КАК ИПДоходыОбороты
	|ИТОГИ
	|	СУММА(Доход)
	|ПО
	|	ОБЩИЕ";

	Общ = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");

	Если Общ.Следующий() Тогда
		Доходы = Доходы + Общ.Доход;
	КонецЕсли;


	// Амортизация ОС
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИППрочиеРасходыТекПериод.СуммаОборот, 0) КАК Сумма
	|ИЗ
	|	РегистрНакопления.ИППрочиеРасходы.Обороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			Год,
	|			Организация = &Организация
	|				И СтатьяЗатрат ССЫЛКА Справочник.ОсновныеСредства
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)) КАК ИППрочиеРасходыТекПериод
	|ИТОГИ
	|	СУММА(Сумма)
	|ПО
	|	ОБЩИЕ";

	АмортизацияОС = Запрос.Выполнить();
	ОБЩ = АмортизацияОС.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");
	Если ОБЩ.Следующий() Тогда
		Амортизация = Амортизация + ОБЩ.Сумма;
	КонецЕсли;

	// Амортизация НМА
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИППрочиеРасходыТекПериод.СуммаОборот, 0) КАК Сумма
	|ИЗ
	|	РегистрНакопления.ИППрочиеРасходы.Обороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			Год,
	|			Организация = &Организация
	|				И СтатьяЗатрат ССЫЛКА Справочник.НематериальныеАктивы
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)) КАК ИППрочиеРасходыТекПериод
	|ИТОГИ
	|	СУММА(Сумма)
	|ПО
	|	ОБЩИЕ";

	АмортизацияОС = Запрос.Выполнить();
	ОБЩ = АмортизацияОС.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");
	Если ОБЩ.Следующий() Тогда
		Амортизация = Амортизация + ОБЩ.Сумма;
	КонецЕсли;

	// Зарплата
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИПРасходыНаОплатуТрудаОбороты.СуммаОборот, 0) КАК Сумма,
	|	ИПРасходыНаОплатуТрудаОбороты.ВидНачисленияУдержания КАК ВидНачисленияУдержания
	|ИЗ
	|	РегистрНакопления.ИПРасходыНаОплатуТруда.Обороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			Регистратор,
	|			Организация = &Организация
	|				И ДокументОплаты <> НЕОПРЕДЕЛЕНО
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)
	|				И (СтатьяЗатрат ССЫЛКА Справочник.СтатьиЗатрат
	|					ИЛИ СтатьяЗатрат ССЫЛКА Справочник.ПрочиеДоходыИРасходы)
	|				И (СтатьяЗатрат.ПринятиеКналоговомуУчету
	|					ИЛИ СтатьяЗатрат.ВидРасходовНУ <> &ВидНеПринимаемыхРасходов)) КАК ИПРасходыНаОплатуТрудаОбороты
	|ИТОГИ
	|	СУММА(Сумма)
	|ПО
	|	ВидНачисленияУдержания";

	ВыбВидНачисления = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ВидНачисленияУдержания");

	РасходыНаОплатуТруда = 0;
	НомерГрафыРОТ = 5;

	Пока ВыбВидНачисления.Следующий() Цикл
		Если ВыбВидНачисления.ВидНачисленияУдержания = Перечисления.ИПВидыНачисленийУдержаний.НачисленоДругое
			ИЛИ ВыбВидНачисления.ВидНачисленияУдержания = Перечисления.ИПВидыНачисленийУдержаний.НачисленоНатуральныйДоход 
			ИЛИ ВыбВидНачисления.ВидНачисленияУдержания = Перечисления.ИПВидыНачисленийУдержаний.НачисленоПовременно
			ИЛИ ВыбВидНачисления.ВидНачисленияУдержания = Перечисления.ИПВидыНачисленийУдержаний.НачисленоСдельно Тогда
			
			РасходыНаОплатуТруда = РасходыНаОплатуТруда + ?(ВыбВидНачисления.Сумма = Null, 0, ВыбВидНачисления.Сумма);
			НомерГрафыРОТ = НомерГрафыРОТ + 1;
		КонецЕсли;
	КонецЦикла;

	// Прочие расходы
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИППрочиеРасходыОбороты.СуммаОборот, 0) КАК Сумма,
	|	ЕСТЬNULL(ИППрочиеРасходыОбороты.НДСОборот, 0) КАК НДС
	|ИЗ
	|	РегистрНакопления.ИППрочиеРасходы.Обороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			,
	|			Организация = &Организация
	|				И ДокументОплаты <> НЕОПРЕДЕЛЕНО
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)
	|				И (СтатьяЗатрат ССЫЛКА Справочник.СтатьиЗатрат
	|					ИЛИ СтатьяЗатрат ССЫЛКА Справочник.ПрочиеДоходыИРасходы)
	|				И (СтатьяЗатрат.ПринятиеКналоговомуУчету
	|					ИЛИ СтатьяЗатрат.ВидРасходовНУ <> &ВидНеПринимаемыхРасходов)) КАК ИППрочиеРасходыОбороты
	|ИТОГИ
	|	СУММА(Сумма),
	|	СУММА(НДС)
	|ПО
	|	ОБЩИЕ";

	Общ = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");
	Если Общ.Следующий() Тогда
		ПрочиеРасходы = ?(НЕ ОблагаетсяНДС, Общ.Сумма + Общ.НДС, Общ.Сумма);
	КонецЕсли;

	// РБП	

	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИПРБПОстаткиИОбороты.СуммаКонечныйОстаток, 0) КАК Сумма,
	|	ЕСТЬNULL(ИПРБПОстаткиИОбороты.НДСКонечныйОстаток, 0) КАК НДС
	|ИЗ
	|	РегистрНакопления.ИПРБП.ОстаткиИОбороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			Период,
	|			,
	|			Организация = &Организация
	|				И ДокументОплаты <> НЕОПРЕДЕЛЕНО
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)
	|				И (ВидРасхода ССЫЛКА Справочник.РасходыБудущихПериодов
	|					ИЛИ ВидРасхода ССЫЛКА Справочник.ПрочиеДоходыИРасходы
	|						И ВидРасхода.ПринятиеКналоговомуУчету)) КАК ИПРБПОстаткиИОбороты
	|ИТОГИ
	|	СУММА(Сумма),
	|	СУММА(НДС)
	|ПО
	|	ОБЩИЕ";

	Общ = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");
	Если Общ.Следующий() Тогда
		РасходыБудущихПериодов = ?(НЕ ОблагаетсяНДС, Общ.Сумма + Общ.НДС, Общ.Сумма);
	КонецЕсли;

	//Прочие доходы
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ИППрочиеДоходыОбороты.СуммаОборот, 0) КАК Сумма
	|ИЗ
	|	РегистрНакопления.ИППрочиеДоходы.Обороты(
	|			&ДатаНачГода,
	|			&ДатаКон,
	|			Период,
	|			Организация = &Организация
	|				И ХарактерДеятельности В (&СписокХарактеровДеятельности)
	|				И НоменклатурнаяГруппа В (&СписокНоменклатурныхГрупп)
	|				И (СтатьяДоходов ССЫЛКА Справочник.ПрочиеДоходыИРасходы
	|					И СтатьяДоходов.ПринятиеКналоговомуУчету)) КАК ИППрочиеДоходыОбороты
	|ИТОГИ
	|	СУММА(Сумма)
	|ПО
	|	ОБЩИЕ";

	Общ = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОБЩИЕ");
	Если Общ.Следующий() Тогда
		ПрочиеДоходы = Общ.Сумма;
	КонецЕсли;

	ИтогоДоходов = Доходы + ПрочиеДоходы;
	ИтогоРасходов = МатериальныеРасходы + Амортизация + РасходыНаОплатуТруда + ПрочиеРасходы;

	СтруктураДанныхЛистаВ = Новый Структура;
	СтруктураДанныхЛистаВ.Вставить("КодОКВЭД",КодОКВЭД);
	СтруктураДанныхЛистаВ.Вставить("Доходы",Доходы);
	СтруктураДанныхЛистаВ.Вставить("ПрочиеДоходы",ПрочиеДоходы);
	СтруктураДанныхЛистаВ.Вставить("МатериальныеРасходы",МатериальныеРасходы);
	СтруктураДанныхЛистаВ.Вставить("Амортизация",Амортизация);
	СтруктураДанныхЛистаВ.Вставить("РасходыНаОплатуТруда",РасходыНаОплатуТруда);
	СтруктураДанныхЛистаВ.Вставить("ПрочиеРасходы",ПрочиеРасходы);
	СтруктураДанныхЛистаВ.Вставить("ИтогоДоходов",ИтогоДоходов);
	СтруктураДанныхЛистаВ.Вставить("ИтогоРасходов",ИтогоРасходов);

	Если ИтогоДоходов <> 0 ИЛИ ИтогоРасходов <> 0 Тогда
		ЗаплнитьЛистВ(СтруктураДанныхЛистаВ,НомерСтроки);
		НомерСтроки = НомерСтроки + 1;			
	КонецЕсли;

КонецПроцедуры

Процедура ЗаплнитьЛистВ(СтруктураДанныхЛистаВ, НомерСтроки)
	
	Перем ТаблицаБлока;
	
	Если НомерСтроки <> 1 Тогда //Добавляем строку
		ВставитьДополнительнуюСтроку(мИдГруппыВ);
	КонецЕсли;
	
	мСтруктураМногострочныхРазделов.Свойство(мИдГруппыВ, ТаблицаБлока);
	//Заполнение таблицы блока
	ТекущаяСтрока = ТаблицаБлока.Получить(НомерСтроки-1);
	ТекущаяСтрока.П000090001001 = "1";
	ТекущаяСтрока.П000090001002 = СтруктураДанныхЛистаВ.КодОКВЭД;
	ТекущаяСтрока.П000090001003 = СтруктураДанныхЛистаВ.ИтогоДоходов;
	ТекущаяСтрока.П000090001004 = СтруктураДанныхЛистаВ.ИтогоРасходов;
	ТекущаяСтрока.П000090001005 = СтруктураДанныхЛистаВ.МатериальныеРасходы;
	ТекущаяСтрока.П000090001006 = СтруктураДанныхЛистаВ.Амортизация;
	ТекущаяСтрока.П000090001007 = СтруктураДанныхЛистаВ.РасходыНаОплатуТруда;
	ТекущаяСтрока.П000090001009 = СтруктураДанныхЛистаВ.ПрочиеРасходы;
	//вывод в форму
	мЛистВ.Области["П000090001001_" + НомерСтроки].Значение = "1";
	мЛистВ.Области["П000090001002_" + НомерСтроки].Значение = СтруктураДанныхЛистаВ.КодОКВЭД;
	мЛистВ.Области["П000090001003_" + НомерСтроки].Значение = СтруктураДанныхЛистаВ.ИтогоДоходов;
	мЛистВ.Области["П000090001004_" + НомерСтроки].Значение = СтруктураДанныхЛистаВ.ИтогоРасходов;
	мЛистВ.Области["П000090001005_" + НомерСтроки].Значение = СтруктураДанныхЛистаВ.МатериальныеРасходы;
	мЛистВ.Области["П000090001006_" + НомерСтроки].Значение = СтруктураДанныхЛистаВ.Амортизация;
	мЛистВ.Области["П000090001007_" + НомерСтроки].Значение = СтруктураДанныхЛистаВ.РасходыНаОплатуТруда;
	мЛистВ.Области["П000090001009_" + НомерСтроки].Значение = СтруктураДанныхЛистаВ.ПрочиеРасходы;
		
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

//обработчики кнопок многостраничных страниц+++
Процедура ПоказатьСтраницуМногостраничногоРаздела(Шаг, ИмяТекущейСтраницыПанели, ПоказатьПоИндексу = Ложь) Экспорт
 
	Перем ТаблицаСтраницРаздела;
	Перем ТаблицаВариантыЗаполнения;
	Перем СтруктураДанныхДопСтрокРаздела;
	
	Форма = ЭтаФорма;

	ИмяТекТабличногоПоля = "ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели;
	ТекТабличноеПоле     = Форма.ЭлементыФормы[ИмяТекТабличногоПоля];

	Если Не Форма.мСтруктураМногостраничныхРазделов.Свойство(ИмяТекущейСтраницыПанели, ТаблицаСтраницРаздела) Тогда
		Возврат;
	КонецЕсли;

	СтрТаблицаСтраницы = ТаблицаСтраницРаздела.Найти(Истина, "АктивнаяСтраница");

	Если СтрТаблицаСтраницы = Неопределено Тогда
		РегламентированнаяОтчетность.роПоказатьСтатикСтраницРаздела(Форма, ИмяТекущейСтраницыПанели);
		Возврат;
	КонецЕсли;

	НомерТекущейСтраницы   = ТаблицаСтраницРаздела.Индекс(СтрТаблицаСтраницы);

	Если Не ПоказатьПоИндексу Тогда
		НомерСледующейСтраницы = НомерТекущейСтраницы + Шаг;
	Иначе
		НомерСледующейСтраницы = Шаг;
	КонецЕсли;

	Если ((НомерСледующейСтраницы + 1) > ТаблицаСтраницРаздела.Количество()) ИЛИ (НомерСледующейСтраницы < 0) Тогда
		Возврат;
	КонецЕсли;

	СтрТаблицаСтраницы.АктивнаяСтраница = Ложь;
	
	// Сохраним данные активной страницы, с присвоением Представления страницы и с очистной многострочных частей (Истина)
	РегламентированнаяОтчетность.роСохранитьДанныеМногостраничногоРазделаВактивнойСтранице(Форма, ИмяТекущейСтраницыПанели, Истина);

	СтрСледующаяСтраница = ТаблицаСтраницРаздела[НомерСледующейСтраницы];

	СтрСледующаяСтраница.АктивнаяСтраница = Истина;

	ТаблицаВариантыЗаполнения = РегламентированнаяОтчетность.роПолучитьТаблицуВариантовЗаполнения(Форма, ИмяТекущейСтраницыПанели);

	КолМногострочныхЧастей = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(Форма, ИмяТекущейСтраницыПанели, "МногострочностьВРазделе");

	Если ТипЗнч(КолМногострочныхЧастей) = Тип("ТаблицаЗначений") Тогда
		КолМногострочныхЧастей = КолМногострочныхЧастей.Количество();
	КонецЕсли;

	Если КолМногострочныхЧастей > 0 Тогда

		НовДанныеДопСтрокРаздела = СтрСледующаяСтраница.ДанныеДопСтрок;

		// Способ хранения многострочных частей
		СохранятьМногострКакТЗ = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(Форма, ИмяТекущейСтраницыПанели, "СохранятьМногострКакТЗ");

	Иначе

		НовТаблицаДопСтрокРаздела = Неопределено; // Многострочности нет
		ИмяГруппыДопСтрок = Неопределено; // Имя группы строк неопределено

	КонецЕсли;

	Если НовДанныеДопСтрокРаздела <> Неопределено Тогда

		// В случае, если многострочных частей больше 1, то хранится структура, иначе, таблица значений с данными
		Если (КолМногострочныхЧастей > 0) И (НЕ СохранятьМногострКакТЗ) Тогда
			Для Каждого ГруппаСтрок Из НовДанныеДопСтрокРаздела Цикл
				ИмяГруппыДопСтрок = ГруппаСтрок.Ключ;
				ДанныеГруппыСтрок = ГруппаСтрок.Значение;

				ПромТаблицаГруппыСтрок = ДанныеГруппыСтрок.Скопировать();

				// Заменяем таблицу значений с данными текущей страницы.
				Форма.мСтруктураМногострочныхРазделов.Вставить(ИмяГруппыДопСтрок, ПромТаблицаГруппыСтрок);
				// Выводим в табличный документ данные группы дополнительных строк
				Форма.ВывестиРазделВТабличныйДокумент(ИмяГруппыДопСтрок, ПромТаблицаГруппыСтрок);
				// обновляем структуру многострочного раздела
				Форма.ОбновитьСтруктуруМногострочногоРаздела(ИмяГруппыДопСтрок);
			КонецЦикла;

		ИначеЕсли (КолМногострочныхЧастей > 0) И (СохранятьМногострКакТЗ) Тогда

			ИмяГруппыДопСтрок = Форма.ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ИмяТекущейСтраницыПанели);

			ПромТаблицаДопСтрокРаздела = НовДанныеДопСтрокРаздела.Скопировать();
			// Заменяем таблицу значений с данными текущей страницы.
			Форма.мСтруктураМногострочныхРазделов.Вставить(ИмяГруппыДопСтрок, ПромТаблицаДопСтрокРаздела);
			// Выводим в табличный документ данные группы дополнительных строк
			Форма.ВывестиРазделВТабличныйДокумент(ИмяГруппыДопСтрок, ПромТаблицаДопСтрокРаздела);
			// обновляем структуру многострочного раздела
			Форма.ОбновитьСтруктуруМногострочногоРаздела(ИмяГруппыДопСтрок);

		КонецЕсли;

	КонецЕсли;

	// отображаем данные следующей страницы
	СтруктураДанныхСледующаяСтраница = СтрСледующаяСтраница.Данные;
	ПредставлениеДанных = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(Форма, ИмяТекТабличногоПоля, "ПредставлениеДанных");

	Для Каждого Элемент Из СтруктураДанныхСледующаяСтраница Цикл
		ИмяПоказателя      = Элемент.Ключ;
		ЗначениеПоказателя = Элемент.Значение;

		Если ПредставлениеДанных Тогда

			Если Форма.ОбновитьПеременныеМодуля(ИмяПоказателя, ЗначениеПоказателя) Тогда
				Продолжить; // Пропустим цикл
			КонецЕсли;

		КонецЕсли;

			//Если Форма.мСтараяВерсияФормы <> Форма.мВерсияФормы Тогда
			// Старая версия формы, нужно по позможности собрать данные

				Попытка
					ТекТабличноеПоле.Области[ИмяПоказателя].Значение = ЗначениеПоказателя;
				Исключение
				КонецПопытки;

			//Иначе
			//	ТекТабличноеПоле.Области[ИмяПоказателя].Значение = ЗначениеПоказателя;
			//КонецЕсли;

			Если Не ТаблицаВариантыЗаполнения = Неопределено Тогда
				// обновляем примечания к ячейкам табличного документа
				НайденнаяСтрока = ТаблицаВариантыЗаполнения.Найти(ИмяПоказателя, "КодПоказателя");
				Если НайденнаяСтрока <> Неопределено Тогда
					ТекущийКомментарий = ТекТабличноеПоле.Области[ИмяПоказателя].Примечание.Текст;
					НовыйКомментарий   = НайденнаяСтрока.Комментарий;

					// примечание к ячейке устанавливаем тогда, когда изменился текст комментария
					Если Не (ПустаяСтрока(ТекущийКомментарий) И ПустаяСтрока(НовыйКомментарий)) Тогда
						ТекТабличноеПоле.Области[ИмяПоказателя].Примечание.Текст = НовыйКомментарий;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;

	КонецЦикла;

	Если ПредставлениеДанных Тогда
		Форма.ЗаполнениеЗначенийВКвадратиках(ИмяТекущейСтраницыПанели);
	КонецЕсли;

	//ТекущийЭлемент = ТекТабличноеПоле;

	РегламентированнаяОтчетность.роПоказатьСтатикСтраницРаздела(Форма, ИмяТекущейСтраницыПанели);

КонецПроцедуры // роПоказатьСтраницуМногостраничногоРаздела()

Процедура КнопкаПредыдущаяСтраницаРаздел6Нажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "Раздел6");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистАНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистА");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистБНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистБ");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистГ1ПродолжениеНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистГ1Продолжение");
 ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение();
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистДНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистД");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистЕНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистЕ");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистЖ2Нажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистЖ2");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистЗНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистЗ");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистЗПродолжениеНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистЗПродолжение");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистИНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистИ");
 
КонецПроцедуры

Процедура КнопкаПредыдущаяСтраницаЛистИПродолжениеНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(- 1, "ЛистИПродолжение");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаРаздел6Нажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "Раздел6");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистАНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистА");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистБНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистБ");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистГ1ПродолжениеНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистГ1Продолжение");
 ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение();
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистДНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистД");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистЕНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистЕ");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистЖ2Нажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистЖ2");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистЗНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистЗ");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистЗПродолжениеНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистЗПродолжение");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистИНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистИ");
 
КонецПроцедуры

Процедура КнопкаСледующаяСтраницаЛистИПродолжениеНажатие(Элемент)
 
 ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистИПродолжение");
 
КонецПроцедуры

Процедура ВставитьДополнительнуюСтраницу(ИмяТекущейСтраницыПанели = Неопределено)

	Перем ТаблицаСтраницРаздела;
	Перем СтруктураДанныхДопСтрокРаздела;

	Если ИмяТекущейСтраницыПанели = Неопределено Тогда
		ТекущаяСтраницаПанели    = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница;
		ИмяТекущейСтраницыПанели = ТекущаяСтраницаПанели.Имя;
	КонецЕсли;

	Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяТекущейСтраницыПанели, ТаблицаСтраницРаздела) Тогда
		Возврат;
	Иначе
		МаксКолвоЭкз = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели, "МаксКолвоЭкз", 0);
		Если МаксКолвоЭкз <> 0 И мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели].Количество() >= МаксКолвоЭкз Тогда
			ЗаголовокСтраницы = ЭлементыФормы.ОсновнаяПанель.Страницы[ИмяТекущейСтраницыПанели].Заголовок;
			Сообщить("В разделе """ + ЗаголовокСтраницы + """ максимальное количество экземпляров страниц равно " + МаксКолвоЭкз + ".", СтатусСообщения.Важное);
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	ИмяТекТабличногоПоля     = "ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели;
	ТекТабличноеПоле         = ЭлементыФормы[ИмяТекТабличногоПоля];
	
	// Найдем активную страницу
	СтрТаблицаСтраницы = ТаблицаСтраницРаздела.Найти(Истина, "АктивнаяСтраница");
	СтрТаблицаСтраницы.АктивнаяСтраница = Ложь;
	
	// Сначала сохраним данные текущей страницы.
	// Если на листе есть многострочность, то удалим ее.
	РегламентированнаяОтчетность.роСохранитьДанныеМногостраничногоРазделаВактивнойСтранице(ЭтаФорма, ИмяТекущейСтраницыПанели, Истина);
	
	СтрТаблицаСтраницы.АктивнаяСтраница = Истина;
	
	Если СтрТаблицаСтраницы <> Неопределено Тогда

		// Убираем активность у текущей страницы
		СтрТаблицаСтраницы.АктивнаяСтраница = Ложь;

		// Добавляем новую страницу
		СтрНоваяСтраница = ТаблицаСтраницРаздела.Добавить();

		// Присваиваем представление по умолчанию
		СтрНоваяСтраница.Представление      = "Новая страница";
		СтрНоваяСтраница.АвтоматическоеПредставление      = Истина;

		// Ставим признак активной страницы
		СтрНоваяСтраница.АктивнаяСтраница   = Истина;

		ОчиститьТабличноеПоле(ТекТабличноеПоле);
		//итоговые ячейки не очистились - необходимо провести расчет
		//для этого сохраним данные страницы
		РегламентированнаяОтчетность.роСохранитьДанныеМногостраничногоРазделаВактивнойСтранице(ЭтаФорма, ИмяТекущейСтраницыПанели, Истина);
		Расчет(ИмяТекущейСтраницыПанели);
		
		//ТекущийЭлемент     = ТекТабличноеПоле;
		Модифицированность = Истина;

	КонецЕсли;

	РегламентированнаяОтчетность.роПоказатьСтатикСтраницРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели);
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуРаздел6Нажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("Раздел6");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуРаздел6Нажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("Раздел6");
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистАНажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистА");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистАНажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("ЛистА");
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистБНажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистБ");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистБНажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("ЛистБ");
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистГ1ПродолжениеНажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистГ1Продолжение");
	ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение();
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистГ1ПродолжениеНажатие(Элемент)
 
 	УдалитьДополнительнуюСтраницу("ЛистГ1Продолжение");
	ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение();
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистДНажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистД");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистДНажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("ЛистД");
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистЕНажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистЕ");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистЕНажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("ЛистЕ");
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистЖ2Нажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистЖ2");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистЖ2Нажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("ЛистЖ2");
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистЗНажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистЗ");
	ВставитьДополнительнуюСтраницу("ЛистЗПродолжение");
	УстановитьСвязанноеЗначение("", "ЛистЗ",1);
	УстановитьСвязанныеСтраницы("ЛистЗ");
	ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистЗПродолжение");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистЗНажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("ЛистЗ");
 
КонецПроцедуры

Процедура КнопкаДобавитьДопСтраницуЛистИНажатие(Элемент)
	
	ВставитьДополнительнуюСтраницу("ЛистИ");
	ВставитьДополнительнуюСтраницу("ЛистИПродолжение");
	УстановитьСвязанноеЗначение("", "ЛистИ",1);
	УстановитьСвязанныеСтраницы("ЛистИ");
	ПоказатьСтраницуМногостраничногоРаздела(1, "ЛистИПродолжение");
	
КонецПроцедуры

Процедура КнопкаУдалитьДопСтраницуЛистИНажатие(Элемент)
 
 УдалитьДополнительнуюСтраницу("ЛистИ");
 
КонецПроцедуры

Процедура УдалитьДополнительнуюСтраницу(ИмяТекущейСтраницыПанели = Неопределено)

	РегламентированнаяОтчетность.роУдалитьДополнительнуюСтраницу(ЭтаФорма, ИмяТекущейСтраницыПанели);
	УдалитьСвязанныеСтраницы(ИмяТекущейСтраницыПанели);
	
	Расчет();
	
КонецПроцедуры

Процедура УдалитьСвязанныеСтраницы(ИмяТекущейСтраницыПанели = Неопределено)
	
	Если ИмяТекущейСтраницыПанели = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели <> "ЛистЗ"
		И ИмяТекущейСтраницыПанели <> "ЛистИ" Тогда
		Возврат;
	КонецЕсли;
	
	НомерАктивнойСтраницы = Число(Прав(мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели].Найти(Истина, "АктивнаяСтраница").Представление,1))-1;
	
	Если НомерАктивнойСтраницы = 0 Тогда
		НомерУдаляемойСтраницы = 1;
	Иначе
		НомерУдаляемойСтраницы = 0;
	КонецЕсли;
	
	Если НомерУдаляемойСтраницы = 1 = мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели + "Продолжение"].Количество() Тогда
		Возврат;
	КонецЕсли;

	АктивнаяСтрокаСвязаннойТаблицы = мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели + "Продолжение"][НомерУдаляемойСтраницы];
	АктивнаяСтрокаСвязаннойТаблицы.АктивнаяСтраница = Истина;
	
	ПассивнаяСтрокаСвязаннойТаблицы = мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели + "Продолжение"][НомерАктивнойСтраницы];
	ПассивнаяСтрокаСвязаннойТаблицы.АктивнаяСтраница = Ложь;
	
	РегламентированнаяОтчетность.роУдалитьДополнительнуюСтраницу(ЭтаФорма, ИмяТекущейСтраницыПанели + "Продолжение");
	
КонецПроцедуры

Процедура УстановитьСвязанныеСтраницы(ИмяТекущейСтраницыПанели = Неопределено)
	
	Если ИмяТекущейСтраницыПанели = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели <> "ЛистЗ"
		И ИмяТекущейСтраницыПанели <> "ЛистИ" Тогда
		Возврат;
	КонецЕсли;
	
	ТекущийЛист = мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели][0].Представление;
	СтрокаСвязаннойТаблицы = мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели + "Продолжение"].Найти(ТекущийЛист, "Представление");
	Если СтрокаСвязаннойТаблицы = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	СтрокаСвязаннойТаблицы.АктивнаяСтраница = Истина;
	Расчет(ИмяТекущейСтраницыПанели + "Продолжение");
	
КонецПроцедуры

Процедура УстановитьСвязанноеЗначение(Значение, ИмяТекущейСтраницыПанели, НомерШага = 0)
	
	Если НомерШага = 0 Тогда
		НомерШага = Число(Прав(мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели].Найти(Истина, "АктивнаяСтраница").Представление,1))-1;
	КонецЕсли;
	
	ТекущийЛист = мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели][НомерШага].Представление;
	СтрокаСвязаннойТаблицы = мСтруктураМногостраничныхРазделов[ИмяТекущейСтраницыПанели + "Продолжение"].Найти(ТекущийЛист, "Представление");
	ДанныеРаздела = СтрокаСвязаннойТаблицы.Данные;
	Если ИмяТекущейСтраницыПанели = "ЛистЗ" Тогда
		ИмяПоказателя = "П000017000101"
	Иначе
		ИмяПоказателя = "П000019000101"
	КонецЕсли;
	
	ДанныеРаздела[ИмяПоказателя] = ?(НЕ ЗначениеЗаполнено(Значение),0,Число(Значение));
	
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуРаздел6Нажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "Раздел6");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистАНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистА");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистБНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистБ");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистГ1ПродолжениеНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистГ1Продолжение");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистДНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистД");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистЕНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистЕ");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистЖ2Нажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистЖ2");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистЗНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистЗ");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистЗПродолжениеНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистЗПродолжение");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистИНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистИ");
 
КонецПроцедуры

Процедура КнопкаПерейтиНаСтраницуЛистИПродолжениеНажатие(Элемент)
 
 РегламентированнаяОтчетность.роОткрытьФормуСпискаДопСтраниц(ЭтаФорма, "ЛистИПродолжение");
 
КонецПроцедуры

//обработчики кнопок многостраничных страниц---

//обработка выбора на всех страницах+++
Функция НайтиСвойстваПоказателя(КодПоказателя)
	СвойстваПоказателя = СвойстваПоказателей.Найти(КодПоказателя, "Показатель");
	Если СвойстваПоказателя = Неопределено Тогда
		Для Каждого Стр из СвойстваПоказателей Цикл
			Если Лев(КодПоказателя, СтрДлина(Стр.Показатель)) = Стр.Показатель Тогда
				СвойстваПоказателя = Стр;
				Прервать;
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	Возврат СвойстваПоказателя;
КонецФункции // ()

Процедура ОбработкаВыбораВПолеТабличногоДокумента(Элемент, Область, СтандартнаяОбработка)
	
	Если РегламентированнаяОтчетность.ВыбраннаяОбластьРегламентированногоОтчетаНеВерна(ЭтаФорма, Область, СтандартнаяОбработка) Тогда
		Возврат;
	КонецЕсли;
	
	ИмяЯчейки = Область.Имя;
	
	//специальная обработка некоторых областей
	Если Лев(Область.Имя, 7) = "КодИМНС" Тогда
		ОбработкаВыбораИФНС();
		СтандартнаяОбработка = Ложь;
		Возврат;
	КонецЕсли;
	
	//форма заполнения листа 03 раздел В
	Если   (ИмяЯчейки = "Индекс")
	   ИЛИ (ИмяЯчейки = "Регион") 
	   ИЛИ (ИмяЯчейки = "Район") 
	   ИЛИ (ИмяЯчейки = "Город") 
	   ИЛИ (ИмяЯчейки = "НаселенныйПункт") 
	   ИЛИ (ИмяЯчейки = "Улица")
	   ИЛИ (ИмяЯчейки = "Дом") 
	   ИЛИ (ИмяЯчейки = "Корпус") 
	   ИЛИ (ИмяЯчейки = "Квартира") Тогда 

		СтандартнаяОбработка = Ложь;
		ФормаВводаАдреса = РегламентированнаяОтчетность.роПолучитьОбщуюФорму("ВводРоссийскогоАдреса");
		СтруктураАдресныхДанных = Новый Структура;

		ПочтИндекс	= мТитульный002.Области.Индекс.Значение;
		СубъектРФНом = мТитульный002.Области.Регион.Значение;
		РайонОб     = мТитульный002.Области.Район.Значение;
		ГородОб     = мТитульный002.Области.Город.Значение;
		НПОб        = мТитульный002.Области.НаселенныйПункт.Значение;
		УлицаОб     = мТитульный002.Области.Улица.Значение;
		ДомаОб      = мТитульный002.Области.Дом.Значение;
		КорпусОб    = мТитульный002.Области.Корпус.Значение;
		КвартираОб  = мТитульный002.Области.Квартира.Значение;

		СтруктураАдресныхДанных.Вставить("Индекс", ПочтИндекс); // индекс
		СтруктураАдресныхДанных.Вставить("Регион", СубъектРФНом); // код
		СтруктураАдресныхДанных.Вставить("Район", РайонОб);
		СтруктураАдресныхДанных.Вставить("Город", ГородОб);
		СтруктураАдресныхДанных.Вставить("НаселенныйПункт", НПОб);
		СтруктураАдресныхДанных.Вставить("Улица", УлицаОб);
		СтруктураАдресныхДанных.Вставить("Дом", ДомаОб);
		СтруктураАдресныхДанных.Вставить("Корпус", КорпусОб);
		СтруктураАдресныхДанных.Вставить("Квартира", КвартираОб);

		ФормаВводаАдреса.НачальноеЗначениеВыбора = СтруктураАдресныхДанных;

		Если ФормаВводаАдреса.ОткрытьМодально() Тогда

			Индекс = "";
			Регион = "";
			НазваниеРегиона = "";
			Район = "";
			Город = "";
			НаселенныйПункт = "";
			Улица = "";
			Дом = "";
			Корпус = "";
			Квартира = "";

			ПочтИндекс = ФормаВводаАдреса.НачальноеЗначениеВыбора.Индекс;
			СубъектРФНом = ФормаВводаАдреса.НачальноеЗначениеВыбора.Регион;

			РайонОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Район;
			ГородОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Город;
			НПОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.НаселенныйПункт;
			УлицаОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Улица;
			ДомаОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Дом;
			КорпусОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Корпус;
			КвартираОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Квартира;

			Модифицированность = Истина;

		КонецЕсли;

		мТитульный002.Области.Индекс.Значение=ПочтИндекс;
		мТитульный002.Области.Регион.Значение = СубъектРФНом;
		мТитульный002.Области.Район.Значение = РайонОб;
		мТитульный002.Области.Город.Значение = ГородОб;
		мТитульный002.Области.НаселенныйПункт.Значение = НПОб;
		мТитульный002.Области.Улица.Значение = УлицаОб;
		мТитульный002.Области.Дом.Значение = ДомаОб;
		мТитульный002.Области.Корпус.Значение = КорпусОб;
		мТитульный002.Области.Квартира.Значение = КвартираОб;
		
	КонецЕсли;
	
	Если (Лев(ИмяЯчейки,13) = "П000080001001") Тогда //Лист Б Код ОКСМ
		СтандартнаяОбработка = Ложь;
		Спр = Справочники.КлассификаторСтранМира.ПолучитьФормуВыбора().ОткрытьМодально();
		Если Спр <> Неопределено Тогда
			мЛистБ.Области[ИмяЯчейки].Значение = Спр.Код;
		КонецЕсли;
	КонецЕсли;
	
	Если (Лев(ИмяЯчейки,13) = "П000080001003") ИЛИ (Лев(ИмяЯчейки,13) = "П000080001004") Тогда //Лист Б информация о валюте
		СтандартнаяОбработка = Ложь;
		Спр = Справочники.Валюты.ПолучитьФормуВыбора().ОткрытьМодально();
		Если Спр <> Неопределено Тогда
			мЛистБ.Области["П000080001003" + Сред(ИмяЯчейки,14,СтрДлина(ИмяЯчейки) - 13)].Значение = Спр.НаименованиеПолное;
			мЛистБ.Области["П000080001004" + Сред(ИмяЯчейки,14,СтрДлина(ИмяЯчейки) - 13)].Значение = Спр.Код;
		КонецЕсли;
	КонецЕсли;
	
		//форма заполнения листа 03 раздел В
	Если   (ИмяЯчейки = "ИмИндекс")
	   ИЛИ (ИмяЯчейки = "ИмРегион") 
	   ИЛИ (ИмяЯчейки = "ИмРайон") 
	   ИЛИ (ИмяЯчейки = "ИмГород") 
	   ИЛИ (ИмяЯчейки = "ИмНаселенныйПункт") 
	   ИЛИ (ИмяЯчейки = "ИмУлица")
	   ИЛИ (ИмяЯчейки = "ИмДом") 
	   ИЛИ (ИмяЯчейки = "ИмКорпус") 
	   ИЛИ (ИмяЯчейки = "ИмКвартира") Тогда 

		СтандартнаяОбработка = Ложь;
		ФормаВводаАдреса = РегламентированнаяОтчетность.роПолучитьОбщуюФорму("ВводРоссийскогоАдреса");
		СтруктураАдресныхДанных = Новый Структура;

		ПочтИндекс	= мЛистЛ.Области.ИмИндекс.Значение;
		СубъектРФНом = мЛистЛ.Области.ИмРегион.Значение;
		РайонОб     = мЛистЛ.Области.ИмРайон.Значение;
		ГородОб     = мЛистЛ.Области.ИмГород.Значение;
		НПОб        = мЛистЛ.Области.ИмНаселенныйПункт.Значение;
		УлицаОб     = мЛистЛ.Области.ИмУлица.Значение;
		ДомаОб      = мЛистЛ.Области.ИмДом.Значение;
		КорпусОб    = мЛистЛ.Области.ИмКорпус.Значение;
		КвартираОб  = мЛистЛ.Области.ИмКвартира.Значение;

		СтруктураАдресныхДанных.Вставить("Индекс", ПочтИндекс); // индекс
		СтруктураАдресныхДанных.Вставить("Регион", СубъектРФНом); // код
		СтруктураАдресныхДанных.Вставить("Район", РайонОб);
		СтруктураАдресныхДанных.Вставить("Город", ГородОб);
		СтруктураАдресныхДанных.Вставить("НаселенныйПункт", НПОб);
		СтруктураАдресныхДанных.Вставить("Улица", УлицаОб);
		СтруктураАдресныхДанных.Вставить("Дом", ДомаОб);
		СтруктураАдресныхДанных.Вставить("Корпус", КорпусОб);
		СтруктураАдресныхДанных.Вставить("Квартира", КвартираОб);

		ФормаВводаАдреса.НачальноеЗначениеВыбора = СтруктураАдресныхДанных;

		Если ФормаВводаАдреса.ОткрытьМодально() Тогда

			Индекс = "";
			Регион = "";
			НазваниеРегиона = "";
			Район = "";
			Город = "";
			НаселенныйПункт = "";
			Улица = "";
			Дом = "";
			Корпус = "";
			Квартира = "";

			ПочтИндекс = ФормаВводаАдреса.НачальноеЗначениеВыбора.Индекс;
			СубъектРФНом = ФормаВводаАдреса.НачальноеЗначениеВыбора.Регион;

			РайонОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Район;
			ГородОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Город;
			НПОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.НаселенныйПункт;
			УлицаОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Улица;
			ДомаОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Дом;
			КорпусОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Корпус;
			КвартираОб = ФормаВводаАдреса.НачальноеЗначениеВыбора.Квартира;

			Модифицированность = Истина;

		КонецЕсли;

		мЛистЛ.Области.ИмИндекс.Значение=ПочтИндекс;
		мЛистЛ.Области.ИмРегион.Значение = СубъектРФНом;
		мЛистЛ.Области.ИмРайон.Значение = РайонОб;
		мЛистЛ.Области.ИмГород.Значение = ГородОб;
		мЛистЛ.Области.ИмНаселенныйПункт.Значение = НПОб;
		мЛистЛ.Области.ИмУлица.Значение = УлицаОб;
		мЛистЛ.Области.ИмДом.Значение = ДомаОб;
		мЛистЛ.Области.ИмКорпус.Значение = КорпусОб;
		мЛистЛ.Области.ИмКвартира.Значение = КвартираОб;
		
	КонецЕсли;

		
	ПараметрВводаПоля = НайтиСвойстваПоказателя(ИмяЯчейки);
	
	//создание динамического списка выбора
	Если ПараметрВводаПоля <> Неопределено И ПараметрВводаПоля.ТаблицаЗначений <> Неопределено Тогда
		//обработка таблицы значений - удаление вариантов, не проходящих по условиям
		КодПоказателя = ПараметрВводаПоля.Показатель;
		ТЗВыбора = ПараметрВводаПоля.ТаблицаЗначений.Скопировать();
		
		//Определение ТребРезультат+++
		//проверка и удаление вариантов происходит для отдельных показателей
		//внутри происходит проверка: требуется ли сокращать список и по какому значению результата проверки
		//если будет требуемый результат проверки условий, отличный от нуля, то будет проверка
		//конструкция проверки должна предусматривать наличие нескольких критериев
		//Примечание: для последующего корректного удаления ТребРезультат следует определять числом
		ТребРезультат = 0;
		Если КодПоказателя = "П000110003003" Тогда
		//код КБК раздела 6	
			//признак налогоплательщика раздела 1.1
			Критерий1 = мРаздел6.Области.П000060002003.Значение;
			
			Если Критерий1 = "1" Тогда
				ТребРезультат = 1;	
			ИначеЕсли Критерий1 = "2" Тогда
				ТребРезультат = 2;	
			КонецЕсли;
			
		КонецЕсли;
		
		//Определение ТребРезультат---
		
		Если ТребРезультат <> 0 Тогда
			//из ТЗВыбора удаляются элементы, у которых результат отличается от нуля и ТребРезультат
			РазмерТЗ = ТЗВыбора.Количество();
			Для Сч = 1 По РазмерТЗ Цикл
				ЭлементТЗ = ТЗВыбора[РазмерТЗ - Сч];
				Рез = ?(ЭлементТЗ.РезультатПроверки = "", 0, Число(ЭлементТЗ.РезультатПроверки));
				Если Рез <> 0 И Рез <> ТребРезультат Тогда
			    	ТЗВыбора.Удалить(ЭлементТЗ);
			 	КонецЕсли;
			КонецЦикла; 
		КонецЕсли;
		
		//удаление перед интерактивным выбором строки из обработанной копии ТЗ служебной колонки "РезультатПроверки"
		ТЗВыбора.Колонки.Удалить(2);
		
		КолонкаПоиска = "Код";
		
		Если КодПоказателя <> "П000012001004" 
			И КодПоказателя <> "П000012001005"
			И КодПоказателя <> "П000012001008" Тогда// Лист Д в одной таблице с доходами содержатся и нормативы
			ТЗВыбора.Колонки.Удалить(2);
		Иначе
			КолонкаПоиска = ?(КодПоказателя = "П000012001005", "Название", "Код");
		КонецЕсли;
		
		ВвестиПоказатель(Элемент, Область, КодПоказателя, Ложь, ПараметрВводаПоля.ТекстПриВыборе, ТЗВыбора, СтандартнаяОбработка, КолонкаПоиска);
		
	КонецЕсли;
КонецПроцедуры

Процедура ОбработкаВыбораИФНС()
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СправочникИФНС.Ссылка КАК Ссылка,
	               |	СправочникИФНС.Код КАК КодНО,
	               |	СправочникИФНС.Представитель КАК Представитель
	               |ИЗ
	               |	Справочник.РегистрацияВИФНС КАК СправочникИФНС
	               |ГДЕ
	               |	СправочникИФНС.Владелец = &Владелец
	               |	И СправочникИФНС.ПометкаУдаления = ЛОЖЬ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	КодНО";
	Запрос.УстановитьПараметр("Владелец", Организация);
	ТаблицаВыбора = Запрос.Выполнить().Выгрузить();
	
	ТаблицаВыбора.Колонки.КодНО.Ширина = 7;
	ТаблицаВыбора.Колонки.КодНО.Заголовок = "ИФНС";
	ТаблицаВыбора.Колонки.Представитель.Ширина = 42;
	
	ПервоначальноеЗначение = РегламентированнаяОтчетность.роВернутьЗначениеПараметраСЛиста(ЭтаФорма, "Титульный", "КодИМНС");
						   
	Ссылки = ТаблицаВыбора.ВыгрузитьКолонку("Ссылка");
	ТаблицаВыбора.Колонки.Удалить("Ссылка");
	
	Если ТаблицаВыбора.Количество() <> 0 Тогда
		ТекСтрока = ТаблицаВыбора.Найти(ПервоначальноеЗначение, "КодНО");
		Если ТекСтрока = Неопределено Тогда
			РезультатВыбора = ТаблицаВыбора.ВыбратьСтроку("Выберите налоговый орган");
		Иначе
			РезультатВыбора = ТаблицаВыбора.ВыбратьСтроку("Выберите налоговый орган", ТекСтрока);
		КонецЕсли;
		Если РезультатВыбора <> Неопределено Тогда
			ВыбранныйКодНО = РезультатВыбора.КодНО;
			ДлинаКодаНО = СтрДлина(ВыбранныйКодНО);
			Для Инд = ДлинаКодаНО + 1 По 4 Цикл
				ВыбранныйКодНО = "0" + ВыбранныйКодНО;
			КонецЦикла;
			Для Инд = 1 По 4 Цикл
				мТитульный.Области["КодИМНС" + Инд].Значение = Сред(ВыбранныйКодНО, Инд, 1);
			КонецЦикла;
			ЗаполнитьСведенияОПредставителе(Ссылки[ТаблицаВыбора.Индекс(РезультатВыбора)]);
			Модифицированность = Истина;
		КонецЕсли;
	ИначеЕсли ПустаяСтрока(ПервоначальноеЗначение) Тогда
		Сообщить("Код налогового органа необходимо задать в справочнике ""Организации"".", СтатусСообщения.Информация);
	Иначе
		Сообщить("Для выбора инспекции, необходимо завести соответствующую запись в справочнике ""Регистрация в ИФНС"".", СтатусСообщения.Информация);
	КонецЕсли;
	
КонецПроцедуры

Процедура ПолеТабличногоДокументаТитульныйВыбор(Элемент, Область, СтандартнаяОбработка)

	ОбработкаВыбораВПолеТабличногоДокумента(Элемент, Область, СтандартнаяОбработка);

КонецПроцедуры

//обработка выбора на всех страницах---

//обработка ПриИзмененииСодержимогоОбласти на всех страницах+++
Процедура ОбработкаИзмененияСодержимогоВПолеТабличногоДокумента(Элемент, Область)
	
	ИмяПоказателя = Область.Имя;
	ЗначПоказателя = Область.Значение;
	
	//обработка изменения значений критериев (влияние на зависимые показатели)---
	
	Модифицированность = Истина;
	ИмяТекущейСтраницыПанели = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница.Имя;
	Если ИмяТекущейСтраницыПанели = "ЛистА" 
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистБ" 
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистВ" 
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистГ2"
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистГ3"
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистГ1Продолжение"
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистЕ" 
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистЖ2"
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистЗ" 
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистИ" 
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистК3" 
		ИЛИ ИмяТекущейСтраницыПанели = "ЛистК4" Тогда
		Группа = РегламентированнаяОтчетность.роРазделТекущейОбласти(ЭтаФорма, Элемент.ТекущаяОбласть);
		Если Группа <> Неопределено Тогда
			НомерСтрокиМнгЧ = Сред(ИмяПоказателя, 15);
			// Обновим многострочный блок.
			РегламентированнаяОтчетность.СохранитьЗначениеВМногостраничномБлоке(ЭтаФорма, Группа, НомерСтрокиМнгЧ, Сред(ИмяПоказателя, 1, 13), Элемент.ТекущаяОбласть.Значение);
		КонецЕсли;
	КонецЕсли;
	
		Если ИмяТекущейСтраницыПанели = "ЛистД"  Тогда
		Группа = РегламентированнаяОтчетность.роРазделТекущейОбласти(ЭтаФорма, Элемент.ТекущаяОбласть);
		Если Группа <> Неопределено Тогда
			НомерСтрокиМнгЧ = Сред(ИмяПоказателя, 15);
			Для НомерПоказателя = 1 По 9 Цикл
				// Обновим многострочный блок вместе со связаннми ячейками.
				РегламентированнаяОтчетность.СохранитьЗначениеВМногостраничномБлоке(ЭтаФорма, Группа, НомерСтрокиМнгЧ, "П00001200100" + НомерПоказателя, Элемент.Области["П00001200100" + НомерПоказателя + "_" + НомерСтрокиМнгЧ].Значение);
			КонецЦикла;
			
			//изменение вариантов заполнения ячеек при изменении определенных показателей
			Если Лев(ИмяПоказателя, 13) = "П000012001007" 
				ИЛИ Лев(ИмяПоказателя, 13) = "П000012001008" Тогда
				ИзменитьТаблицуВариантовЗаполненияЛистаД(НЕ ФлажокОтклАвтоРасчет);
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "ЛистВ" Тогда
		Если Лев(ИмяПоказателя, 13) = "П000090001002" Тогда
			Если НЕ РегламентированнаяОтчетность.ОКВЭДСоответствуетТребованиям(Область.Значение) Тогда
				Сообщить("На листе В задано некорректное значение кода вида деятельности по ОКВЭД! Допустимы значения, соответствующие следующим шаблонам: ""XX"", ""XX.X"", ""XX.XX"", ""XX.XX.X"", ""XX.XX.XX"" (X - любая цифра).", СтатусСообщения.Важное);
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "ЛистЗ" ИЛИ ИмяТекущейСтраницыПанели = "ЛистИ" Тогда
		Если Лев(ИмяПоказателя, 13) = "П000016000101" 
			ИЛИ Лев(ИмяПоказателя, 13) = "П000018000101" Тогда
			УстановитьСвязанноеЗначение(ЗначПоказателя, ИмяТекущейСтраницыПанели);
		КонецЕсли;
	КонецЕсли;
	
	Если ИмяПоказателя = "СтатусНалогоплательщика" Тогда
		Если ЗначПоказателя = "1" Тогда
			мСтатусНалогоплательщика = 1;
		ИначеЕсли ЗначПоказателя = "2" Тогда
			мСтатусНалогоплательщика = 2;
		Иначе
			мСтатусНалогоплательщика = 0;
		КонецЕсли;
	КонецЕсли;
	
	Расчет();	
	//действия, связанные с показателями, обладающими списками выбора,
	//на элементы которых наложены условия (макет "Списки...") ---
КонецПроцедуры

Процедура ПолеТабличногоДокументаПриИзмененииСодержимогоОбласти(Элемент, Область, СтандартнаяОбработка)

	ОбработкаИзмененияСодержимогоВПолеТабличногоДокумента(Элемент, Область);

КонецПроцедуры

//обработка ПриИзмененииСодержимогоОбласти на всех страницах---

//обработка ПриАктивизацииОбласти на всех страницах+++
Процедура ПолеТабличногоДокументаРаздел1ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "Раздел1");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаРаздел2ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "Раздел2");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаРаздел3ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "Раздел3");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаРаздел4ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "Раздел4");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаРаздел5ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "Раздел5");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаРаздел6ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "Раздел6");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистАПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистА");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистБПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистБ");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистВПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистВ");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистГ1ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистГ1");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистГ1ПродолжениеПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистГ1Продолжение");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистГ2ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистГ2");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистГ3ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистГ3");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистДПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистД");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистЕПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистЕ");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистЖ1ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистЖ1");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистЖ2ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистЖ2");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистЗПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистЗ");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистЗПродолжениеПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистЗПродолжение");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистИПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистИ");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистИПродолжениеПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистИПродолжение");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистК1ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистК1");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистК2ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистК2");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистК3ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистК3");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистК4ПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистК4");
 
КонецПроцедуры

Процедура ПолеТабличногоДокументаЛистЛПриАктивизацииОбласти(Элемент)
 
 РегламентированнаяОтчетность.роПриАктивизацииОбластиРегламентированногоОтчета(ЭтаФорма, Элемент, "ЛистЛ");
 
КонецПроцедуры

//обработка ПриАктивизацииОбласти на всех страницах---

//обработчики нажатия на кнопки добавления/удаления дополнительных строк многострочных разделов+++
//и связанные с ними процедуры - функции по работе с многострочными блоками

// Обновляет структуру многострочнго раздела, заданного
// уникальным идентификатором. Заполняет таблицу значений
// многострочного раздела значениями соответствующих ячеек.
//
// Параметры:
//  ИмяГруппы - строка - идентификатор многострочного раздела.
//
Процедура ОбновитьСтруктуруМногострочногоРаздела(ИмяГруппы) Экспорт
	РегламентированнаяОтчетность.роОбновитьСтруктуруМногострочногоРаздела(ЭтаФорма, ИмяГруппы);
КонецПроцедуры // ОбновитьСтруктуруМногострочногоРаздела()

// Процедура выводит строки многострочного раздела в табличный документ.
// При отсутствии в табличном документе необходимого количества строк
// добавляет отсутствующие строки.
//
// Параметры:
//  ИмяГруппы       - строка, имя многострочного раздела;
//  СтруктураГруппы - таблица значений, содержащая значения показателей многострочного раздела.
//  ПерерисоватьСтроки - Истина из процедуры удаления доп. строк, для перерисовки областей.
//
Процедура ВывестиРазделВТабличныйДокумент(ИмяГруппы, СтруктураГруппы) Экспорт
	Перем ИсходноеКоличествоСтрокГруппы;
	
	// определим исходное колво строк многострочного раздела,
	// соответствующее бумажной форме отчета
	мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, ИсходноеКоличествоСтрокГруппы);
	
	// реальное кол-во строк (колво заполненных строк)
	ТекущееКоличествоСтрокГруппы = СтруктураГруппы.Количество();
	
	ТекТабличноеПоле = ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИмяГруппы);
	ТекТабличноеПолеИмя = ТекТабличноеПоле.Имя;
	
	ПерерисоватьСтроки = (НЕ ТекущееКоличествоСтрокГруппы > ИсходноеКоличествоСтрокГруппы);
	СтруктураГруппыКолонки = СтруктураГруппы.Колонки;
	
	Раздел = ЭлементыФормы[ТекТабличноеПолеИмя];
	// При восстановлении сохраненных данных отчета сравниваем исходное кол-во
	// отображаемых в форме строк многострочного раздела с реальным количеством
	// созданных строк в сохраненном отчете.
	Если ТекущееКоличествоСтрокГруппы > ИсходноеКоличествоСтрокГруппы Тогда
		
		// Режим восстановления многострочных блоков. Из процедуры ВосстановитьСохраненныеДанные.
		НастройкиМнгЧ = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ТекТабличноеПолеИмя, "МногострочностьВРазделе").Скопировать();
		НазвОбласти = НастройкиМнгЧ.Найти(ИмяГруппы, "ИдГруппы").Область;
		
		НастройкиМнгЧ.Колонки.Добавить("НизМногострочнойЧасти");
		НастройкиМнгЧ.Колонки.Добавить("ВерхМногострочнойЧасти");
		
		// Определим координаты всех многострочных блоков, для последующего восстановления.
		Для каждого Зап Из НастройкиМнгЧ Цикл
			КоординатаНиз = Раздел.Области[Зап.Область].Низ;
			КоординатаВерх = Раздел.Области[Зап.Область].Верх;
			Зап.НизМногострочнойЧасти = КоординатаНиз;
			Зап.ВерхМногострочнойЧасти = КоординатаВерх;
			// Координаты текущей области
			Если Зап.Область = НазвОбласти Тогда
				Низ = КоординатаНиз;
				Верх = КоординатаВерх;
			КонецЕсли;
		КонецЦикла;
		
		ВысотаСтроки = НастройкиМнгЧ.Найти(ИмяГруппы, "ИдГруппы").ВысотаСтроки;
		
		// Скопируем верхнюю часть документа, не включая многострочную часть.
		ТаблДок = Раздел.ПолучитьОбласть(1, , Верх - 1);
		// Скопируем подвал, всё, что ниже области многострочного блока.
		Подвал = Раздел.ПолучитьОбласть(Низ + 1, , Раздел.ВысотаТаблицы);
		
		Строка = Раздел.ПолучитьОбласть(Верх, , Верх + ВысотаСтроки - 1);
		
		Если ВысотаСтроки > 1 Тогда
			ОбластьОпределениеВысотыСтрокиМногострочнойЧасти = Строка.Области.Найти("ОпределениеВысотыСтрокиМногострочнойЧасти");
			Если ОбластьОпределениеВысотыСтрокиМногострочнойЧасти <> Неопределено Тогда
				ОбластьОпределениеВысотыСтрокиМногострочнойЧасти.Имя = "";
			КонецЕсли;
		КонецЕсли;
		
		Если Строка.Области.Найти(НазвОбласти) <> Неопределено Тогда
			Строка.Области[НазвОбласти].Имя = "";
		КонецЕсли;
		
		// При превышении реального кол-ва строк над исходным кол-вом (по шаблону),
		// автоматически добавляем необходимое колво строк.
		
		Для НомНовойСтроки = 1 По ТекущееКоличествоСтрокГруппы Цикл
			// Переопределим именнованность.
			Строка1 = Строка.ПолучитьОбласть(1, , Строка.ВысотаТаблицы);
			НомСтр = Формат(НомНовойСтроки, "ЧГ=0");
			Для каждого Кол Из СтруктураГруппыКолонки Цикл
				КолИмя = Кол.Имя;
				Строка1.Области[КолИмя + "_1"].Имя = КолИмя + "_" + НомСтр;
			КонецЦикла;
			
			РегламентированнаяОтчетность.ЗаполнитьСтрокуДаннымиИзТаблицы(СтруктураГруппы, Строка1, СтруктураГруппы[НомНовойСтроки - 1], НомСтр);
			ТаблДок.Вывести(Строка1);
			
		КонецЦикла;
		
		ТаблДок.Вывести(Подвал);
		Раздел.Очистить();
		Раздел.Вывести(ТаблДок);
		
		// Восстановим области.
		Для каждого Зап Из НастройкиМнгЧ Цикл
			Раздел.Область("R" + Формат(Зап.НизМногострочнойЧасти, "ЧГ=0") + ":R" + Формат(Зап.ВерхМногострочнойЧасти, "ЧГ=0")).Имя = Зап.Область;
		КонецЦикла;
		
	КонецЕсли;
	
	// выводим значения строк
	Для Каждого СтрокаТаблицы Из СтруктураГруппы Цикл
		НомерСтрокиВТаблице      = СтруктураГруппы.Индекс(СтрокаТаблицы);
		НомерСтрокиВФормеТаблицы = НомерСтрокиВТаблице + 1;
		НомерСтрокиВФормеТаблицыСтр = Формат(НомерСтрокиВФормеТаблицы, "ЧГ=0");
		Для Каждого КолонкаТаблицы Из СтруктураГруппы.Колонки Цикл
			
			КолонкаТаблицыИмя        = КолонкаТаблицы.Имя;
			ЗначениеЯчейки           = СтрокаТаблицы[КолонкаТаблицыИмя];
			ИмяЯчейки                = КолонкаТаблицыИмя + "_" + НомерСтрокиВФормеТаблицыСтр;
			
			ОбластьЯчейкиТаблицы          = ТекТабличноеПоле.Области[ИмяЯчейки];
			
			Если ОбластьЯчейкиТаблицы.СодержитЗначение = Истина Тогда
				ОбластьЯчейкиТаблицы.Значение = ЗначениеЯчейки;
			Иначе
				ОбластьЯчейкиТаблицы.Текст = ЗначениеЯчейки;
			КонецЕсли;
			
			
		КонецЦикла;
		
	КонецЦикла;	
КонецПроцедуры // ВывестиРазделВТабличныйДокумент()

// Функция определяет поле табличного документа формы, содержащее 
// многострочный раздел.по имени ИдГруппы.
//
// Параметры:
//  ИдГруппы - строка, имя многострочного раздела.
//
// Возвращаемое значение:
//  Поле табличного документа.
//
Функция ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИдГруппы) Экспорт
	Перем ТекТабличноеПоле;
	
	Если ИдГруппы = мИдГруппыА Тогда // Лист А
		ТекТабличноеПоле = мЛистА;
	ИначеЕсли ИдГруппы = мИдГруппыБ Тогда // Лист Б
		ТекТабличноеПоле = мЛистБ;
	ИначеЕсли ИдГруппы = мИдГруппыВ Тогда // Лист В
		ТекТабличноеПоле = мЛистВ;
	ИначеЕсли ИдГруппы = мИдГруппыГ1Продолжение Тогда // Лист Г1 Продолжение
		ТекТабличноеПоле = мЛистГ1Продолжение;
	ИначеЕсли ИдГруппы = мИдГруппыГ2 Тогда // Лист Г2
		ТекТабличноеПоле = мЛистГ2;
	ИначеЕсли ИдГруппы = мИдГруппыГ3 Тогда // Лист Г3
		ТекТабличноеПоле = мЛистГ3;
	ИначеЕсли ИдГруппы = мИдГруппыД Тогда // Лист Д
		ТекТабличноеПоле = мЛистД;
	ИначеЕсли ИдГруппы = мИдГруппыЕ Тогда // Лист Е
		ТекТабличноеПоле = мЛистЕ;
	ИначеЕсли ИдГруппы = мИдГруппыЖ2_1 ИЛИ ИдГруппы = мИдГруппыЖ2_2 Тогда // Лист Ж2
		ТекТабличноеПоле = мЛистЖ2;
	ИначеЕсли ИдГруппы = мИдГруппыЗ Тогда // Лист З
		ТекТабличноеПоле = мЛистЗ;
	ИначеЕсли ИдГруппы = мИдГруппыИ Тогда // Лист И
		ТекТабличноеПоле = мЛистИ;
	ИначеЕсли ИдГруппы = мИдГруппыК3_1 ИЛИ ИдГруппы = мИдГруппыК3_2 Тогда // Лист К3
		ТекТабличноеПоле = мЛистК3;
	ИначеЕсли ИдГруппы = мИдГруппыК4_1 ИЛИ ИдГруппы = мИдГруппыК4_2 Тогда // Лист К4
		ТекТабличноеПоле = мЛистК4;
	КонецЕсли;

	Возврат ТекТабличноеПоле;
КонецФункции // ОпределитьТабличноеПолеПоИдМногострочногоРаздела()
// Функция определяет многострочный раздел табличного документа
// на активной странице основной панели формы.
//
// Параметры:
//  Нет;
//
// Возвращаемое значение:
//  строка, имя многострочного раздела.
//
Функция ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ИмяЛиста = Неопределено) Экспорт
	Перем ИмяГруппы;

	Если ИмяЛиста = Неопределено Тогда

		ТекущаяСтраницаПанели    = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница;
		ИмяТекущейСтраницыПанели = ТекущаяСтраницаПанели.Имя;
	Иначе
		ИмяТекущейСтраницыПанели = ИмяЛиста;

	КонецЕсли;

	Если ИмятекущейСтраницыПанели = "ЛистА" Тогда
		ИмяГруппы = мИдГруппыА;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистБ" Тогда
		ИмяГруппы = мИдГруппыБ;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистВ" Тогда
		ИмяГруппы = мИдГруппыВ;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистГ1Продолжение" Тогда
		ИмяГруппы = мИдГруппыГ1Продолжение;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистГ2" Тогда
		ИмяГруппы = мИдГруппыГ2;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистГ3" Тогда
		ИмяГруппы = мИдГруппыГ3;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистД" Тогда
		ИмяГруппы = мИдГруппыД;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистЕ" Тогда
		ИмяГруппы = мИдГруппыЕ;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистЖ2" Тогда
		ИмяГруппы = мИдГруппыЖ2_1;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистЗ" Тогда
		ИмяГруппы = мИдГруппыЗ;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистИ" Тогда
		ИмяГруппы = мИдГруппыИ;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистК3" Тогда
		ИмяГруппы = мИдГруппыК3_1;
	ИначеЕсли ИмятекущейСтраницыПанели = "ЛистК4" Тогда
		ИмяГруппы = мИдГруппыК4_1;
	КонецЕсли;

	Возврат ИмяГруппы;

КонецФункции // ОпределитьИдМногострочногоРазделаПоАктивнойСтранице()

// Создает новую строку многострочного раздела.
// Процедура вставляет строку в многострочный блок.
//
// Параметры:
//  Форма          - ссылка на форму отчета
//  ИмяГруппыБлока - имя группы, в том случае, если необходимо вставить строки в процедурах автозаполнения, без фокусировок.
//  СпециальноеДобавление - режим добавления строк по нестандартному алгоритму, когда в правой части распологаются данные.
//  ИмяКолонкиНомера - имя колонки, в которой необходимо проставлять номер при вставки строки.
//
Процедура ВставитьДополнительнуюСтроку(ИмяГруппыБлока = Неопределено, СпециальноеДобавление = Ложь, ИмяКолонкиНомера = Неопределено) Экспорт
	Перем СтруктураГруппы;
	Перем МаксимальноеКоличествоСтрокГруппы;

	Если ИмяГруппыБлока = Неопределено Тогда
		// Сначала выполним проверку на активную страницу панели формы,
		// которая содержит многострочный раздел
		ИмяГруппы = ОпределитьИдМногострочногоРазделаПоАктивнойСтранице();
		Если ИмяГруппы = Неопределено Тогда
			Сообщить("Не выбран многострочный раздел, в который необходимо добавить строку.", СтатусСообщения.Внимание);
			Возврат;
		КонецЕсли;
	Иначе
		ИмяГруппы = ИмяГруппыБлока;
	КонецЕсли;

	// Исходное количество строк группы
	мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, МаксимальноеКоличествоСтрокГруппы);

	ТекТабличноеПоле = ОпределитьТабличноеПолеПоИдМногострочногоРаздела(ИмяГруппы);
	мСтруктураМногострочныхРазделов.Свойство(ИмяГруппы, СтруктураГруппы);

	// определяем последнюю строку многострочной группы
	КолСтрок = СтруктураГруппы.Количество();
	КолСтрокСтр = Формат(КолСтрок, "ЧГ=0");
	ИмяПервойЯчейкиПоследнейСтроки = СтруктураГруппы.Колонки[0].Имя + "_" + КолСтрокСтр;

	// область первой ячейки последней строки многострочного раздела
	ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяПервойЯчейкиПоследнейСтроки];

	НастройкиМнгЧ = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ТекТабличноеПоле.Имя, "МногострочностьВРазделе").Найти(ИмяГруппы, "ИдГруппы");
	ВысотаСтроки = НастройкиМнгЧ.ВысотаСтроки;
	
	// номера строк исходной области
	НомерВерхЯчейкиОбласти = ОбластьЯчейки.Верх;
	НомерНижнЯчейкиОбласти = ОбластьЯчейки.Низ + ВысотаСтроки - 1;
		
	НастройкиМнгЧ = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ТекТабличноеПоле.Имя, "МногострочностьВРазделе").Найти(ИмяГруппы, "ИдГруппы");
	ВысотаСтроки = НастройкиМнгЧ.ВысотаСтроки;

	СдвигСтрок = НомерНижнЯчейкиОбласти - НомерВерхЯчейкиОбласти + 1;

	// номера строк вставляемой области
	НомерВерхЯчейкиНовойОбласти = НомерВерхЯчейкиОбласти + СдвигСтрок;
	НомерНижнЯчейкиНовойОбласти = НомерНижнЯчейкиОбласти + СдвигСтрок;

	Если СпециальноеДобавление Тогда
		//Форма.СпециальногоДобавленияСтроки(ТекТабличноеПоле, ИмяГруппы, НомерВерхЯчейкиОбласти, НомерНижнЯчейкиОбласти);
	Иначе
		// определяем вставляемую область
		ВставляемаяОбласть = ТекТабличноеПоле.Область(НомерВерхЯчейкиОбласти, , НомерНижнЯчейкиОбласти,);		
		// добавляем в таблицу новую строку
		ТекТабличноеПоле.ВставитьОбласть(ВставляемаяОбласть,,ТипСмещенияТабличногоДокумента.ПоВертикали);
	КонецЕсли;

	КолСтрокСтр1 = Формат(КолСтрок + 1, "ЧГ=0");
	// переопределяем имена вставленной области
	Для Каждого Колонка Из СтруктураГруппы.Колонки Цикл

		ИмяКолонки          = Колонка.Имя;
		ИмяОбластиЯчейки    = ИмяКолонки + "_" + КолСтрокСтр;
		ИмяНовОбластиЯчейки = ИмяКолонки + "_" + КолСтрокСтр1;

		ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяОбластиЯчейки];
		ОбластьЯчейки.Имя = ИмяНовОбластиЯчейки;

		// определяем границы ячейки исходной области
		НомерВерхСтрокиЯчейки  = ОбластьЯчейки.Верх - СдвигСтрок;
		НомерНижнСтрокиЯчейки  = ОбластьЯчейки.Низ  - СдвигСтрок;
		НомерЛевоКолонкиЯчейки = ОбластьЯчейки.Лево;
		НомерПравКолонкиЯчейки = ОбластьЯчейки.Право;

		// Назначаем имя ячейки исходной области,
		// (т.к. в результате вставки новой области оно было очищено)
		ОбластьЯчейкиИсходнойОбласти = ТекТабличноеПоле.Область(НомерВерхСтрокиЯчейки, НомерЛевоКолонкиЯчейки, НомерНижнСтрокиЯчейки, НомерПравКолонкиЯчейки);
		ОбластьЯчейкиИсходнойОбласти.Имя = ИмяОбластиЯчейки;

		// очищаем значения ячеек вставленной области
		Если ОбластьЯчейки.СодержитЗначение = Истина Тогда
			ОбластьЯчейки.Очистить();
		КонецЕсли;

		Если ИмяКолонкиНомера <> Неопределено Тогда
			Если ИмяКолонкиНомера = ИмяКолонки Тогда
				Если ОбластьЯчейки.СодержитЗначение = Истина Тогда
					ОбластьЯчейки.Значение = КолСтрокСтр1;
				Иначе
					ОбластьЯчейки.Текст = КолСтрокСтр1;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;

	Если ИмяГруппыБлока = Неопределено Тогда

		// Назначим текущей областью таблицы первую редактируемую ячейку добавленной строки.
		// Определяем текущую область таблицы
		ИмяТекущейОбласти = СтруктураГруппы.Колонки[0].Имя + "_" + КолСтрокСтр1;

		ТекТабличноеПоле.ТекущаяОбласть = ТекТабличноеПоле.Области[ИмяТекущейОбласти];
		// установим фокус на поле табличн. документа
		ТекущийЭлемент = ТекТабличноеПоле;
	КонецЕсли;

	// добавляем в структуру многострочной группы новую строку
	СтруктураГруппы.Добавить();
	Модифицированность = Истина;
КонецПроцедуры // ВставитьДополнительнуюСтроку()

Процедура КнопкаДобавитьДопСтрокиЛистАНажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистАНажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистБНажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистБНажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистВНажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистВНажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистГ2Нажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистГ3Нажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистГ2Нажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистГ3Нажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистДНажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистДНажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистЕНажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистЕНажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистЖ2Нажатие(Элемент)
	ВставитьДополнительнуюСтроку(мИдГруппыЖ2_1);
	ВставитьДополнительнуюСтроку(мИдГруппыЖ2_2);
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистЖ2Нажатие(Элемент)
	УдалитьДополнительнуюСтроку(,,мИдГруппыЖ2_1);
	УдалитьДополнительнуюСтроку(,,мИдГруппыЖ2_2, Ложь);
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистЗНажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистЗНажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистИНажатие(Элемент)
	ВставитьДополнительнуюСтроку();
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистИНажатие(Элемент)
	УдалитьДополнительнуюСтроку();
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистК3Нажатие(Элемент)
	ВставитьДополнительнуюСтроку(мИдГруппыК3_1);
	ВставитьДополнительнуюСтроку(мИдГруппыК3_2);
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистК3Нажатие(Элемент)
	УдалитьДополнительнуюСтроку(,,мИдГруппыК3_1);
	УдалитьДополнительнуюСтроку(,,мИдГруппыК3_2, Ложь);
	Расчет();
КонецПроцедуры

Процедура КнопкаДобавитьДопСтрокиЛистК4Нажатие(Элемент)
	ВставитьДополнительнуюСтроку(мИдГруппыК4_1);
	ВставитьДополнительнуюСтроку(мИдГруппыК4_2);
КонецПроцедуры

Процедура КнопкаУдалитьДопСтрокиЛистК4Нажатие(Элемент)
	УдалитьДополнительнуюСтроку(,,мИдГруппыК4_1);
	УдалитьДополнительнуюСтроку(,,мИдГруппыК4_2, Ложь);
	Расчет();
КонецПроцедуры

//обработчики нажатия на кнопки добавления/удаления дополнительных строк многострочных разделов---
//и связанные с ними процедуры-функции по работе с многострочными блоками

// Процедура - обработчик события "ПередОткрытием" формы.
//
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)

	РегламентированнаяОтчетность.ПередОткрытиемФормыРегламентированногоОтчета(ЭтаФорма, Отказ);
	Если Отказ Тогда
		Возврат;
	КонецЕсли;

	Инициализация();
	
КонецПроцедуры

// Процедура - обработчик события "ПриОткрытии" формы.
//
Процедура ПриОткрытии()

	РегламентированнаяОтчетность.ВключитьОбработчикАвтосохранения(ЭтаФорма);

КонецПроцедуры

// Процедура - обработчик события "ПередЗакрытием" формы.
//
Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)

	РегламентированнаяОтчетность.ПередЗакрытиемРегламентированногоОтчета(ЭтаФорма, Отказ, СтандартнаяОбработка);
	
КонецПроцедуры

Процедура СохранитьДеревоНастройкиСтраниц()
	
	Если мСохраненныйДок <> Неопределено Тогда
		Если НЕ мСохраненныйДок.ЭтоНовый() Тогда
			ХранилищеДанных = Новый ХранилищеЗначения(мДеревоСтраницОтчета);
			мСохраненныйДок.ДеревоНастройкиСтраниц = ХранилищеДанных;
			Попытка
				мСохраненныйДок.Записать();
			Исключение
			КонецПопытки;
		КонецЕсли;
	КонецЕсли;
	
Конецпроцедуры

// Процедура - обработчик события "ПриЗакрытии" формы.
//
Процедура ПриЗакрытии()

	СохранитьДеревоНастройкиСтраниц();
	РегламентированнаяОтчетность.ПриЗакрытииРегламентированногоОтчета(ЭтаФорма);

КонецПроцедуры // ПриЗакрытии()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ДЕЙСТВИЯ КОМАНДНЫХ ПАНЕЛЕЙ ФОРМЫ

Процедура КоманднаяПанельФормыВыбратьВариантОчисткиОтчета(Кнопка)
	
	РегламентированнаяОтчетность.МеханизмыОчисткиРегламентированныхОтчетов(ЭтаФорма, Кнопка);
	
КонецПроцедуры

Процедура КоманднаяПанельФормыПоиск(Кнопка)
	
	ПоискВРегламентированномОтчете(ЭтаФорма);

КонецПроцедуры

Процедура КоманднаяПанельФормыЗаполнить(Кнопка)
	Если ОчиститьОтчет() Тогда
		ЗаполнитьАвто();
	КонецЕсли; 
КонецПроцедуры

Процедура КоманднаяПанельФормыКнопкаНастройкаСтраниц(Кнопка)

	ОткрытьФормуВыбораСтраниц("ВыбратьДляНастройки");
	РегламентированнаяОтчетность.роПоказатьСтраницыОтчета(ЭтаФорма);

КонецПроцедуры

Процедура КоманднаяПанельДействийСохранитьИЗакрыть(Кнопка)

	Если Сохранить() Тогда
		Закрыть();
	КонецЕсли;

КонецПроцедуры

Процедура КоманднаяПанельДействийЗаписать(Кнопка)

	Сохранить();

КонецПроцедуры

//////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ДИАЛОГА И ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ/ПРОЦЕДУРЫ

Процедура ПолеВыбораВидДокументаОчистка(Элемент, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;

КонецПроцедуры

Процедура ПолеВыбораВидДокументаПриИзменении(Элемент)

	УправлениеЭУВидДокументаНомерКорректировки();
	ОтобразитьНомерКорректировки();

КонецПроцедуры

Процедура НомерКорректировкиПриИзменении(Элемент)

	ОтобразитьНомерКорректировки();

КонецПроцедуры

Процедура КнопкаЗаполнитьСведенияОбОрганизацииНажатие(Элемент)

	ЗаполнитьСведенияОбОрганизации();

КонецПроцедуры

Процедура ОсновнаяПанельПриСменеСтраницы(Элемент, ТекущаяСтраница) Экспорт
	
	Перем ТекущаяОбласть;

	РегламентированнаяОтчетность.СформироватьСоставКнопкиОчиститьДляРегОтчетов(ЭтаФорма);
	
	ИмяТекущейСтраницыПанели = ЭлементыФормы.ОсновнаяПанель.Страницы[ТекущаяСтраница].Имя;
	Если РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели, "МногостраничностьВРазделе") Тогда
		РегламентированнаяОтчетность.роПоказатьСтатикСтраницРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели);
	КонецЕсли;
	Если РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели, "РазделЯвляетсяАвтозаполняемым") Тогда
		ТекущаяОбласть = ЭлементыФормы["ПолеТабличногоДокумента" + ИмяТекущейСтраницыПанели].ТекущаяОбласть;
		РегламентированнаяОтчетность.роВывестиЭлементыВариантаЗаполнения(ЭтаФорма, ТекущаяОбласть);
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "ЛистД" Тогда
		//Накладываем условие на доступность ячейки
		ИзменитьТаблицуВариантовЗаполненияЛистаД(НЕ ФлажокОтклАвтоРасчет);
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "ЛистГ1Продолжение" Тогда
		ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение();
	КонецЕсли;
	
КонецПроцедуры

Процедура ПолеВводаДатаСдачиПриИзменении(Элемент)

	ЗаполнитьСведенияОбОрганизации(Истина);
	ЗаполнитьДатуПодписи();

КонецПроцедуры

// Выполняет начальные настройки параметров отчета.
// По данным макета "СоствПоказателей" формирует:
//   - состав показателей отчета;
//   - варианты заполнения показателей отчета;
//   - дерево выводимых на печать листов отчета.
//
Процедура ЗаполнитьНачальныеНастройки()

	МакетСоставаПоказателей = ЭтотОбъект.ПолучитьМакет(мСоставПоказателей);
	ОписаниеТиповСтрока15  = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(15);
	ОписаниеТиповСтрока50  = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(50);
	ОписаниеТиповСтрока100 = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(100);
	ОписаниеТиповЧисло1    = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(1);

	Для Инд = 0 По МакетСоставаПоказателей.Области.Количество() - 1 Цикл

		ТекОбласть    = МакетСоставаПоказателей.Области[Инд];
		ИмяСтраницы   = ТекОбласть.Имя;

		ТаблицаВариантыЗаполнения = Новый ТаблицаЗначений;
		ТаблицаВариантыЗаполнения.Колонки.Добавить("КодПоказателя",				ОписаниеТиповСтрока50);
		ТаблицаВариантыЗаполнения.Колонки.Добавить("ВариантЗаполнения",			ОписаниеТиповЧисло1);
		ТаблицаВариантыЗаполнения.Колонки.Добавить("ЗначениеАвто",				мОписаниеТиповЧислоЕ);
		ТаблицаВариантыЗаполнения.Колонки.Добавить("Дельта",					мОписаниеТиповЧислоЕ);
		ТаблицаВариантыЗаполнения.Колонки.Добавить("Комментарий",				ОписаниеТиповСтрока100);
		ТаблицаВариантыЗаполнения.Колонки.Добавить("КодПоказателяПоСтруктуре",	ОписаниеТиповСтрока50);

		Для Ном = ТекОбласть.Верх По ТекОбласть.Низ Цикл

			КодПоказателя = СокрП(МакетСоставаПоказателей.Область(Ном, 1).Текст);
			ИмяПоказателя = КодПоказателя;

			Если КодПоказателя = "===" Тогда
				Прервать;
			КонецЕсли;

			Если Лев(КодПоказателя, 2) = "//" Тогда
				Продолжить;
			КонецЕсли;

			КодПоказателяПоФорме = СокрЛП(МакетСоставаПоказателей.Область(Ном, 2).Текст);
			ПризнМногострочность = СокрЛП(МакетСоставаПоказателей.Область(Ном, 3).Текст);
			ТипДанныхРеквизита   = СокрЛП(МакетСоставаПоказателей.Область(Ном, 4).Текст);
			стрКолСтрокИсходный  = СокрЛП(МакетСоставаПоказателей.Область(Ном, 5).Текст);
			стрВариантЗаполнения = РегламентированнаяОтчетность.ПолучитьВариантЗаполненияПоказателяРегОтчета(МакетСоставаПоказателей, Ном);
			КодПоказателяПоСтруктуре = СокрЛП(МакетСоставаПоказателей.Область(Ном, 9).Текст);
			ТочностьПоказателя  = СокрЛП(МакетСоставаПоказателей.Область(Ном, 10).Текст);

			чКолСтрокИсходный    = ? (ПустаяСтрока(стрКолСтрокИсходный),  0, Число(стрКолСтрокИсходный));
			чВариантЗаполнения   = ? (ПустаяСтрока(стрВариантЗаполнения), 0, Число(стрВариантЗаполнения));

			НоваяСтрока = мТаблицаСоставПоказателей.Добавить();
			НоваяСтрока.ИмяПоляТаблДокумента   = ИмяСтраницы;
			НоваяСтрока.КодПоказателяПоСоставу = КодПоказателя;
			НоваяСтрока.КодПоказателяПоФорме   = КодПоказателяПоФорме;
			НоваяСтрока.ПризнМногострочности   = ПризнМногострочность;
			НоваяСтрока.ТипДанныхПоказателя    = ТипДанныхРеквизита;
			НоваяСтрока.КодПоказателяПоСтруктуре  = КодПоказателяПоСтруктуре;
			НоваяСтрока.ТочностьПоказателя  = ТочностьПоказателя;

			Если чВариантЗаполнения <> 0 Тогда
				НоваяСтрока = ТаблицаВариантыЗаполнения.Добавить();
				НоваяСтрока.КодПоказателя      = ? (Не ПустаяСтрока(КодПоказателяПоФорме), КодПоказателяПоФорме, КодПоказателя);
				НоваяСтрока.ВариантЗаполнения  = чВариантЗаполнения;
				НоваяСтрока.КодПоказателяПоСтруктуре  = КодПоказателяПоСтруктуре;
			КонецЕсли;

		КонецЦикла;

		Если ТаблицаВариантыЗаполнения.Количество() > 0 Тогда
			МассивВариантовЗаполненияСтраниц = Новый Массив;
			МассивВариантовЗаполненияСтраниц.Добавить(ТаблицаВариантыЗаполнения);
			мСтруктураВариантыЗаполнения.Вставить(ИмяСтраницы, МассивВариантовЗаполненияСтраниц);
		Конецесли;

	КонецЦикла;

КонецПроцедуры // ЗаполнитьНачальныеНастройки()

// Формирует дерево значений - структуру страниц отчета,
// содержащей настройки показа страниц, вывода на печать и выгрузки в ИМНС.
//
Процедура ФормироватьСтруктуруСтраницОтчета() 

	ОписаниеТиповСтрока100 = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(100);

	ОписаниеТиповЧисло1    = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(1);

	// Дерево содержит коллекцию страниц отчета.
	// В колонках дерева хранятся следующие данные:
	//    - представление листа;
	//    - имя страницы основной панели формы, содержащей выводимый на печать лист;
	//    - имя поля табличного документа;
	//    - имя области ячеек табличного документа (используется в случае вывода
	//      на печать отдельных страниц титульного листа);
	//    - ориентация страницы при печати;
	//    - число, метка вывода страницы на печать;
	//    - число, метка показа страницы на основной панели формы;
	//    - число, метка выгрузки данных страницы в ИМНС.
	//
	мДеревоСтраницОтчета               = Новый ДеревоЗначений;
	мДеревоСтраницОтчета.Колонки.Добавить("Представление",            ОписаниеТиповСтрока100);
	мДеревоСтраницОтчета.Колонки.Добавить("ИмяСтраницы",              ОписаниеТиповСтрока100);
	мДеревоСтраницОтчета.Колонки.Добавить("ИмяПоляТабличногоДокум",   ОписаниеТиповСтрока100);
	мДеревоСтраницОтчета.Колонки.Добавить("ИмяОбластиТабличногоПоля", ОписаниеТиповСтрока100);
	мДеревоСтраницОтчета.Колонки.Добавить("ОриентацияСтраницы");
	мДеревоСтраницОтчета.Колонки.Добавить("ВыводНаПечать",            ОписаниеТиповЧисло1);
	мДеревоСтраницОтчета.Колонки.Добавить("ПоказатьСтраницу",         ОписаниеТиповЧисло1);
	мДеревоСтраницОтчета.Колонки.Добавить("ВыгрузитьСтраницу",        ОписаниеТиповЧисло1);

	мДеревоСтраницОтчета.Строки.Очистить();

	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Титульный";
	СтрокаУровня1.Представление            = "Титульный лист";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаТитульный";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Титульный002";
	СтрокаУровня1.Представление            = "Физ. лицо";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаТитульный002";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;

	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел1";
	СтрокаУровня1.Представление            = "Раздел 1";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаРаздел1";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел2";
	СтрокаУровня1.Представление            = "Раздел 2";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаРаздел2";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел3";
	СтрокаУровня1.Представление            = "Раздел 3";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаРаздел3";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел4";
	СтрокаУровня1.Представление            = "Раздел 4";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаРаздел4";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел5";
	СтрокаУровня1.Представление            = "Раздел 5";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаРаздел5";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "Раздел6";
	СтрокаУровня1.Представление            = "Раздел 6";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаРаздел6";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистА";
	СтрокаУровня1.Представление            = "Лист А";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистА";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистБ";
	СтрокаУровня1.Представление            = "Лист Б";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистБ";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистВ";
	СтрокаУровня1.Представление            = "Лист В";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистВ";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистГ1";
	СтрокаУровня1.Представление            = "Лист Г1";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистГ1";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистГ1Продолжение";
	СтрокаУровня1.Представление            = "Лист Г1 (продолжение)";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистГ1Продолжение";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистГ2";
	СтрокаУровня1.Представление            = "Лист Г2";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистГ2";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистГ3";
	СтрокаУровня1.Представление            = "Лист Г3";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистГ3";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистД";
	СтрокаУровня1.Представление            = "Лист Д";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистД";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистЕ";
	СтрокаУровня1.Представление            = "Лист Е";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистЕ";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистЖ1";
	СтрокаУровня1.Представление            = "Лист Ж1";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистЖ1";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистЖ2";
	СтрокаУровня1.Представление            = "Лист Ж2";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистЖ2";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистЗ";
	СтрокаУровня1.Представление            = "Лист З";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистЗ";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистЗПродолжение";
	СтрокаУровня1.Представление            = "Лист З (продолжение)";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистЗПродолжение";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистИ";
	СтрокаУровня1.Представление            = "Лист И";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистИ";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистИПродолжение";
	СтрокаУровня1.Представление            = "Лист И (продолжение)";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистИПродолжение";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистК1";
	СтрокаУровня1.Представление            = "Лист К1";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистК1";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистК2";
	СтрокаУровня1.Представление            = "Лист К2";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистК2";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистК3";
	СтрокаУровня1.Представление            = "Лист К3";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистК3";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистК4";
	СтрокаУровня1.Представление            = "Лист К4";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистК4";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
	СтрокаУровня1 = мДеревоСтраницОтчета.Строки.Добавить();
	СтрокаУровня1.ИмяСтраницы              = "ЛистЛ";
	СтрокаУровня1.Представление            = "Лист Л";
	СтрокаУровня1.ИмяПоляТабличногоДокум   = "ПолеТабличногоДокументаЛистЛ";
	СтрокаУровня1.ОриентацияСтраницы       = ОриентацияСтраницы.Портрет;
	СтрокаУровня1.ВыводНаПечать            = 1;
	СтрокаУровня1.ПоказатьСтраницу         = 1;
	СтрокаУровня1.ВыгрузитьСтраницу        = 2;
	
КонецПроцедуры // ФормироватьСтруктуруСтраницОтчета()

Процедура ФлажокОтклАвтоРасчетПриИзменении(Элемент)

	ТекущаяСтраницаПанели    = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница;
	ИмяТекущейСтраницыПанели = ТекущаяСтраницаПанели.Имя;
		
	Если ИмяТекущейСтраницыПанели = "ЛистД" Тогда
		//Накладываем условие на доступность ячейки
		ИзменитьТаблицуВариантовЗаполненияЛистаД(НЕ ФлажокОтклАвтоРасчет);
	Иначе
		РегламентированнаяОтчетность.роИзменитьТаблицуВариантовЗаполнения(ЭтаФорма, НЕ ФлажокОтклАвтоРасчет);
	КонецЕсли;
	
	Если ИмяТекущейСтраницыПанели = "ЛистГ1Продолжение" Тогда
		ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение();
	КонецЕсли;
	
	Расчет();
	
КонецПроцедуры

Процедура ИзменитьТаблицуВариантовЗаполненияЛистаГ1Продолжение()
		
	Перем МассивВариантовЗаполненияСтраниц;
	Перем ЦветФона;
	
	мСтруктураЦветовРаскраски.Свойство("_5", ЦветФона);
	ИмяСтраницы = "ЛистГ1Продолжение";
	
	Если Не мСтруктураВариантыЗаполнения.Свойство(ИмяСтраницы, МассивВариантовЗаполненияСтраниц) Тогда
		Возврат;
	КонецЕсли;
	
	Для Инд = 0 по МассивВариантовЗаполненияСтраниц.Количество() - 1 Цикл
		Для Каждого Строка Из МассивВариантовЗаполненияСтраниц[Инд] Цикл
			ТекущиеОбласти = ЭтаФорма.ЭлементыФормы.ПолеТабличногоДокументаЛистг1Продолжение.Области;				
			
			Для НомСтр = 1 По 12 Цикл
				ИмяПоказателя = "П000025119001_" + НомСтр;			
				ТекущиеОбласти[ИмяПоказателя].Защита = Истина;
				ТекущиеОбласти[ИмяПоказателя].ЦветФона = ЦветФона;
			КонецЦикла;
			
			ИмяПоказателя = "П000025119006_12";			
			ТекущиеОбласти[ИмяПоказателя].Защита = Истина;
			ТекущиеОбласти[ИмяПоказателя].ЦветФона = ЦветФона;
			
			ИмяПоказателя = "П000025119004_1";
			ТекущиеОбласти[ИмяПоказателя].Защита = Истина;
			ТекущиеОбласти[ИмяПоказателя].ЦветФона = ЦветФона;
		КонецЦикла; // Для каждого
	КонецЦикла; // Для
	
КонецПроцедуры

Процедура ИзменитьТаблицуВариантовЗаполненияЛистаД(ПолныйРучнойВвод = Ложь)

	Перем МассивВариантовЗаполненияСтраниц;
	Перем ЦветФона;
	
	// Не нужно разукрашивать табличные поля, если открывается без открытия формы (например печать или просмотр)
	Если мБезОткрытияФормы ИЛИ мРежимПечати Тогда
		Возврат;
	КонецЕсли;
	
	
	Если ПолныйРучнойВвод Тогда
		
		ИмяСтраницы = "ЛистД";
		// а если это многостраничный раздел?
		КолСтрВРазделе = РегламентированнаяОтчетность.роПолучитьКоличествоСтраницРаздела(ЭтаФорма, ИмяСтраницы); // кол-во страниц в разделе
		// Всегда получим актуальную таблицу заполнения. Не эталонную.
		ТаблицаВариантыЗаполнения = РегламентированнаяОтчетность.роПолучитьТаблицуВариантовЗаполнения(ЭтаФорма, ИмяСтраницы);
		
		Если ТаблицаВариантыЗаполнения = Неопределено Тогда
			Возврат;
		КонецЕсли;
		
		// Если раздел многостраничный, то нужно насквозь все обнулять !!!
		
		Если КолСтрВРазделе = 1 Тогда
			
			Для Каждого Строка Из ТаблицаВариантыЗаполнения Цикл
				
				ИмяПоказателя            =  Строка.КодПоказателя;
				КолвоСтрокВМногострочнойЧасти = РегламентированнаяОтчетность.роПоказательВходитВМногострочнуюЧасть(ЭтаФорма, ИмяПоказателя);
				БазоваяЧасть = ИмяПоказателя;
				ОписанияБлоков = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяСтраницы, "МногострочностьВРазделе");
				ТекущиеОбласти = ЭтаФорма.ЭлементыФормы.ПолеТабличногоДокументаЛистД.Области;
				
				Для НомСтр = 1 по КолвоСтрокВМногострочнойЧасти Цикл
					ИмяКонтрольногоПоказателя = "П000012001007" + "_" + Формат(НомСтр, "ЧГ=0");
					ИмяПоказателя = БазоваяЧасть + "_" + Формат(НомСтр, "ЧГ=0");
					Если ТекущиеОбласти[ИмяКонтрольногоПоказателя].Значение = "404" Тогда
						Ключ = "_" + 0;
						мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);
						ТекущиеОбласти[ИмяПоказателя].Защита = Ложь;
						ТекущиеОбласти[ИмяПоказателя].ЦветФона = ЦветФона;
					Иначе
						Ключ = "_" + 4;
						мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);
						ТекущиеОбласти[ИмяПоказателя].Защита = Истина;
						ТекущиеОбласти[ИмяПоказателя].ЦветФона = ЦветФона;
					КонецЕсли;
				КонецЦикла;
				
			КонецЦикла; // Для Каждого Строка Из
				
		КонецЕсли; // КолСтрВРазделе = 1 Иначе // если многостраничный раздел
		
		Если КолСтрВРазделе >= 2 Тогда
			
			Если Не мСтруктураВариантыЗаполнения.Свойство(ИмяСтраницы, МассивВариантовЗаполненияСтраниц) Тогда
				Возврат;
			КонецЕсли;
			
			Для Инд = 0 по МассивВариантовЗаполненияСтраниц.Количество() - 1 Цикл
				Для Каждого Строка Из МассивВариантовЗаполненияСтраниц[Инд] Цикл
					ИмяПоказателя            =  Строка.КодПоказателя;
					КолвоСтрокВМногострочнойЧасти = РегламентированнаяОтчетность.роПоказательВходитВМногострочнуюЧасть(ЭтаФорма, ИмяПоказателя);
					БазоваяЧасть = ИмяПоказателя;
					ОписанияБлоков = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяСтраницы, "МногострочностьВРазделе");
					ТекущиеОбласти = ЭтаФорма.ЭлементыФормы.ПолеТабличногоДокументаЛистД.Области;
					
					Для НомСтр = 1 по КолвоСтрокВМногострочнойЧасти Цикл
						ИмяКонтрольногоПоказателя = "П000012001007" + "_" + Формат(НомСтр, "ЧГ=0");
						ИмяПоказателя = БазоваяЧасть + "_" + Формат(НомСтр, "ЧГ=0");
						Если ТекущиеОбласти[ИмяКонтрольногоПоказателя].Значение = "404" Тогда
							Ключ = "_" + 0;
							мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);
							ТекущиеОбласти[ИмяПоказателя].Защита = Ложь;
							ТекущиеОбласти[ИмяПоказателя].ЦветФона = ЦветФона;
						Иначе
							Ключ = "_" + 4;
							мСтруктураЦветовРаскраски.Свойство(Ключ, ЦветФона);
							ТекущиеОбласти[ИмяПоказателя].Защита = Истина;
							ТекущиеОбласти[ИмяПоказателя].ЦветФона = ЦветФона;
						КонецЕсли;
					КонецЦикла;
				КонецЦикла; // Для каждого
			КонецЦикла; // Для
		КонецЕсли; // КолСтрВРазделе >= 2
	КонецЕсли;
	
КонецПроцедуры // Процедура ИзменитьТаблицуВариантовЗаполненияЛистаД(ПолныйРучнойВвод = 0)

////////////////////////////////////////////////////////////////////////////////
//	ПРОЦЕДУРЫ И ФУНКЦИИ МЕХАНИЗМА АВТОСОХРАНЕНИЯ
//

// Процедура является частью механизма автосохранения
// и назначается динамически методом ПодключитьОбработчикОжидания()
// Обработчик может подключаться и отключаться из процедуры ПриОткрытии текущей формы и
// процедуры ОсновныеДействияФормыКнопкаВыбратьНажатие формы ФормаНастройки
Процедура ОбработчикСобытияПоТаймеру()
	
	Если РегламентированнаяОтчетность.АвтосохранениеВозможно(ЭтаФорма) Тогда
		Сохранить(Истина);
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////

Процедура КоманднаяПанельФормыРасширитьПолеБланка(Кнопка)
	
	РегламентированнаяОтчетность.ПриНажатииНаКнопкуПереходаВРежимВводаДанных(ЭтаФорма);
	
КонецПроцедуры

Процедура СформироватьСпискиВыбора()
	
	МакетСоставаПоказателей = ПолучитьМакет("Списки2009Кв1");
	
	КоллекцияСписковВыбора = Новый Соответствие;
	Для Каждого Область Из МакетСоставаПоказателей.Области Цикл
		Если Область.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Строки Тогда
			ВерхОбласти = Область.Верх;
			НизОбласти = Область.Низ;
			ТаблСписка = Новый ТаблицаЗначений;
			ТаблСписка.Колонки.Добавить("Код",,, МакетСоставаПоказателей.Область(ВерхОбласти, 1, ВерхОбласти, 1).ШиринаКолонки);
			ТаблСписка.Колонки.Добавить("Название",,, МакетСоставаПоказателей.Область(ВерхОбласти, 2, ВерхОбласти, 2).ШиринаКолонки);
			ТаблСписка.Колонки.Добавить("РезультатПроверки",,, 0);
			ТаблСписка.Колонки.Добавить("Норматив",,, 0);
			Для НомСтр = ВерхОбласти По НизОбласти Цикл
				КодПоказателя = СокрП(МакетСоставаПоказателей.Область(НомСтр, 1).Текст);
				Если КодПоказателя <> "###" Тогда
					НовСтрока = ТаблСписка.Добавить();
					НовСтрока.Код = КодПоказателя;
					НовСтрока.Название = СокрП(МакетСоставаПоказателей.Область(НомСтр, 2).Текст);
					НовСтрока.РезультатПроверки = СокрП(МакетСоставаПоказателей.Область(НомСтр, 3).Текст);
					НовСтрока.Норматив = СокрП(МакетСоставаПоказателей.Область(НомСтр, 4).Текст);
				КонецЕсли;
			КонецЦикла;
			КоллекцияСписковВыбора.Вставить(Область.Имя, ТаблСписка);
		КонецЕсли;
	КонецЦикла;
	
	СвойстваПоказателей = Новый ТаблицаЗначений;
	СвойстваПоказателей.Колонки.Добавить("Показатель");
	СвойстваПоказателей.Колонки.Добавить("Длина");
	СвойстваПоказателей.Колонки.Добавить("Тип");
	СвойстваПоказателей.Колонки.Добавить("ТекстПриВыборе");
	СвойстваПоказателей.Колонки.Добавить("ТаблицаЗначений");
	
	СвойстваПоказателей.Индексы.Добавить("Показатель");
	
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "ПоМесту", 3, , "Выбор места представления", КоллекцияСписковВыбора["МестаПредставления"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "ОКАТО", 11, "ОКАТО");
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "Гражданство", 1, , "Наличие гражданства", КоллекцияСписковВыбора["Гражданство"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "СтатусНалогоплательщика", 1, , "Статус налогоплательщика", КоллекцияСписковВыбора["СтатусНалогоплательщика"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "МестоЖительства", 1, , "Выбор вида места жительства", КоллекцияСписковВыбора["МестаЖительства"]);
	
	//Раздел 6
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000060001001", 1, , "Выбор кода строки 010", КоллекцияСписковВыбора["КодСтроки010"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000060003003", 11, "ОКАТО");
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000060002003", 20, , "Выбор КБК", КоллекцияСписковВыбора["КБК"]);
	
	//Лист А
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "СтавкаНалога", 2, , "Выбор налоговой ставки", КоллекцияСписковВыбора["СтавкаНалога"]);
	
	//Лист В
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000090001001", 1, , "Выбор вида деятельности", КоллекцияСписковВыбора["ВидДеятельности"]);
	
	//Лист Д
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000012000101", 1, , "Выбор места нахождения источника доходов", КоллекцияСписковВыбора["ИсточникДоходов"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000012001004", 4, , "Выбор кода дохода", КоллекцияСписковВыбора["КодДохода"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000012001005", 4, , "Выбор кода дохода", КоллекцияСписковВыбора["КодДохода"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000012001008", 4, , "Выбор кода дохода", КоллекцияСписковВыбора["КодДохода"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000012001007", 3, , "Выбор кода расхода", КоллекцияСписковВыбора["КодРасхода"]);

	//Лист Е
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000013000101", 1, , "Выбор места нахождения источника доходов", КоллекцияСписковВыбора["ИсточникДоходов"]);
	
	//Лист Ж2
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000015000101", 1, , "Выбор места нахождения источника доходов", КоллекцияСписковВыбора["ИсточникДоходов"]);
	
	//Лист З
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000016000101", 1, , "Выбор места нахождения источника доходов", КоллекцияСписковВыбора["ИсточникДоходов"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000016001001", 1, , "Выбор признака операции", КоллекцияСписковВыбора["ПризнакОперации"]);
	
	//Лист И
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000018000101", 1, , "Выбор места нахождения источника доходов", КоллекцияСписковВыбора["ИсточникДоходов"]);
	ДобавитьСтрокуОписанияВвода(СвойстваПоказателей, "П000018001001", 1, , "Выбор признака операции", КоллекцияСписковВыбора["ПризнакОперации"]);
	
КонецПроцедуры

Функция ДобавитьСтрокуОписанияВвода(ТаблицаПараметров, Показатель, Длина, Тип = Неопределено, ТекстПриВыборе = Неопределено, Значения = Неопределено)
	
	НовСтр = ТаблицаПараметров.Добавить();
	НовСтр.Показатель = Показатель;
	НовСтр.Тип = Тип;
	НовСтр.Длина = Длина;
	НовСтр.ТекстПриВыборе = ТекстПриВыборе;
	НовСтр.ТаблицаЗначений = Значения;
	
КонецФункции

Процедура ВвестиПоказатель(Элемент, Область, КодПоказателя, Знач ЭтоСумма, Знач ТекстВыбора, ТаблицаВыбора, СтандартнаяОбработка, КолонкаПоиска = "Код") Экспорт
	
	Если ТаблицаВыбора = Неопределено ИЛИ мАвтоВыборКодов Тогда
		Возврат;
	КонецЕсли;
	
	СтандартнаяОбработка = Ложь;
	
	Если Область.Имя = КодПоказателя Тогда
		ИсходноеЗначение = ?(ТипЗнч(Область.Значение) = Тип("Строка"), СокрЛП(Область.Значение), Область.Значение);
	Иначе
		Разделитель = ?(Лев(Область.Имя, СтрДлина(КодПоказателя) + 1) = КодПоказателя + "_", "_", "");
		ИндексОбласти = 1;
		ИсходноеЗначение = "";
		Пока ТекущийЭлемент.Области.Найти(КодПоказателя + Разделитель + Формат(ИндексОбласти, "ЧГ=")) <> Неопределено Цикл
			ИсходноеЗначение = ИсходноеЗначение + Строка(ТекущийЭлемент.Области[КодПоказателя + Разделитель + Формат(ИндексОбласти, "ЧГ=")].Значение);
			ИндексОбласти = ИндексОбласти + 1;
		КонецЦикла;
		ИсходноеЗначение = СокрЛП(ИсходноеЗначение);
	КонецЕсли;
	ИсходнаяСтрока = ТаблицаВыбора.Найти(ИсходноеЗначение, КолонкаПоиска);
	
	Если ИсходнаяСтрока = Неопределено Тогда
		РезультатВыбора = ТаблицаВыбора.ВыбратьСтроку(ТекстВыбора);
	Иначе
		РезультатВыбора = ТаблицаВыбора.ВыбратьСтроку(ТекстВыбора, ИсходнаяСтрока);
	КонецЕсли;
	
	Если РезультатВыбора = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	//если показатель входит в состав многострочной части, тогда имя области не будет совпадать с переданным кодом показателя
	//необходимо это учесть
	//считаем, что в многострочной части не может быть показателя, состоящего из нескольких ячеек
	
	Если Область.Имя = КодПоказателя ИЛИ РегламентированнаяОтчетность.роПоказательВходитВМногострочнуюЧасть(ЭтаФорма, КодПоказателя) > 0 Тогда
		Область.Значение = РезультатВыбора[КолонкаПоиска];
	Иначе
		СтрокаРезультатВыбора = Строка(РезультатВыбора[КолонкаПоиска]);
		Для Инд = СтрДлина(СтрокаРезультатВыбора) + 1 По ИндексОбласти - 1 Цикл
			СтрокаРезультатВыбора = " " + РезультатВыбора[КолонкаПоиска];
		КонецЦикла;
		Для Инд = 1 По ИндексОбласти - 1 Цикл
			ТекущийЭлемент.Области[КодПоказателя + Разделитель + Формат(Инд, "ЧГ=")].Значение = СокрЛП(Сред(РезультатВыбора[КолонкаПоиска], Инд, 1));
		КонецЦикла;
	КонецЕсли;
	
	//Изменение связанных данных
	Если Элемент.Имя = "ПолеТабличногоДокументаЛистД" Тогда
		Если КодПоказателя = "П000012001004" 
			ИЛИ КодПоказателя = "П000012001005" 
			ИЛИ КодПоказателя = "П000012001008" Тогда
			
			Стр = Прав(Область.Имя, СтрДлина(Область.Имя) - СтрДлина(КодПоказателя));
			
			Если Элемент.Области["П000012001007" + Стр].Значение = "" Тогда
				Элемент.Области["П000012001007" + Стр].Значение = "405";
			КонецЕсли;
			
			Если КодПоказателя = "П000012001008" Тогда
				Элемент.Области["П000012001007" + Стр].Значение = "405";
			КонецЕсли;
			
			ПоНормативу = Элемент.Области["П000012001007" + Стр].Значение = "405";
			
			Область.Значение = РезультатВыбора.Код;
			Элемент.Области["П000012001004" + Стр].Значение = РезультатВыбора.Код;
			Элемент.Области["П000012001005" + Стр].Значение = РезультатВыбора.Название;
			Элемент.Области["П000012001008" + Стр].Значение = ?(ПоНормативу, РезультатВыбора.Норматив, 0);
			
			
		ИначеЕсли КодПоказателя = "П000012001007" Тогда
			Стр = Прав(Область.Имя, СтрДлина(Область.Имя) - СтрДлина(КодПоказателя));
			ПоНормативу = Элемент.Области["П000012001007" + Стр].Значение = "405";
			Если НЕ ПоНормативу Тогда
				Элемент.Области["П000012001008" + Стр].Значение = 0;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Модифицированность = Истина;
	
	ОбработкаИзмененияСодержимогоВПолеТабличногоДокумента(Элемент, Область);
КонецПроцедуры

Процедура ОкончаниеВводаТекстаВПолеВводаВПолеТабличногоДокумента(Элемент, Текст, Значение, СтандартнаяОбработка)
	
	ИмяТекущейСтраницы = ЭлементыФормы.ОсновнаяПанель.ТекущаяСтраница.Имя;
	Если ЭлементыФормы.Найти("ПолеТабличногоДокумента" + ИмяТекущейСтраницы) <> Неопределено Тогда
		Область = ЭлементыФормы["ПолеТабличногоДокумента" + ИмяТекущейСтраницы].ТекущаяОбласть;
	Иначе
		Возврат;
	КонецЕсли;
		
	ПараметрВводаПоля = СвойстваПоказателей.Найти(Область.Имя, "Показатель");
	Если ПараметрВводаПоля = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ПараметрВводаПоля.Тип = "ОКАТО" И ЗначениеЗаполнено(Текст) Тогда
		ДлинаЗначения = СтрДлина(СокрЛП(Текст));
		Для Инд = ДлинаЗначения+1 По 11 Цикл
			Текст = СокрЛП(Текст) + "0";
		КонецЦикла;
	КонецЕсли;
	
	
	Если СтрДлина(СокрЛП(Текст)) <> 0 И ПараметрВводаПоля.Длина <> 0 И СтрДлина(СокрЛП(Текст)) <> ПараметрВводаПоля.Длина Тогда
		Сообщить("Длина значения показателя должна быть равна " + ПараметрВводаПоля.Длина + "!", СтатусСообщения.Внимание);
		Возврат;
	КонецЕсли;
	
	Элемент.Значение=Текст;
КонецПроцедуры

Процедура ПроставитьНаВсехЛистах(Показатель, Знач ЗначениеПоказателя, Посимвольно = Истина)
	
	// преобразовываем, при необходимости, значение показателя к типу "Строка"
	ТипЗначенияПоказателя = ТипЗнч(ЗначениеПоказателя);
	Если ТипЗначенияПоказателя = Тип("Число") Тогда
		ЗначениеПоказателя = Формат(ЗначениеПоказателя, "ЧГ=");
	ИначеЕсли ТипЗначенияПоказателя = Тип("Дата") Тогда
		ЗначениеПоказателя = Формат(ЗначениеПоказателя, "ДФ=dd.MM.yyyy");
	КонецЕсли;
	
	// проставляем значение в табличные документы
	Для Каждого Раздел Из мСвойстваРазделовДекларации.Строки Цикл
		ТаблДок = ЭлементыФормы["ПолеТабличногоДокумента" + Раздел.ИмяСтраницы];
		Если НЕ Посимвольно Тогда
			Если ТаблДок.Области.Найти(Показатель) <> Неопределено Тогда
				ТаблДок.Области[Показатель].Значение = ЗначениеПоказателя;
			КонецЕсли;
		Иначе
			Для Инд = 1 По СтрДлина(ЗначениеПоказателя) Цикл
				ТекОбласть = ТаблДок.Области.Найти(Показатель + Формат(Инд, "ЧГ="));
				Если ТекОбласть <> Неопределено Тогда
					ТекОбласть.Значение = Сред(ЗначениеПоказателя, Инд, 1);
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;
	КонецЦикла;             
	
	// проставляем значение в многостраничные разделы
	Для Каждого Раздел Из мСтруктураМногостраничныхРазделов Цикл
		СтраницыРаздела = Раздел.Значение;
		ТаблДокРаздела = ЭлементыФормы["ПолеТабличногоДокумента" + Раздел.Ключ];
		Если НЕ Посимвольно Тогда
			Если ТаблДокРаздела.Области.Найти(Показатель) <> Неопределено Тогда
				Для Каждого Стр Из СтраницыРаздела Цикл
					ДанныеСтраницы = Стр.Данные;
					Если ДанныеСтраницы = Неопределено Тогда
						Продолжить;
					КонецЕсли;
					ДанныеСтраницы.Вставить(Показатель, ЗначениеПоказателя);
				КонецЦикла;
			КонецЕсли;
		Иначе
			Для Каждого Стр Из СтраницыРаздела Цикл
				ДанныеСтраницы = Стр.Данные;
				Если ДанныеСтраницы = Неопределено Тогда
					Продолжить;
				КонецЕсли;
				Для Инд = 1 По СтрДлина(ЗначениеПоказателя) Цикл
					Если ТаблДокРаздела.Области.Найти(Показатель + Формат(Инд, "ЧГ=")) <> Неопределено Тогда
						ДанныеСтраницы.Вставить(Показатель + Формат(Инд, "ЧГ="), Сред(ЗначениеПоказателя, Инд, 1));
					КонецЕсли;
				КонецЦикла;
			КонецЦикла;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Функция ОчиститьОтчет(ЗапрашиватьПодтверждение = Истина)
	
	Если ЗапрашиватьПодтверждение Тогда
		Ответ = Вопрос("Внимание! Будут очищены все разделы (листы) отчета." + Символы.ПС + "Продолжить операцию?", РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Нет);
		Если Ответ <> КодВозвратаДиалога.Да Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЕсли;

	// очищаем поля табличных документов (кроме "Титульный")
	Для Каждого СтрокаУровня1 Из мСвойстваРазделовДекларации.Строки Цикл
		Если СтрокаУровня1.ИмяСтраницы <> "Титульный" И СтрокаУровня1.ИмяСтраницы <> "Титульный002" Тогда
			ОчиститьТабличноеПоле(ЭлементыФормы["ПолеТабличногоДокумента" + СтрокаУровня1.ИмяСтраницы]);
		КонецЕсли;
	КонецЦикла;

	// удаляем все страницы, кроме текущих
	Для Каждого Страница Из мСтруктураМногостраничныхРазделов Цикл
		ИмяТекущейСтраницыПанели = Страница.Ключ;
		ТаблицаТекущейСтраницы   = Страница.Значение;
		Если ТаблицаТекущейСтраницы.Количество() > 1 Тогда
			ИндексСтраницы = 0;
			Пока Не (ИндексСтраницы > (ТаблицаТекущейСтраницы.Количество()-1)) Цикл
				СтрокаТаблицы = ТаблицаТекущейСтраницы[ИндексСтраницы];
				Если НЕ СтрокаТаблицы.АктивнаяСтраница Тогда
					ТаблицаТекущейСтраницы.Удалить(СтрокаТаблицы);
					Продолжить;
				КонецЕсли;
				ИндексСтраницы = ИндексСтраницы + 1;
			КонецЦикла;
		КонецЕсли;
		ПанельРаздела = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели, "НазваниеПанелиТабличногоПоляРаздела");
		Если ЭлементыФормы[ПанельРаздела].ТекущаяСтраница.Имя = ИмяТекущейСтраницыПанели Тогда
			РегламентированнаяОтчетность.роПоказатьСтатикСтраницРаздела(ЭтаФорма, ИмяТекущейСтраницыПанели);
		КонецЕсли;
	КонецЦикла;
	
	РегламентированнаяОтчетность.роОбновитьСтруктуруМногостраничныхРазделов(ЭтаФорма);
	РегламентированнаяОтчетность.роОбновитьСтруктуруМногострочныхРазделов(ЭтаФорма);
	ЗаполнитьДатуПодписи();
	Расчет();
	
	Модифицированность = Истина;

	Возврат Истина;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ МЕХАНИЗМА ВЫГРУЗКИ В XML
//

Процедура КоманднаяПанельФормыВыгрузить(Кнопка)
	
	Выгрузить();
	
КонецПроцедуры

Процедура КоманднаяПанельФормыПроверить(Кнопка)
	
	Если Модифицированность Тогда
		Если Вопрос("Перед проверкой отчета требуется сохранить введенную информацию." + Символы.ПС + "Продолжить?",РежимДиалогаВопрос.ДаНет) <> КодВозвратаДиалога.Да ИЛИ НЕ Сохранить() Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	НовыйДок = Документы.ВыгрузкаРегламентированныхОтчетов.СоздатьДокумент();
	СпДокОсн = Новый СписокЗначений;
	СпДокОсн.Добавить(мСохраненныйДок);
 	НовыйДок.ПолучитьФорму(, ЭтаФорма).Проверить(СпДокОсн);
	
КонецПроцедуры

Процедура Выгрузить() Экспорт
	
	Если Модифицированность Тогда
		Если Вопрос("Перед выгрузкой отчета требуется сохранить введенную информацию." + Символы.ПС + "Продолжить?",РежимДиалогаВопрос.ДаНет) <> КодВозвратаДиалога.Да ИЛИ НЕ Сохранить() Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	НовыйДок = Документы.ВыгрузкаРегламентированныхОтчетов.СоздатьДокумент();
	СпДокОсн = Новый СписокЗначений;
	СпДокОсн.Добавить(мСохраненныйДок);
 	Если НовыйДок.ПолучитьФорму(, ЭтаФорма).СформироватьИЗаписать(СпДокОсн) Тогда
		// Сообщить("Отчет успешно выгружен!", СтатусСообщения.Информация);
	КонецЕсли;
	
КонецПроцедуры

Функция ПроверитьПоказатели() Экспорт
	
	СформироватьСтруктуруПоказателей();
	ДеревоВыгрузки = ИзвлечьСтруктуруXML();
	Параметры = СформироватьСтруктуруПараметров();
	Если НЕ ПроверитьВозможностьВыгрузки(Параметры, ДеревоВыгрузки) Тогда
		Возврат Ложь;
	КонецЕсли;
	ЗаполнитьДанными(ДеревоВыгрузки, Параметры);
	Если НЕ ПроверитьДанные(ДеревоВыгрузки) Тогда
		Возврат Ложь;
	КонецЕсли;
	Возврат Истина;
	
КонецФункции
	
Функция УниверсальнаяВыгрузка(ТекстВыгрузки = Неопределено, ПроверятьБлокировки = Истина) Экспорт
	
	Отказ = Ложь;
	РегламентированнаяОтчетность.ПередВыгрузкойРегламентированногоОтчета(ЭтаФорма, Отказ, ПроверятьБлокировки);
	Если Отказ Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Если Модифицированность Тогда
		Если Вопрос("Перед выгрузкой отчета требуется сохранить введенную информацию." + Символы.ПС + "Продолжить?",РежимДиалогаВопрос.ДаНет) <> КодВозвратаДиалога.Да ИЛИ НЕ Сохранить() Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЕсли;
	
	СформироватьСтруктуруПоказателей();
	Параметры = СформироватьСтруктуруПараметров();
	ДеревоВыгрузки = ИзвлечьСтруктуруXML();
	Если НЕ ПроверитьВозможностьВыгрузки(Параметры, ДеревоВыгрузки) Тогда
		Возврат Ложь;
	КонецЕсли;
	ЗаполнитьДанными(ДеревоВыгрузки, Параметры);
	Если НЕ ПроверитьДанные(ДеревоВыгрузки) Тогда
		Возврат Ложь;
	КонецЕсли;
	ТекстВыгрузки = ВыгрузитьДеревоВXML(ДеревоВыгрузки, Параметры);
	Если Открыта() Тогда
		СохранитьФайлВыгрузкиНаДиск(ТекстВыгрузки, Параметры);
	Иначе
		// Сообщить("" + РегламентированнаяОтчетность.ПредставлениеДокументаРеглОтч(мСохраненныйДок) + " успешно выгружен!");
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции

Процедура СохранитьФайлВыгрузкиНаДиск(ТекстXML, Параметры)
	
	ПутьДляВыгрузки = РегламентированнаяОтчетность.ПолучитьПутьВыгрузки(); // получаем каталог для сохранения
	Если ПутьДляВыгрузки <> Ложь Тогда
		ФайлДляВыгрузки = ?(Прав(ПутьДляВыгрузки, 1) = "\", ПутьДляВыгрузки, ПутьДляВыгрузки + "\") + Параметры.ИдФайл + ".xml";
		ЗаписатьТесктНаДиск(ТекстXML, ФайлДляВыгрузки); // записываем XML в файл на диск
	КонецЕсли;
	
КонецПроцедуры

Функция ИзвлечьСтруктуруXML()
	
	ДеревоСтруктуры = Новый ДеревоЗначений;
	ДеревоСтруктуры.Колонки.Добавить("Код");
	ДеревоСтруктуры.Колонки.Добавить("Тип");
	ДеревоСтруктуры.Колонки.Добавить("Формат");
	ДеревоСтруктуры.Колонки.Добавить("МинРазмерность");
	ДеревоСтруктуры.Колонки.Добавить("МаксРазмерность");
	ДеревоСтруктуры.Колонки.Добавить("Обязательность");
	ДеревоСтруктуры.Колонки.Добавить("Многостраничность");
	ДеревоСтруктуры.Колонки.Добавить("Многострочность");
	ДеревоСтруктуры.Колонки.Добавить("Раздел");
	ДеревоСтруктуры.Колонки.Добавить("Ключ");
	ДеревоСтруктуры.Колонки.Добавить("Условие");
	ДеревоСтруктуры.Колонки.Добавить("ЗначениеПоУмолчанию");
	ДеревоСтруктуры.Колонки.Добавить("Значение");
	ДеревоСтруктуры.Колонки.Добавить("Представление");
	ДеревоСтруктуры.Колонки.Добавить("Показатели");
	
	Макет = ПолучитьМакет("СтруктураXML505");
	ВысотаТаблицы = Макет.ВысотаТаблицы;
	
	УчтенныеГруппы = Новый Соответствие;
	
	Для Уровень = 0 По Макет.КоличествоУровнейГруппировокСтрок() - 1 Цикл
		Макет.ПоказатьУровеньГруппировокСтрок(Уровень);
		Для НомерСтроки = 2 По ВысотаТаблицы Цикл
			НомСтр = ВысотаТаблицы - НомерСтроки + 2;
			Если Макет.Область(НомСтр, 0, НомСтр, 0).Видимость И УчтенныеГруппы.Получить(НомСтр) = Неопределено Тогда
				
				РодительскийУзел = ДеревоСтруктуры;
				Если Уровень <> 0 Тогда
					Для Инд = 1 По НомСтр - 2 Цикл
						Узел = УчтенныеГруппы.Получить(НомСтр - Инд);
						Если Узел <> Неопределено Тогда
							РодительскийУзел = Узел;
							Прервать;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
				
				НовСтр = РодительскийУзел.Строки.Вставить(0);
				НовСтр.Код = СокрЛП(Макет.Область(НомСтр, 1, НомСтр, 1).Текст);
				НовСтр.Раздел = СокрЛП(Макет.Область(НомСтр, 2, НомСтр, 2).Текст);
				НовСтр.Ключ = СокрЛП(Макет.Область(НомСтр, 3, НомСтр, 3).Текст);
				НовСтр.Тип = СокрЛП(Макет.Область(НомСтр, 4, НомСтр, 4).Текст);
				НовСтр.Формат = СокрЛП(Макет.Область(НомСтр, 5, НомСтр, 5).Текст);
				МинРазмерность = СокрЛП(Макет.Область(НомСтр, 6, НомСтр, 6).Текст);
				НовСтр.МинРазмерность = ?(ПустаяСтрока(МинРазмерность), ?(НовСтр.Формат = "N", 99999, 0), Число(МинРазмерность));
				МаксРазмерность = СокрЛП(Макет.Область(НомСтр, 7, НомСтр, 7).Текст);
				НовСтр.МаксРазмерность = ?(ПустаяСтрока(МаксРазмерность), 99999, Число(МаксРазмерность));
				НовСтр.Обязательность = СокрЛП(Макет.Область(НомСтр, 8, НомСтр, 8).Текст);
				НовСтр.Многостраничность = НЕ ПустаяСтрока(Макет.Область(НомСтр, 9, НомСтр, 9).Текст);
				НовСтр.Многострочность = НЕ ПустаяСтрока(Макет.Область(НомСтр, 10, НомСтр, 10).Текст);
				НовСтр.Условие = СокрЛП(Макет.Область(НомСтр, 11, НомСтр, 11).Текст);
				НовСтр.ЗначениеПоУмолчанию = СокрЛП(Макет.Область(НомСтр, 12, НомСтр, 12).Текст);
				НовСтр.Представление = СокрЛП(Макет.Область(НомСтр, 13, НомСтр, 13).Текст);
				
				УчтенныеГруппы.Вставить(НомСтр, НовСтр);
				
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
	Возврат ДеревоСтруктуры;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////

Функция СформироватьИдФайл(Параметры)
	
	Если РабочаяДата >= '20081001' Тогда
		Возврат Параметры.ПрефиксИмениФайлаВыгрузки
				+ "_" + Параметры.КодИФНС
				+ "_" + Параметры.КодИФНС
				+ "_" + СокрЛП(Параметры.ИННФЛ)
				+ "_" + Формат(РабочаяДата, "ДФ=ггггММдд")
				+ "_" + Строка(Новый УникальныйИдентификатор);
	Иначе
		Возврат Параметры.ПрефиксИмениФайлаВыгрузки
				+ "_" + Параметры.КодИФНС
				+ Параметры.КодИФНС
				+ "_" + СокрЛП(Параметры.ИННФЛ)
				+ "_" + Формат(РабочаяДата, "ДФ=ггггММдд")
				+ "_" + Строка(Новый УникальныйИдентификатор);
	КонецЕсли;
	
КонецФункции

Функция СформироватьСтруктуруПоказателей()
	
	мДанныеОтчета = Новый Структура;
	
	СохрСтруктура = мСохраненныйДок.ДанныеОтчета.Получить();
	ПоказателиОтчета = СохрСтруктура.ПоказателиОтчета;
	Для Каждого Раздел Из ПоказателиОтчета Цикл
		мДанныеОтчета.Вставить(Сред(Раздел.Ключ, 24), РегламентированнаяОтчетность.СвернутьДанныеТабличногоПоля(Раздел.Значение));
	КонецЦикла;
	мСтруктураМногостраничныхРазделов = СохрСтруктура.ДанныеМногостраничныхРазделов;
	Для Каждого Раздел Из мСтруктураМногостраничныхРазделов Цикл
		ТаблицаЛистовРаздела = Раздел.Значение;
		Для Каждого Лист Из ТаблицаЛистовРаздела Цикл
			Лист.Данные = РегламентированнаяОтчетность.СвернутьДанныеТабличногоПоля(Лист.Данные);
		КонецЦикла;
		мДанныеОтчета.Вставить(Раздел.Ключ, Раздел.Значение);
	КонецЦикла;
	
КонецФункции

Функция СформироватьСтруктуруПараметров()
	
	Титульный = мДанныеОтчета.Титульный;
	Титульный002 = мДанныеОтчета.Титульный002;
	ЛистЛ = мДанныеОтчета.ЛистЛ;
	
	СтрокаСведений = "ИННФЛ, ДатаРожд, ДатаУдЛичн";
	СведенияОбОрганизации = РегламентированнаяОтчетность.ПолучитьСведенияОбОрганизации(Организация, мСохраненныйДок.ДатаПодписи, СтрокаСведений);
	
	Параметры = Новый Структура;
	Параметры.Вставить("ВерсПрог",			РегламентированнаяОтчетность.СформироватьВерсПрог());
	Параметры.Вставить("КНД",				"1151020");
	Параметры.Вставить("ДатаДок",			Формат(РабочаяДата, "ДФ=дд.ММ.гггг"));
	Параметры.Вставить("ГодПериодОтч",		Формат(мСохраненныйДок.ДатаОкончания, "ДФ=гггг"));
	Параметры.Вставить("ПериодОтч",			СокрЛП(Титульный.Период));
	Параметры.Вставить("КодИФНС",			СокрЛП(Титульный.КодИМНС));
	Параметры.Вставить("ВидДок",			Строка(мСохраненныйДок.Вид));
	Параметры.Вставить("ОКАТОФЛ",			СокрЛП(Титульный.ОКАТО));
	Параметры.Вставить("ТелФЛ",				СокрЛП(Титульный.ТелОрганизации));
	Параметры.Вставить("ФамилияФЛ",			СокрЛП(Титульный.Фамилия));
	Параметры.Вставить("ИмяФЛ",				СокрЛП(Титульный.Имя));
	Параметры.Вставить("ОтчествоФЛ",		СокрЛП(Титульный.Отчество));
	
	Параметры.Вставить("КодКатегорииФЛ",	СокрЛП(Титульный.ПоМесту1 + Титульный.ПоМесту2 + Титульный.ПоМесту3));
	Параметры.Вставить("СтатусФЛ",			СокрЛП(Титульный002.СтатусНалогоплательщика));
	Параметры.Вставить("АдресИноФЛ",		СокрЛП(Титульный002.АдресЗаПределамиРФ));
	
	Параметры.Вставить("ПрАдрФЛ",			СокрЛП(Титульный002.МестоЖительства));
	Параметры.Вставить("ИндексФЛ",			СокрЛП(Титульный002.Индекс));
	Параметры.Вставить("РегионФЛ",			СокрЛП(Титульный002.Регион));
	Параметры.Вставить("РайонФЛ",			СокрЛП(Титульный002.Район));
	Параметры.Вставить("ГородФЛ",			СокрЛП(Титульный002.Город));
	Параметры.Вставить("НаселенныйПунктФЛ",	СокрЛП(Титульный002.НаселенныйПункт));
	Параметры.Вставить("УлицаФЛ",			СокрЛП(Титульный002.Улица));
	Параметры.Вставить("ДомФЛ",				СокрЛП(Титульный002.Дом));
	Параметры.Вставить("КорпусФЛ",			СокрЛП(Титульный002.Корпус));
	Параметры.Вставить("КвартираФЛ",		СокрЛП(Титульный002.Квартира));
	
	Параметры.Вставить("ИННФЛ",				СокрЛП(СведенияОбОрганизации.ИННФЛ));
	Параметры.Вставить("ДатаРожденияФЛ",	СокрЛП(СведенияОбОрганизации.ДатаРожд));
	Параметры.Вставить("МестоРожденияФЛ",	СокрЛП(Титульный002.МестоРождения));
	Параметры.Вставить("ГражданствоФЛ",		СокрЛП(Титульный002.Гражданство));
	Параметры.Вставить("СтранаФЛ",			СокрЛП(Титульный002.КодСтраны));
	
	Параметры.Вставить("КодВидДокФЛ",		СокрЛП(Титульный002.КодВидаДокумента));
	Параметры.Вставить("СерНомДокФЛ",		СокрЛП(Титульный002.СерияИНомерДокумента));
	Параметры.Вставить("ДатаДокФЛ",			Формат(СведенияОбОрганизации.ДатаУдЛичн, "ДФ=дд.ММ.гггг"));
	Параметры.Вставить("ВыдДокФЛ",			СокрЛП(Титульный002.КемВыданДокумент)); 	
	
	Параметры.Вставить("ТипПодписанта",			СокрЛП(Титульный.ПрПодп));
	Параметры.Вставить("НаимОргПредставителя", СокрЛП(Титульный.ОргУп));
	Параметры.Вставить("НаимДокПредставителя", СокрЛП(Титульный.ДокУпПред));
	
	ФИОПодписанта = РазложитьФИО(Титульный.ОргПодписант);
	Параметры.Вставить("ФамилияПодписанта",		ФИОПодписанта.Фамилия);
	Параметры.Вставить("ИмяПодписанта",			ФИОПодписанта.Имя);
	Параметры.Вставить("ОтчествоПодписанта",	ФИОПодписанта.Отчество);
	
	Параметры.Вставить("ИмяФайлаСхемы",				"NO_NDFL3_1_033_00_05_05_01.xsd");
	Параметры.Вставить("ПрефиксИмениФайлаВыгрузки",	"NO_NDFL3");
	
	Параметры.Вставить("ИмяКлючевогоУзлаСодержательнойЧасти", "НДФЛ3");
	
	Параметры.Вставить("ИдФайл",		СформироватьИдФайл(Параметры));
	
	Возврат Параметры;
	
КонецФункции

Функция РазложитьФИО(Знач ФИОСтр)
	
	ФИОСтр = СокрЛП(ФИОСтр);
	ФИО = Новый Структура("Фамилия, Имя, Отчество", "", "", "");
	
	ПервыйПробел = Найти(ФИОСтр, " ");
	Если ПервыйПробел = 0 Тогда
		ФИО.Фамилия = ФИОСтр;
		Возврат ФИО;
	КонецЕсли;
	ФИО.Фамилия = СокрЛП(Лев(ФИОСтр, ПервыйПробел - 1));
	ФИОСтр = СокрЛП(Сред(ФИОСтр, ПервыйПробел + 1));
	
	ВторойПробел = Найти(ФИОСтр, " ");
	Если ВторойПробел = 0 Тогда
		ФИО.Имя = ФИОСтр;
		Возврат ФИО;
	КонецЕсли;
	ФИО.Имя = СокрЛП(Лев(ФИОСтр, ВторойПробел - 1));
	
	ФИО.Отчество = СокрЛП(Сред(ФиоСтр, ВторойПробел + 1));
	
	Возврат ФИО;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////

Функция ПолучитьВыгружаемыеПоказателиРаздела(Узел, Раздел, МассивРезультат = Неопределено)
	
	ТипУзла = ТипЗнч(Узел);
	Если ТипУзла = Тип("ДеревоЗначений") Тогда
		МассивРезультат = Новый Массив;
	ИначеЕсли СокрЛП(Узел.Раздел) = СокрЛП(Раздел) Тогда
		МассивРезультат.Добавить(Узел);
	КонецЕсли;
	
	Для Каждого Стр Из Узел.Строки Цикл
		ВыгружаемыеПоказателиРаздела = ПолучитьВыгружаемыеПоказателиРаздела(Стр, Раздел, МассивРезультат);
	КонецЦикла;
	
	Если ТипУзла = Тип("ДеревоЗначений") Тогда
		Возврат МассивРезультат;
	КонецЕсли;
	
КонецФункции

Функция ПолучитьПоказателиРаздела(ДеревоВыгрузки, Раздел)
	
	ПоказателиРаздела = ДеревоВыгрузки.Строки.НайтиСтроки(Новый Структура("Раздел", Раздел), Истина);
	КоличествоСтрокРаздела = ПоказателиРаздела.Количество();
	Для ОбрИнд = 1 По КоличествоСтрокРаздела Цикл
		Инд = КоличествоСтрокРаздела - ОбрИнд;
		ТекСтр = ПоказателиРаздела[Инд];
		Если НЕ ЗначениеЗаполнено(ТекСтр.Ключ) Тогда
			ПоказателиРаздела.Удалить(Инд);
		КонецЕсли;
	КонецЦикла;
	
	Возврат ПоказателиРаздела;
	
КонецФункции

Функция ПоказательЗаполнен(Показатель, Значение)
	
	Возврат ЗначениеЗаполнено(Значение) И НЕ (СокрЛП(Показатель.Формат) = "N" И Показатель.МаксРазмерность = 15 И ТипЗнч(Значение) = Тип("Число") И Окр(Значение) = 0);
	
КонецФункции

Функция СтраницаПуста(ДанныеСтраницы, Показатели, ДеревоВыгрузки = Неопределено)
	
	Если ТипЗнч(Показатели) = Тип("Строка") Тогда
		ПоказателиРаздела = ПолучитьПоказателиРаздела(ДеревоВыгрузки, Показатели);
	Иначе
		ПоказателиРаздела = Показатели;
	КонецЕсли;
	
	ПоказателиНеанализируемыеНаЗаполненность = Новый Массив;
//	ПоказателиНеанализируемыеНаЗаполненность.Добавить("П002000014003");
	
	Для Каждого Пок Из ПоказателиРаздела Цикл
		Если ПоказателиНеанализируемыеНаЗаполненность.Найти(Пок.Ключ) <> Неопределено Тогда
			Продолжить;
		КонецЕсли;
		Если Пок.Многострочность Тогда
			ИндексСтроки = 1;
			ЗначениеПоказателя = Неопределено;
			Пока ДанныеСтраницы.Свойство(Пок.Ключ + "_" + Формат(ИндексСтроки, "ЧГ="), ЗначениеПоказателя) Цикл
				Если ПоказательЗаполнен(Пок, ЗначениеПоказателя) Тогда
					Возврат Ложь;
				КонецЕсли;
				ИндексСтроки = ИндексСтроки + 1;
			КонецЦикла;
		Иначе
			Если ПоказательЗаполнен(Пок, ДанныеСтраницы[Пок.Ключ]) Тогда
				Возврат Ложь;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	Возврат Истина;
	
КонецФункции

Функция РазделПуст(ДеревоВыгрузки, Раздел)
	
	ПоказателиРаздела = ПолучитьПоказателиРаздела(ДеревоВыгрузки, Раздел);
	
	ДанныеРаздела = мДанныеОтчета[Раздел];
	РазделПуст = Истина;
	Если ТипЗнч(ДанныеРаздела) = Тип("ТаблицаЗначений") Тогда
		Для Каждого Стр Из ДанныеРаздела Цикл
			Если НЕ СтраницаПуста(Стр.Данные, ПоказателиРаздела) Тогда
				Возврат Ложь;
			КонецЕсли;
		КонецЦикла;
	Иначе
		Если НЕ СтраницаПуста(ДанныеРаздела, ПоказателиРаздела) Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции

Функция ПроверитьРазделыНаНаличиеИнформации(ДеревоВыгрузки, парамРазделы)
	
	Разделы = Новый Массив;
	Если ТипЗнч(парамРазделы) = Тип("Строка") Тогда
		Если Найти(парамРазделы, ",") <> 0 Тогда
			СтрРазделы = Новый Структура(парамРазделы);
			Для Каждого Эл Из СтрРазделы Цикл
				Разделы.Добавить(Эл.Ключ);
			КонецЦикла;
		Иначе
			Разделы.Добавить(парамРазделы);
		КонецЕсли;
	КонецЕсли;
	
	РазделыПусты = Истина;
	Для Каждого Раздел Из Разделы Цикл
		Если НЕ РазделПуст(ДеревоВыгрузки, Раздел) Тогда
			РазделыПусты = Ложь;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	Возврат НЕ РазделыПусты;
	
КонецФункции

Функция ПроверитьВозможностьВыгрузки(Параметры, ДеревоВыгрузки)
	
	СтатусПроверки = Истина;
	
	// проверка на незаполненный отчет
	Если НЕ ПроверитьРазделыНаНаличиеИнформации(ДеревоВыгрузки, "Раздел1, Раздел2, Раздел3, Раздел4, Раздел5, Раздел6") Тогда
		РегламентированнаяОтчетность.роСообщитьВТаблицуСообщений(ЭтаФорма, "Должен быть заполнен, как минимум, один из следующих разделов: ""Раздел 1"", ""Раздел 2"", ""Раздел 3"", ""Раздел 4"", ""Раздел 5"" или ""Раздел 6"".", "Титульный", "КодИМНС1");
		СтатусПроверки = Ложь;
		Возврат СтатусПроверки;
	КонецЕсли;
	
//	
	Возврат СтатусПроверки;
	
КонецФункции

Функция СкопироватьУзел(Родитель, Узел)
	
	// находим узел с максимальным индексом и с тем же кодом, что и у копируемого, и добавляем новый сразу после найденного
	СтрокиСТемЖеКодом = Родитель.Строки.НайтиСтроки(Новый Структура("Код", Узел.Код), Ложь);
	МаксИндекс = -1;
	Для Каждого СтрокаСТемЖеКодом Из СтрокиСТемЖеКодом Цикл
		ТекИндекс = Родитель.Строки.Индекс(СтрокаСТемЖеКодом);
		Если ТекИндекс > МаксИндекс Тогда
			МаксИндекс = ТекИндекс;
		КонецЕсли;
	КонецЦикла;
	
	ИндексСоздаваемогоУзла = МаксИндекс + 1;
	Если ИндексСоздаваемогоУзла >= Родитель.Строки.Количество() ИЛИ ИндексСоздаваемогоУзла = 0 Тогда // если аналогичный узел не найден или найденный узел - последний
		НовыйУзел = Родитель.Строки.Добавить();
	Иначе
		НовыйУзел = Родитель.Строки.Вставить(ИндексСоздаваемогоУзла);
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(НовыйУзел, Узел, , "Родитель, Строки");
	Для Каждого Стр из Узел.Строки Цикл
		СкопироватьУзел(НовыйУзел, Стр);
	КонецЦикла;
	Возврат НовыйУзел;
	
КонецФункции

Функция ПолучитьПодчиненныйЭлемент(Узел, КодЭлемента)
	
	ЧислоВместоКодаЭлемента = (ТипЗнч(КодЭлемента) = Тип("Число"));
	Если ТипЗнч(КодЭлемента) = Тип("Число") Тогда
		Если Узел.Строки.Количество() > КодЭлемента Тогда
			Возврат Узел.Строки.Получить(КодЭлемента);
		Иначе
			Возврат Неопределено;
		КонецЕсли;
	Иначе
		Для Каждого Стр Из Узел.Строки Цикл
			Если Стр.Код = КодЭлемента Тогда
				Возврат Стр;
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецФункции

Процедура ЗаполнитьСодержательнуюЧасть(УзелРодитель)

	// заполнение основного раздела
	ИтогУплВозв = ПолучитьПодчиненныйЭлемент(УзелРодитель, "ИтогУплВозв");
	СведДохВыч = ПолучитьПодчиненныйЭлемент(ИтогУплВозв, "СведДохВыч");	

	// заполнение Раздела 1
	Если НЕ СтраницаПуста(мДанныеОтчета.Раздел1, "Раздел1", ИтогУплВозв.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.Раздел1, ПолучитьПодчиненныйЭлемент(ИтогУплВозв, "НалБаза13"));
	КонецЕсли;

	// заполнение Раздела 2
	Если НЕ СтраницаПуста(мДанныеОтчета.Раздел2, "Раздел2", ИтогУплВозв.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.Раздел2, ПолучитьПодчиненныйЭлемент(ИтогУплВозв, "НалБаза30"));
	КонецЕсли;

	// заполнение Раздела 3
	Если НЕ СтраницаПуста(мДанныеОтчета.Раздел3, "Раздел3", ИтогУплВозв.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.Раздел3, ПолучитьПодчиненныйЭлемент(ИтогУплВозв, "НалБаза35"));
	КонецЕсли;

	// заполнение Раздела 4
	Если НЕ СтраницаПуста(мДанныеОтчета.Раздел4, "Раздел4", ИтогУплВозв.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.Раздел4, ПолучитьПодчиненныйЭлемент(ИтогУплВозв, "НалБаза9"));
	КонецЕсли;
	
	// заполнение Раздела 5
	Если НЕ СтраницаПуста(мДанныеОтчета.Раздел5, "Раздел5", ИтогУплВозв.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.Раздел5, ПолучитьПодчиненныйЭлемент(ИтогУплВозв, "НалБаза15"));
	КонецЕсли;
	
	// заполнение Сведений о доходах
	СведДохВыч = ПолучитьПодчиненныйЭлемент(ИтогУплВозв, "СведДохВыч");
	
	// заполнение Листа А
	ДоходИстРФ = ПолучитьПодчиненныйЭлемент(СведДохВыч, "ДоходИстРФ");
	ДанныеЛистаА = мДанныеОтчета.ЛистА;
	Для Каждого Стр Из ДанныеЛистаА Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистА", ДоходИстРФ.Владелец()) Тогда
			ЭкзДоходИстРФ = СкопироватьУзел(СведДохВыч, ДоходИстРФ);
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзДоходИстРФ);
		КонецЕсли;
	КонецЦикла;
	
	// заполнение Листа Б
	ДоходИстИно = ПолучитьПодчиненныйЭлемент(СведДохВыч, "ДоходИстИно");
	ДанныеЛистаБ = мДанныеОтчета.ЛистБ;
	Для Каждого Стр Из ДанныеЛистаБ Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистБ", ДоходИстИно.Владелец()) Тогда
			ЭкзДоходИстИно = СкопироватьУзел(СведДохВыч, ДоходИстИно);
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзДоходИстИно);
		КонецЕсли;
	КонецЦикла;
	
	// заполнение Листа В
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистВ, "ЛистВ", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистВ, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ДоходПредпр"));
	КонецЕсли;
	
	// заполнение Листа Г1
	ДоходОсвПрев = ПолучитьПодчиненныйЭлемент(СведДохВыч, "ДоходОсвПрев");	
	ДанныеЛистаГ1 = мДанныеОтчета.ЛистГ1;
	Если НЕ СтраницаПуста(ДанныеЛистаГ1, "ЛистГ1", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(ДанныеЛистаГ1, ДоходОсвПрев);
	КонецЕсли;
	
	ДохОплСХ = ПолучитьПодчиненныйЭлемент(ДоходОсвПрев, "ДохОплСХ");
	ДанныеЛистаГ1Продолжение = мДанныеОтчета.ЛистГ1Продолжение;	
	Для Каждого Стр Из ДанныеЛистаГ1Продолжение Цикл		
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистГ1Продолжение", ДоходОсвПрев.Владелец()) Тогда
			ЭкзДохОплСХ = СкопироватьУзел(ДоходОсвПрев, ДохОплСХ);			
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзДохОплСХ);			
		КонецЕсли;
	КонецЦикла;
	
	
	// заполнение Листа Г2
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистГ2, "ЛистГ2", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистГ2, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ДоходИгрПриз"));
	КонецЕсли;
	
	// заполнение Листа Г3
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистГ3, "ЛистГ3", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистГ3, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ДоходМатВыг"));
	КонецЕсли;
	
	// заполнение Листа Д
	ВычВозн = ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычВозн");
	ДанныеЛистаД = мДанныеОтчета.ЛистД;
	Для Каждого Стр Из ДанныеЛистаД Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистД", ВычВозн.Владелец()) Тогда
			ЭкзВычВозн = СкопироватьУзел(СведДохВыч, ВычВозн);
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзВычВозн);
		КонецЕсли;
	КонецЦикла;
	
	// заполнение Листа Е
	ВычДоговорГПХ = ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычДоговорГПХ");
	ДанныеЛистаЕ = мДанныеОтчета.ЛистЕ;
	Для Каждого Стр Из ДанныеЛистаЕ Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистЕ", ВычДоговорГПХ.Владелец()) Тогда
			ЭкзВычДоговорГПХ = СкопироватьУзел(СведДохВыч, ВычДоговорГПХ);
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзВычДоговорГПХ);
		КонецЕсли;
	КонецЦикла;
	
	// заполнение Листа Ж1
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистЖ1, "ЛистЖ1", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистЖ1, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычПродИмущ"));
	КонецЕсли;
	
	// заполнение Листа Ж2
	ВычИмущПрав = ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычИмущПрав");
	ДанныеЛистаЖ2 = мДанныеОтчета.ЛистЖ2;
	Для Каждого Стр Из ДанныеЛистаЖ2 Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистЖ2", ВычИмущПрав.Владелец()) Тогда
			ЭкзВычИмущПрав = СкопироватьУзел(СведДохВыч, ВычИмущПрав);
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзВычИмущПрав);
		КонецЕсли;
	КонецЦикла;
	
	// заполнение Листа З
	НалБазОперЦБ = ПолучитьПодчиненныйЭлемент(СведДохВыч, "НалБазОперЦБ");	
	ДанныеЛистаЗ = мДанныеОтчета.ЛистЗ;
	ДанныеЛистаЗПродолжение = мДанныеОтчета.ЛистЗПродолжение;
	Для Каждого Стр Из ДанныеЛистаЗ Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистЗ", НалБазОперЦБ.Владелец()) Тогда
			ЭкзНалБазОперЦБ = СкопироватьУзел(СведДохВыч, НалБазОперЦБ);			
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзНалБазОперЦБ);
			Ключ = Строка(Стр.Данные.П000016000101);
			Для Каждого ДопСтр Из ДанныеЛистаЗПродолжение Цикл				
				ДопКлюч = Строка(ДопСтр.Данные.П000017000101);
				Если  ДопКлюч = Ключ Тогда
					РезОперИт = ПолучитьПодчиненныйЭлемент(ЭкзНалБазОперЦБ, "РезОперИт");	
					ЗаполнитьДаннымиУзел(ДопСтр.Данные, РезОперИт);
					Прервать;
				КонецЕсли;
			КонецЦикла;			
			//Установим признак принудительно
			ЭкзНалБазОперЦБ.Строки[0].Значение = Ключ;
		КонецЕсли;
	КонецЦикла;

	// заполнение Листа И
	НалБазОперЦБДУ = ПолучитьПодчиненныйЭлемент(СведДохВыч, "НалБазОперЦБДУ");
	ДанныеЛистаИ = мДанныеОтчета.ЛистИ;
	ДанныеЛистаИПродолжение = мДанныеОтчета.ЛистИПродолжение;
	Для Каждого Стр Из ДанныеЛистаИ Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "ЛистИ", НалБазОперЦБДУ.Владелец()) Тогда
			ЭкзНалБазОперЦБДУ = СкопироватьУзел(СведДохВыч, НалБазОперЦБДУ);			
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзНалБазОперЦБДУ);
			Ключ = Строка(Стр.Данные.П000018000101);
			Для Каждого ДопСтр Из ДанныеЛистаИПродолжение Цикл
				ДопКлюч = Строка(ДопСтр.Данные.П000019000101);
				Если ДопКлюч = Ключ Тогда
					РезОперИт = ПолучитьПодчиненныйЭлемент(ЭкзНалБазОперЦБДУ, "РезОперИт");	
					ЗаполнитьДаннымиУзел(ДопСтр.Данные, РезОперИт);
					Прервать;
				КонецЕсли;
			КонецЦикла;			
			//Установим признак принудительно
			ЭкзНалБазОперЦБДУ.Строки[0].Значение = Ключ;
		КонецЕсли;
	КонецЦикла;
	
	// заполнение Листа К1
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистК1, "ЛистК1", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистК1, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычСтанд"));
	КонецЕсли;
	
	// заполнение Листа К2
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистК2, "ЛистК2", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистК2, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычСоциал"));
	КонецЕсли;
	
	// заполнение Листа К3
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистК3, "ЛистК3", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистК3, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычДогДПС"));
	КонецЕсли;
	
	// заполнение Листа К4
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистК4, "ЛистК4", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистК4, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычДогНПО"));
	КонецЕсли;
	
	// заполнение Листа Л
	Если НЕ СтраницаПуста(мДанныеОтчета.ЛистЛ, "ЛистЛ", СведДохВыч.Владелец()) Тогда
		ЗаполнитьДаннымиУзел(мДанныеОтчета.ЛистЛ, ПолучитьПодчиненныйЭлемент(СведДохВыч, "ВычИмущНовМ"));
	КонецЕсли;
	
	// заполнение Раздела 6
	ПодлУплВозв = ПолучитьПодчиненныйЭлемент(УзелРодитель, "ПодлУплВозв");
	ДанныеРаздела6 = мДанныеОтчета.Раздел6;
	Для Каждого Стр Из ДанныеРаздела6 Цикл
		Если НЕ СтраницаПуста(Стр.Данные, "Раздел6", УзелРодитель.Владелец()) Тогда
			ЭкзПодлУплВозв = СкопироватьУзел(УзелРодитель, ПодлУплВозв);
			ЗаполнитьДаннымиУзел(Стр.Данные, ЭкзПодлУплВозв);
		КонецЕсли;
	КонецЦикла;

	
КонецПроцедуры

Процедура ЗаполнитьДанными(ДеревоВыгрузки, Параметры)
	
	ОбработатьУсловныеЭлементы(Параметры, ДеревоВыгрузки); // формируем точную структуру XML-макета
	ЗаполнитьДаннымиУзел(Параметры, ДеревоВыгрузки); // заполняем дерево данными
	ОтсечьНезаполненныеНеобязательныеУзлы(ДеревоВыгрузки);
		
КонецПроцедуры

Функция ИмеютсяАналогичныеСоседниеУзлы(Стр)
	
	Возврат (Стр.Родитель.Строки.НайтиСтроки(Новый Структура("Ключ, Раздел", Стр.Ключ, Стр.Раздел), Ложь).Количество() > 1);
	
КонецФункции

Процедура УдалитьУзел(Узел)
	
	РодительУзла = ?(Узел.Родитель = Неопределено, Узел.Владелец(), Узел.Родитель);
	РодительУзла.Строки.Удалить(Узел);
	
КонецПроцедуры

Процедура ОтсечьНезаполненныеНеобязательныеУзлы(Узел)
	
	КоличествоСтрок = Узел.Строки.Количество();
	Для Инд = 1 По КоличествоСтрок Цикл
		Стр = Узел.Строки.Получить(КоличествоСтрок - Инд);
		ОтсечьНезаполненныеНеобязательныеУзлы(Стр);
	КонецЦикла;
	
	Если ТипЗнч(Узел) <> Тип("ДеревоЗначений") Тогда
		Если (Найти(Узел.Обязательность, "Н") <> 0 ИЛИ Найти(Узел.Обязательность, "H") <> 0) И УзелПуст(Узел) Тогда // учтем оба варианта: кириллицу и латиницу
			УдалитьУзел(Узел);
		ИначеЕсли (Найти(Узел.Обязательность, "М") <> 0 ИЛИ Найти(Узел.Обязательность, "M") <> 0) // учтем оба варианта: кириллицу и латиницу
		И УзелПуст(Узел)
		И ?(Найти(Узел.Обязательность, "О") <> 0 ИЛИ Найти(Узел.Обязательность, "O") <> 0, ИмеютсяАналогичныеСоседниеУзлы(Узел), Истина) Тогда
			УдалитьУзел(Узел);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Функция УзелПуст(Узел, ПоказателиНеанализируемыеНаЗаполненность = Неопределено)
	
	ПустойУзел = ?(	Узел.Формат = "N",
				Узел.Значение = "0" ИЛИ (НЕ ЗначениеЗаполнено(Узел.Значение)),
				НЕ ЗначениеЗаполнено(Узел.Значение));
	Для Каждого Стр из Узел.Строки Цикл
		Если НЕ УзелПуст(Стр) Тогда
			Возврат Ложь;
		КонецЕсли;
	КонецЦикла;
	Возврат ПустойУзел;
	
КонецФункции

Функция УсловиеВыполнено(Параметры, Условие)
	
	Попытка
		РезультатВычисленияВыражения = Вычислить(СтрЗаменить(Условие, "&", "Параметры."));
		Если ТипЗнч(РезультатВычисленияВыражения) <> Тип("Булево") Тогда
			РегламентированнаяОтчетность.роСообщитьВТаблицуСообщений(ЭтаФорма, "Не удалось вычислить выражение-условие: """ + Условие + """!", "Титульный", "");
		КонецЕсли;
		Возврат НЕ (РезультатВычисленияВыражения = Ложь);
	Исключение
		РегламентированнаяОтчетность.роСообщитьВТаблицуСообщений(ЭтаФорма, "Не удалось вычислить выражение-условие: """ + Условие + """!", "Титульный", "");
		Возврат Истина;
	КонецПопытки;
	
КонецФункции

Функция СвойствоОпределено(Объект, ИмяСвойства)
	
	ГУИД = Новый УникальныйИдентификатор;
	ВремСтрукт = Новый Структура(ИмяСвойства, ГУИД);
	ЗаполнитьЗначенияСвойств(ВремСтрукт, Объект);
	Возврат (ВремСтрукт[ИмяСвойства] <> ГУИД);
	
КонецФункции

Процедура ДополнитьСтруктуруПараметров(Параметры, Узел)
	
	Если НЕ ПустаяСтрока(Узел.Раздел) Тогда
		Если СвойствоОпределено(мДанныеОтчета, Узел.Раздел) Тогда
			ПоказателиРаздела = мДанныеОтчета[Узел.Раздел];
			Для Каждого Эл Из ПоказателиРаздела Цикл
				Параметры.Вставить(Эл.Ключ, Эл.Значение);
			КонецЦикла;
		Иначе
			ПоказателиРаздела = мДанныеОтчета[Узел.Раздел];
			Для Каждого Эл Из ПоказателиРаздела Цикл
				Параметры.Вставить(Эл.Ключ, Эл.Значение);
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработатьУсловныеЭлементы(Знач Параметры, Узел)
	
	Если ТипЗнч(Узел) <> Тип("ДеревоЗначений") Тогда
		Если Узел.Код = Параметры.ИмяКлючевогоУзлаСодержательнойЧасти Тогда // !!!
			Возврат;
		КонецЕсли;
		ДополнитьСтруктуруПараметров(Параметры, Узел);
	КонецЕсли;
	КоличествоСтрок = Узел.Строки.Количество();
	Для Инд = 1 По КоличествоСтрок Цикл
		ТекСтр = Узел.Строки.Получить(КоличествоСтрок - Инд);
		Если НЕ ПустаяСтрока(ТекСтр.Условие) Тогда
			Если НЕ УсловиеВыполнено(Параметры, ТекСтр.Условие) Тогда
				Узел.Строки.Удалить(ТекСтр);
				Продолжить;
			КонецЕсли;
		КонецЕсли;
		ОбработатьУсловныеЭлементы(Параметры, ТекСтр);
	КонецЦикла;
	
КонецПроцедуры

Функция ВывестиПоказательВXML(Узел, ЗначениеПоказателя)
	
	МинШирина = Узел.МинРазмерность;
	МаксШирина = Узел.МаксРазмерность;
	
	Если Узел.Формат = "T" ИЛИ Узел.Формат = "Т" Тогда // учтем оба варианта: кириллицу и латиницу
		Если ЗначениеЗаполнено(ЗначениеПоказателя) Тогда
			Узел.Значение = ?(МаксШирина < СтрДлина(СокрЛП(ЗначениеПоказателя)), СокрЛП(Лев(СокрЛП(ЗначениеПоказателя), МаксШирина)), СокрЛП(ЗначениеПоказателя));
		Иначе
			Узел.Значение = Неопределено;
		КонецЕсли;
	ИначеЕсли Узел.Формат = "N" Тогда
		СтрокаФормата = "ЧРД=.;ЧН=0;ЧГ=;";
		Если Узел.МаксРазмерность <> 0 И Узел.МаксРазмерность <> 99999 Тогда
			СтрокаФормата = СтрокаФормата + "ЧЦ=" + Формат(Узел.МаксРазмерность, "ЧГ=") + ";";
		КонецЕсли;
		Если Узел.МинРазмерность <> 99999 Тогда
			СтрокаФормата = СтрокаФормата + "ЧДЦ=" + Формат(Узел.МинРазмерность, "ЧГ=") + ";";
		КонецЕсли;
		Узел.Значение = СокрЛП(Формат(ЗначениеПоказателя, СтрокаФормата));
	ИначеЕсли Узел.Формат = "gYear" Тогда
		Если ТипЗнч(ЗначениеПоказателя) = Тип("Дата") Тогда
			Если ЗначениеЗаполнено(ЗначениеПоказателя) Тогда
				Узел.Значение = СокрЛП(Формат(ЗначениеПоказателя, "ДФ=гггг"));
			Иначе
				Узел.Значение = Неопределено;
			КонецЕсли;
		Иначе
			Узел.Значение = Прав(СокрЛП(ЗначениеПоказателя), 4);
		КонецЕсли;
	КонецЕсли;
	
КонецФункции

Функция ПолучитьПервыйПодчиненныйУзелСЗаполненнымКлючом(Родитель)
	
	Для Каждого Стр из Родитель.Строки Цикл
		Если ЗначениеЗаполнено(Стр.Ключ) Тогда
			Возврат Стр;
		КонецЕсли;
	КонецЦикла;
	Возврат Неопределено;
	
КонецФункции

Процедура ЗаполнитьДаннымиУзел(Параметры, Узел, НомерСтроки = Неопределено)
	
	СтрокиУзла = Новый Массив;
	Для Каждого Стр Из Узел.Строки Цикл
		СтрокиУзла.Добавить(Стр);
	КонецЦикла;
	
	Для Каждого Стр из СтрокиУзла Цикл
		Если Стр.Тип = "С" ИЛИ Стр.Тип = "C" Тогда // учтем оба варианта: кириллицу и латиницу
			Если СвойствоОпределено(Параметры, "ИмяКлючевогоУзлаСодержательнойЧасти") И Стр.Код = Параметры.ИмяКлючевогоУзлаСодержательнойЧасти Тогда // !!!
				ЗаполнитьСодержательнуюЧасть(Стр);
			ИначеЕсли Стр.Многострочность Тогда
				//Особенность декларации, многострочные подузлы для вывода сведений об организациях-источниках
				//
				Если Стр.Код = "ИстЮЛ" ИЛИ Стр.Код = "ИстФЛИн" ИЛИ Стр.Код = "СведИст" 
					ИЛИ Стр.Код = "СвОрг" ИЛИ Стр.Код = "СвФЛ" Тогда
					Если Стр.Родитель.Многострочность Тогда
						Если УсловиеЮр_Физ(Параметры, Стр, НомерСтроки) Тогда
							ЗаполнитьДаннымиУзел(Параметры, Стр, НомерСтроки);
						КонецЕсли;
						Продолжить;
					КонецЕсли;
				КонецЕсли;
				НомСтр = 1;
				ПодчиненныйЭлемент = ПолучитьПервыйПодчиненныйУзелСЗаполненнымКлючом(Стр);
				КлючПодчиненногоЭлемента = ПодчиненныйЭлемент.Ключ;
				Пока СвойствоОпределено(Параметры, КлючПодчиненногоЭлемента + "_" + Формат(НомСтр, "ЧГ=")) Цикл
					Если Стр.Раздел = "ЛистГ1Продолжение" И НомСтр = 1 Тогда
						УзелСоответствующийСтроке = ПолучитьПодчиненныйЭлемент(Узел, "СумДохМес");
					Иначе
						УзелСоответствующийСтроке = СкопироватьУзел(Узел, Стр);
					КонецЕсли;
					ЗаполнитьДаннымиУзел(Параметры, УзелСоответствующийСтроке, НомСтр);
					НомСтр = НомСтр + 1;
				КонецЦикла;
			Иначе
				
				Если Стр.Код = "ИстЮЛ" ИЛИ Стр.Код = "ИстФЛИн" ИЛИ Стр.Код = "СведИст" 
					ИЛИ Стр.Код = "СвОрг" ИЛИ Стр.Код = "СвФЛ" Тогда
					Если УсловиеЮр_Физ(Параметры, Стр, НомерСтроки) Тогда
						ЗаполнитьДаннымиУзел(Параметры, Стр, НомерСтроки);
					КонецЕсли;
				Иначе
					ЗаполнитьДаннымиУзел(Параметры, Стр, НомерСтроки);
				КонецЕсли;
				
			КонецЕсли;
		Иначе
			Если ПустаяСтрока(Стр.ЗначениеПоУмолчанию) Тогда
				Если НЕ ПустаяСтрока(Стр.Ключ) Тогда
					ПолныйКодПоказателя = Стр.Ключ + ?(ЗначениеЗаполнено(НомерСтроки), "_" + Формат(НомерСтроки, "ЧГ="), "");
					ЗначениеПоказателя = Неопределено;
					Если Параметры.Свойство(ПолныйКодПоказателя, ЗначениеПоказателя) Тогда
						ВывестиПоказательВXML(Стр, ЗначениеПоказателя);
					Иначе
						ВывестиПоказательВXML(Стр, "");
					КонецЕсли;
				Иначе
					Стр.Значение = "";
				КонецЕсли;
			ИначеЕсли Лев(Стр.ЗначениеПоУмолчанию, 1) = "&" Тогда
				ВывестиПоказательВXML(Стр, Параметры[Сред(Стр.ЗначениеПоУмолчанию, 2)]);
			Иначе
				Стр.Значение = Стр.ЗначениеПоУмолчанию;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Функция УсловиеЮр_Физ(Параметры, Узел, НомерСтроки = Неопределено)
	
	//проверка на длину ИНН для заполнения соответствующей ветки
	Результат = Ложь;
	ЗначениеПоказателя = Неопределено;
	Если Узел.Код = "ИстЮЛ" ИЛИ Узел.Код = "СведИст" ИЛИ Узел.Код = "СвОрг" Тогда
		КлючПодчиненногоЭлемента = Узел.Строки.Найти("ИННЮЛ").Ключ;
		ПолныйКодПоказателя = КлючПодчиненногоЭлемента + ?(ЗначениеЗаполнено(НомерСтроки), "_" + Формат(НомерСтроки, "ЧГ="), "");
		Если Параметры.Свойство(ПолныйКодПоказателя, ЗначениеПоказателя) Тогда
			Если СтрДлина(СокрЛП(ЗначениеПоказателя)) > 10 Тогда
				УдалитьУзел(Узел);
				Результат = Ложь;
			Иначе
				Результат = Истина;
			КонецЕсли;
		КонецЕсли;
	ИначеЕсли Узел.Код = "ИстФЛИн" ИЛИ Узел.Код = "СвФЛ" Тогда
		КлючПодчиненногоЭлемента = Узел.Строки.Найти("ИННФЛ").Ключ;
		ПолныйКодПоказателя = КлючПодчиненногоЭлемента + ?(ЗначениеЗаполнено(НомерСтроки), "_" + Формат(НомерСтроки, "ЧГ="), "");
		Если Параметры.Свойство(ПолныйКодПоказателя, ЗначениеПоказателя) Тогда
			Если СтрДлина(СокрЛП(ЗначениеПоказателя)) <= 10 Тогда
				УдалитьУзел(Узел);
				Результат = Ложь;
			Иначе
				Результат = Истина;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

Функция ЗначениеСоответствуетФормату(Стр)
	
	СтатусПроверки = Истина;
	Если Стр.Формат = "Т" ИЛИ Стр.Формат = "T" Тогда // учтем оба варианта: кириллицу и латиницу
		ДлинаЗначения = СтрДлина(Стр.Значение);
		Если ДлинаЗначения < Стр.МинРазмерность Тогда
			СтатусПроверки = Ложь;
			РегламентированнаяОтчетность.роСообщитьВТаблицуСообщений(ЭтаФорма, "Длина значения показателя """ + ПредставлениеПоказателя(Стр) + """ меньше минимально возможной (" + ДлинаЗначения + " < " + Стр.МинРазмерность + ")", "Титульный", "");
		КонецЕсли;
		Если ДлинаЗначения > Стр.МаксРазмерность Тогда
			СтатусПроверки = Ложь;
			РегламентированнаяОтчетность.роСообщитьВТаблицуСообщений(ЭтаФорма, "Длина значения показателя """ + ПредставлениеПоказателя(Стр) + """ больше максимально возможной (" + ДлинаЗначения + " > " + Стр.МаксРазмерность + ")", "Титульный", "");
		КонецЕсли;
	КонецЕсли;
	Возврат СтатусПроверки;
	
КонецФункции

Функция ПредставлениеПоказателя(Стр)
	
	Возврат ?(ПустаяСтрока(Стр.Представление), Стр.Код, Стр.Представление);
	
КонецФункции

Функция ПроверитьДанные(Узел)
	
	СтатусПроверки = Истина;
	Если ТипЗнч(Узел) <> Тип("ДеревоЗначений") Тогда
		Если НЕ ЗначениеСоответствуетФормату(Узел) Тогда
			СтатусПроверки = Ложь;
		КонецЕсли;
	КонецЕсли;
	Для Каждого Стр из Узел.Строки Цикл
		СтатусПроверки = (ПроверитьДанные(Стр) И СтатусПроверки); // именно в указанном порядке для выдачи всех ошибок
	КонецЦикла;
	Возврат СтатусПроверки;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////

Функция ВыгрузитьДеревоВXML(ДеревоВыгрузки, Параметры)
	
	ПотокXML = СоздатьНовыйПотокXML(); // создаем новый поток для записи
	ЗаписатьУзелДереваВXML(ДеревоВыгрузки, ПотокXML, Параметры); // пишем дерево в поток
	ТекстДляЗаписи = ПотокXML.Закрыть(); // получаем текст XML
	//ТекстДляЗаписи = "<?xml version=""1.0"" encoding=""windows-1251""?>" + Сред(ТекстДляЗаписи, Найти(ТекстДляЗаписи, Символы.ПС));
	Возврат ТекстДляЗаписи;
	
КонецФункции

Функция СоздатьНовыйПотокXML() Экспорт
	
	ПотокXML = Новый ЗаписьXML();
	ПотокXML.Отступ = Истина;
	ПотокXML.УстановитьСтроку("windows-1251");
	ПотокXML.ЗаписатьОбъявлениеXML();
	Возврат ПотокXML;
	
КонецФункции

Функция ЗаписатьУзелДереваВXML(СтрокаДерева, ПотокXML, Параметры) Экспорт
	
	Если ТипЗнч(СтрокаДерева) = Тип("ДеревоЗначений") Тогда
		ПотокXML.ЗаписатьНачалоЭлемента("Файл");
		ПотокXML.ЗаписатьАтрибут("xmlns:xsi", "http://www.w3.org/2001/XMLSchema-instance");
		//ПотокXML.ЗаписатьАтрибут("xsi:noNamespaceSchemaLocation", Параметры.ИмяФайлаСхемы);
		Для каждого Стр Из СтрокаДерева.Строки Цикл
			ЗаписатьУзелДереваВXML(Стр, ПотокXML, Параметры);
		КонецЦикла;
		ПотокXML.ЗаписатьКонецЭлемента();
	Иначе
		Если СтрокаДерева.Тип = "А" ИЛИ СтрокаДерева.Тип = "A" Тогда 
			ПотокXML.ЗаписатьАтрибут(СтрокаДерева.Код, Строка(СтрокаДерева.Значение));
		Иначе
			ПотокXML.ЗаписатьНачалоЭлемента(СтрокаДерева.Код);
			Для каждого Лист из СтрокаДерева.Строки Цикл
				ЗаписатьУзелДереваВXML(Лист, ПотокXML, Параметры);
			КонецЦикла;
			ПотокXML.ЗаписатьТекст(Строка(СтрокаДерева.Значение));
			ПотокXML.ЗаписатьКонецЭлемента();
		КонецЕсли;
	КонецЕсли;

КонецФункции

Функция ЗаписатьТесктНаДиск(ТекстДляЗаписи, ФайлДляЗаписи) Экспорт
	
	ПотокЗаписи = Новый ЗаписьТекста(ФайлДляЗаписи, КодировкаТекста.ANSI);
	ПотокЗаписи.Записать(ТекстДляЗаписи);
	ПотокЗаписи.Закрыть();
	Сообщить("Отчет успешно выгружен в файл """ + ФайлДляЗаписи + """.", СтатусСообщения.Информация);
	Возврат Истина;
	
КонецФункции

//
// ПРОЦЕДУРЫ И ФУНКЦИИ МЕХАНИЗМА ВЫГРУЗКИ В XML
////////////////////////////////////////////////////////////////////////////////

Процедура АктивизироватьЯчейку(Ячейка) Экспорт
	
	РегламентированнаяОтчетность.роАктивизироватьЯчейку(ЭтаФорма, Ячейка);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////

//используется для удаления значений итоговых показателей на листах МЧБ, образованных многострочными разделами (кроме последнего)
Процедура ОбнулитьИтоговыеПоказателиНаЛистеМЧБ(ТаблДок, КоличествоОбластей = 0)
	
	ПервыйШаг = ?(КоличествоОбластей = 0, 0, 1);
	
	Для НомерОбласти = ПервыйШаг По КоличествоОбластей Цикл
		НомОбласти = ?(НомерОбласти = 0,"", НомерОбласти);
		ОбластьИтоговыеПоказатели = ТаблДок.Области.Найти("ИтоговыеПоказатели" + НомОбласти);
		Если ОбластьИтоговыеПоказатели <> Неопределено Тогда
			
			ОбластьИтоговыеПоказателиВерх = ОбластьИтоговыеПоказатели.Верх;
			ОбластьИтоговыеПоказателиНиз = ОбластьИтоговыеПоказатели.Низ;
			
			Для Каждого Обл Из ТаблДок.Области Цикл
				Если Обл.Верх >= ОбластьИтоговыеПоказателиВерх
					И Обл.Низ <= ОбластьИтоговыеПоказателиНиз
					И Обл.ГраницаСлева.ТипЛинии = ТипЛинииЯчейкиТабличногоДокумента.Точечная
					Тогда
					Обл.Текст = "-";
				КонецЕсли;
			КонецЦикла;	
		КонецЕсли
	КонецЦикла;	
	
КонецПроцедуры

Процедура Печать(ВидПечати) Экспорт

	Отказ = Ложь;
	РегламентированнаяОтчетность.ПередПечатьюРегламентированногоОтчета(ЭтаФорма, Отказ);
	Если Отказ Тогда
		Возврат;
	КонецЕсли;

	Если НЕ РегламентированнаяОтчетность.ПринтерДоступен() Тогда
		Предупреждение("Перед формированием печатных форм необходимо определить в системе принтер и
						|задать его в качестве используемого по умолчанию!");
		Возврат;
	КонецЕсли;
	
	мПечатныеФормы.Очистить();
	мРежимПечати = Истина;
	
	Для Каждого СтрокаУровня1 Из мДеревоВыбранныхСтраниц.Строки Цикл
		
		Если СтрокаУровня1.ВыводНаПечать = 0 Тогда
			Продолжить;
		КонецЕсли;

		СтруктураПараметров = Новый Структура;
		СтруктураПараметров.Вставить("НаименованиеЛиста",  СтрокаУровня1.Представление);
		СтруктураПараметров.Вставить("ОриентацияЛиста",    СтрокаУровня1.ОриентацияСтраницы);
		СтруктураПараметров.Вставить("ИмяТабличногоПоля",  СтрокаУровня1.ИмяПоляТабличногоДокум);
		Структурапараметров.Вставить("ИмяОбластиТаблПоля", СтрокаУровня1.ИмяОбластиТабличногоПоля);
		СтруктураПараметров.Вставить("ВидПечати",          ВидПечати);

		Если НЕ мСтруктураМногостраничныхРазделов.Свойство(СтрокаУровня1.ИмяСтраницы) Тогда
			ВывестиНаПечатьЛист(СтруктураПараметров);
		Иначе
			СтруктураПараметров.Вставить("ИмяСтраницыПанели", СтрокаУровня1.ИмяСтраницы);
			ВывестиНаПечатьДополнительныеСтраницы(СтруктураПараметров);
		КонецЕсли;
		
	КонецЦикла;

	РегламентированнаяОтчетность.ПроставитьНомераЛистов(ЭтаФорма, ВидПечати);
	мРежимПечати = Ложь;

КонецПроцедуры

Процедура ВывестиНаПечатьДополнительныеСтраницы(СтруктураПараметровСтраницы)
	Перем ИмяСтраницы;
	Перем ТаблицаСтраницРаздела;
	
	СтруктураПараметровСтраницы.Свойство("ИмяСтраницыПанели", ИмяСтраницы);

	Если Не мСтруктураМногостраничныхРазделов.Свойство(ИмяСтраницы, ТаблицаСтраницРаздела) Тогда
		Возврат;
	КонецЕсли;

	АктивнаяСтраницаРаздела = ТаблицаСтраницРаздела.Найти(Истина, "АктивнаяСтраница");
	Если АктивнаяСтраницаРаздела = Неопределено Тогда
		ВывестиНаПечатьЛист(СтруктураПараметровСтраницы);
		Возврат;
	КонецЕсли;

	ИсходныйИндекс = ТаблицаСтраницРаздела.Индекс(АктивнаяСтраницаРаздела);

	Для Каждого Страница Из ТаблицаСтраницРаздела Цикл
		// выводим на печать каждую страницу многостраничного раздела
		ТекущийИндекс = ТаблицаСтраницРаздела.Индекс(Страница);
		ПоказатьСтраницуМногостраничногоРаздела(ТекущийИндекс, ИмяСтраницы, Истина);
		ВывестиНаПечатьЛист(СтруктураПараметровСтраницы);
	КонецЦикла;

	// вывод в форму данных исходной (активной) страницы
	ПоказатьСтраницуМногостраничногоРаздела(ИсходныйИндекс, ИмяСтраницы, Истина);
	
КонецПроцедуры

Процедура ВывестиНаПечатьЛист(Параметры)
	
	СоответствиеРазделовМакетам = Новый Соответствие;
	
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаТитульный",		"МЧБ_2009_01_Титул_001");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаТитульный002",		"МЧБ_2009_02_Титул_002");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаРаздел1",			"МЧБ_2009_03_Раздел_1");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаРаздел2",			"МЧБ_2009_04_Раздел_2");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаРаздел3",			"МЧБ_2009_05_Раздел_3");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаРаздел4",			"МЧБ_2009_06_Раздел_4");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаРаздел5",			"МЧБ_2009_07_Раздел_5");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаРаздел6",			"МЧБ_2009_08_Раздел_6");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистА",			"МЧБ_2009_09_Лист_А");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистБ",			"МЧБ_2009_10_Лист_Б");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистВ",			"МЧБ_2009_11_Лист_В");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистГ1",			"МЧБ_2009_12_Лист_Г1");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистГ1Продолжение","МЧБ_2009_27_Лист_Г1_Продолжение");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистГ2",			"МЧБ_2009_13_Лист_Г2");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистГ3",			"МЧБ_2009_28_Лист_Г3");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистД",			"МЧБ_2009_14_Лист_Д");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистЕ",			"МЧБ_2009_15_Лист_Е");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистЖ1",			"МЧБ_2009_16_Лист_Ж1");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистЖ2",			"МЧБ_2009_17_Лист_Ж2");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистЗ",			"МЧБ_2009_18_Лист_З");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистЗПродолжение",	"МЧБ_2009_19_Лист_З_Продолжение");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистИ",			"МЧБ_2009_20_Лист_И");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистИПродолжение",	"МЧБ_2009_21_Лист_И_Продолжение");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистК1",			"МЧБ_2009_22_Лист_К1");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистК2",			"МЧБ_2009_23_Лист_К2");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистК3",			"МЧБ_2009_24_Лист_К3");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистК4",			"МЧБ_2009_25_Лист_К4");
	СоответствиеРазделовМакетам.Вставить("ПолеТабличногоДокументаЛистЛ",			"МЧБ_2009_26_Лист_Л");

	
	МЧБРаздела = СоответствиеРазделовМакетам[Параметры.ИмяТабличногоПоля];
	
	сохрТаблДок = ЭлементыФормы[Параметры.ИмяТабличногоПоля].ПолучитьОбласть();
	
	МакетМЧБ = ПолучитьМакет(МЧБРаздела);
	МакетМЧБ.ПолеСверху = 0;
	МакетМЧБ.ПолеСправа = 0;
	МакетМЧБ.ПолеСнизу = 0;
	МакетМЧБ.ПолеСлева = 0;
	
	СтрПоля = "ПолеСверху, ПолеСправа, ПолеСнизу, ПолеСлева";
	ВремПоля = Новый Структура(СтрПоля);
	
	//Специальный алгоритм для многострочных разделов+++
	//Определение: является ли раздел многострочным 
	ИмяМногострочногоРаздела = (Сред(Параметры.ИмяТабличногоПоля,24));
	ОписанияБлоков = РегламентированнаяОтчетность.роПолучитьСвойствоРаздела(ЭтаФорма, ИмяМногострочногоРаздела, "МногострочностьВРазделе");
	КоличествоОбластей = 0;
	Если ТипЗнч(ОписанияБлоков) = Тип("ТаблицаЗначений") Тогда
		КоличествоОбластей = ОписанияБлоков.Количество();
		КоличествоОбластей = ?(КоличествоОбластей = 1, 0,КоличествоОбластей);
		
		СписокМногострочныхЧастей = ОписанияБлоков.ВыгрузитьКолонку("ИдГруппы");
		//Исходим из того что если несколько многострочных частей, то они симметричны
	КонецЕсли;
	
	ИдГруппы = ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ИмяМногострочногоРаздела);
	Если ИдГруппы <> Неопределено Тогда
		//определение исходного количества строк на листе МЧБ
		ИсхКолвоСтрокБлока = 0;
		мСтруктураИсхКолвоСтрокРазделов.Свойство(ИдГруппы,ИсхКолвоСтрокБлока);
		ТекКолвоСтрокБлока = мСтруктураМногострочныхРазделов[ИдГруппы].Количество();
		Если ТекКолвоСтрокБлока > ИсхКолвоСтрокБлока И ИсхКолвоСтрокБлока > 0 Тогда
			//Добавляли строки - значит будут доп. листы МЧБ
			//Определение общего количества листов МЧБ
			КолвоЛистовМЧБ = Цел(ТекКолвоСтрокБлока / ИсхКолвоСтрокБлока);
			КолвоСтрокНаПоследнемЛисте = ТекКолвоСтрокБлока % ИсхКолвоСтрокБлока;
			Если КолвоСтрокНаПоследнемЛисте <> 0 Тогда
				КолвоЛистовМЧБ = КолвоЛистовМЧБ + 1;	
			КонецЕсли;
			
			//заполнение строки имен показателей (для проверки перед переименованием)
			СтрИменаПоказателей = "";
			Если СписокМногострочныхЧастей.Количество() > 1 Тогда
				Для Каждого МнгИдГруппы Из СписокМногострочныхЧастей Цикл
					Для каждого КолонкаСтруктуры Из мСтруктураМногострочныхРазделов[МнгИдГруппы].Колонки Цикл
						СтрИменаПоказателей = СтрИменаПоказателей + КолонкаСтруктуры.Имя;
					КонецЦикла;
				КонецЦикла;
			Иначе
				Для каждого КолонкаСтруктуры Из мСтруктураМногострочныхРазделов[ИдГруппы].Колонки Цикл
					СтрИменаПоказателей = СтрИменаПоказателей + КолонкаСтруктуры.Имя;
				КонецЦикла;
			КонецЕсли;
			
			//Заполнение списка листов МЧБ
			СписокЛистовМЧБ = Новый СписокЗначений;
			Для Сч = 1 По КолвоЛистовМЧБ Цикл
				//переименование+++ (начиная со второго листа)
				Если Сч > 1 Тогда
					СписокОчищаемыхОбластей = Новый Массив;
					СписокОбластейПереименования = Новый СписокЗначений;
					Для каждого ТекущаяОбласть Из МакетМЧБ.Области Цикл
						ИмяЯчейки = ТекущаяОбласть.Имя;
						
						Если СтрДлина(ИмяЯчейки) < 13 ИЛИ Найти(СтрИменаПоказателей, Лев(ИмяЯчейки, 13)) = 0 Тогда
							//проверка на вхождение в данную многострочную часть
							Продолжить;
						КонецЕсли;
						
						//определение и обрасывание НомерЯчейки
						ПоказательИНомерСтрокиСРазделителем = РегламентированнаяОтчетность.роПолучитьСмысловуюЧастьИмениЯчейки(ИмяЯчейки, Истина); // ВМЕСТЕ с разделителем
						ПоказательИНомерСтроки = Лев(ПоказательИНомерСтрокиСРазделителем,СтрДлина(ПоказательИНомерСтрокиСРазделителем) - 1);
						НомерЯчейки = РегламентированнаяОтчетность.роПолучитьСмысловуюЧастьИмениЯчейки(ИмяЯчейки, Ложь);
						
						ЯвляетсяМоноЯчейкой = ЯвляетсяМоноЯчейкой(ПоказательИНомерСтроки);
						Если ЯвляетсяМоноЯчейкой Тогда
							СмысловаяЧасть = ПоказательИНомерСтроки;
							ТекущийСчетчик = НомерЯчейки;
						Иначе
							//определение СмысловаяЧасть и ТекущийСчетчик
							СмысловаяЧастьСРазделителем = РегламентированнаяОтчетность.роПолучитьСмысловуюЧастьИмениЯчейки(ПоказательИНомерСтроки, Истина); // ВМЕСТЕ с разделителем
							СмысловаяЧасть = Лев(СмысловаяЧастьСРазделителем,СтрДлина(СмысловаяЧастьСРазделителем) - 1);
							ТекущийСчетчик = РегламентированнаяОтчетность.роПолучитьСмысловуюЧастьИмениЯчейки(ПоказательИНомерСтроки, Ложь);
						КонецЕсли;
						
						//Окончательная проверка на вхождение в данную многострочную часть
						Если Найти(СтрИменаПоказателей,СмысловаяЧасть) = 0 Тогда
							Продолжить;
						КонецЕсли;
						
						НовыйСчетчик = Число(ТекущийСчетчик) + ИсхКолвоСтрокБлока;
						Если НовыйСчетчик > ТекКолвоСтрокБлока Тогда
							//очищение происходит после этого цикла
							СписокОчищаемыхОбластей.Добавить(ТекущаяОбласть);
							Продолжить;
						КонецЕсли;
						
						//Подготовка к переименованию
						//заполнение списка: значение - область, представление - будущее имя
						Если ЯвляетсяМоноЯчейкой Тогда
							СписокОбластейПереименования.Добавить(ТекущаяОбласть, СмысловаяЧасть + "_" + НовыйСчетчик);
						Иначе
							СписокОбластейПереименования.Добавить(ТекущаяОбласть, СмысловаяЧасть + "_" + НовыйСчетчик + "_" + НомерЯчейки);
						КонецЕсли;
					КонецЦикла;
					
					//Очищение
					Для каждого ОбластьСписка Из СписокОчищаемыхОбластей Цикл
						ОбластьСписка.Имя = "";
						ОбластьСписка.Текст = "-";
					КонецЦикла;
					
					//Переименование
					Для каждого ЭлСпискаОбластей Из СписокОбластейПереименования Цикл
						ЭлСпискаОбластей.Значение.Имя = ЭлСпискаОбластей.Представление;
					КонецЦикла;
							
				КонецЕсли; 
				//переименование---
				//
				СписокЛистовМЧБ.Добавить(МакетМЧБ.ПолучитьОбласть());
			КонецЦикла;
			
			Для каждого элЛистМЧБ Из СписокЛистовМЧБ Цикл
				ЛистМЧБ = элЛистМЧБ.Значение;
				
				ЗаполнитьМакетМЧБ(Параметры, ЛистМЧБ);
				
				Если СписокЛистовМЧБ.Индекс(элЛистМЧБ)<СписокЛистовМЧБ.Количество() - 1 Тогда
					//Выводится не последний лист многострочной серии листов МЧБ
					//Необходимо обнулить итоговые показатели
					ОбнулитьИтоговыеПоказателиНаЛистеМЧБ(ЛистМЧБ, КоличествоОбластей);
				КонецЕсли;
				
				ЗаполнитьЗначенияСвойств(ВремПоля, ЭлементыФормы[Параметры.ИмяТабличногоПоля], СтрПоля);
				ЭлементыФормы[Параметры.ИмяТабличногоПоля].Очистить();
				ЭлементыФормы[Параметры.ИмяТабличногоПоля].Вывести(ЛистМЧБ);
				ЗаполнитьЗначенияСвойств(ЭлементыФормы[Параметры.ИмяТабличногоПоля], ЛистМЧБ, СтрПоля);
				РегламентированнаяОтчетность.ВывестиНаПечатьЛистОбщая(ЭтаФорма, Параметры);
				
				ЭлементыФормы[Параметры.ИмяТабличногоПоля].Очистить();
				ЭлементыФормы[Параметры.ИмяТабличногоПоля].Вывести(сохрТаблДок);
				ЗаполнитьЗначенияСвойств(ЭлементыФормы[Параметры.ИмяТабличногоПоля], ВремПоля, СтрПоля);
			КонецЦикла;
			Возврат;
		Иначе
			//Не добавляли строки - продолжение выполнения
		КонецЕсли;
	КонецЕсли;
	
	ЗаполнитьМакетМЧБ(Параметры, МакетМЧБ);
	
	ЗаполнитьЗначенияСвойств(ВремПоля, ЭлементыФормы[Параметры.ИмяТабличногоПоля], СтрПоля);
	ЭлементыФормы[Параметры.ИмяТабличногоПоля].Очистить();
	ЭлементыФормы[Параметры.ИмяТабличногоПоля].Вывести(МакетМЧБ);
	ЗаполнитьЗначенияСвойств(ЭлементыФормы[Параметры.ИмяТабличногоПоля], МакетМЧБ, СтрПоля);
	
	//Специальный алгоритм для многострочных разделов+++
	
	РегламентированнаяОтчетность.ВывестиНаПечатьЛистОбщая(ЭтаФорма, Параметры);
	
	ЭлементыФормы[Параметры.ИмяТабличногоПоля].Очистить();
	ЭлементыФормы[Параметры.ИмяТабличногоПоля].Вывести(сохрТаблДок);
	ЗаполнитьЗначенияСвойств(ЭлементыФормы[Параметры.ИмяТабличногоПоля], ВремПоля, СтрПоля);
КонецПроцедуры

// Функция ЯвляетсяМоноЯчейкой
// проверяет, является ли ячейка многоквадратной
// Параметры:
//  ИмяЯчейки      - название ячейки, строка.
//
// Возвращаемое значение:
//  Булево - Истина - если ячейка не многоквадратная
//
Функция ЯвляетсяМоноЯчейкой(ИмяЯчейки)

	Если мСписокМоноЯчеек.НайтиПоЗначению(ИмяЯчейки) <> Неопределено Тогда
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;

КонецФункции // роПолучитьСмысловуюЧастьИмениЯчейки

Процедура ЗаполнитьМакетМЧБ(Параметры, МакетМЧБ)
	
	Показатели = Новый ТаблицаЗначений;
	Показатели.Колонки.Добавить("Имя");
	Показатели.Колонки.Добавить("Значение");
	Показатели.Колонки.Добавить("ЗначениеМЧБ");
	
	Показатели.Индексы.Добавить("Имя");
	
	ИсходныйМакет = ЭлементыФормы[Параметры.ИмяТабличногоПоля];
	Для Каждого Область Из ИсходныйМакет.Области Цикл
		Если Область.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник И Область.СодержитЗначение = Истина Тогда
			НовСтр = Показатели.Добавить();
			НовСтр.Имя = Область.Имя;
			НовСтр.Значение = Область.Значение;
			НовСтр.ЗначениеМЧБ = ПолучитьЗначениеМЧБ(Область);
			
			//Особая обработка значения ОКВЭД листа В
			Если Параметры.ИмяТабличногоПоля = "ПолеТабличногоДокументаЛистВ" Тогда
				Если Лев(Область.Имя, 13) = "П000090001002" Тогда
					ОКВЭД = НовСтр.ЗначениеМЧБ;
					Если Сред(ОКВЭД, 2, 1) = "." Тогда
						ОКВЭД = Лев(ОКВЭД, 1) + " " + Сред(ОКВЭД, 2);
					КонецЕсли;
					Если Сред(ОКВЭД, 5, 1) = "." Тогда
						ОКВЭД = Лев(ОКВЭД, 4) + " " + Сред(ОКВЭД, 5);
					КонецЕсли;
					НовСтр.Значение = ОКВЭД;
					НовСтр.ЗначениеМЧБ = ОКВЭД;
				КонецЕсли;
			КонецЕсли;
			
		КонецЕсли;
	КонецЦикла;
	
	// особая обработка ФИО на титульном листе
	Если Параметры.ИмяТабличногоПоля = "ПолеТабличногоДокументаТитульный" Тогда
		
		ПокПодписант = Показатели.Найти("ОргПодписант", "Имя");
		Если ПокПодписант <> Неопределено Тогда
			
			ФИО = РазложитьФИО(ПокПодписант.Значение);
			
			НовСтр = Показатели.Добавить();
			НовСтр.Имя = "ОргПодписантФамилия";
			НовСтр.Значение = ФИО.Фамилия;
			НовСтр.ЗначениеМЧБ = ФИО.Фамилия;
			
			НовСтр = Показатели.Добавить();
			НовСтр.Имя = "ОргПодписантИмя";
			НовСтр.Значение = ФИО.Имя;
			НовСтр.ЗначениеМЧБ = ФИО.Имя;
			
			НовСтр = Показатели.Добавить();
			НовСтр.Имя = "ОргПодписантОтчество";
			НовСтр.Значение = ФИО.Отчество;
			НовСтр.ЗначениеМЧБ = ФИО.Отчество;
			
		КонецЕсли;

	КонецЕсли;
	
	// особая обработка ИНН
	ИНН = Новый Массив(12);
	Для Инд = 1 По 9 Цикл
		Для Знакоместо = 0 По 11 Цикл
			ИНН[Знакоместо] = Показатели.Найти("ИНН" + Инд + "_" + (Знакоместо + 1), "Имя");
		КонецЦикла;
		Если ИНН[0] = Неопределено ИЛИ ИНН[1] = Неопределено ИЛИ ИНН[10] = Неопределено Тогда
			Продолжить;
		КонецЕсли;
	КонецЦикла;
	
	ИндексТочкиПоКорню=Новый Структура;
	Для каждого Область Из МакетМЧБ.Области Цикл
		Если Область.Текст="." Тогда
			ТекАдресЗначенияОбласти = АдресЗначенияОбласти(Область);
			Корень=ТекАдресЗначенияОбласти.Корень;
			ИндексТочкиЧислаНаМЧБ=ТекАдресЗначенияОбласти.ИндексЗнакоместа;
			ИндексТочкиПоКорню.Вставить(Корень,ИндексТочкиЧислаНаМЧБ);
		КонецЕсли;
	КонецЦикла;
	
	Для Каждого Область Из МакетМЧБ.Области Цикл
		Если Область.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Прямоугольник Тогда
			ИмяОбласти = Область.Имя;
			РезультатПоиска = Показатели.Найти(ИмяОбласти, "Имя");
			Если РезультатПоиска = Неопределено Тогда
				ТекАдресЗначенияОбласти = АдресЗначенияОбласти(Область);
				ЗначениеВыведено = Ложь;
				Если ТекАдресЗначенияОбласти.ИндексЗнакоместа <> 0 Тогда
					РезультатПоиска = Показатели.Найти(ТекАдресЗначенияОбласти.Корень, "Имя");
					Если РезультатПоиска <> Неопределено Тогда
						Если ТипЗнч(РезультатПоиска.Значение)=Тип("Число") Тогда
							//разделение числа на 2 части
							ЦелаяЧасть = Цел(РезультатПоиска.Значение);
							СтрЦелаяЧасть = Строка(Формат(Цел(РезультатПоиска.Значение),"ЧГ=0"));
							СтрДообнаяЧасть = Сред(Строка(РезультатПоиска.Значение - ЦелаяЧасть),3);
							//разделение областей показателя на 2 части
							
							ИндексТочкиЧислаНаМЧБ = Неопределено;
							Если ИндексТочкиПоКорню.Свойство(ТекАдресЗначенияОбласти.Корень,ИндексТочкиЧислаНаМЧБ) = Ложь Тогда
								//На МЧБ нет разделения на целую и дробную части
								ПрисвоитьЗначениеОбласти(Область, РезультатПоиска.ЗначениеМЧБ, ТекАдресЗначенияОбласти.ИндексЗнакоместа);
								ЗначениеВыведено = Истина;	
							Иначе
								//определяем какая часть выводится (Целая, дробная или точка)
								Если ТекАдресЗначенияОбласти.ИндексЗнакоместа<ИндексТочкиЧислаНаМЧБ Тогда
									//выводится целая часть
									ПрисвоитьЗначениеОбласти(Область, ?(РезультатПоиска.ЗначениеМЧБ = "-","-",СтрЦелаяЧасть), ТекАдресЗначенияОбласти.ИндексЗнакоместа);
									ЗначениеВыведено = Истина;	
								ИначеЕсли ТекАдресЗначенияОбласти.ИндексЗнакоместа > ИндексТочкиЧислаНаМЧБ Тогда
									//выводится дробная часть
									ПрисвоитьЗначениеОбласти(Область, СтрДообнаяЧасть, ТекАдресЗначенияОбласти.ИндексЗнакоместа - ИндексТочкиЧислаНаМЧБ);
									ЗначениеВыведено = Истина;
								Иначе
									//выводится точка
									//присваивать ничего не будем, но считаем, что область заполненяется корректно
									ЗначениеВыведено = Истина;
								КонецЕсли;
							КонецЕсли;
						Иначе
							ПрисвоитьЗначениеОбласти(Область, РезультатПоиска.ЗначениеМЧБ, ТекАдресЗначенияОбласти.ИндексЗнакоместа, ТипЗнч(РезультатПоиска.Значение) <> Тип("Строка") ИЛИ НЕ ЗначениеЗаполнено(РезультатПоиска.Значение));
							ЗначениеВыведено = Истина;		
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
				Если НЕ ЗначениеВыведено Тогда
					Сообщить("Не удалось заполнить область """ + ИмяОбласти + """!");
				КонецЕсли;
			Иначе
				ПрисвоитьЗначениеОбласти(Область, РезультатПоиска.ЗначениеМЧБ);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Процедура ПрисвоитьЗначениеОбласти(Область, Знач Значение, ИндексЗнакоместа = 0, ДополнятьСправа_ = Истина)
	
	Если ИндексЗнакоместа <> 0 Тогда
		Если СтрДлина(Значение) >= ИндексЗнакоместа Тогда
			Значение = Сред(Значение, ИндексЗнакоместа, 1);
		Иначе
			Значение = ?(ДополнятьСправа_, "-", "");
		КонецЕсли;
	ИначеЕсли НЕ ЗначениеЗаполнено(Значение) Тогда
		Значение = "-";
	КонецЕсли;
	
	Если Область.СодержитЗначение = Истина Тогда
		Область.Значение = ВРЕГ(Значение);
	Иначе
		Область.Текст = ВРЕГ(Значение);
	КонецЕсли;
	
КонецПроцедуры

Функция АдресЗначенияОбласти(Область)
	
	Имя = Область.Имя;
	КореньИмениОбласти = Неопределено;
	СтрИндексЗнакоместа = "";
	ИндексЗнакоместа = 0;
	ДлинаИмени = СтрДлина(Имя);
	Для ИндексВхождения = 1 По ДлинаИмени Цикл
		СтрИндексЗнакоместа = Сред(Имя, ДлинаИмени - ИндексВхождения + 1);
		Если ОбщегоНазначения.ТолькоЦифрыВСтроке(СтрИндексЗнакоместа) Тогда
			КореньИмениОбласти = Лев(Имя, ДлинаИмени - ИндексВхождения);
			ИндексЗнакоместа = Число(СтрИндексЗнакоместа);
		Иначе
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Если Прав(КореньИмениОбласти, 1) = "_" Тогда
		КореньИмениОбласти = Лев(КореньИмениОбласти, СтрДлина(КореньИмениОбласти) - 1);
	КонецЕсли;
		
	Возврат Новый Структура("Корень, ИндексЗнакоместа", КореньИмениОбласти, ИндексЗнакоместа);
	
КонецФункции

Функция ПолучитьЗначениеМЧБ(Область)
	
	ТипЗначения = ТипЗнч(Область.Значение);
	Если ТипЗначения = Тип("Число") Тогда
		ФорматОбласти = Область.Формат;
		СоотвСтрокаФормата = РазобратьСтрокуФормата(ФорматОбласти);
		СоотвСтрокаФормата.Вставить("ЧРД", ".");
		СоотвСтрокаФормата.Вставить("ЧГ", "");
		Результат = Формат(Область.Значение, СобратьСтрокуФормата(СоотвСтрокаФормата));
	ИначеЕсли ТипЗначения = Тип("Строка") Тогда
		Результат = СокрЛП(Область.Значение);
	ИначеЕсли ТипЗначения = Тип("Дата") Тогда
		Результат = Формат(Область.Значение, ?(ПустаяСтрока(Область.Формат), "ДФ=ddMMyyyy", Область.Формат));
	ИначеЕсли ТипЗначения = Тип("Булево") Тогда
		Результат = Формат(Область.Значение, Область.Формат);
	КонецЕсли;
	Возврат СокрЛП(Результат);
	
КонецФункции

Функция РазобратьСтрокуФормата(Знач СтрокаФормата)
	
	ЗначенияПараметров = Новый Соответствие;
	Пока Найти(СтрокаФормата, ";") <> 0 Цикл
		ВхождениеРазделителя = Найти(СтрокаФормата, ";");
		ДоРазделителя = Лев(СтрокаФормата, ВхождениеРазделителя - 1);
		ВхождениеРавно = Найти(ДоРазделителя, "=");
		Если ВхождениеРавно <> 0 И ВхождениеРавно <> 1 Тогда
			ЗначенияПараметров.Вставить(Лев(ДоРазделителя, ВхождениеРавно - 1), Сред(ДоРазделителя, ВхождениеРавно + 1));
		КонецЕсли;
		СтрокаФормата = Сред(СтрокаФормата, ВхождениеРазделителя + 1);
	КонецЦикла;
	ВхождениеРавно = Найти(СтрокаФормата, "=");
	Если ВхождениеРавно <> 0 И ВхождениеРавно <> 1 Тогда
		ЗначенияПараметров.Вставить(Лев(СтрокаФормата, ВхождениеРавно - 1), Сред(СтрокаФормата, ВхождениеРавно + 1));
	КонецЕсли;
	Возврат ЗначенияПараметров;
	
КонецФункции

Функция СобратьСтрокуФормата(ПараметрыФормата)
	
	СтрокаФормата = "";
	Для Каждого Параметр Из ПараметрыФормата Цикл
		СтрокаФормата = СтрокаФормата + "; " + Параметр.Ключ + "=" + Параметр.Значение;
	КонецЦикла;
	Если НЕ ПустаяСтрока(СтрокаФормата) Тогда
		СтрокаФормата = Сред(СтрокаФормата, 3);
	КонецЕсли;
	Возврат СтрокаФормата;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////

Процедура ВывестиНаПечатьЛистРаздела(СтруктураПараметровЛиста) Экспорт
	
	Состояние(Заголовок + ". Формирование печатной формы " + СтруктураПараметровЛиста.НаименованиеЛиста + "...");
	
	ПечатныеЛисты = Новый СписокЗначений;
	ПечатныеЛисты.Добавить(ВывестиНаПечатьЛистРазделаБезМногострочныхЧастей(СтруктураПараметровЛиста));
	мПечатныеФормы.Добавить(ПечатныеЛисты[0], СтруктураПараметровЛиста.НаименованиеЛиста);
	
КонецПроцедуры

Функция ВывестиНаПечатьЛистРазделаБезМногострочныхЧастей(СтруктураПараметровЛиста)
	Перем Ориентация;
	Перем ИмяТабличногоПоля;
	Перем ИмяОбластиТаблПоля;

	ТаблДок = ЭлементыФормы[СтруктураПараметровЛиста.ИмяТабличногоПоля];
	
	ПечатнаяФорма = Новый ТабличныйДокумент;
	ПечатнаяФорма.ОтображатьЗаголовки = Ложь;
	ПечатнаяФорма.ОтображатьСетку     = Ложь;
	ПечатнаяФорма.ЧерноБелыйПросмотр  = Истина;
	ПечатнаяФорма.ЧерноБелаяПечать    = Истина;
	ПечатнаяФорма.Автомасштаб         = Истина;
	ПечатнаяФорма.ОриентацияСтраницы  = СтруктураПараметровЛиста.ОриентацияЛиста;
	ЗаполнитьЗначенияСвойств(ПечатнаяФорма, ТаблДок, "ПолеСлева, ПолеСверху, ПолеСправа, ПолеСнизу");

	СписокВыводимыхНаПечатьОбластей = Новый СписокЗначений;
	Для каждого Область Из ТаблДок.Области Цикл
		Если Область.ТипОбласти = ТипОбластиЯчеекТабличногоДокумента.Строки Тогда
			СписокВыводимыхНаПечатьОбластей.Добавить(Область.Верх, Область.Имя);
		КонецЕсли;
	КонецЦикла;
	
	// Сортируем список в порядке расположения областей в таблице (по верхней координате).
	СписокВыводимыхНаПечатьОбластей.СортироватьПоЗначению();

	// Выполняем цикл до тех пор, пока не закончатся области, выводимые на печать.
	Пока СписокВыводимыхНаПечатьОбластей.Количество() > 0 Цикл
		
		Если СтрЧислоВхождений(ВРег(СписокВыводимыхНаПечатьОбластей[0].Представление), "ПУСТАЯСТРОКА") = 0 Тогда
			ОбластьВыводимаяНаПечать = ТаблДок.ПолучитьОбласть(СписокВыводимыхНаПечатьОбластей[0].Представление);
			СписокВыводимыхНаПечатьОбластей.Удалить(0);
			ПечатнаяФорма.Вывести(ОбластьВыводимаяНаПечать);
			Продолжить;
		КонецЕсли;
		
		// Получаем области "ПустаяСтрока" и "Ограничители", одновременно удаляя их из списка.
		ОбластьПустаяСтрока = ТаблДок.ПолучитьОбласть(СписокВыводимыхНаПечатьОбластей[0].Представление);
		СписокВыводимыхНаПечатьОбластей.Удалить(0);
		ОбластьОграничители = ТаблДок.ПолучитьОбласть(СписокВыводимыхНаПечатьОбластей[0].Представление);
		СписокВыводимыхНаПечатьОбластей.Удалить(0);
		
		ВыводимыеОбласти = Новый Массив;
		ВыводимыеОбласти.Добавить(ОбластьПустаяСтрока);
		ВыводимыеОбласти.Добавить(ОбластьОграничители);
		
		Пока ПечатнаяФорма.ПроверитьВывод(ВыводимыеОбласти) Цикл
			ПечатнаяФорма.Вывести(ОбластьПустаяСтрока);
		КонецЦикла;
		
		ПечатнаяФорма.Вывести(ОбластьОграничители);
		ПечатнаяФорма.ВывестиГоризонтальныйРазделительСтраниц();
		
	КонецЦикла;
	
	Возврат ПечатнаяФорма;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////

Процедура КоманднаяПанельДействийПоказатьБланк(Кнопка)
	
	Печать(Кнопка.Имя);
	
КонецПроцедуры

Процедура КоманднаяПанельДействийПечатьМашиночитаемогоБланка(Кнопка)
	
	РегламентированнаяОтчетность.ВывестиМашиночитаемуюФорму(ЭтаФорма, Кнопка.Имя);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////

Процедура ПоискВРегламентированномОтчете(Форма) Экспорт
	
	ФормаПоиска = РегламентированнаяОтчетность.роПолучитьОбщуюФорму("НастройкиПоиска", Форма);
	ЧтоИскать = ФормаПоиска.ОткрытьМодально();
	Если ЧтоИскать = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	мРезультатПоиска = Новый ТаблицаЗначений;
	мРезультатПоиска.Колонки.Добавить("Раздел");
	мРезультатПоиска.Колонки.Добавить("Страница");
	мРезультатПоиска.Колонки.Добавить("НаименованиеЛиста");
	мРезультатПоиска.Колонки.Добавить("ИмяЯчейки");
	мРезультатПоиска.Колонки.Добавить("СтрокаПП");
	мРезультатПоиска.Колонки.Добавить("НайденоВСтроке");
	
	мСчетчикиСтраницПриПоиске = Новый ТаблицаЗначений;
	мСчетчикиСтраницПриПоиске.Колонки.Добавить("ИмяТабличногоПоля");
	мСчетчикиСтраницПриПоиске.Колонки.Добавить("Счетчик");
	
	ПечатьЧерновика("", ЧтоИскать);
	
	Состояние("Поиск завершен.");
	Если мРезультатПоиска.Количество() = 0 Тогда
		Предупреждение("По Вашему запросу ничего не найдено!");
		Возврат;
	КонецЕсли;
	
	ФормаРезультатыПоиска = РегламентированнаяОтчетность.роПолучитьОбщуюФорму("РезультатыПоиска", Форма);
	Если ФормаРезультатыПоиска.Открыта() Тогда
		ФормаРезультатыПоиска.Закрыть();
	КонецЕсли;
	ФормаРезультатыПоиска.Заголовок = Заголовок + " - результаты поиска значения [" + ЧтоИскать.ИскомоеЗначение + "]";
	ФормаРезультатыПоиска.ЗакрыватьПриЗакрытииВладельца = Истина;
	ФормаРезультатыПоиска.ЭлементыФормы.РезультатыПоиска.Значение = мРезультатПоиска.Скопировать();
	ФормаРезультатыПоиска.НадписьНайдено = "Найдено: " + Формат(мРезультатПоиска.Количество(), "ЧГ=");
	ФормаРезультатыПоиска.Открыть();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////

Процедура КоманднаяПанельФормыДействиеОтправка(Кнопка)
	
	РегламентированнаяОтчетность.ПриНажатииНаКнопкуОтправкиВРегламентированномОтчете(ЭтаФорма, Кнопка);
	
КонецПроцедуры

Процедура СтатусНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	РегламентированнаяОтчетность.НачалоВыбораСтатусаВРегламентированномОтчете(ЭтаФорма, Элемент, СтандартнаяОбработка);
	
КонецПроцедуры

Процедура СтатусПриИзменении(Элемент)
	
	РегламентированнаяОтчетность.ПриИзмененииСтатусаВРегламентированномОтчете(ЭтаФорма, Элемент);
	
КонецПроцедуры

Процедура СтатусОчистка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
КонецПроцедуры

Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	РегламентированнаяОтчетность.ОбработкаОповещенияОбИзмененииСтатусаРегламентированногоОтчета(ЭтаФорма, ИмяСобытия, Параметр, Источник);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ

мСоставПоказателей = "СоставПоказателей2009Кв1";
мОписаниеТиповЧислоЕ = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(17, 2);
мОписаниеТиповЧислоЕ4 = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(17, 4);
мОписаниеТиповЧислоЕ0 = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(15, 0);

мОписаниеТиповЧислоЕ9 = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(9, 2);
мОписаниеТиповЧислоЕ8 = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(8, 2);
мОписаниеТиповЧислоЕ7 = ОбщегоНазначения.ПолучитьОписаниеТиповЧисла(7, 2);

СоответствиеЕдиницыИзмеренияДелителю = Новый Соответствие;
СоответствиеЕдиницыИзмеренияДелителю.Вставить(Перечисления.ПорядкиОкругленияОтчетности.Окр1, 1);
СоответствиеЕдиницыИзмеренияДелителю.Вставить(Перечисления.ПорядкиОкругленияОтчетности.Окр1000, 1000);
СоответствиеЕдиницыИзмеренияДелителю.Вставить(Перечисления.ПорядкиОкругленияОтчетности.Окр1000000, 1000000);

ОписаниеТиповСтрока2   = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(2);
ОписаниеТиповСтрока3   = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(3);
ОписаниеТиповСтрока11   = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(11);
ОписаниеТиповСтрока254 = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(254);
ОписаниеТиповСтрока62 = ОбщегоНазначения.ПолучитьОписаниеТиповСтроки(62);

МассивДата = Новый Массив;
МассивДата.Добавить(Тип("Дата"));
КвалификаторДата = Новый КвалификаторыДаты(ЧастиДаты.Дата);
ОписаниеТиповДата = Новый ОписаниеТипов(МассивДата, КвалификаторДата);

// ОПИСАНИЕ ПАРАМЕТРОВ МНОГОСТРОЧНЫХ ГРУПП
// Идентификаторы многострочных групп

мСписокМоноЯчеек = Новый СписокЗначений;
мСписокМоноЯчеек.Добавить("П000070001004"); //Лист А стр. 030 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000080001002"); //Лист Б стр. 020 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000010201004"); //Лист Г2 стр. 030 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000027201004"); //Лист Г3 стр. 030 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000012001003"); //Лист Д стр. 030 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000012001005"); //Лист Д стр. 050 "Наименование вида вознаграждения"
мСписокМоноЯчеек.Добавить("П000013001003"); //Лист Е стр. 030 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000015001003"); //Лист Ж2 стр. 030 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000015002003"); //Лист Ж2 стр. 090 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000016001004"); //Лист З стр. 040 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000018001004"); //Лист И стр. 040 "Наименование источника выплаты дохода"
мСписокМоноЯчеек.Добавить("П000022001003"); //Лист К3 стр. 030 "Наименование страховой организации"
мСписокМоноЯчеек.Добавить("П000022002003"); //Лист К3 стр. 110 "Наименование страховой организации"
мСписокМоноЯчеек.Добавить("П000023001003"); //Лист К4 стр. 030 "Наименование страховой организации"
мСписокМоноЯчеек.Добавить("П000023002003"); //Лист К4 стр. 110 "Наименование страховой организации"


//Лист А
мИдГруппыА  = "П0000700010";
СтруктураГруппыА = Новый ТаблицаЗначений;
СтруктураГруппыА.Колонки.Добавить("П000070001000", ОписаниеТиповСтрока3);
СтруктураГруппыА.Колонки.Добавить("П000070001001", ОписаниеТиповСтрока3);
СтруктураГруппыА.Колонки.Добавить("П000070001002", ОписаниеТиповСтрока3);
СтруктураГруппыА.Колонки.Добавить("П000070001003", ОписаниеТиповСтрока11);
СтруктураГруппыА.Колонки.Добавить("П000070001004", ОписаниеТиповСтрока62);
СтруктураГруппыА.Колонки.Добавить("П000070001005", мОписаниеТиповЧислоЕ);
СтруктураГруппыА.Колонки.Добавить("П000070001006", мОписаниеТиповЧислоЕ);
СтруктураГруппыА.Колонки.Добавить("П000070001007", мОписаниеТиповЧислоЕ0);
СтруктураГруппыА.Колонки.Добавить("П000070001008", мОписаниеТиповЧислоЕ0);

//Лист Б
мИдГруппыБ  = "П0000800010";
СтруктураГруппыБ = Новый ТаблицаЗначений;
СтруктураГруппыБ.Колонки.Добавить("П000080001000", ОписаниеТиповСтрока3);
СтруктураГруппыБ.Колонки.Добавить("П000080001001", мОписаниеТиповЧислоЕ);
СтруктураГруппыБ.Колонки.Добавить("П000080001002", ОписаниеТиповСтрока62);
СтруктураГруппыБ.Колонки.Добавить("П000080001003", ОписаниеТиповСтрока254);
СтруктураГруппыБ.Колонки.Добавить("П000080001004", ОписаниеТиповСтрока3);
СтруктураГруппыБ.Колонки.Добавить("П000080001005", ОписаниеТиповДата);
СтруктураГруппыБ.Колонки.Добавить("П000080001006", мОписаниеТиповЧислоЕ4);
СтруктураГруппыБ.Колонки.Добавить("П000080001007", мОписаниеТиповЧислоЕ);
СтруктураГруппыБ.Колонки.Добавить("П000080001008", мОписаниеТиповЧислоЕ);
СтруктураГруппыБ.Колонки.Добавить("П000080001009", ОписаниеТиповДата);
СтруктураГруппыБ.Колонки.Добавить("П000080001010", мОписаниеТиповЧислоЕ4);
СтруктураГруппыБ.Колонки.Добавить("П000080001011", мОписаниеТиповЧислоЕ);
СтруктураГруппыБ.Колонки.Добавить("П000080001012", мОписаниеТиповЧислоЕ);
СтруктураГруппыБ.Колонки.Добавить("П000080001013", мОписаниеТиповЧислоЕ0);
СтруктураГруппыБ.Колонки.Добавить("П000080001014", мОписаниеТиповЧислоЕ0);

//Лист В
мИдГруппыВ  = "П0000900010";
СтруктураГруппыВ = Новый ТаблицаЗначений;
СтруктураГруппыВ.Колонки.Добавить("П000090001000", ОписаниеТиповСтрока3);
СтруктураГруппыВ.Колонки.Добавить("П000090001001", ОписаниеТиповСтрока3);
СтруктураГруппыВ.Колонки.Добавить("П000090001002", ОписаниеТиповСтрока3);
СтруктураГруппыВ.Колонки.Добавить("П000090001003", мОписаниеТиповЧислоЕ);
СтруктураГруппыВ.Колонки.Добавить("П000090001004", мОписаниеТиповЧислоЕ);
СтруктураГруппыВ.Колонки.Добавить("П000090001005", мОписаниеТиповЧислоЕ);
СтруктураГруппыВ.Колонки.Добавить("П000090001006", мОписаниеТиповЧислоЕ);
СтруктураГруппыВ.Колонки.Добавить("П000090001007", мОписаниеТиповЧислоЕ);
СтруктураГруппыВ.Колонки.Добавить("П000090001008", мОписаниеТиповЧислоЕ);
СтруктураГруппыВ.Колонки.Добавить("П000090001009", мОписаниеТиповЧислоЕ);
СтруктураГруппыВ.Колонки.Добавить("П000090001010", мОписаниеТиповЧислоЕ);

//Лист Г1 Продолжение
мИдГруппыГ1Продолжение  = "П0000251190";
СтруктураГруппыГ1Продолжение = Новый ТаблицаЗначений;
СтруктураГруппыГ1Продолжение.Колонки.Добавить("П000025119001", ОписаниеТиповСтрока2);
СтруктураГруппыГ1Продолжение.Колонки.Добавить("П000025119002", мОписаниеТиповЧислоЕ);
СтруктураГруппыГ1Продолжение.Колонки.Добавить("П000025119003", мОписаниеТиповЧислоЕ);
СтруктураГруппыГ1Продолжение.Колонки.Добавить("П000025119004", мОписаниеТиповЧислоЕ);
СтруктураГруппыГ1Продолжение.Колонки.Добавить("П000025119005", мОписаниеТиповЧислоЕ);
СтруктураГруппыГ1Продолжение.Колонки.Добавить("П000025119006", мОписаниеТиповЧислоЕ);

//Лист Г2
мИдГруппыГ2  = "П0000102010";
СтруктураГруппыГ2 = Новый ТаблицаЗначений;
СтруктураГруппыГ2.Колонки.Добавить("П000010201000", ОписаниеТиповСтрока3);
СтруктураГруппыГ2.Колонки.Добавить("П000010201001", ОписаниеТиповСтрока3);
СтруктураГруппыГ2.Колонки.Добавить("П000010201002", ОписаниеТиповСтрока3);
СтруктураГруппыГ2.Колонки.Добавить("П000010201004", ОписаниеТиповСтрока3);
СтруктураГруппыГ2.Колонки.Добавить("П000010201005", мОписаниеТиповЧислоЕ);
СтруктураГруппыГ2.Колонки.Добавить("П000010201006", мОписаниеТиповЧислоЕ);

//Лист Г3
мИдГруппыГ3  = "П0000272010";
СтруктураГруппыГ3 = Новый ТаблицаЗначений;
СтруктураГруппыГ3.Колонки.Добавить("П000027201000", ОписаниеТиповСтрока3);
СтруктураГруппыГ3.Колонки.Добавить("П000027201001", ОписаниеТиповСтрока3);
СтруктураГруппыГ3.Колонки.Добавить("П000027201002", ОписаниеТиповСтрока3);
СтруктураГруппыГ3.Колонки.Добавить("П000027201003", ОписаниеТиповСтрока11);
СтруктураГруппыГ3.Колонки.Добавить("П000027201004", ОписаниеТиповСтрока3);
СтруктураГруппыГ3.Колонки.Добавить("П000027201005", мОписаниеТиповЧислоЕ);
СтруктураГруппыГ3.Колонки.Добавить("П000027201006", мОписаниеТиповЧислоЕ);

//Лист Д
мИдГруппыД  = "П0000120010";
СтруктураГруппыД = Новый ТаблицаЗначений;
СтруктураГруппыД.Колонки.Добавить("П000012001000", ОписаниеТиповСтрока3);
СтруктураГруппыД.Колонки.Добавить("П000012001001", ОписаниеТиповСтрока3);
СтруктураГруппыД.Колонки.Добавить("П000012001002", ОписаниеТиповСтрока3);
СтруктураГруппыД.Колонки.Добавить("П000012001003", ОписаниеТиповСтрока3);
СтруктураГруппыД.Колонки.Добавить("П000012001004", ОписаниеТиповСтрока3);
СтруктураГруппыД.Колонки.Добавить("П000012001005", ОписаниеТиповСтрока3);
СтруктураГруппыД.Колонки.Добавить("П000012001006", мОписаниеТиповЧислоЕ);
СтруктураГруппыД.Колонки.Добавить("П000012001007", ОписаниеТиповСтрока3);
СтруктураГруппыД.Колонки.Добавить("П000012001008", мОписаниеТиповЧислоЕ0);
СтруктураГруппыД.Колонки.Добавить("П000012001009", мОписаниеТиповЧислоЕ);

//Лист Е
мИдГруппыЕ  = "П0000130010";
СтруктураГруппыЕ = Новый ТаблицаЗначений;
СтруктураГруппыЕ.Колонки.Добавить("П000013001000", ОписаниеТиповСтрока3);
СтруктураГруппыЕ.Колонки.Добавить("П000013001001", ОписаниеТиповСтрока3);
СтруктураГруппыЕ.Колонки.Добавить("П000013001002", ОписаниеТиповСтрока3);
СтруктураГруппыЕ.Колонки.Добавить("П000013001003", ОписаниеТиповСтрока3);
СтруктураГруппыЕ.Колонки.Добавить("П000013001004", мОписаниеТиповЧислоЕ);
СтруктураГруппыЕ.Колонки.Добавить("П000013001005", мОписаниеТиповЧислоЕ);

//Лист Ж2
// список 1
мИдГруппыЖ2_1  = "П0000150010";
СтруктураГруппыЖ2_1 = Новый ТаблицаЗначений;
СтруктураГруппыЖ2_1.Колонки.Добавить("П000015001000", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_1.Колонки.Добавить("П000015001001", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_1.Колонки.Добавить("П000015001002", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_1.Колонки.Добавить("П000015001003", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_1.Колонки.Добавить("П000015001004", мОписаниеТиповЧислоЕ);
СтруктураГруппыЖ2_1.Колонки.Добавить("П000015001005", мОписаниеТиповЧислоЕ);
//Список 2
мИдГруппыЖ2_2  = "П0000150020";
СтруктураГруппыЖ2_2 = Новый ТаблицаЗначений;
СтруктураГруппыЖ2_2.Колонки.Добавить("П000015002000", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_2.Колонки.Добавить("П000015002001", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_2.Колонки.Добавить("П000015002002", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_2.Колонки.Добавить("П000015002003", ОписаниеТиповСтрока3);
СтруктураГруппыЖ2_2.Колонки.Добавить("П000015002004", мОписаниеТиповЧислоЕ);
СтруктураГруппыЖ2_2.Колонки.Добавить("П000015002005", мОписаниеТиповЧислоЕ);

//Лист З
мИдГруппыЗ = "П0000160010";
СтруктураГруппыЗ= Новый ТаблицаЗначений;
СтруктураГруппыЗ.Колонки.Добавить("П000016001000", ОписаниеТиповСтрока3);
СтруктураГруппыЗ.Колонки.Добавить("П000016001001", ОписаниеТиповСтрока3);
СтруктураГруппыЗ.Колонки.Добавить("П000016001002", ОписаниеТиповСтрока3);
СтруктураГруппыЗ.Колонки.Добавить("П000016001003", ОписаниеТиповСтрока3);
СтруктураГруппыЗ.Колонки.Добавить("П000016001004", ОписаниеТиповСтрока3);
СтруктураГруппыЗ.Колонки.Добавить("П000016001005", мОписаниеТиповЧислоЕ);
СтруктураГруппыЗ.Колонки.Добавить("П000016001006", мОписаниеТиповЧислоЕ);
СтруктураГруппыЗ.Колонки.Добавить("П000016001007", мОписаниеТиповЧислоЕ);

//Лист И
мИдГруппыИ = "П0000180010";
СтруктураГруппыИ= Новый ТаблицаЗначений;
СтруктураГруппыИ.Колонки.Добавить("П000018001000", ОписаниеТиповСтрока3);
СтруктураГруппыИ.Колонки.Добавить("П000018001001", ОписаниеТиповСтрока3);
СтруктураГруппыИ.Колонки.Добавить("П000018001002", ОписаниеТиповСтрока3);
СтруктураГруппыИ.Колонки.Добавить("П000018001003", ОписаниеТиповСтрока3);
СтруктураГруппыИ.Колонки.Добавить("П000018001004", ОписаниеТиповСтрока3);
СтруктураГруппыИ.Колонки.Добавить("П000018001005", мОписаниеТиповЧислоЕ);
СтруктураГруппыИ.Колонки.Добавить("П000018001006", мОписаниеТиповЧислоЕ);
СтруктураГруппыИ.Колонки.Добавить("П000018001007", мОписаниеТиповЧислоЕ);

//Лист К3
// список 1
мИдГруппыК3_1  = "П0000220010";
СтруктураГруппыК3_1 = Новый ТаблицаЗначений;
СтруктураГруппыК3_1.Колонки.Добавить("П000022001000", ОписаниеТиповСтрока3);
СтруктураГруппыК3_1.Колонки.Добавить("П000022001001", ОписаниеТиповСтрока3);
СтруктураГруппыК3_1.Колонки.Добавить("П000022001002", ОписаниеТиповСтрока3);
СтруктураГруппыК3_1.Колонки.Добавить("П000022001003", ОписаниеТиповСтрока3);
СтруктураГруппыК3_1.Колонки.Добавить("П000022001004", ОписаниеТиповДата);
СтруктураГруппыК3_1.Колонки.Добавить("П000022001005", ОписаниеТиповСтрока3);
СтруктураГруппыК3_1.Колонки.Добавить("П000022001006", мОписаниеТиповЧислоЕ);
СтруктураГруппыК3_1.Колонки.Добавить("П000022001007", мОписаниеТиповЧислоЕ);
//Список 2
мИдГруппыК3_2  = "П0000220020";
СтруктураГруппыК3_2 = Новый ТаблицаЗначений;
СтруктураГруппыК3_2.Колонки.Добавить("П000022002000", ОписаниеТиповСтрока3);
СтруктураГруппыК3_2.Колонки.Добавить("П000022002001", ОписаниеТиповСтрока3);
СтруктураГруппыК3_2.Колонки.Добавить("П000022002002", ОписаниеТиповСтрока3);
СтруктураГруппыК3_2.Колонки.Добавить("П000022002003", ОписаниеТиповСтрока3);
СтруктураГруппыК3_2.Колонки.Добавить("П000022002004", ОписаниеТиповДата);
СтруктураГруппыК3_2.Колонки.Добавить("П000022002005", ОписаниеТиповСтрока3);
СтруктураГруппыК3_2.Колонки.Добавить("П000022002006", мОписаниеТиповЧислоЕ);
СтруктураГруппыК3_2.Колонки.Добавить("П000022002007", мОписаниеТиповЧислоЕ);

//Лист К4
// список 1
мИдГруппыК4_1  = "П0000230010";
СтруктураГруппыК4_1 = Новый ТаблицаЗначений;
СтруктураГруппыК4_1.Колонки.Добавить("П000023001000", ОписаниеТиповСтрока3);
СтруктураГруппыК4_1.Колонки.Добавить("П000023001001", ОписаниеТиповСтрока3);
СтруктураГруппыК4_1.Колонки.Добавить("П000023001002", ОписаниеТиповСтрока3);
СтруктураГруппыК4_1.Колонки.Добавить("П000023001003", ОписаниеТиповСтрока3);
СтруктураГруппыК4_1.Колонки.Добавить("П000023001004", ОписаниеТиповДата);
СтруктураГруппыК4_1.Колонки.Добавить("П000023001005", ОписаниеТиповСтрока3);
СтруктураГруппыК4_1.Колонки.Добавить("П000023001006", мОписаниеТиповЧислоЕ);
СтруктураГруппыК4_1.Колонки.Добавить("П000023001007", мОписаниеТиповЧислоЕ);
//Список 2
мИдГруппыК4_2  = "П0000230020";
СтруктураГруппыК4_2 = Новый ТаблицаЗначений;
СтруктураГруппыК4_2.Колонки.Добавить("П000023002000", ОписаниеТиповСтрока3);
СтруктураГруппыК4_2.Колонки.Добавить("П000023002001", ОписаниеТиповСтрока3);
СтруктураГруппыК4_2.Колонки.Добавить("П000023002002", ОписаниеТиповСтрока3);
СтруктураГруппыК4_2.Колонки.Добавить("П000023002003", ОписаниеТиповСтрока3);
СтруктураГруппыК4_2.Колонки.Добавить("П000023002004", ОписаниеТиповДата);
СтруктураГруппыК4_2.Колонки.Добавить("П000023002005", ОписаниеТиповСтрока3);
СтруктураГруппыК4_2.Колонки.Добавить("П000023002006", мОписаниеТиповЧислоЕ);
СтруктураГруппыК4_2.Колонки.Добавить("П000023002007", мОписаниеТиповЧислоЕ);

// количество строк многострочных разделов по "бумажной" форме отчета
// (минимальное количество строк, которое должно присутствовать всегда)

КолИсхСтрокИдГруппыА   = 4;
КолИсхСтрокИдГруппыБ   = 2;
КолИсхСтрокИдГруппыВ   = 1;
КолИсхСтрокИдГруппыГ1Продолжение  = 12;
КолИсхСтрокИдГруппыГ2  = 5;
КолИсхСтрокИдГруппыГ3  = 6;
КолИсхСтрокИдГруппыД   = 3;
КолИсхСтрокИдГруппыЕ   = 6;
КолИсхСтрокИдГруппыЖ2  = 2;
КолИсхСтрокИдГруппыЗ   = 3;
КолИсхСтрокИдГруппыИ   = 3;
КолИсхСтрокИдГруппыК3  = 2;
КолИсхСтрокИдГруппыК4  = 2;

// структура многострочных разделов формы
мСтруктураМногострочныхРазделов = Новый Структура;
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыА, СтруктураГруппыА);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыБ, СтруктураГруппыБ);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыВ, СтруктураГруппыВ);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыГ1Продолжение, СтруктураГруппыГ1Продолжение);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыГ2, СтруктураГруппыГ2);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыГ3, СтруктураГруппыГ3);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыД, СтруктураГруппыД);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыЕ, СтруктураГруппыЕ);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыЖ2_1, СтруктураГруппыЖ2_1);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыЖ2_2, СтруктураГруппыЖ2_2);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыЗ, СтруктураГруппыЗ);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыИ, СтруктураГруппыИ);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыК3_1, СтруктураГруппыК3_1);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыК3_2, СтруктураГруппыК3_2);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыК4_1, СтруктураГруппыК4_1);
мСтруктураМногострочныхРазделов.Вставить(мИдГруппыК4_2, СтруктураГруппыК4_2);

// структура исходных строк (минимального кол-ва) многострочных разделов формы
мСтруктураИсхКолвоСтрокРазделов = Новый Структура;
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыА, КолИсхСтрокИдГруппыА);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыБ, КолИсхСтрокИдГруппыБ);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыВ, КолИсхСтрокИдГруппыВ);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыГ1Продолжение, КолИсхСтрокИдГруппыГ1Продолжение);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыГ2, КолИсхСтрокИдГруппыГ2);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыГ3, КолИсхСтрокИдГруппыГ3);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыД, КолИсхСтрокИдГруппыД);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыЕ, КолИсхСтрокИдГруппыЕ);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыЖ2_1, КолИсхСтрокИдГруппыЖ2);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыЖ2_2, КолИсхСтрокИдГруппыЖ2);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыЗ, КолИсхСтрокИдГруппыЗ);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыИ, КолИсхСтрокИдГруппыИ);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыК3_1, КолИсхСтрокИдГруппыК3);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыК3_2, КолИсхСтрокИдГруппыК3);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыК4_1, КолИсхСтрокИдГруппыК4);
мСтруктураИсхКолвоСтрокРазделов.Вставить(мИдГруппыК4_2, КолИсхСтрокИдГруппыК4);


ЦветЗаполняетсяТолькоВручную     = Новый Цвет(255, 255, 225);
ЦветЗаполняетсяАвтоКорректир     = Новый Цвет(255, 240, 200);
ЦветЗаполняетсяАвтоБезКорректир  = Новый Цвет(230, 240, 220);
ЦветЗаполняетсяАвтоАрифметика    = Новый Цвет(192, 220, 192); // ЗЕЛЕНЫЙ
ЦветЗаполняетсяОднозначноВручную = Новый Цвет(255, 255, 192); // ЖЕЛТЫЙ
ЦветЗаполняетсяАвтоматически     = Новый Цвет(255, 255, 255); // Белый, Ввод запрещен

// структура цветов раскраски автозаполняемых ячеек
мСтруктураЦветовРаскраски = Новый Структура;
мСтруктураЦветовРаскраски.Вставить("_1", ЦветЗаполняетсяТолькоВручную);
мСтруктураЦветовРаскраски.Вставить("_2", ЦветЗаполняетсяАвтоКорректир);
мСтруктураЦветовРаскраски.Вставить("_3", ЦветЗаполняетсяАвтоБезКорректир);
мСтруктураЦветовРаскраски.Вставить("_4", ЦветЗаполняетсяАвтоАрифметика);
мСтруктураЦветовРаскраски.Вставить("_0", ЦветЗаполняетсяОднозначноВручную);
мСтруктураЦветовРаскраски.Вставить("_5", ЦветЗаполняетсяАвтоматически);

ТаблицаСтраницыРаздела = ПолучитьТаблицуМногостраничногоРаздела();
ТаблицаСтраницыРазделаДляМногострочныхРазделов=ПолучитьТаблицуМногостраничногоРаздела(Истина);
мСтруктураМногостраничныхРазделов = Новый Структура;
мСтруктураМногостраничныхРазделов.Вставить("Раздел6", ТаблицаСтраницыРаздела.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистА", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистБ", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистГ1Продолжение", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистД", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистЕ", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистЖ2", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистЗ", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистЗПродолжение", ТаблицаСтраницыРаздела.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистИ", ТаблицаСтраницыРазделаДляМногострочныхРазделов.Скопировать());
мСтруктураМногостраничныхРазделов.Вставить("ЛистИПродолжение", ТаблицаСтраницыРаздела.Скопировать());

мСтатусНалогоплательщика = 0;

// Версия формы
мВерсияФормы = "01/01/2010";

// Код отчета, равен КНД
мКодОтчета = "1151020";

ВариантыФорматовВыгрузки = Новый СписокЗначений;
ВариантыФорматовВыгрузки.Добавить(мСоставПоказателей, "Формат 5.03", Истина);

ТаблицаСообщений = Новый ТаблицаЗначений;
ТаблицаСообщений.Колонки.Добавить("Раздел");
ТаблицаСообщений.Колонки.Добавить("Графа");
ТаблицаСообщений.Колонки.Добавить("Строка");
ТаблицаСообщений.Колонки.Добавить("Страница");
ТаблицаСообщений.Колонки.Добавить("СтрокаПП");
ТаблицаСообщений.Колонки.Добавить("ИмяЯчейки");
ТаблицаСообщений.Колонки.Добавить("Описание");

мПечатныеформы = Новый СписокЗначений;
мПечатаемыеРазделы = Новый СписокЗначений;

ТочностьЕдиницыИзмерения = 2;
ЕдиницаИзмерения = Перечисления.ПорядкиОкругленияОтчетности.Окр1;