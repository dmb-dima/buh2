Перем ТаблицаОрганизаций Экспорт;

Процедура ОбновитьОтчет(ВыводитьПолностью = Истина) Экспорт
	
	Если ВыводитьПолностью Тогда
		Если Не СтандартныеОтчеты.ПроверитьЗаполнениеОбязательныхРеквизитов(ЭтаФорма) Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;  
	
	Если РежимРасшифровки Тогда
		РежимРасшифровки = Ложь;
	Иначе
		СтандартныеОтчеты.СохранитьДанныеОтчета(ЭтаФорма);    
	КонецЕсли;
	
	Если НастройкиФормы.ЗакрыватьПанельПриФормированииОтчета И ВыводитьПолностью Тогда
		ЭлементыФормы.ДействияФормыДополнительные.Кнопки.ПанельПользователя.Пометка = Ложь;
		СтандартныеОтчеты.УправлениеОтображениемПанелиПользователя(ЭтаФорма);
	КонецЕсли;
	
	ФормироватьДиаграмму = ЭлементыФормы.ДействияФормыДополнительные.Кнопки.Диаграмма.Пометка;
	Если ДанныеОтчета.Свойство("ВысотаШапки") Тогда
		СтандартныеОтчеты.УправлениеОтображениемДиаграммы(ЭтаФорма, ДанныеОтчета.ВысотаШапки);
	Иначе
		СтандартныеОтчеты.УправлениеОтображениемДиаграммы(ЭтаФорма);
	КонецЕсли;
	
	СформироватьОтчет(ЭтаФорма.ЭлементыФормы.Результат, ДанныеРасшифровки, Ложь, , ВыводитьПолностью);
	СтандартныеОтчеты.ОбновитьКоллекциюКнопокИстории(ЭтаФорма);
	
КонецПроцедуры

Процедура ОбновитьПанельНастроек() Экспорт
	
	СтандартныеОтчеты.ОбновитьПредставлениеПоказателейОтчета(ЭтотОбъект, ЭтаФорма);
	Группировка                   = ДанныеОтчета.Группировка.Скопировать();
	ДополнительныеПоля            = ДанныеОтчета.ДополнительныеПоля.Скопировать();
	ПоказательДиаграммы           = ДанныеОтчета.ПоказательДиаграммы;
	ПредставлениеДиаграммы        = ДанныеОтчета.ПредставлениеДиаграммы;
	ПредставлениеПодписиДиаграммы = СтандартныеОтчеты.ПолучитьВидПодписиДиаграммы(ДанныеОтчета.ВидПодписиДиаграммы, Истина);
	РазмещениеДополнительныхПолей = ДанныеОтчета.РазмещениеДополнительныхПолей;
	
	ОбновитьПредставлениеВыводимыхДанных();
	
	Если НастройкиФормы.Свойство("ДоступностьПодразделения") Тогда
		ЭлементыФормы.Подразделение.Доступность = НастройкиФормы.ДоступностьПодразделения;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбновитьПредставлениеВыводимыхДанных() 
	
	ВыводимыеДанные.Очистить();
	
	// Сальдо на начало
	НоваяСтрока = ВыводимыеДанные.Добавить();
	НоваяСтрока.Дт     = СальдоНаНачалоДт;
	НоваяСтрока.Кт     = СальдоНаНачалоКт;
	НоваяСтрока.Данные = "Сальдо на начало";
	
	// Сальдо на конец
	НоваяСтрока = ВыводимыеДанные.Добавить();
	НоваяСтрока.Дт     = СальдоНаКонецДт;
	НоваяСтрока.Кт     = СальдоНаКонецКт;
	НоваяСтрока.Данные = "Сальдо на конец";
	
	// Оборот за период
	НоваяСтрока = ВыводимыеДанные.Добавить();
	НоваяСтрока.Дт     = ОборотыЗаПериодДт;
	НоваяСтрока.Кт     = ОборотыЗаПериодКт;
	НоваяСтрока.Данные = "Обороты за период";
	
	// Обороты со счетами
	НоваяСтрока = ВыводимыеДанные.Добавить();
	НоваяСтрока.Дт     = ОборотыСоСчетамиДт;
	НоваяСтрока.Кт     = ОборотыСоСчетамиКт;
	НоваяСтрока.Данные = "Обороты со счетами";
	
КонецПроцедуры
/////
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	ТиповыеОтчеты.НазначитьФормеУникальныйКлючИдентификации(ЭтаФорма);
	
	СохранятьНастройкуОтчета = Не РежимРасшифровки;
	
	Если Не СохранениеНастроек.ЗаполнитьНастройкиПриОткрытииОтчета(ОтчетОбъект) Тогда
		ИнициализацияОтчета();
	КонецЕсли;
	
	СтандартныеОтчеты.УстановитьВидимостьПодразделения(ЭтаФорма);
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если Не РежимРасшифровки Тогда
		Настроить();
	КонецЕсли;
	
	СтандартныеОтчеты.ВосстановитьНастройкиФормы(ЭтаФорма);
	ОбновитьПанельНастроек();
	СтандартныеОтчеты.УправлениеОтображениемОбластейОтчета(ЭтотОбъект, ЭтаФорма);
	СтандартныеОтчеты.УправлениеОтображениемПанелиПользователя(ЭтаФорма);
	СтандартныеОтчеты.ЗаполнитьТаблицуОрганизаций(ЭтаФорма);
	СтандартныеОтчеты.ЗаполнитьТаблицуЭлементов(ЭтаФорма);
	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	Заголовок = ПолучитьТекстЗаголовка(Ложь);
	
КонецПроцедуры
                             
Процедура ПриЗакрытии()
	
	СтандартныеОтчеты.СохранитьДанныеОтчета(ЭтаФорма);
	СтандартныеОтчеты.СохранитьНастройкиФормы(ЭтаФорма);
	СохранитьНастройку();
	
КонецПроцедуры
////////
Процедура ДействияФормыОсновныеСформировать(Кнопка)
	
	ОбновитьОтчет();
	
КонецПроцедуры

Процедура ДействияФормыОсновныеПечать(Кнопка)
	
	ЭлементыФормы.Результат.Напечатать(Ложь);
	
КонецПроцедуры

Процедура ДействияФормыОсновныеСохранитьКак(Кнопка)
	
	ПредставлениеСохраняемогоФайла = ПолучитьТекстЗаголовка(Ложь);
	СтандартныеОтчеты.СохранитьКопиюРезультатаОтчета(ЭтотОбъект, ЭтаФорма, ПредставлениеСохраняемогоФайла);
	
КонецПроцедуры
//
Процедура ДействияФормыДополнительныеДиаграмма(Кнопка)
	
	Кнопка.Пометка = Не Кнопка.Пометка;
	ФормироватьДиаграмму = Кнопка.Пометка;
	
	ТекстВывестиДиаграмму = "с диаграммой";
	ТекстУбратьДиаграмму  = "без диаграммы";
	ШаблонВопроса = "Для формирования отчета %диаграмма%, небоходимо переформировать отчет.
		|Сделать это сейчас?";
	ТекстВопроса = СтрЗаменить(ШаблонВопроса, "%диаграмма%", ?(Кнопка.Пометка, ТекстВывестиДиаграмму, ТекстУбратьДиаграмму));
	
	Если Вопрос(ТекстВопроса, РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Да Тогда
		ОбновитьОтчет();
	Иначе
		НастройкиФормы.Вставить("ВыводитьДиаграмму", ФормироватьДиаграмму);
	КонецЕсли;
	
КонецПроцедуры

Процедура ДействияФормыДополнительныеПанельПользователя(Кнопка)
	
	Кнопка.Пометка = Не Кнопка.Пометка;
	СтандартныеОтчеты.УправлениеОтображениемПанелиПользователя(ЭтаФорма);
	
КонецПроцедуры

Процедура ДействияФормыДополнительныеИстория(Кнопка) Экспорт
	
	СтандартныеОтчеты.ДействияФормыДополнительныеИстория(ЭтаФорма, Кнопка);
	
КонецПроцедуры

Процедура ДействияФормыДополнительныеВосстановитьЗначения(Кнопка)
	
	СтандартныеОтчеты.ДействияФормыДополнительныеВосстановитьЗначения(ЭтотОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура ДействияФормыДополнительныеСохранитьЗначения(Кнопка)
	
	СтандартныеОтчеты.ДействияФормыДополнительныеСохранитьЗначения(ЭтотОбъект, ЭтаФорма);
	
КонецПроцедуры
//
Процедура ДействияФормыДополнительныеНастройкаПанелиПользователя(Кнопка)
	
	СтандартныеОтчеты.НастроитьСтраницыПанелиПользователя(ЭтаФорма, Кнопка);
		
КонецПроцедуры

Процедура КоманднаяПанельПанелиНастроекЗакрытьПанельНастроек(Кнопка)
	
	КнопкаПанельПользователя = ЭлементыФормы.ДействияФормыДополнительные.Кнопки.ПанельПользователя;
	КнопкаПанельПользователя.Пометка = Не КнопкаПанельПользователя.Пометка;
	СтандартныеОтчеты.УправлениеОтображениемПанелиПользователя(ЭтаФорма);
	
КонецПроцедуры
////
Процедура ПоказательДиаграммыПриИзменении(Элемент)
	
	ДанныеОтчета.Вставить("ПоказательДиаграммы", ПоказательДиаграммы);
	
	Если ДанныеОтчета.Свойство("ВысотаШапки") И ДанныеОтчета.Свойство("КоличествоПоказателей") Тогда
		СтандартныеОтчеты.ОбработкаИзмененияНастроекДиаграммы(ЭтотОбъект, ЭлементыФормы.Результат, ДанныеОтчета.ВысотаШапки, ?(ДанныеОтчета.КоличествоПоказателей > 1, 2, 1));
	КонецЕсли;

КонецПроцедуры

Процедура ПредставлениеДиаграммыПриИзменении(Элемент)
	
	ДанныеОтчета.Вставить("ПредставлениеДиаграммы", ПредставлениеДиаграммы);
	
	Если ДанныеОтчета.Свойство("ВысотаШапки") И ДанныеОтчета.Свойство("КоличествоПоказателей") Тогда
		СтандартныеОтчеты.ОбработкаИзмененияНастроекДиаграммы(ЭтотОбъект, ЭлементыФормы.Результат, ДанныеОтчета.ВысотаШапки, ?(ДанныеОтчета.КоличествоПоказателей > 1, 2, 1));
	КонецЕсли;
	
КонецПроцедуры

Процедура ПредставлениеПодписиДиаграммыНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартныеОтчеты.ПредставлениеПодписиДиаграммыНачалоВыбора(ЭтаФорма, СтандартнаяОбработка);
	
КонецПроцедуры
//
Процедура ПоказателиОтчетаПриИзмененииФлажка(Элемент, Колонка)
	
	СтандартныеОтчеты.ПоказателиОтчетаПриИзмененииФлажка(ЭтотОбъект, Элемент, Колонка);
	
КонецПроцедуры
//
Процедура ВыводимыеДанныеПриИзмененииФлажка(Элемент, Колонка)
	
	Для Каждого СтрокаТаблицы Из ВыводимыеДанные Цикл
		Если СтрокаТаблицы.Данные = "Сальдо на начало" Тогда 
			СальдоНаНачалоДт = СтрокаТаблицы.Дт;
			СальдоНаНачалоКт = СтрокаТаблицы.Кт;
		ИначеЕсли СтрокаТаблицы.Данные = "Сальдо на конец" Тогда 
			СальдоНаКонецДт = СтрокаТаблицы.Дт;
			СальдоНаКонецКт = СтрокаТаблицы.Кт;
		ИначеЕсли СтрокаТаблицы.Данные = "Обороты за период" Тогда 
			ОборотыЗаПериодДт = СтрокаТаблицы.Дт;
			ОборотыЗаПериодКт = СтрокаТаблицы.Кт;
		ИначеЕсли СтрокаТаблицы.Данные = "Обороты со счетами" Тогда 
			ОборотыСоСчетамиДт = СтрокаТаблицы.Дт;
			ОборотыСоСчетамиКт = СтрокаТаблицы.Кт;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры
//
Процедура КоманднаяПанельДополнительныеПоляДобавитьЭлемент(Кнопка)
	
	СтандартныеОтчеты.ДополнительныеПоляДобавитьЭлемент(ЭтотОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура КоманднаяПанельДополнительныеПоляВключитьВсе(Кнопка)
	
	ДополнительныеПоля.ЗаполнитьЗначения(Истина, "Использование");
	
КонецПроцедуры

Процедура КоманднаяПанельДополнительныеПоляВыключитьВсе(Кнопка)
	
	ДополнительныеПоля.ЗаполнитьЗначения(Ложь, "Использование");
	
КонецПроцедуры

Процедура ДополнительныеПоляПередНачаломДобавления(Элемент, Отказ, Копирование)
	
	СтандартныеОтчеты.ДополнительныеПоляДобавитьЭлемент(ЭтотОбъект, ЭтаФорма, Отказ);
	
КонецПроцедуры

Процедура ДополнительныеПоляПередНачаломИзменения(Элемент, Отказ)
	
	СтандартныеОтчеты.ДополнительныеПоляПередНачаломИзменения(ЭтотОбъект, ЭтаФорма, Элемент, Отказ);
	
КонецПроцедуры
 
Процедура ДополнительныеПоляПриПолученииДанных(Элемент, ОформленияСтрок)
	
	СтандартныеОтчеты.РаскраскаНедоступныхПриПолученииДанных(Элемент, ОформленияСтрок);
	
КонецПроцедуры
//
Процедура КоманднаяПанельГруппировкаДобавитьЭлемент(Кнопка)
	
	СтандартныеОтчеты.ГруппировкаДобавитьЭлемент(ЭтотОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура КоманднаяПанельГруппировкаВключитьВсе(Кнопка)
	
	Группировка.ЗаполнитьЗначения(Истина, "Использование");
	
КонецПроцедуры

Процедура КоманднаяПанельГруппировкаВыключитьВсе(Кнопка)
	
	Группировка.ЗаполнитьЗначения(Ложь, "Использование");
	
КонецПроцедуры

Процедура ГруппировкаПередНачаломДобавления(Элемент, Отказ, Копирование)
	
	СтандартныеОтчеты.ГруппировкаДобавитьЭлемент(ЭтотОбъект, ЭтаФорма, Отказ);
	
КонецПроцедуры

Процедура ГруппировкаПередНачаломИзменения(Элемент, Отказ)
	
	СтандартныеОтчеты.ГруппировкаПередНачаломИзменения(ЭтотОбъект, ЭтаФорма, Элемент, Отказ);
	
КонецПроцедуры
  
Процедура ГруппировкаПриПолученииДанных(Элемент, ОформленияСтрок)
	
	СтандартныеОтчеты.РаскраскаНедоступныхПриПолученииДанных(Элемент, ОформленияСтрок);
	
КонецПроцедуры
//
Процедура КоманднаяПанельОтборДобавитьЭлемент(Кнопка)
	
	СтандартныеОтчеты.ОтборДобавитьЭлемент(ЭтотОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура КоманднаяПанельОтборДобавитьГруппу(Кнопка)
	
	СтандартныеОтчеты.ОтборДобавитьГруппу(ЭтотОбъект, ЭтаФорма, Кнопка);
	
КонецПроцедуры

Процедура ОтборПередНачаломДобавления(Элемент, Отказ, Копирование)
	
	СтандартныеОтчеты.ОтборДобавитьЭлемент(ЭтотОбъект, ЭтаФорма, Отказ);
	
КонецПроцедуры

Процедура ОтборПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	ОформлениеСтроки.Ячейки.ЛевоеЗначениеДляКраткогоОтображенияЭлемента.ОтображатьКартинку = Ложь;
	
КонецПроцедуры

Процедура ОтборПриПолученииДанных(Элемент, ОформленияСтрок)
	
	СтандартныеОтчеты.РаскраскаНедоступныхПриПолученииДанных(Элемент, ОформленияСтрок);
	
КонецПроцедуры

Процедура ОтборПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	
	СтандартныеОтчеты.ОтборПриОкончанииРедактирования(ЭтаФорма, Элемент, НоваяСтрока, ОтменаРедактирования);
	
КонецПроцедуры

Процедура ОтборЛевоеЗначениеДляКраткогоОтображенияЭлементаНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартныеОтчеты.ОтборНачалоВыбора(ЭтотОбъект, ЭтаФорма, Элемент, СтандартнаяОбработка);
	
КонецПроцедуры

Процедура ОтборПравоеЗначениеДляКраткогоОтображенияЭлементаНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартныеОтчеты.ОтборНачалоВыбора(ЭтотОбъект, ЭтаФорма, Элемент, СтандартнаяОбработка);

КонецПроцедуры
//
Процедура КоманднаяПанельСортировкаДобавитьЭлемент(Кнопка)
	
	СтандартныеОтчеты.ДобавитьЭлементСортировки(ЭтотОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура СортировкаПередНачаломДобавления(Элемент, Отказ, Копирование)
	
	СтандартныеОтчеты.ДобавитьЭлементСортировки(ЭтотОбъект, ЭтаФорма, Отказ);
	
КонецПроцедуры

Процедура СортировкаПередНачаломИзменения(Элемент, Отказ)
	
	СтандартныеОтчеты.СортировкаПередНачаломИзменения(ЭтотОбъект, ЭтаФорма, Элемент, Отказ);	
	
КонецПроцедуры

Процедура СортировкаПриПолученииДанных(Элемент, ОформленияСтрок)
	
	СтандартныеОтчеты.РаскраскаНедоступныхПриПолученииДанных(Элемент, ОформленияСтрок);
	
КонецПроцедуры
//
Процедура ФлагВыводитьЗаголовокПриИзменении(Элемент)
	
	НастройкиФормы.Вставить("ВыводитьЗаголовок", Элемент.Значение);

КонецПроцедуры

Процедура ФлагВыводитьПодписиПриИзменении(Элемент)
	
	НастройкиФормы.Вставить("ВыводитьПодписи", Элемент.Значение);
		
КонецПроцедуры

Процедура ПолеВыбораОформленияПриИзменении(Элемент)
	
	НастройкиФормы.Вставить("МакетОформления" , ЭлементыФормы.ПолеВыбораОформления.Значение);	
	
КонецПроцедуры

Процедура УсловноеОформлениеПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	СтандартныеОтчеты.УсловноеОформлениеПриВыводеСтроки(ЭтотОбъект, Элемент, ОформлениеСтроки, ДанныеСтроки);
	
КонецПроцедуры

Процедура УсловноеОформлениеПриПолученииДанных(Элемент, ОформленияСтрок)
	
	СтандартныеОтчеты.РаскраскаНедоступныхПриПолученииДанных(Элемент, ОформленияСтрок);
	
КонецПроцедуры
//
Процедура ПолеВводаПериодПриИзменении(Элемент)
	
	ТиповыеОтчеты.ОбновитьПараметрыПериодаПоФорме(КомпоновщикНастроек, ЭтаФорма);
	
КонецПроцедуры

Процедура КнопкаНастройкаПериодаНажатие(Элемент)
	
	ТиповыеОтчеты.НастроитьПериод(НастройкаПериода, НачалоПериода, КонецПериода);
	ТиповыеОтчеты.ОбновитьПараметрыПериодаПоФорме(КомпоновщикНастроек, ЭтаФорма);
	
КонецПроцедуры

Процедура СчетПриИзменении(Элемент)
	
	ОбработкаИзмененияСчета();
	ОбновитьПанельНастроек();
	
КонецПроцедуры

Процедура ОрганизацияПриИзменении(Элемент)
	
	СтандартныеОтчеты.ОрганизацияПриИзменении(ЭтаФорма, Элемент);
	
КонецПроцедуры 

Процедура ПодразделениеПриИзменении(Элемент)
	
	СтандартныеОтчеты.ПодразделениеПриИзменении(ЭтаФорма, Элемент);
	
КонецПроцедуры
////
Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	СтандартныеОтчеты.ОбработкаРасшифровкиСтандартногоОтчета(ЭтотОбъект, ЭтаФорма, Расшифровка, СтандартнаяОбработка);
	
КонецПроцедуры

Процедура РезультатПриАктивизацииОбласти(Элемент)
	
	СтандартныеОтчеты.РезультатПриАктивизацииОбласти(ЭтаФорма, Элемент);
	
КонецПроцедуры

Процедура УсловноеОформлениеПередНачаломИзменения(Элемент, Отказ)
	
	ТекКолонка = Элемент.ТекущаяКолонка;
	Если ТекКолонка = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	// Менять представление у предопределенных режимов оформления, нельзя
	Если ТекКолонка.Данные = "ПредставлениеДляКраткогоОтображенияЭлемента" И Элемент.ТекущаяСтрока.Представление <> "" Тогда
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры
