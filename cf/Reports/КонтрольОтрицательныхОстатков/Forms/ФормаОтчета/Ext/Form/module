Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	//ВыбранноеПоле = КомпоновщикНастроек.Настройки.Выбор.Элементы.Добавить(Тип("ВыбранноеПолеКомпоновкиДанных"));
	//ВыбранноеПоле.Поле = Новый ПолеКомпоновкиДанных("ФизЛицо.[Адрес по прописке физ. лица]");
	
	Если Не ЭтоОтработкаРасшифровки 
	   И Не СохранениеНастроек.ЗаполнитьНастройкиПриОткрытииОтчета(ОтчетОбъект) Тогда
		ИнициализацияОтчета();
	КонецЕсли;

	ТиповыеОтчеты.НазначитьФормеУникальныйКлючИдентификации(ЭтаФорма);
	ТиповыеОтчеты.ОбновитьФормуТиповогоОтчетаПоКомпоновщику(ОтчетОбъект, ЭтаФорма);
	ТиповыеОтчеты.УправлениеОтображениемЭлементовФормыТиповогоОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура ДействияФормыНастройки(Кнопка)
	
	Если ТиповыеОтчеты.РедактироватьНастройкиТиповогоОтчета(ОтчетОбъект, ЭтаФорма) Тогда
		//ОбновитьОтчет();
	КонецЕсли;
	
КонецПроцедуры

Процедура ДействияФормыСформировать(Кнопка)
	
	ОбновитьОтчет();
	
КонецПроцедуры

Процедура ДействияФормыЗаголовок(Кнопка)
	
	Кнопка.Пометка = Не Кнопка.Пометка;
	ТиповыеОтчеты.УправлениеОтображениемЭлементовФормыТиповогоОтчета(ОтчетОбъект, ЭтаФорма);
	ТиповыеОтчеты.УправлениеОтображениемЗаголовкаТиповогоОтчета(ОтчетОбъект, ЭтаФорма.ЭлементыФормы.Результат);
	
КонецПроцедуры

Процедура ДействияФормыОткрытьВНовомОкне(Кнопка)
	
	ТиповыеОтчеты.ОткрытьВНовомОкнеТиповойОтчет(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура ДействияФормыВосстановитьЗначения(Кнопка)
	
	СохранениеНастроек.ВыбратьНастройкуФормы(СохраненнаяНастройка, ЭтаФорма, "ОтчетОбъект." + ОтчетОбъект.Метаданные().Имя, Ложь);
	ТиповыеОтчеты.ОбновитьФормуТиповогоОтчетаПоКомпоновщику(ОтчетОбъект, ЭтаФорма);
	ТиповыеОтчеты.ОбновитьЗаголовокТиповогоОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура ДействияФормыСохранитьЗначения(Кнопка)
	
	СохранениеНастроек.ВыбратьНастройкуФормы(СохраненнаяНастройка, ЭтаФорма, "ОтчетОбъект." + ОтчетОбъект.Метаданные().Имя, Истина);
	ТиповыеОтчеты.ОбновитьЗаголовокТиповогоОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура ДействияФормыОтбор(Кнопка)
	
	Кнопка.Пометка = Не Кнопка.Пометка;
	ПоказыватьБыстрыйОтбор = Кнопка.Пометка;
	ТиповыеОтчеты.УправлениеОтображениемЭлементовФормыТиповогоОтчета(ОтчетОбъект, ЭтаФорма);
	ТиповыеОтчеты.ОбработкаИзмененияТиповогоОтчетаНаФормеОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	ТиповыеОтчеты.ОбновитьЗаголовокТиповогоОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура КнопкаНастройкаПериодаНажатие(Элемент)
	
	ТиповыеОтчеты.НастроитьПериод(НастройкаПериода, НачалоПериода, КонецПериода);
	ТиповыеОтчеты.ОбновитьПараметрыПериодаПоФорме(КомпоновщикНастроек, ЭтаФорма);
	ТиповыеОтчеты.ОбработкаИзмененияТиповогоОтчетаНаФормеОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура ПолеВводаПериодПриИзменении(Элемент)
	
	ТиповыеОтчеты.ОбновитьПараметрыПериодаПоФорме(КомпоновщикНастроек, ЭтаФорма);
	ТиповыеОтчеты.ОбработкаИзмененияТиповогоОтчетаНаФормеОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	МассивПолейРасшифровки = ТиповыеОтчеты.ПолучитьМассивПолейРасшифровки(Расшифровка, ЭтаФорма.ДанныеРасшифровки);
	
	ПоляРасшифровки = Новый Соответствие;
	
	Для каждого ПолеРасшифровки Из МассивПолейРасшифровки Цикл
		
		Если ТипЗнч(ПолеРасшифровки) = Тип("ЗначениеПоляРасшифровкиКомпоновкиДанных") Тогда
			ПоляРасшифровки.Вставить(ПолеРасшифровки.Поле, ПолеРасшифровки.Значение);
		КонецЕсли;
	
	КонецЦикла;
	
	Если ЗначениеЗаполнено(ПоляРасшифровки["Товар"]) Тогда
		
		СтандартнаяОбработка = Ложь;

		ФормаОтчета = Отчеты.АнализСубконто.ПолучитьФорму();
		ФормаОтчета.РежимРасшифровки = Истина;
		
		ПолеОрганизации = Новый ПолеКомпоновкиДанных("Организация");
		Для каждого ЭлементОтбора Из КомпоновщикНастроек.Настройки.Отбор.Элементы Цикл
			Если ЭлементОтбора.ЛевоеЗначение = ПолеОрганизации
				И ЭлементОтбора.Использование = Истина
				И ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно
				Тогда
				Организация = ЭлементОтбора.ПравоеЗначение;
			КонецЕсли;
		КонецЦикла;
		
		Если ЗначениеЗаполнено(Организация) Тогда
			ФормаОтчета.Организация = Организация;
		КонецЕсли;
		
		ЗначениеПараметра = ТиповыеОтчеты.ПолучитьПараметр(ФормаОтчета.КомпоновщикНастроек, "НачалоПериода");
		Если ЗначениеПараметра.Использование Тогда 
			ФормаОтчета.НачалоПериода = ЗначениеПараметра.Значение;
		КонецЕсли;
		ЗначениеПараметра = ТиповыеОтчеты.ПолучитьПараметр(ФормаОтчета.КомпоновщикНастроек, "КонецПериода");
		Если ЗначениеПараметра.Использование Тогда 
			ФормаОтчета.КонецПериода = ЗначениеПараметра.Значение;
		КонецЕсли;
		СписокВидовСубконто = Новый СписокЗначений;
		СписокВидовСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Номенклатура);
		СписокВидовСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Склады);
		ФормаОтчета.СписокВидовСубконто = СписокВидовСубконто.Скопировать();
		ФормаОтчета.Настроить();
		
		ТиповыеОтчеты.ДобавитьОтбор(ФормаОтчета.КомпоновщикНастроек, "Субконто1"    , ПоляРасшифровки["Товар"]);
		ТиповыеОтчеты.ДобавитьОтбор(ФормаОтчета.КомпоновщикНастроек, "Субконто2"    , ПоляРасшифровки["Склад"]);
		ТиповыеОтчеты.ДобавитьОтбор(ФормаОтчета.КомпоновщикНастроек, "Подразделение", ПоляРасшифровки["Подразделение"]);
		
		ФормаОтчета.ПоСубсчетам = Истина;
		ФормаОтчета.ДанныеОтчета.ПоказателиОтчета.ВалютнаяСумма.Значение = Ложь;
		ФормаОтчета.ДанныеОтчета.ПоказателиОтчета.Количество.Значение    = Истина;
		
		ФормаОтчета.Открыть();
		ФормаОтчета.ОбновитьОтчет();
		
	ИначеЕсли ЗначениеЗаполнено(ПоляРасшифровки["ДокументРасхода"]) Тогда
		
		СтандартнаяОбработка = Ложь;
		
		ОткрытьЗначение(ПоляРасшифровки["ДокументРасхода"]);
		
	Иначе
		
		ТиповыеОтчеты.ОбработкаРасшифровкиТиповогоОтчета(Расшифровка, СтандартнаяОбработка, ОтчетОбъект, ЭтаФорма);
		
	КонецЕсли;
	

КонецПроцедуры

Процедура ДействияФормыПечать(Кнопка)
	
	ТиповыеОтчеты.ПечатьТиповогоОтчета(ЭлементыФормы.Результат);
	
КонецПроцедуры

Процедура ОбновитьОтчет() Экспорт
	
	СформироватьОтчет(ЭтаФорма.ЭлементыФормы.Результат, ЭтаФорма.ДанныеРасшифровки);
	
КонецПроцедуры

Процедура ТабличноеПолеОтборПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	
	ТиповыеОтчеты.ОбработкаИзмененияТиповогоОтчетаНаФормеОтчета(ОтчетОбъект, ЭтаФорма);
	
КонецПроцедуры

