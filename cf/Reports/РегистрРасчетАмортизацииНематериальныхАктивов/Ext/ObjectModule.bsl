#Если Клиент Тогда
Перем НП Экспорт;

Перем CписокСчетов;
Перем ИтогСуммаАмортизации;

// Возвращает полное наименование элемента справочника, если у этого вида 
// справочников есть реквизит НаименованиеПолное.
// 
// Параметры:      
//    Элемент - элемент справочника, для которого нужно вернуть полное наименование
//
// Возвращаемое значение: 
//  Строка с полным наименованием.
//
Функция ПолноеНаименование(Элемент) Экспорт
 
	Если НЕ ЗначениеЗаполнено(Элемент) Тогда
		Возврат "";
 
	ИначеЕсли Элемент.Метаданные().Реквизиты.Найти("НаименованиеПолное") = Неопределено Тогда
		Возврат Элемент.Наименование;;

	ИначеЕсли НЕ ЗначениеЗаполнено(Элемент.НаименованиеПолное) Тогда
		Возврат Элемент.Наименование;

	Иначе
		Возврат Элемент.НаименованиеПолное;
	КонецЕсли;
 
КонецФункции

Процедура ВывестиСтроку(Опер, ДокументРезультат, Макет, ТабКоэффициентов)
	
	Если Опер.Амортизация = 0 Тогда
		Возврат;
	КонецЕсли;
	
	СтрокиТабКоэффициентов = ТабКоэффициентов.НайтиСтроки(Новый Структура("НематериальныйАктив,Период", Опер.НематериальныйАктив, КонецДня(КонецМесяца(Опер.Период))));
	Если СтрокиТабКоэффициентов = Неопределено Или СтрокиТабКоэффициентов.Количество() = 0  Тогда
		 СпециальныйКоэффициент = 0;
	 Иначе
		 СпециальныйКоэффициент = СтрокиТабКоэффициентов[0].СпециальныйКоэффициент;
	 КонецЕсли;
	
	Строка1 = Макет.ПолучитьОбласть("Строка|Общая1");
	Строка2 = Макет.ПолучитьОбласть("Строка|Объект");
	Строка3 = Макет.ПолучитьОбласть("Строка|Общая2");
	
	Строка1.Параметры.ДатаОперации = Формат(Опер.Период, "ДФ=dd.MM.yyyy");
	Строка3.Параметры.СпециальныйКоэффициент = СпециальныйКоэффициент;
	Строка3.Параметры.МетодНачисленияАмортизации = Опер.МетодНачисленияАмортизации;
	Строка2.Параметры.НаименованиеОбъекта = ПолноеНаименование(Опер.НематериальныйАктив);
	
	Если Опер.МетодНачисленияАмортизации = Перечисления.МетодыНачисленияАмортизации.Линейный Тогда
		Стоимость = Опер.ПервоначальнаяСтоимость;
		
	Иначе
		ОстаточнаяСтоимость = Опер.ПервоначальнаяСтоимость - Опер.АмортизацияНач;
		Если ОстаточнаяСтоимость < 0.2 * Опер.ПервоначальнаяСтоимость Тогда
			Стоимость = Опер.ПервоначальнаяСтоимость - Опер.СуммаНакопленнойАмортизации;
		Иначе
			Стоимость = ОстаточнаяСтоимость;
		КонецЕсли;
	КонецЕсли;
	
	Если Стоимость = 0 Тогда
		Возврат;
	КонецЕсли;
	
	КоличествоМесяцевПолезногоИспользованияНаНач = 0;
	ДатаПринятияКУчету = Опер.ДатаПринятияКУчету;
	ТекДата = КонецМесяца(ДобавитьМесяц(ДатаПринятияКУчету, 1));
	ТекДатаНач = КонецМесяца(Опер.Период);
	Пока ТекДата < ТекДатаНач Цикл
		КоличествоМесяцевПолезногоИспользованияНаНач = КоличествоМесяцевПолезногоИспользованияНаНач + 1;
		ТекДата = КонецМесяца(ДобавитьМесяц(ТекДата, 1));
	КонецЦикла;
	
	Строка3.Параметры.Стоимость = Стоимость;
	Строка3.Параметры.ПолезныйСрок = ?(Опер.СрокПолезногоИспользования - КоличествоМесяцевПолезногоИспользованияНаНач < 0, 0, Опер.СрокПолезногоИспользования - КоличествоМесяцевПолезногоИспользованияНаНач);
	Строка3.Параметры.СуммаАмортизации = Опер.Амортизация;

	ДокументРезультат.Вывести(Строка1);
	Если Не ГруппироватьПоОбъектам Тогда
		ДокументРезультат.Присоединить(Строка2);
	КонецЕсли;
	ДокументРезультат.Присоединить(Строка3);
	
	ИтогСуммаАмортизации = ИтогСуммаАмортизации + Опер.Амортизация;
	
КонецПроцедуры

// Выполняет запрос и формирует табличный документ-результат отчета
// в соответствии с настройками, заданными значениями реквизитов отчета.
//
// Параметры:
//	ДокументРезультат - табличный документ, формируемый отчетом
//	ПоказыватьЗаголовок - признак видимости строк с заголовком отчета
//	ВысотаЗаголовка - параметр, через который возвращается высота заголовка в строках 
//
Процедура СформироватьОтчет(ДокументРезультат, ПоказыватьЗаголовок, ВысотаЗаголовка, ТолькоЗаголовок = Ложь) Экспорт
	
	 ДокументРезультат.Очистить();

	Макет = ПолучитьМакет("Отчет");

	Если ГруппироватьПоОбъектам Тогда
		Заголовок1 = Макет.ПолучитьОбласть("Заголовок|Общая1");
		Заголовок2 = Макет.ПолучитьОбласть("Заголовок|Общая2");
		
	Иначе
		Заголовок1 = Макет.ПолучитьОбласть("Заголовок");
	КонецЕсли;
	
	Заголовок1.Параметры.НачалоПериода       = Формат(ДатаНач, "ДФ=dd.MM.yyyy");
	Заголовок1.Параметры.КонецПериода        = Формат(ДатаКон, "ДФ=dd.MM.yyyy");
	СведенияОбОрганизации = УправлениеКонтактнойИнформацией.СведенияОЮрФизЛице(Организация);
	НазваниеОрганизации = ФормированиеПечатныхФорм.ОписаниеОрганизации(СведенияОбОрганизации, "НаименованиеДляПечатныхФорм");
	Заголовок1.Параметры.НазваниеОрганизации = НазваниеОрганизации;
	Заголовок1.Параметры.ИННОрганизации      = "" + Организация.ИНН + "/" + Организация.КПП;
	Заголовок1.Параметры.НазваниеАмортизационнойГруппы = ?(НЕ ЗначениеЗаполнено(АмортизационнаяГруппа), "по всем", АмортизационнаяГруппа);
	
	Если ГруппироватьПоОбъектам Тогда
		ДокументРезультат.Вывести(Заголовок1);
		ДокументРезультат.Присоединить(Заголовок2);
		
	Иначе
		ДокументРезультат.Вывести(Заголовок1);
	КонецЕсли;

	// Параметр для показа заголовка
	ВысотаЗаголовка = ДокументРезультат.ВысотаТаблицы;

	// Когда нужен только заголовок:
	Если ТолькоЗаголовок Тогда
		Возврат;
	КонецЕсли;

	// Проверим заполнение обязательных реквизитов
	Если НалоговыйУчет.ПроверитьЗаполнениеОбязательныхРеквизитов(ДатаНач,ДатаКон,Организация) Тогда
		Возврат;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ВысотаЗаголовка) Тогда
		ДокументРезультат.Область("R1:R" + ВысотаЗаголовка).Видимость = ПоказыватьЗаголовок;
	КонецЕсли;
	
	// Шапка
	Если ГруппироватьПоОбъектам Тогда
		Шапка1 = Макет.ПолучитьОбласть("Шапка|Общая1");
		Шапка2 = Макет.ПолучитьОбласть("Шапка|Общая2");
		Шапка2.Параметры.НК1 = 2;
		Шапка2.Параметры.НК2 = 3;
		Шапка2.Параметры.НК3 = 4;
		Шапка2.Параметры.НК4 = 5;
		Шапка2.Параметры.НК5 = 6;
		
		ДокументРезультат.Вывести(Шапка1);
		ДокументРезультат.Присоединить(Шапка2);
		
	Иначе
		Шапка = Макет.ПолучитьОбласть("Шапка");
		Шапка.Параметры.НК1 = 3;
		Шапка.Параметры.НК2 = 4;
		Шапка.Параметры.НК3 = 5;
		Шапка.Параметры.НК4 = 6;
		Шапка.Параметры.НК5 = 7;
		ДокументРезультат.Вывести(Шапка);
	КонецЕсли;

	Если ГруппироватьПоОбъектам Тогда
		ТекстЗапроса = "ВЫБРАТЬ
		               |	ЕСТЬNULL(АмортизацияНМАНалоговыйУчетОстаткиИОбороты.СуммаНУОборотКт, 0) КАК Амортизация,
		               |	АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Период,
		               |	АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1 КАК НематериальныйАктив,
		               |	ВЫБОР
		               |		КОГДА АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1.АмортизационнаяГруппа В (ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ВосьмаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДевятаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДесятаяГруппа))
		               |				ИЛИ АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1.АмортизационнаяГруппа = ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ОтдельнаяГруппа)
		               |			ТОГДА ЗНАЧЕНИЕ(Перечисление.МетодыНачисленияАмортизации.Линейный)
		               |		ИНАЧЕ УчетнаяПолитикаОрганизаций.МетодНачисленияАмортизацииНУ
		               |	КОНЕЦ КАК МетодНачисленияАмортизации,
		               |	ВЫБОР
		               |		КОГДА ГОД(&ДатаПереходаКЛинейномуМетоду) = 2009
		               |			ТОГДА ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.ПервоначальнаяСтоимостьНУ, 0) - ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.АмортизацияДо2009, 0)
		               |		ИНАЧЕ ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.ПервоначальнаяСтоимостьНУ, 0) - ВЫБОР
		               |				КОГДА АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Период > &ДатаПереходаКЛинейномуМетоду
		               |					ТОГДА ЕСТЬNULL(АмортизацияОСПриПереходеКЛинейномуМетоду.СуммаНУОстатокКт, 0)
		               |				ИНАЧЕ 0
		               |			КОНЕЦ
		               |	КОНЕЦ КАК ПервоначальнаяСтоимость,
		               |	ВЫБОР
		               |		КОГДА ГОД(&ДатаПереходаКЛинейномуМетоду) = 2009
		               |			ТОГДА ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.СрокПолезногоИспользования, 0) - ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.ФактическийСрокИспользованияДо2009, 0)
		               |		ИНАЧЕ ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.СрокПолезногоИспользования, 0)
		               |	КОНЕЦ КАК СрокПолезногоИспользования,
		               |	ЕСТЬNULL(АмортизацияНМАНалоговыйУчетОстаткиИОбороты.СуммаНУНачальныйОстатокКт, 0) КАК АмортизацияНач,
		               |	СостояниеНМАОрганизацииСрезПоследних.Период КАК ДатаПринятияКУчету,
		               |	АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1.АмортизационнаяГруппа
		               |ПОМЕСТИТЬ РегистрАмортизацииНМА
		               |ИЗ
		               |	РегистрБухгалтерии.Хозрасчетный.ОстаткиИОбороты(&ДатаНачала, &ДатаКонца, Регистратор, Движения, Счет = &Счет, &ВидСубконто, Организация = &Организация) КАК АмортизацияНМАНалоговыйУчетОстаткиИОбороты
		               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияНМАНалоговыйУчет.СрезПоследних КАК ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних
		               |		ПО АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1 = ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.НематериальныйАктив
		               |			И АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Организация = ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.Организация
		               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Хозрасчетный.Остатки(&ДатаПереходаКЛинейномуМетоду, Счет = &Счет, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.НематериальныеАктивы), Организация = &Организация) КАК АмортизацияОСПриПереходеКЛинейномуМетоду
		               |		ПО (ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.НематериальныйАктив = АмортизацияОСПриПереходеКЛинейномуМетоду.Субконто1)
		               |			И (ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.Организация = АмортизацияОСПриПереходеКЛинейномуМетоду.Организация)
		               |			И ((НЕ АмортизацияОСПриПереходеКЛинейномуМетоду.Субконто1 В
		               |					(ВЫБРАТЬ
		               |						НематериальныеАктивы.Ссылка
		               |					ИЗ
		               |						Справочник.НематериальныеАктивы КАК НематериальныеАктивы
		               |					ГДЕ
		               |						(НематериальныеАктивы.АмортизационнаяГруппа В (ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ВосьмаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДевятаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДесятаяГруппа))
		               |							ИЛИ НематериальныеАктивы.АмортизационнаяГруппа = ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ОтдельнаяГруппа)))))
		               |			И (ВЫБОР
		               |				КОГДА ГОД(&ДатаПереходаКЛинейномуМетоду) = 2009
		               |					ТОГДА ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.МетодНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.МетодыНачисленияАмортизации.Нелинейный)
		               |				ИНАЧЕ ИСТИНА
		               |			КОНЕЦ)
		               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СостоянияНМАОрганизаций.СрезПоследних(, Состояние = &Состояние) КАК СостояниеНМАОрганизацииСрезПоследних
		               |		ПО АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1 = СостояниеНМАОрганизацииСрезПоследних.НематериальныйАктив
		               |			И АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Организация = СостояниеНМАОрганизацииСрезПоследних.Организация
		               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
		               |		ПО (УчетнаяПолитикаОрганизаций.Период В
		               |				(ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |					МАКСИМУМ(УстановкаПараметров.Период)
		               |				ИЗ
		               |					РегистрСведений.УчетнаяПолитикаОрганизаций КАК УстановкаПараметров
		               |				ГДЕ
		               |					УстановкаПараметров.Период <= НАЧАЛОПЕРИОДА(АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Период, МЕСЯЦ)
		               |					И УстановкаПараметров.Организация = &Организация))
		               |			И АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Организация = УчетнаяПолитикаОрганизаций.Организация
					   |;
					   |";
		
	Иначе
		ТекстЗапроса = "ВЫБРАТЬ
		               |	ЕСТЬNULL(АмортизацияНМАНалоговыйУчетОстаткиИОбороты.СуммаНУОборотКт, 0) КАК Амортизация,
		               |	АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Период,
		               |	ЕСТЬNULL(АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1, 0) КАК НематериальныйАктив,
					   |	ВЫБОР
					   |		КОГДА ((АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1.АмортизационнаяГруппа В (ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ВосьмаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДевятаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДесятаяГруппа))))
					   |			ИЛИ (АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1.АмортизационнаяГруппа = ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ОтдельнаяГруппа)) ТОГДА
					   |			ЗНАЧЕНИЕ(Перечисление.МетодыНачисленияАмортизации.Линейный)
					   |		ИНАЧЕ
					   |			УчетнаяПолитикаОрганизаций.МетодНачисленияАмортизацииНУ
					   |	КОНЕЦ КАК МетодНачисленияАмортизации,
		               |	ВЫБОР
		               |		КОГДА ГОД(&ДатаПереходаКЛинейномуМетоду) = 2009
		               |			ТОГДА ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.ПервоначальнаяСтоимостьНУ, 0) - ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.АмортизацияДо2009, 0)
		               |		ИНАЧЕ ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.ПервоначальнаяСтоимостьНУ, 0) - ВЫБОР
		               |				КОГДА АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Период > &ДатаПереходаКЛинейномуМетоду
		               |					ТОГДА ЕСТЬNULL(АмортизацияОСПриПереходеКЛинейномуМетоду.СуммаНУОстатокКт, 0)
		               |				ИНАЧЕ 0
		               |			КОНЕЦ
		               |	КОНЕЦ КАК ПервоначальнаяСтоимость,
		               |	ВЫБОР
		               |		КОГДА ГОД(&ДатаПереходаКЛинейномуМетоду) = 2009
		               |			ТОГДА ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.СрокПолезногоИспользования, 0) - ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.ФактическийСрокИспользованияДо2009, 0)
		               |		ИНАЧЕ ЕСТЬNULL(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.СрокПолезногоИспользования, 0)
		               |	КОНЕЦ КАК СрокПолезногоИспользования,
		               |	ЕСТЬNULL(АмортизацияНМАНалоговыйУчетОстаткиИОбороты.СуммаНУНачальныйОстатокКт, 0) КАК АмортизацияНач,
		               |	СостояниеНМАОрганизацииСрезПоследних.Период КАК ДатаПринятияКУчету
					   |ПОМЕСТИТЬ РегистрАмортизацииНМА
		               |ИЗ
		               |	РегистрБухгалтерии.Хозрасчетный.ОстаткиИОбороты(&ДатаНачала, &ДатаКонца, Регистратор, Движения, Счет = &Счет, &ВидСубконто, Организация = &Организация) КАК АмортизацияНМАНалоговыйУчетОстаткиИОбороты
		               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияНМАНалоговыйУчет.СрезПоследних КАК ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних
		               |		ПО АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1 = ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.НематериальныйАктив
		               |			И АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Организация = ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.Организация
					   |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Хозрасчетный.Остатки(&ДатаПереходаКЛинейномуМетоду, 
					   |		                                     Счет = &Счет,
					   |		                                     ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.НематериальныеАктивы), 
					   |		                                     Организация = &Организация) КАК АмортизацияОСПриПереходеКЛинейномуМетоду
					   |			ПО ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.НематериальныйАктив = АмортизацияОСПриПереходеКЛинейномуМетоду.Субконто1
					   |			И ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.Организация = АмортизацияОСПриПереходеКЛинейномуМетоду.Организация
					   |			И АмортизацияОСПриПереходеКЛинейномуМетоду.Субконто1 НЕ В (ВЫБРАТЬ НематериальныеАктивы.Ссылка ИЗ Справочник.НематериальныеАктивы КАК НематериальныеАктивы ГДЕ 
					   |			(НематериальныеАктивы.АмортизационнаяГруппа В (ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ВосьмаяГруппа), 
					   |			                                      ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДевятаяГруппа), 
					   |			                                      ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДесятаяГруппа))) 
					   |			ИЛИ (НематериальныеАктивы.АмортизационнаяГруппа = ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ОтдельнаяГруппа)))
					   |			И ВЫБОР КОГДА ГОД(&ДатаПереходаКЛинейномуМетоду) = 2009 ТОГДА
					   |				(ПервоначальныеСведенияОНМАНалоговыйУчетСрезПоследних.МетодНачисленияАмортизации = ЗНАЧЕНИЕ(Перечисление.МетодыНачисленияАмортизации.Нелинейный))
					   |			  ИНАЧЕ ИСТИНА КОНЕЦ
		               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СостоянияНМАОрганизаций.СрезПоследних(, Состояние = &Состояние) КАК СостояниеНМАОрганизацииСрезПоследних
		               |		ПО АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Субконто1 = СостояниеНМАОрганизацииСрезПоследних.НематериальныйАктив
		               |			И АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Организация = СостояниеНМАОрганизацииСрезПоследних.Организация
					   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
					   |		ПО (УчетнаяПолитикаОрганизаций.Период В
					   |				(ВЫБРАТЬ РАЗЛИЧНЫЕ
					   |					МАКСИМУМ(УстановкаПараметров.Период)
					   |				ИЗ
					   |					РегистрСведений.УчетнаяПолитикаОрганизаций КАК УстановкаПараметров
					   |				ГДЕ
					   |					УстановкаПараметров.Период <= НАЧАЛОПЕРИОДА(АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Период, МЕСЯЦ)
					   |					И УстановкаПараметров.Организация = &Организация))
					   |			И АмортизацияНМАНалоговыйУчетОстаткиИОбороты.Организация = УчетнаяПолитикаОрганизаций.Организация
					   |;
					   |";
	КонецЕсли;
	
	ТекстЗапроса = ТекстЗапроса + "
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РегистрАмортизацииНМА.Период,
	|	МАКСИМУМ(УчетнаяПолитикаОрганизаций.Период) КАК ПериодСреза
	|ПОМЕСТИТЬ УчетнаяПолитикаОрганизацийСрезПоследнихПериодовНМА
	|ИЗ
	|	РегистрАмортизацииНМА КАК РегистрАмортизацииНМА
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|		ПО РегистрАмортизацииНМА.Период >= УчетнаяПолитикаОрганизаций.Период
	|ГДЕ
	|	ВЫБОР КОГДА &ДатаКонца = ДАТАВРЕМЯ(1,1,1) ТОГДА ИСТИНА ИНАЧЕ УчетнаяПолитикаОрганизаций.Период < &ДатаКонца КОНЕЦ
	|	И УчетнаяПолитикаОрганизаций.Организация = &Организация
	|СГРУППИРОВАТЬ ПО
	|	РегистрАмортизацииНМА.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	УчетнаяПолитикаОрганизацийСрезПоследнихПериодовНМА.Период,
	|	УчетнаяПолитикаОрганизаций.МетодНачисленияАмортизацииНУ КАК МетодНачисленияАмортизацииНУ
	|ПОМЕСТИТЬ УчетнаяПолитикаОрганизацийСрезПоследнихНМА
	|ИЗ
	|	УчетнаяПолитикаОрганизацийСрезПоследнихПериодовНМА КАК УчетнаяПолитикаОрганизацийСрезПоследнихПериодовНМА
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаОрганизаций КАК УчетнаяПолитикаОрганизаций
	|		ПО УчетнаяПолитикаОрганизацийСрезПоследнихПериодовНМА.ПериодСреза = УчетнаяПолитикаОрганизаций.Период
	|ГДЕ
	|	ВЫБОР КОГДА &ДатаКонца = ДАТАВРЕМЯ(1,1,1) ТОГДА ИСТИНА ИНАЧЕ УчетнаяПолитикаОрганизаций.Период < &ДатаКонца КОНЕЦ
	|	И УчетнаяПолитикаОрганизаций.Организация = &Организация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ * ИЗ РегистрАмортизацииНМА
	|ГДЕ
	|	(РегистрАмортизацииНМА.НематериальныйАктив.АмортизационнаяГруппа В (ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ВосьмаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДевятаяГруппа), ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ДесятаяГруппа)))
	|	ИЛИ (РегистрАмортизацииНМА.НематериальныйАктив.АмортизационнаяГруппа = ЗНАЧЕНИЕ(Перечисление.АмортизационныеГруппы.ОтдельнаяГруппа))
	|	ИЛИ (РегистрАмортизацииНМА.Период НЕ В
	|			(ВЫБРАТЬ
	|				УчетнаяПолитикаОрганизацийСрезПоследнихНМА.Период
	|			ИЗ
	|				УчетнаяПолитикаОрганизацийСрезПоследнихНМА
	|			ГДЕ
	|				УчетнаяПолитикаОрганизацийСрезПоследнихНМА.МетодНачисленияАмортизацииНУ = ЗНАЧЕНИЕ(Перечисление.МетодыНачисленияАмортизации.Нелинейный)))
	|";
	
	Если ГруппироватьПоОбъектам Тогда
	
		ТекстЗапроса = ТекстЗапроса + "ИТОГИ
		                              |	СУММА(Амортизация)
		                              |ПО
		                              |	НематериальныйАктив
									  |";
									  
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("ДатаНачала", НачалоДня(ДатаНач));
	Запрос.УстановитьПараметр("ДатаКонца", КонецДня(ДатаКон));
	Запрос.УстановитьПараметр("АмортизационнаяГруппа", АмортизационнаяГруппа);
	Запрос.УстановитьПараметр("ФильтрПоГруппе", Не АмортизационнаяГруппа.Пустая());
	Запрос.УстановитьПараметр("ЗначениеИстина", Истина);
	Запрос.УстановитьПараметр("Состояние", Перечисления.ВидыСостоянийНМА.ПринятКУчету);
	Запрос.УстановитьПараметр("Счет",ПланыСчетов.Хозрасчетный.АмортизацияНематериальныхАктивов);
	Запрос.УстановитьПараметр("ВидСубконто",ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.НематериальныеАктивы);
	Запрос.УстановитьПараметр("ДатаПереходаКЛинейномуМетоду", УправлениеВнеоборотнымиАктивами.ПолучитьДатуПереходаКЛинейномуМетоду(ДатаНач, Организация));
	Запрос.Текст = ТекстЗапроса;
	
	ТабКоэффициентов = Новый ТаблицаЗначений;
	ТабКоэффициентов.Колонки.Добавить("Период");
	ТабКоэффициентов.Колонки.Добавить("НематериальныйАктив");
	ТабКоэффициентов.Колонки.Добавить("СпециальныйКоэффициент",	Новый ОписаниеТипов("Число"));
	ТекМесяц = КонецДня(КонецМесяца(ДатаНач));

Пока ТекМесяц <= КонецДня(ДобавитьМесяц(ДатаКон, 1)) Цикл
	ТекстЗапросаДляКоф = "ВЫБРАТЬ
	  |	НачислениеАмортизацииНМАСпециальныйКоэффициентНалоговыйУчетСрезПоследних.СпециальныйКоэффициент,
	  |	НачислениеАмортизацииНМАСпециальныйКоэффициентНалоговыйУчетСрезПоследних.НематериальныйАктив,
	  |	НачислениеАмортизацииНМАСпециальныйКоэффициентНалоговыйУчетСрезПоследних.Период
	  |ИЗ
	  |	РегистрСведений.НачислениеАмортизацииНМАСпециальныйКоэффициентНалоговыйУчет.СрезПоследних(&ТекПериод, Организация = &Организация) КАК НачислениеАмортизацииНМАСпециальныйКоэффициентНалоговыйУчетСрезПоследних";
	ЗапросДляКоф = Новый Запрос;
	ЗапросДляКоф.УстановитьПараметр("Организация", Организация);
	ЗапросДляКоф.УстановитьПараметр("ТекПериод", ДобавитьМесяц(ТекМесяц, -1));
	ЗапросДляКоф.Текст = ТекстЗапросаДляКоф;

	ВыборкаКоэф = ЗапросДляКоф.Выполнить().Выгрузить();
	Для Каждого Строка Из ВыборкаКоэф Цикл
		СтрокаТаблицы = ТабКоэффициентов.Добавить();
		СтрокаТаблицы.Период = ТекМесяц;
		СтрокаТаблицы.НематериальныйАктив = Строка.НематериальныйАктив;
		СтрокаТаблицы.СпециальныйКоэффициент = Строка.СпециальныйКоэффициент;
	КонецЦикла;
	ТекМесяц = КонецДня(КонецМесяца(ДобавитьМесяц(ТекМесяц, 1)));
	КонецЦикла;
	
	СтруктураПоиска = Новый Структура;
	СтруктураПоиска.Вставить("Организация", Организация);
	
	ИтогСуммаАмортизации = 0;
	
	Если ГруппироватьПоОбъектам Тогда
		Опер = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
	Иначе
		Опер = Запрос.Выполнить().Выбрать();
	КонецЕсли;
	
	Пока Опер.Следующий() Цикл
		Если (Опер.НематериальныйАктив.АмортизационнаяГруппа <> АмортизационнаяГруппа) и (не АмортизационнаяГруппа.Пустая()) Тогда
			Продолжить;
		КонецЕсли;
		
		Если ГруппироватьПоОбъектам Тогда
			Группировка1 = Макет.ПолучитьОбласть("Группировка|Общая1");
			Группировка3 = Макет.ПолучитьОбласть("Группировка|Общая2");
			
			Группировка1.Параметры.ЗначениеГруппировки = ПолноеНаименование(Опер.НематериальныйАктив);
			Группировка3.Параметры.ИтогСуммаПоГруппировке = Опер.Амортизация;
			
			ДокументРезультат.Вывести(Группировка1);
			ДокументРезультат.Присоединить(Группировка3);
			
			ОперПоОбъекту = Опер.Выбрать();
			Пока ОперПоОбъекту.Следующий() Цикл
				ВывестиСтроку(ОперПоОбъекту, ДокументРезультат, Макет, ТабКоэффициентов);
			КонецЦикла;
			
		Иначе
			ВывестиСтроку(Опер, ДокументРезультат, Макет, ТабКоэффициентов);
		КонецЕсли;
	КонецЦикла;
	
	// Подвал
	Если ГруппироватьПоОбъектам Тогда
		Подвал1 = Макет.ПолучитьОбласть("Подвал1|Общая1");
		Подвал2 = Макет.ПолучитьОбласть("Подвал1|Общая2");
		Подвал2.Параметры.ИтогСуммаАмортизации = ИтогСуммаАмортизации;
		ДокументРезультат.Вывести(Подвал1);
		ДокументРезультат.Присоединить(Подвал2);
		
	Иначе
		Подвал = Макет.ПолучитьОбласть("Подвал1");
		Подвал.Параметры.ИтогСуммаАмортизации = ИтогСуммаАмортизации;
		ДокументРезультат.Вывести(Подвал);
	КонецЕсли;
	
	ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
	СтруктураЛиц = РегламентированнаяОтчетность.ОтветственныеЛицаОрганизаций(Организация, ДатаКон);
	ОбластьПодвал.Параметры.ОтветственныйЗаРегистры = ОбщегоНазначения.ФамилияИнициалыФизЛица(СтруктураЛиц.ОтветственныйЗаРегистры);
	ДокументРезультат.Вывести(ОбластьПодвал);

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ
// 

НП = Новый НастройкаПериода;
#КонецЕсли
