
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	ЭлементыФормы.ПолеHTMLДокументаСообщение.УстановитьТекст(ПолучитьМакет("ПодтверждениеВыходаВИнтернетДляЦелейОбновленияМодуля").ПолучитьТекст());
	
КонецПроцедуры

Процедура КнопкаРазрешитьНажатие(Элемент)
	
	СохранитьЗначение("ДокументооборотСКонтролирующимиОрганами_РазрешитьОнлайнОбновление", Истина);
	
	ПрерватьПопыткиСоединения = Ложь;
	Пока НЕ ДоступВИнтернетОткрыт() И НЕ ПрерватьПопыткиСоединения Цикл
		ПрерватьПопыткиСоединения = НЕ ПоказатьДиалогОшибкиДоступаВИнтернет("Ошибка доступа к серверу обновлений модуля документооборота с контролирующими органами.");
	КонецЦикла;;
	
	Закрыть(НЕ ПрерватьПопыткиСоединения);
	
КонецПроцедуры

Процедура КнопкаЗапретитьНажатие(Элемент)
	
	СохранитьЗначение("ДокументооборотСКонтролирующимиОрганами_РазрешитьОнлайнОбновление", Ложь);
	Закрыть(Ложь);
	
КонецПроцедуры

Процедура КнопкаНапомнитьПозжеНажатие(Элемент)
	
	Закрыть();
	
КонецПроцедуры

Функция ДоступВИнтернетОткрыт()
	
	URLСервера = "downloads.1c.ru";
	КаталогФайловНаСервере = "/RO_OnlineServices/XCHG_FNS";
	ИмяКлючевогоФайлаНаСервере = "/infomap.dat";
	
	Соединение = УстановитьСоединениеССерверомИнтернета(URLСервера);
	Если Соединение = Неопределено Тогда
		Возврат Ложь;
	КонецЕсли;
	
	КлючевойФайл = ПолучитьИмяВременногоФайла();
	Попытка
		Соединение.Получить(КаталогФайловНаСервере + ИмяКлючевогоФайлаНаСервере, КлючевойФайл);
		УдалитьФайлы(КлючевойФайл);
		Возврат Истина;
	Исключение
		Возврат Ложь;
	КонецПопытки;
	
КонецФункции
