
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	ЗаполнитьДанные(Отказ);
	Если Отказ Тогда
		ПоказатьТекстОтказа();
		Возврат;
	КонецЕсли;
	
	Заголовок = СокрЛП("Отказ в обслуживании " + СокрЛП(ИмяФайлаОтказа));
	
КонецПроцедуры

Процедура ПоказатьТекстОтказа()
	
	Текст = Новый ТекстовыйДокумент;
	Текст.УстановитьТекст(ТекстОтказа);
	Текст.Показать(СокрЛП("Отказ в обслуживании " + СокрЛП(ИмяФайлаОтказа)), СокрЛП(ИмяФайлаОтказа));
	
КонецПроцедуры

Процедура ЗаполнитьДанные(Отказ)
	
	Если НЕ ЗначениеЗаполнено(ТекстОтказа) Тогда
		Предупреждение("Уведомление пусто!");
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	Дерево = КонтекстЭДО.ЗагрузитьСтрокуXMLВДеревоЗначений(ТекстОтказа);
	
	// заполняем причины отказа
	УзлыПричОтказ = Дерево.Строки.НайтиСтроки(Новый Структура("Имя", "ПричОтказ"), Истина);
	Для Каждого УзелПричОтказ Из УзлыПричОтказ Цикл
		
		УзелНомПП = УзелПричОтказ.Строки.Найти("НомПП", "Имя");
		УзелТекстОшОб = УзелПричОтказ.Строки.Найти("ТекстОшОб", "Имя");
		
		Если УзелНомПП <> Неопределено И УзелТекстОшОб <> Неопределено Тогда
			НовСтр = ПричиныОтказа.Добавить();
			НовСтр.НомерСтроки = УзелНомПП.Значение;
			НовСтр.ТекстСообщения = УзелТекстОшОб.Значение;
		КонецЕсли;
		
	КонецЦикла;
	
	
КонецПроцедуры