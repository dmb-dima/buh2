Перем СпрашиватьПриЗакрытии;

Функция Проверить()
	
	Если ПустаяСтрока(ИмяФайла) Тогда
		Предупреждение("Имя файла не задано!");
		ТекущийЭлемент = ЭлементыФормы.ИмяФайла;
		Возврат Ложь;
	КонецЕсли;
	
	Если ПустаяСтрока(Текст) Тогда
		Предупреждение("Текст выгрузки пуст!");
		ТекущийЭлемент = ЭлементыФормы.Текст;
		Возврат Ложь;
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Если СпрашиватьПриЗакрытии Тогда
		Если Модифицированность Тогда
			Ответ = Вопрос("Данные были изменены. Сохранить изменения?", РежимДиалогаВопрос.ДаНетОтмена);
			Если Ответ = КодВозвратаДиалога.Да Тогда
				Если НЕ Проверить() Тогда
					Отказ = Истина;
					СпрашиватьПриЗакрытии = Истина;
					Возврат;
				КонецЕсли;
				Отказ = Истина;
				СпрашиватьПриЗакрытии = Ложь;
				Закрыть(Истина);
			ИначеЕсли Ответ = КодВозвратаДиалога.Нет Тогда
				Отказ = Истина;
				СпрашиватьПриЗакрытии = Ложь;
				Закрыть(Ложь);
			Иначе
				Отказ = Истина;
				СпрашиватьПриЗакрытии = Истина;
			КонецЕсли;
		Иначе
			Отказ = Истина;
			СпрашиватьПриЗакрытии = Ложь;
			Закрыть(Ложь);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОсновныеДействияФормыОК(Кнопка)
	
	Если НЕ Проверить() Тогда
		Возврат;
	КонецЕсли;
	СпрашиватьПриЗакрытии = Ложь;
	Закрыть(Истина);
	
КонецПроцедуры

Процедура ЗаголовокПриИзменении(Элемент)
	
	ОбновитьЗаголовок();
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	ОбновитьЗаголовок();
	
КонецПроцедуры

Процедура ОбновитьЗаголовок()
	
	Заголовок = ?(ПустаяСтрока(ИмяФайла), "<имя файла не задано>", СокрЛП(ИмяФайла)) + " - редактирование";
	
КонецПроцедуры

СпрашиватьПриЗакрытии = Истина;