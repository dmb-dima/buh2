
Процедура КоманднаяПанель1Выполнить(Кнопка) 
	
	ОбновитьПоиск();
	
КонецПроцедуры

Процедура КоманднаяПанель1Справка(Кнопка)
	
	ОткрытьПодсказкуПользователю("ПоискСовпадающихОбъектов");
	
КонецПроцедуры

Процедура ОткрытьПодсказкуПользователю(ИмяПодсказки)
	
	ФормаПомощи = ПолучитьФорму("ФормаПомощи");
	ФормаПомощи.ОткрытьПомощь(ИмяПодсказки);
	ФормаПомощи.Открыть();	
	
КонецПроцедуры

Процедура ОбновитьПоиск() Экспорт
	
	ДеревоСовпадающихОбъектов.Строки.Очистить();
	ДеревоПоиска = ВыполнитьПоискСовпадающихОбъектов();
	
	Если ДеревоСовпадающихОбъектов.Колонки.Найти("ЗначенияРеквизитов") = Неопределено тогда	
		
		ДеревоСовпадающихОбъектов.Колонки.Добавить("ЗначенияРеквизитов");
		
	КонецЕсли;	
	
	ЗаполнитьОдинаковыеСтрокиДерева(ДеревоПоиска,ДеревоСовпадающихОбъектов);
	ЭлементыФормы.ДеревоСовпадающихОбъектов.Колонки.КолВо_Всего.ТекстПодвала = ДеревоСовпадающихОбъектов.Строки.Итог("КоличествоЭлементов");
	
КонецПроцедуры	

Процедура ДеревоСовпадающихОбъектовПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	Если ДанныеСтроки.Строки.Количество() = 0 Тогда
		
		ОформлениеСтроки.Ячейки.КоличествоЭлементов.УстановитьТекст("");
		
	КонецЕсли;	
	
КонецПроцедуры

Процедура ДеревоСовпадающихОбъектовОбъектОткрытие(Элемент, СтандартнаяОбработка)
	
	Если ТипЗнч(Элемент.Значение) = Тип("Строка") тогда
		
		СтандартнаяОбработка = Ложь;
		СтрокаДанных = ЭлементыФормы.ДеревоСовпадающихОбъектов.ТекущаяСтрока;
		
		Если СтрокаДанных<>Неопределено И ТипЗнч(СтрокаДанных.ЗначенияРеквизитов) = Тип("Соответствие") тогда
			
			СтрокаЗаголовка = "Реквизиты объекта : " + Строка(СтрокаДанных.Объект) + " ("+Строка(СтрокаДанных.Родитель.Объект)+")";
			ОткрытьФормуРеквизитовОбъекта(СтрокаДанных.ЗначенияРеквизитов,СтрокаЗаголовка)
			
		КонецЕсли;	
		
	КонецЕсли;	
	
КонецПроцедуры
//открывает форму реквизитов объекта
//Параметры: 
//РеквизитыОбъекта  - соответствие;
//ЗаголовокФормы    - строка
Процедура ОткрытьФормуРеквизитовОбъекта(РеквизитыОбъекта,СтрокаЗаголовка = "")
	
	ФормаРеквизитовОбъектов = ПолучитьФорму("СписокРеквизитовОбъектаСравнения");
	ФормаРеквизитовОбъектов.Заголовок = СтрокаЗаголовка;
	
	Для каждого РеквизитИЗначение Из РеквизитыОбъекта цикл
		
		НовСтр = ФормаРеквизитовОбъектов.ТаблицаРеквизитовОбъекта.Добавить();	
		НовСтр.Реквизит = РеквизитИЗначение.Ключ;
		НовСтр.ЗначениеРеквизита = РеквизитИЗначение.Значение;
		
	КонецЦикла;	
	
	ФормаРеквизитовОбъектов.ОткрытьМодально();
	
КонецПроцедуры	


