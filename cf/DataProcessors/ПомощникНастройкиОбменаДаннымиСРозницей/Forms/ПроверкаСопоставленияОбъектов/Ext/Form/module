Процедура КоманднаяПанель1Выполнить(Кнопка) 
	
	ОбновитьАнализ();
	
КонецПроцедуры

Процедура КоманднаяПанель1Справка(Кнопка)
	
	ОткрытьПодсказкуПользователю("ПроверкаСопоставленияОбъектов");
	
КонецПроцедуры

Процедура ОткрытьПодсказкуПользователю(ИмяПодсказки)
	
	ФормаПомощи = ПолучитьФорму("ФормаПомощи");
	ФормаПомощи.ОткрытьПомощь(ИмяПодсказки);
	ФормаПомощи.Открыть();	
	
КонецПроцедуры

Процедура ОбновитьАнализ() Экспорт
	
	РезультатАнализаСопоставленияОбъектов.Строки.Очистить();
	
	Если РезультатАнализаСопоставленияОбъектов.Колонки.Найти("UIDОбъекта") = Неопределено тогда	
		
		РезультатАнализаСопоставленияОбъектов.Колонки.Добавить("UIDОбъекта");
		
	КонецЕсли;	
	
	АнализСопоставления = ВыполнитьАнализСопоставленияОбъектов(Истина);
	
	Если АнализСопоставления.ПерваяЧастьЭтаБаза.Строки.Количество() > 0  
		ИЛИ АнализСопоставления.ВтораяЧастьЭтаБаза.Строки.Количество() > 0  Тогда
		
	СтрокаИБ = РезультатАнализаСопоставленияОбъектов.Строки.Добавить();
	СтрокаИБ.ПерваяКолонка = "В этой информационной базе";

	КонецЕсли;	
    		
	Для каждого СтрокаЗаголовка Из АнализСопоставления.ПерваяЧастьЭтаБаза.Строки цикл
		
		СтрокаЗаголовкаРезультата = СтрокаИБ.Строки.Добавить();
		СтрокаЗаголовкаРезультата.ПерваяКолонка = СтрокаЗаголовка.Заголовок;
		СтрокаЗаголовкаРезультата.ВтораяКолонка = "Ссылка в базе-приемнике";
		СтрокаЗаголовкаРезультата.КоличествоСопоставлений = "Количество дублей";
		
		Для каждого СтрокаУзлов Из СтрокаЗаголовка.Строки цикл
			
			СтрокаУзловРезультата = СтрокаЗаголовкаРезультата.Строки.Добавить();
			СтрокаУзловРезультата.ПерваяКолонка = СтрокаУзлов.УзелОбмена;
			СтрокаУзловРезультата.КоличествоСопоставлений = СтрокаУзлов.КоличествоСопоставлений;
			
			Для каждого СтрокаОбъектов Из СтрокаУзлов.Строки цикл
				
				СтрокаОбъектовРезультата = СтрокаУзловРезультата.Строки.Добавить();
				СтрокаОбъектовРезультата.ПерваяКолонка = СтрокаОбъектов.СобственнаяСсылка;
				СтрокаОбъектовРезультата.КоличествоСопоставлений = СтрокаОбъектов.КоличествоСопоставлений;
				
				Для каждого СтрокаДублей Из СтрокаОбъектов.Строки цикл
					
					СтрокаДублейРезультата = СтрокаОбъектовРезультата.Строки.Добавить();
					СтрокаДублейРезультата.ВтораяКолонка = "UID объекта";
					СтрокаДублейРезультата.UIDОбъекта = СтрокаДублей.СсылкаВДругойИБ;
					
				КонецЦикла;	
				
			КонецЦикла;	
			
		КонецЦикла;
		
	КонецЦикла;	
	
	Для каждого СтрокаЗаголовка Из АнализСопоставления.ВтораяЧастьЭтаБаза.Строки цикл
		
		СтрокаЗаголовкаРезультата = СтрокаИБ.Строки.Добавить();
		СтрокаЗаголовкаРезультата.ПерваяКолонка = СтрокаЗаголовка.Заголовок;
		СтрокаЗаголовкаРезультата.ВтораяКолонка = "Ссылка в базе-источнике";
		СтрокаЗаголовкаРезультата.КоличествоСопоставлений = "Количество дублей";
		
		Для каждого СтрокаУзлов Из СтрокаЗаголовка.Строки цикл
			
			СтрокаУзловРезультата = СтрокаЗаголовкаРезультата.Строки.Добавить();
			СтрокаУзловРезультата.ПерваяКолонка = СтрокаУзлов.УзелОбмена;
			СтрокаУзловРезультата.КоличествоСопоставлений = СтрокаУзлов.КоличествоСопоставлений;
			
			Для каждого СтрокаОбъектов Из СтрокаУзлов.Строки цикл
				
				СтрокаОбъектовРезультата = СтрокаУзловРезультата.Строки.Добавить();
				СтрокаОбъектовРезультата.ПерваяКолонка = "UID объекта";
				СтрокаОбъектовРезультата.UIDОбъекта    = СтрокаОбъектов.СсылкаВДругойИБ;
				СтрокаОбъектовРезультата.КоличествоСопоставлений    = СтрокаОбъектов.КоличествоСопоставлений;
				
				Для каждого СтрокаДублей Из СтрокаОбъектов.Строки цикл
					
					СтрокаДублейРезультата = СтрокаОбъектовРезультата.Строки.Добавить();
					СтрокаДублейРезультата.ВтораяКолонка = СтрокаДублей.СобственнаяСсылка;
					СтрокаДублейРезультата.КоличествоСопоставлений = СтрокаДублей.КоличествоСопоставлений;
					
				КонецЦикла;	
				
			КонецЦикла;	
			
		КонецЦикла;
		
	КонецЦикла;
	
	Если АнализСопоставления.ПерваяЧастьДругаяБаза.Строки.Количество() > 0  
		ИЛИ АнализСопоставления.ВтораяЧастьДругаяБаза.Строки.Количество() > 0  Тогда
		
		СтрокаИБ = РезультатАнализаСопоставленияОбъектов.Строки.Добавить();
		СтрокаИБ.ПерваяКолонка = "В другой информационной базе";
		
	КонецЕсли;	
	
	Если АнализСопоставления.ПерваяЧастьДругаяБаза.Строки.Количество() > 0 Тогда  
		
		Для каждого СтрокаЗаголовка Из АнализСопоставления.ПерваяЧастьДругаяБаза.Строки цикл
			
			СтрокаЗаголовкаРезультата = СтрокаИБ.Строки.Добавить();
			СтрокаЗаголовкаРезультата.ПерваяКолонка = СтрокаЗаголовка.Заголовок;
			СтрокаЗаголовкаРезультата.ВтораяКолонка = "Ссылка в базе-приемнике";
			СтрокаЗаголовкаРезультата.КоличествоСопоставлений = "Количество дублей";
			
			Для каждого СтрокаУзлов Из СтрокаЗаголовка.Строки цикл
				
				СтрокаУзловРезультата = СтрокаЗаголовкаРезультата.Строки.Добавить();
				СтрокаУзловРезультата.ПерваяКолонка = СтрокаУзлов.УзелОбмена;
				СтрокаУзловРезультата.КоличествоСопоставлений = СтрокаУзлов.КоличествоСопоставлений;
				
				Для каждого СтрокаОбъектов Из СтрокаУзлов.Строки цикл
					
					СтрокаОбъектовРезультата = СтрокаУзловРезультата.Строки.Добавить();
					СтрокаОбъектовРезультата.ПерваяКолонка = "UID объекта";
					СтрокаОбъектовРезультата.UIDОбъекта = СтрокаОбъектов.СобственнаяСсылка;
					СтрокаОбъектовРезультата.КоличествоСопоставлений = СтрокаОбъектов.КоличествоСопоставлений;
					
					Для каждого СтрокаДублей Из СтрокаОбъектов.Строки цикл
						
						СтрокаДублейРезультата = СтрокаОбъектовРезультата.Строки.Добавить();
						СтрокаДублейРезультата.ВтораяКолонка = СтрокаДублей.СсылкаВДругойИБ;
						
					КонецЦикла;	
					
				КонецЦикла;	
				
			КонецЦикла;
			
		КонецЦикла;	
		
	КонецЕсли;
	
	Если АнализСопоставления.ВтораяЧастьДругаяБаза.Строки.Количество() > 0  Тогда
		
		Для каждого СтрокаЗаголовка Из АнализСопоставления.ВтораяЧастьДругаяБаза.Строки цикл
			
			СтрокаЗаголовкаРезультата = СтрокаИБ.Строки.Добавить();
			СтрокаЗаголовкаРезультата.ПерваяКолонка = СтрокаЗаголовка.Заголовок;
			СтрокаЗаголовкаРезультата.ВтораяКолонка = "Ссылка в базе-источнике";
			СтрокаЗаголовкаРезультата.КоличествоСопоставлений = "Количество дублей";
			
			Для каждого СтрокаУзлов Из СтрокаЗаголовка.Строки цикл
				
				СтрокаУзловРезультата = СтрокаЗаголовкаРезультата.Строки.Добавить();
				СтрокаУзловРезультата.ПерваяКолонка = СтрокаУзлов.УзелОбмена;
				СтрокаУзловРезультата.КоличествоСопоставлений = СтрокаУзлов.КоличествоСопоставлений;
				
				Для каждого СтрокаОбъектов Из СтрокаУзлов.Строки цикл
					
					СтрокаОбъектовРезультата = СтрокаУзловРезультата.Строки.Добавить();
					СтрокаОбъектовРезультата.ПерваяКолонка = СтрокаОбъектов.СсылкаВДругойИБ; 
					СтрокаОбъектовРезультата.КоличествоСопоставлений    = СтрокаОбъектов.КоличествоСопоставлений;
					
					Для каждого СтрокаДублей Из СтрокаОбъектов.Строки цикл
						
						СтрокаДублейРезультата = СтрокаОбъектовРезультата.Строки.Добавить();
						СтрокаДублейРезультата.ВтораяКолонка = "UID объекта";
						СтрокаДублейРезультата.UIDОбъекта    = СтрокаДублей.СобственнаяСсылка;
						СтрокаДублейРезультата.КоличествоСопоставлений = СтрокаДублей.КоличествоСопоставлений;
						
					КонецЦикла;	
					
				КонецЦикла;	
				
			КонецЦикла;
			
		КонецЦикла;
		
	КонецЕсли;	
	
КонецПроцедуры	

Процедура РезультатАнализаСопоставленияОбъектовПерваяКолонкаОткрытие(Элемент, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(ЭлементыФормы.РезультатАнализаСопоставленияОбъектов.ТекущаяСтрока.UIDОбъекта) тогда
		
		СтандартнаяОбработка = Ложь;
		СтрокаЗаголовка = "UID Объекта";
		ЗначенияРеквизитов = Новый Соответствие;
		ЗначенияРеквизитов.Вставить(СтрокаЗаголовка,ЭлементыФормы.РезультатАнализаСопоставленияОбъектов.ТекущаяСтрока.UIDОбъекта);
		ОткрытьФормуРеквизитовОбъекта(ЗначенияРеквизитов,СтрокаЗаголовка);
		
	КонецЕсли;
	
КонецПроцедуры

Процедура РезультатАнализаСопоставленияОбъектовВтораяКолонкаОткрытие(Элемент, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(ЭлементыФормы.РезультатАнализаСопоставленияОбъектов.ТекущаяСтрока.UIDОбъекта) тогда
		
		СтандартнаяОбработка = Ложь;
		СтрокаЗаголовка = "UID Объекта";
		ЗначенияРеквизитов = Новый Соответствие;
		ЗначенияРеквизитов.Вставить(СтрокаЗаголовка,ЭлементыФормы.РезультатАнализаСопоставленияОбъектов.ТекущаяСтрока.UIDОбъекта);
		ОткрытьФормуРеквизитовОбъекта(ЗначенияРеквизитов,СтрокаЗаголовка);
		
	КонецЕсли;
	
КонецПроцедуры
//открывает форму реквизитов объекта
//Параметры: 
//РеквизитыОбъекта  - соответствие;
//ЗаголовокФормы    - строка
Процедура ОткрытьФормуРеквизитовОбъекта(РеквизитыОбъекта,СтрокаЗаголовка = "")
	
	ФормаРеквизитовОбъектов = ПолучитьФорму("СписокРеквизитовОбъектаСравнения");
	ФормаРеквизитовОбъектов.Заголовок = СтрокаЗаголовка;
	
	Для каждого РеквизитИЗначение Из РеквизитыОбъекта цикл
		
		НовСтр = ФормаРеквизитовОбъектов.ТаблицаРеквизитовОбъекта.Добавить();	
		НовСтр.Реквизит = РеквизитИЗначение.Ключ;
		НовСтр.ЗначениеРеквизита = РеквизитИЗначение.Значение;
		
	КонецЦикла;	
	
	ФормаРеквизитовОбъектов.ОткрытьМодально();
	
КонецПроцедуры

Процедура КоманднаяПанель1УдалитьНекорректныеЗаписи(Кнопка)
	
	УбратьДублиОбъектовСопоставления(ВыполнитьАнализСопоставленияОбъектов());
	ОбновитьАнализ();
	
КонецПроцедуры
