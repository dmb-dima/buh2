Перем мВалютаРегламентированногоУчета;
Перем мПоказыватьФорму Экспорт;

// Процедура вызывается при нажатии кнопки "Сформировать".
// Формирует документ ОтчетККМ на основе документов ЧекККМ
// и удаляет обработанные документы.
//
Процедура ЗакрытьСмену()
	
	МассивФР = ПолучитьСерверТО().ПолучитьСписокУстройств(Перечисления.ВидыТорговогоОборудования.ФискальныйРегистратор, Неопределено);

	Если МассивФР.Количество() > 0 Тогда
		Пароль    = ПолучитьСерверТО().ПолучитьПарольАдминистратораККМ();
		Результат = Неопределено;
		ФР        = Неопределено;
		Для Каждого ФР Из МассивФР Цикл
			Результат = ПолучитьСерверТО().ОтчетСГашением(ФР, Пароль);
			Если ЗначениеЗаполнено(Результат) Тогда
				ТекстОшибки =ПолучитьСерверТО().ПолучитьТекстОшибкиФРТО(Результат);
				Сообщить(ТекстОшибки, СтатусСообщения.Важное);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;


КонецПроцедуры // КнопкаСформироватьНажатие()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Процедура - обработчик события "ПередОткрытием" формы
//
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)

	Если мПоказыватьФорму <> Неопределено
	   И НЕ мПоказыватьФорму Тогда
		ЗакрытьСмену();
		Отказ = Истина;
	КонецЕсли;

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ДЕЙСТВИЯ ЭЛЕМЕНТОВ ФОРМЫ

// Процедура вызывается при нажатии кнопки "Сформировать".
// Формирует документ ОтчетККМ на основе документов ЧекККМ
// и удаляет обработанные документы.
//
Процедура КнопкаЗакрытьСменуНажатие(Элемент)

	ЗакрытьСмену();

КонецПроцедуры // КнопкаСформироватьНажатие()

Процедура ПриОткрытии()
	
	ПолучитьСерверТО().ПодключитьКлиента(ЭтаФорма);
	
КонецПроцедуры

Процедура ПриЗакрытии()
	
	ПолучитьСерверТО().ОтключитьКлиента(ЭтаФорма);
	
КонецПроцедуры

///////////////////////////////////////////////////////////////////////////////
//// ФУНКЦИИ ВЗАИМОДЕЙСТВИЯ С ТОРГОВЫМ ОБОРУДОВАНИЕМ (ОБЩИЕ ФУНКЦИИ API)

// Функция возвращает признак того, что клиент поддерживает работу с видом ТО,
// переданным в качестве параметра.
//
// Параметры:
//  Вид      - <ПеречислениеСсылка.ВидыТорговогоОборудования>
//           - Вид торгового оборудования, информация о поддержке
//             которого запрашивается.
//
// Возвращаемое значение:
//  <Булево> - Признак поддержки указанного класса торгового оборудования.
//
Функция ПоддерживаетсяВидТО(Вид) Экспорт

	Результат = Ложь;

	Если Вид = Перечисления.ВидыТорговогоОборудования.ФискальныйРегистратор Тогда
		Результат = Истина;
	КонецЕсли;

	Возврат Результат;

КонецФункции // ПоддерживаетсяВидТО()

мВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();
