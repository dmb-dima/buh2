Перем ИменаВременныхФайловВыгрузкиВXML Экспорт;

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ


// Процедура - обработчик события Выбор табличного поля ДокументСписок.
//
Процедура ДокументСписокВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	
	Если Колонка.Имя = "Период" Тогда
		Выбраннаястрока.Ссылка.ПолучитьФорму().Открыть();
	КонецЕсли;
	
КонецПроцедуры

Процедура ТабличноеПолеОснованияПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		ОформлениеСтроки.Ячейки.Основание.УстановитьТекст(РегламентированнаяОтчетность.ПредставлениеДокументаРеглОтч(ОформлениеСтроки.ДанныеСтроки.Основание));
	КонецЦикла;
	
КонецПроцедуры

Процедура ТабличноеПолеОснованияВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	
	ВыбраннаяСтрока.Основание.ПолучитьФорму().Открыть();
	
КонецПроцедуры

Процедура ДокументСписокПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		ОформлениеСтроки.Ячейки.Период.УстановитьТекст(РегламентированнаяОтчетность.ПредставлениеПериодаДокументаВыгрузкаРегламентированныхОтчетов(ОформлениеСтроки.ДанныеСтроки.Ссылка));
	КонецЦикла;
	
КонецПроцедуры

Процедура ДокументСписокПриАктивизацииСтроки(Элемент)
	
	Если Элемент.ТекущиеДанные = Неопределено ИЛИ Элемент.ТекущиеДанные.Выгрузки.Количество() = 0 Тогда
		ЭлементыФормы.ТекстВыгрузки.Значение = "";
		ЭлементыФормы.ПолеXMLДокумента.УстановитьТекст("");
	КонецЕсли;
	
КонецПроцедуры

Процедура ТабличноеПолеВыгрузкиПриАктивизацииСтроки(Элемент)
	
	Если Элемент.ТекущиеДанные = Неопределено Тогда
		ЭлементыФормы.ТекстВыгрузки.Значение = "";
		ЭлементыФормы.ПолеXMLДокумента.УстановитьТекст("");
		ЭлементыФормы.ТекстВыгрузки.Видимость = Истина;
		ЭлементыФормы.ПолеXMLДокумента.Видимость = Ложь;
	Иначе
		Если Элемент.ТекущиеДанные.Тип <> Перечисления.ВерсииФорматовВыгрузки.Версия400 
		   И Элемент.ТекущиеДанные.Тип <> Перечисления.ВерсииФорматовВыгрузки.Версия401алко 
		   И Элемент.ТекущиеДанные.Тип <> Перечисления.ВерсииФорматовВыгрузки.Версия500 Тогда
			ЭлементыФормы.ТекстВыгрузки.Видимость = Истина;
			ЭлементыФормы.ПолеXMLДокумента.Видимость = Ложь;
			ЭлементыФормы.ТекстВыгрузки.Значение = Элемент.ТекущиеДанные.Текст;
		Иначе
			ЭлементыФормы.ТекстВыгрузки.Видимость = Ложь;
			ЭлементыФормы.ПолеXMLДокумента.Видимость = Истина;
			ИмяВременногоФайлаXML = ПолучитьИмяВременногоФайла("xml");
			ЗаписьТекста = Новый ЗаписьТекста(ИмяВременногоФайлаXML, КодировкаТекста.ANSI);
			ЗаписьТекста.Записать(Элемент.ТекущиеДанные.Текст);
			ЗаписьТекста.Закрыть();
			ЭлементыФормы.ПолеXMLДокумента.Перейти(ИмяВременногоФайлаXML);
			ИменаВременныхФайловВыгрузкиВXML.Добавить(ИмяВременногоФайлаXML);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗакрытии()
	
	Состояние("Удаление временных файлов...");
	Для Каждого ИмяВременногоФайлаВыгрузкиВXML Из ИменаВременныхФайловВыгрузкиВXML Цикл
		ОбъектФайл = Новый Файл(ИмяВременногоФайлаВыгрузкиВXML);
		Если ОбъектФайл.Существует() Тогда
			Попытка
				УдалитьФайлы(ИмяВременногоФайлаВыгрузкиВXML);
			Исключение
			КонецПопытки;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

ДокументСписок.Колонки.Добавить("ПериодПо");
ИменаВременныхФайловВыгрузкиВXML = Новый Массив;