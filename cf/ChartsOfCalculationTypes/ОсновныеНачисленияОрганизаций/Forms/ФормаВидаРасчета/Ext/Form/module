////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ
// 
Перем мТабличнаяЧасть;
Перем мСписокКодовЕСН;
Перем мСписокВидовДляОсновныхНачислений;

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Процедура - вызывается при открытии формы
Процедура ПриОткрытии()
	
	// инициализируем списки выбора

	мСписокВидовДляОсновныхНачислений = Новый СписокЗначений;
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.НеОблагаетсяЦеликом);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.НеЯвляетсяОбъектом);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.ОблагаетсяЦеликом);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.ПособияЗаСчетФСС);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.Матпомощь);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.МатпомощьПриРожденииРебенка);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.ДоговорыГПХ);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеАудиовизуальныеПроизведения);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеГрафическиеПроизведения);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеДругиеМузыкальныеПроизведения);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеИсполнениеПроизведений);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеЛитературныеПроизведения);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеМузыкальноСценическиеПроизведение);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеНаучныеТруды);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеОткрытия);
	мСписокВидовДляОсновныхНачислений.Добавить(Справочники.ДоходыПоСтраховымВзносам.АвторскиеСкульптуры);

	// Доступные способы отражения в учете ЕСН (те способы, по которым не может быть месячной или годовой скидки)
	мСписокКодовЕСН = Новый СписокЗначений;
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.ВыплатыЗаСчетПрибыли);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.ДоговораАвторские);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.ДоговораГПХ);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.ПособияЗаСчетФСС);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.НеОблагаетсяЦеликом);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.НеЯвляетсяОбъектом);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.ОблагаетсяЦеликом);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.РаспределятьПоБазовымНачислениям);
	// в конфигурации БП в этот список должны попасть и остальные коды доходов ЕСН (т.к. нет дополнительных начислений)
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.Матпомощь);
	мСписокКодовЕСН.Добавить(Справочники.ДоходыЕСН.МатпомощьПриРожденииРебенка);
	
	
	Если ЭтоНовый() Тогда
		
		// Инициализация реквизитов для нового объекта
		Если НЕ ЗначениеЗаполнено(КодДоходаНДФЛ) Тогда
			КодДоходаНДФЛ				= Справочники.ДоходыНДФЛ.КодДоходаПоУмолчанию;
		КонецЕсли;
		Если НЕ ЗначениеЗаполнено(КодДоходаЕСН) Тогда
			КодДоходаЕСН				= Справочники.ДоходыЕСН.ОблагаетсяЦеликом;
		КонецЕсли;
		Если НЕ ЗначениеЗаполнено(КодДоходаФСС_НС) Тогда
			КодДоходаФСС_НС				= Перечисления.ДоходыФСС_НС.Облагается;
		КонецЕсли;
		Если НЕ ЗначениеЗаполнено(СпособОтраженияВБухучете) Тогда
			СпособОтраженияВБухучете	= Справочники.СпособыОтраженияЗарплатыВРеглУчете.ОтражениеНачисленийПоУмолчанию;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события записи вида расчета
Процедура ПриЗаписи(Отказ)

	// Проверка правильности настройки вида расчета
	РезультатПроверки = ПроведениеРасчетов.ПроверитьНастройкуВидаРасчета(ЭтотОбъект, Отказ);
	Если Не Отказ Тогда
		Если Не ПустаяСтрока(РезультатПроверки) Тогда
			Ответ = Вопрос(РезультатПроверки + " Записать вид расчета?", РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Нет);
			// отказались от записи
			Отказ = Ответ <> КодВозвратаДиалога.Да;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

Процедура КодДоходаЕСННачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ЭлементСписка = ВыбратьИзСписка(мСписокКодовЕСН,Элемент,мСписокКодовЕСН.НайтиПоЗначению(Элемент.Значение));
	Если ЭлементСписка <> Неопределено Тогда
		Элемент.Значение = ЭлементСписка.Значение
	КонецЕсли;
КонецПроцедуры


Процедура КодДоходаСтраховыеВзносыНачалоВыбора(Элемент, СтандартнаяОбработка)
		
	СтандартнаяОбработка = Ложь;
	
	ФормаВыбора = Справочники.ДоходыПоСтраховымВзносам.ПолучитьФормуВыбора("ФормаВыбора", Элемент, "дляДокументаРасчетСтраховыхВзносов");
	ФормаВыбора.НачальноеЗначениеВыбора = Элемент.Значение;
	ФормаВыбора.Отбор.Ссылка.ВидСравнения = ВидСравнения.ВСписке;
	ФормаВыбора.Отбор.Ссылка.Значение = мСписокВидовДляОсновныхНачислений;
	ФормаВыбора.Отбор.Ссылка.Использование = Истина;
	ФормаВыбора.Открыть();

КонецПроцедуры

