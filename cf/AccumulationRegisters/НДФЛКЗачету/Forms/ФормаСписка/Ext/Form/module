// Процедура прописывает заголовок формы 
//
// Параметры:
//  Элемент - элемент формы, который отображает организацию
//  
Процедура ОрганизацияПриИзменении(Элемент)

	Заголовок = "НДФЛ к зачету по работникам организации " + Элемент.Значение.Наименование;
	Отбор.Организация.Использование = Не Элемент.Значение.Пустая();

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Если форма открывается из списка документов, процедура заполняет организацию 
// прописывает заголовок формы и выставляет отбор регистру
//
Процедура ПриОткрытии()

	Если ЗначениеЗаполнено(ПараметрОтборПоРегистратору) Тогда
		
		МетаданныеДокумента = ПараметрОтборПоРегистратору.Метаданные();
		
		Если МетаданныеДокумента.Реквизиты.Найти("Организация") <> Неопределено Тогда
			
			// Движения всегда записываются на головную организацию
			Если Не ЗначениеЗаполнено(ПараметрОтборПоРегистратору.Организация.ГоловнаяОрганизация) Тогда
				Отбор.Организация.Значение = ПараметрОтборПоРегистратору.Организация;
			Иначе
				Отбор.Организация.Значение = ПараметрОтборПоРегистратору.Организация.ГоловнаяОрганизация;	
			КонецЕсли; 

			ЭлементыФормы.Организация.ТолькоПросмотр = Истина
			
		КонецЕсли;

		Отбор.Организация.Использование = Истина;
		
	Иначе
		
		ОрганизацияПоУмолчанию = глЗначениеПеременной("ОсновнаяОрганизация");
		// Движения всегда записываются на головную организацию
		Если Не ЗначениеЗаполнено(ОрганизацияПоУмолчанию.ГоловнаяОрганизация) Тогда
			Отбор.Организация.Значение = ОрганизацияПоУмолчанию;
		Иначе
			Отбор.Организация.Значение = ОрганизацияПоУмолчанию.ГоловнаяОрганизация;	
		КонецЕсли; 
		
		Отбор.Организация.Использование = Не Отбор.Организация.Значение.Пустая();

	КонецЕсли;
	
	Заголовок = "НДФЛ к зачету по работникам организации " + Отбор.Организация.Значение.Наименование;

КонецПроцедуры

Процедура ПриПовторномОткрытии(СтандартнаяОбработка)

	Если ЗначениеЗаполнено(ПараметрОтборПоРегистратору) Тогда
		
		МетаданныеДокумента = ПараметрОтборПоРегистратору.Метаданные();
		
		Если МетаданныеДокумента.Реквизиты.Найти("Организация") <> Неопределено Тогда
			
			// Движения всегда записываются на головную организацию
			Если Не ЗначениеЗаполнено(ПараметрОтборПоРегистратору.Организация.ГоловнаяОрганизация) Тогда
				Отбор.Организация.Значение = ПараметрОтборПоРегистратору.Организация;
			Иначе
				Отбор.Организация.Значение = ПараметрОтборПоРегистратору.Организация.ГоловнаяОрганизация;	
			КонецЕсли; 
			Заголовок = "НДФЛ к зачету по работникам организации " + Отбор.Организация.Значение.Наименование;
			ЭлементыФормы.Организация.ТолькоПросмотр = Истина;
			Возврат
			
		КонецЕсли;
		
	КонецЕсли;

	ОрганизацияПоУмолчанию = глЗначениеПеременной("ОсновнаяОрганизация");
	// Движения всегда записываются на головную организацию
	Если Не ЗначениеЗаполнено(ОрганизацияПоУмолчанию.ГоловнаяОрганизация) Тогда
		Отбор.Организация.Значение = ОрганизацияПоУмолчанию;
	Иначе
		Отбор.Организация.Значение = ОрганизацияПоУмолчанию.ГоловнаяОрганизация;	
	КонецЕсли; 
	
	Отбор.Организация.Использование = Не Отбор.Организация.Значение.Пустая();
	Заголовок = "НДФЛ к зачету по работникам организации " + Отбор.Организация.Значение.Наименование;
	ЭлементыФормы.Организация.ТолькоПросмотр = Ложь;

КонецПроцедуры

