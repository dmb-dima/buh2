// Процедура прописывает заголовок формы 
//
// Параметры:
//  Элемент - элемент формы, который отображает организацию
//  
Процедура ОрганизацияПриИзменении(Элемент)

	Отбор.ОбособленноеПодразделение.Использование = Не Отбор.ОбособленноеПодразделение.Значение.Пустая();
	УстановитьЗаголовок();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Если форма открывается из списка документов, процедура заполняет организацию 
// прописывает заголовок формы и выставляет отбор регистру
//
Процедура ПриОткрытии()

	УстановитьОрганизацию();
	УстановитьЗаголовок();

	// Проверка однофирменности
	РаботаСДиалогами.УстановитьОтборПоОрганизации(ЭтаФорма,, глЗначениеПеременной("ОсновнаяОрганизация"), "РегистрНакопленияСписок");

КонецПроцедуры

Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "ИзменениеТекущейОрганизации" Тогда
		РаботаСДиалогами.УстановитьОтборПоОрганизации(ЭтаФорма,, глЗначениеПеременной("ОсновнаяОрганизация"), "РегистрНакопленияСписок", Истина);
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриПовторномОткрытии(СтандартнаяОбработка)
	
	УстановитьОрганизацию();
	УстановитьЗаголовок();
	
КонецПроцедуры

Процедура УстановитьЗаголовок()
	Заголовок = Метаданные.РегистрыНакопления.ЕСНСведенияОДоходах.Синоним + ?(Отбор.Организация.Использование, "(" + Отбор.Организация.Значение + ")","");
КонецПроцедуры


Процедура УстановитьОрганизацию()
	Если ЗначениеЗаполнено(ПараметрОтборПоРегистратору) Тогда
		
        МетаданныеДокумента = ПараметрОтборПоРегистратору.Метаданные();
		
		Если МетаданныеДокумента.Реквизиты.Найти("Организация") <> Неопределено Тогда
			
			Отбор.ОбособленноеПодразделение.Значение = ПараметрОтборПоРегистратору.Организация;
	    	Отбор.ОбособленноеПодразделение.Использование = Не Отбор.ОбособленноеПодразделение.Значение.Пустая();
			
		КонецЕсли;
		
	Иначе
		Отбор.ОбособленноеПодразделение.Значение = глЗначениеПеременной("ОсновнаяОрганизация");
	    Отбор.ОбособленноеПодразделение.Использование = Не Отбор.ОбособленноеПодразделение.Значение.Пустая();

	КонецЕсли;
	
КонецПроцедуры
