Процедура УстановитьДоступностьСостава()

	Если Ссылка.Пустая() Тогда
		СписокГруппы.Отбор.Код.Установить("");

	Иначе
		СписокГруппы.Отбор.Сбросить();
		СписокГруппы.Отбор.НоменклатурнаяГруппа.Установить(Ссылка);

	КонецЕсли;

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ ОБРАБОТКИ СВОЙСТВ И КАТЕГОРИЙ

// Процедура выполняет открытие формы работы со свойствами документа
//
Процедура ДействияФормыДействиеОткрытьСвойства(Кнопка)

	РаботаСДиалогами.ОткрытьСвойстваДокумента(ЭтотОбъект, ЭтаФорма);

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Обработчик события ПриОткрытии формы.
//
Процедура ПриОткрытии()

	УстановитьДоступностьСостава();
	
	МеханизмНумерацииОбъектов.ДобавитьВМенюДействияКнопкуРедактированияКода(ЭлементыФормы.ДействияФормы.Кнопки.Подменю);
	МеханизмНумерацииОбъектов.УстановитьДоступностьПоляВводаНомера(Метаданные(), ЭтаФорма, ЭлементыФормы.ДействияФормы.Кнопки.Подменю,ЭлементыФормы.Код);
	
	РаботаСДиалогами.ИзменитьПредставлениеКнопкиВыбораСвойств(ЭтаФорма, РаботаСДиалогами.ПолучитьОписаниеЗначенийСвойствОбъекта(Ссылка));
	
КонецПроцедуры

// Процедура - обработчик события "ОбработкаОповещения" формы.
//
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "ОбновлениеЗначенийСвойств" И Источник = Ссылка Тогда
		РаботаСДиалогами.ИзменитьПредставлениеКнопкиВыбораСвойств(ЭтаФорма, Параметр);
	КонецЕсли;
	
КонецПроцедуры

// Обработчик события ПослеЗаписи формы.
//
Процедура ПослеЗаписи()

	УстановитьДоступностьСостава();

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ РАБОТЫ СО СПИСКОМ ГРУППЫ

Процедура СписокГруппыПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, ЭтоГруппа)

	Перем ВыбЭлемент;

	Отказ = Истина;

	Если Копирование Тогда
		Предупреждение("Ввод новой записи копированием запрещен!");
		Возврат;
	КонецЕсли;

	Если ЭтоНовый() Тогда

		Ответ = Вопрос("Элемент еще не записан. Записать?", РежимДиалогаВопрос.ОКОтмена);

		Если Ответ = КодВозвратаДиалога.ОК Тогда
			Если Не ЗаписатьВФорме() Тогда
				Возврат;
			КонецЕсли;
		Иначе
			Возврат;
		КонецЕсли;

	КонецЕсли;

	Если ВвестиЗначение(ВыбЭлемент,,Тип("СправочникСсылка.Номенклатура")) Тогда

		ОбъектНоменклатуры = ВыбЭлемент.ПолучитьОбъект();

		Если ОбъектНоменклатуры.ЭтоГруппа Тогда
			Предупреждение("В состав номенклатурной группы могут включаться только элементы номенклатуры!");
		Иначе
			Если ЗначениеЗаполнено(ОбъектНоменклатуры.НоменклатурнаяГруппа) Тогда
				Если Вопрос("Выбранная номенклатура " + ВыбЭлемент + " уже входит в группу " + 
					        ОбъектНоменклатуры.НоменклатурнаяГруппа+". Включить ее текущую номенклатурную группу?",
					        РежимДиалогаВопрос.ОКОтмена) = КодВозвратаДиалога.Отмена Тогда
					Возврат;
				КонецЕсли;
			КонецЕсли;

			ОбъектНоменклатуры.НоменклатурнаяГруппа = Ссылка;
			ОбъектНоменклатуры.Записать();
			СписокГруппы.Обновить();

		КонецЕсли;

	КонецЕсли;

КонецПроцедуры

Процедура СписокГруппыПриНачалеРедактирования(Элемент, НоваяСтрока)

	Если НоваяСтрока Тогда
		Элемент.ТекущиеДанные.Вес = 1;
		Элемент.ТекущиеДанные.НоменклатурнаяГруппа = Ссылка;
	КонецЕсли;

КонецПроцедуры

Процедура СписокГруппыВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;

	ФормаЭлемента = ВыбраннаяСтрока.ПолучитьФорму("ФормаЭлемента", ЭтаФорма, ВыбраннаяСтрока);
	ФормаЭлемента.Открыть();

КонецПроцедуры

// Процедура разрешения/запрещения редактирования номера документа
Процедура ДействияФормыРедактироватьКод(Кнопка)
	
	МеханизмНумерацииОбъектов.ИзменениеВозможностиРедактированияНомера(ЭтотОбъект.Метаданные(), ЭтаФорма, ЭлементыФормы.ДействияФормы.Кнопки.Подменю, ЭлементыФормы.Код);
			
КонецПроцедуры



Процедура СписокГруппыПередУстановкойПометкиУдаления(Элемент, Отказ)
	
	Отказ = Истина;
	
	ОбъектНоменклатуры = Элемент.ТекущиеДанные.Ссылка.ПолучитьОбъект();
	ОбъектНоменклатуры.НоменклатурнаяГруппа = Справочники.Номенклатура.ПустаяСсылка();
	ОбъектНоменклатуры.Записать();
	
	СписокГруппы.Обновить();

КонецПроцедуры


