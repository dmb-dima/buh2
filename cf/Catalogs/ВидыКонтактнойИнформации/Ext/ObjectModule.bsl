Процедура ПередЗаписью(Отказ)

	Если ЭтоНовый() Тогда
		Порядок = 0;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ВидОбъектаКонтактнойИнформации) И Не Отказ И Порядок = 0 Тогда
		УстановитьПорядок();
	КонецЕсли;

КонецПроцедуры

Процедура ПриЗаписи(Отказ)

	Если (НЕ ОбменДанными.Загрузка) И (НЕ ЗначениеЗаполнено(ВидОбъектаКонтактнойИнформации) ИЛИ НЕ ЗначениеЗаполнено(Тип)) Тогда
		#Если Клиент Тогда
			Предупреждение("Укажите вид и тип объекта контактной информации.");
		#КонецЕсли
		
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

Процедура УстановитьПорядок()

	ТЗ = "ВЫБРАТЬ
	|	МАКСИМУМ(ВидыКонтактнойИнформации.Порядок) КАК Порядок
	|ИЗ
	|	Справочник.ВидыКонтактнойИнформации КАК ВидыКонтактнойИнформации
	|ГДЕ
	|	ВидыКонтактнойИнформации.ВидОбъектаКонтактнойИнформации = &ВидОбъектаКонтактнойИнформации";
		
	Запрос = Новый Запрос;
	Запрос.Текст = ТЗ;
	Запрос.УстановитьПараметр("ВидОбъектаКонтактнойИнформации", ВидОбъектаКонтактнойИнформации);
	Выборка = Запрос.Выполнить().Выбрать();
		
	Порядок = ?(Выборка.Следующий() И Выборка.Порядок <> Null, Выборка.Порядок+1, 1);

КонецПроцедуры

